# Webhook 快速开始

## 一、准入控制器(Admission Controller)概念

### 1. 介绍

#### 1.1 概念

**准入控制器** 是一段代码，它会在请求通过**认证**和**鉴权**之后、对象被持久化之前拦截到达 API 服务器的请求。

- 用户/Pod -> 认证 -> 鉴权 -> 准入控制 -> 资源持久化（即部署）

#### 1.2 分类

准入控制器可以执行 **变更（Mutating）** 和或 **验证（Validating）** 操作。

- 变更（mutating）控制器可以根据被其接受的请求更改相关对象；验证（validating）控制器则不行。

- Kubernetes 1.30 中的准入控制器由（参数）列表组成， 并编译进 `kube-apiserver` 可执行文件，并且只能由集群管理员配置。 在该（参数）列表中，有两个特殊的控制器：
  
  - **MutatingAdmissionWebhook** 根据 API 中的配置执行变更准入控制 Webhook
  
  - **ValidatingAdmissionWebhook** 根据 API 中的配置执行验证准入控制 Webhook

#### 1.3 功能

- 准入控制器可以限制创建、删除、修改对象的请求。 

- 准入控制器也可以阻止自定义动作，例如通过 API 服务器代理连接到 Pod 的请求。 

- 准入控制器**不会** （也不能）阻止读取（**get**、**watch** 或 **list**）对象的请求。

- 某些控制器既是变更准入控制器又是验证准入控制器。如果两个阶段之一的任何一个控制器拒绝了某请求，则整个请求将立即被拒绝，并向最终用户返回错误

#### 1.4 准入控制阶段

准入控制过程分为两个阶段。
- 第一阶段，运行变更准入控制器。
- 第二阶段，运行验证准入控制器。 再次提醒，某些控制器既是变更准入控制器又是验证准入控制器。

如果两个阶段之一的任何一个控制器拒绝了某请求，则整个请求将立即被拒绝，并向最终用户返回错误。

最后，除了对对象进行变更外，准入控制器还可能有其它副作用：将相关资源作为请求处理的一部分进行变更。 增加配额用量就是一个典型的示例，说明了这样做的必要性。 此类用法都需要相应的回收或回调过程，因为任一准入控制器都无法确定某个请求能否通过所有其它准入控制器。

# 
