<!DOCTYPE html>
<!-- saved from url=(0051)https://cloud.tencent.com/developer/article/2197170 -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><style class="vjs-styles-defaults">
      .video-js {
        width: 300px;
        height: 150px;
      }

      .vjs-fluid {
        padding-top: 56.25%
      }
    </style><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><title>Kubernetes 1.8.x 全手动安装教程 - 腾讯云开发者社区-腾讯云</title><meta name="keywords" content="网络安全,JSON,etcd,TCP/IP,数据分析"><meta name="subject" content="网络技术-网络安全,前端开发-JSON,开发技术-etcd,网络技术-TCP/IP,大数据技术-数据分析"><meta name="subject-time" content="2022-12-21 06:30:39"><meta name="description" content="Kubernetes 提供了许多云端平台与操作系统的安装方式，本章将以全手动安装方式来部署，主要是学习与了解 Kubernetes 创建流程。若想要了解更多平台..."><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, viewport-fit=cover"><meta name="format-detection" content="telephone=no"><link rel="canonical" href="https://cloud.tencent.com/developer/article/2197170"><link rel="stylesheet" href="./Kubernetes 1.8.x 全手动安装教程 - 腾讯云开发者社区-腾讯云_files/global-20209142343.css"><link rel="stylesheet" href="./Kubernetes 1.8.x 全手动安装教程 - 腾讯云开发者社区-腾讯云_files/base-202302011602.css"><link rel="stylesheet" href="./Kubernetes 1.8.x 全手动安装教程 - 腾讯云开发者社区-腾讯云_files/Result-202211241518.css"><link rel="stylesheet" href="./Kubernetes 1.8.x 全手动安装教程 - 腾讯云开发者社区-腾讯云_files/base-202301151105.css"><link rel="stylesheet" href="./Kubernetes 1.8.x 全手动安装教程 - 腾讯云开发者社区-腾讯云_files/AskDialog-202204021635.css"><link rel="stylesheet" href="./Kubernetes 1.8.x 全手动安装教程 - 腾讯云开发者社区-腾讯云_files/base-202301051514.css"><link rel="stylesheet" href="./Kubernetes 1.8.x 全手动安装教程 - 腾讯云开发者社区-腾讯云_files/base-202302011602.css"><link rel="stylesheet" href="./Kubernetes 1.8.x 全手动安装教程 - 腾讯云开发者社区-腾讯云_files/Column-202212021450.css"><link rel="stylesheet" href="./Kubernetes 1.8.x 全手动安装教程 - 腾讯云开发者社区-腾讯云_files/Packs-202210112017.css"><link rel="stylesheet" href="./Kubernetes 1.8.x 全手动安装教程 - 腾讯云开发者社区-腾讯云_files/markdown-201810241044.css"><link rel="stylesheet" href="./Kubernetes 1.8.x 全手动安装教程 - 腾讯云开发者社区-腾讯云_files/draft-master-v1.4.76.d4s2ddo9sb.css"><style media="screen">@supports (padding:max(0px)){.set-safe-area .com-main{bottom:calc(max(12px,constant(safe-area-inset-bottom)) + 50px);bottom:calc(max(12px,env(safe-area-inset-bottom)) + 50px)}.set-safe-area .com-main-simple-sec,.set-safe-area .com-main.without-tab-ft,.set-safe-area .com-main.without-ft{bottom:max(12px,constant(safe-area-inset-bottom));bottom:max(12px,env(safe-area-inset-bottom))}.set-safe-area .com-main-sec{bottom:max(12px,constant(safe-area-inset-bottom));bottom:max(12px,env(safe-area-inset-bottom))}.set-safe-area .com-m-footer,.set-safe-area .sa-fixed-btns{bottom:max(12px,constant(safe-area-inset-bottom));bottom:max(12px,env(safe-area-inset-bottom))}.set-safe-area .com-mobile-body{bottom:max(12px,constant(safe-area-inset-bottom));bottom:max(12px,env(safe-area-inset-bottom))}}@supports (padding:max(0px)){.set-safe-area .support-wrap,.set-safe-area div.body{bottom:max(12px,constant(safe-area-inset-bottom));bottom:max(12px,env(safe-area-inset-bottom))}.set-safe-area .com-responsive-no-ft div.body{bottom:max(12px,constant(safe-area-inset-bottom));bottom:max(12px,env(safe-area-inset-bottom))}}.doc-con .J-docShareModal{display: none;} .doc-con .J-docShareCopyTipModalMB{display: none}</style><style id="menu">.pg-2-article .com-nav-bar::-webkit-scrollbar {
              display: none; /* Chrome Safari */
            }
            .pg-2-article .com-nav-bar {
              scrollbar-width: none; /* firefox */
              -ms-overflow-style: none; /* IE 10+ */
              overflow-y: auto;
            }</style><script async="" src="./Kubernetes 1.8.x 全手动安装教程 - 腾讯云开发者社区-腾讯云_files/gtm.js.下载"></script><script async="" src="./Kubernetes 1.8.x 全手动安装教程 - 腾讯云开发者社区-腾讯云_files/analytics.js.下载"></script><script src="./Kubernetes 1.8.x 全手动安装教程 - 腾讯云开发者社区-腾讯云_files/aegis.min.js.下载"></script><script id="aegis">
					
					if (Aegis) {
						var aegis = new Aegis({
							id: 'dWlmyFvjDnalkbZO8q',
							env: 'production',
							onError: true,
							pagePerformance: true,
							reportAssetSpeed: true,
							api: {
								reportRequest: true,
								resHeaders: ['x-req-id'],
							},
							reportApiSpeed: {
								urlHandler(url, payload) {
									// 处理action
									if(payload) {
										var data = {};
										try{
											data = JSON.parse(payload);
										}catch(err){}
										if(data.action ) {
											var urls = url.split('?');
											return urls[0]+'/'+ data.action;
										}
									}
									return url;
								}
							},
							beforeRequest: function (data) {
								// load js failed
								if (data.logType === 'log') {
									if (data.logs.level === '32' && data.logs.msg.indexOf('google') > -1) return false;
								}
								var ignoreKeys = ['Script error', 'chrome-extension', 'qq.com', 'queryWeappQrcodeStatus', 'login/ajax/info', 'woa.com', 'trafficCollect.php', 'google', 'dscache', 'act-api', 'set_qc_cookie', 'opc.cloud.tencent.com', 'uc_gre_ad_buss', 'eb.xcj.pub', 'UCShellJava','/developer/labs/quick/loader','edgeImmersiveReaderDOM'];
								var alarmMsg = [data.logs.url, data.logs.msg].join('|');
								for (var i=0; i<ignoreKeys.length; i++) {
									if (alarmMsg.indexOf(ignoreKeys[i]) != -1) return false;
								}

								if (/bot|wechatdevtools|spider/i.test(navigator.userAgent)) {
									return false;
								}
							},
						});
					}
					</script><style id="dynamic-inserted-css-ask-pop-menu">
	.ask-pop-menu .com-correction-bubble {
		box-shadow: none;
		border: none;
		position: inherit;
    padding: 0;
	}
	.ask-pop-menu .com-correction-bubble::before {
		border:none;
	}
	</style><style id="dynamic-inserted-css-view-image">
.zoom-mask {
	position:fixed;
	left:0;
	right:0;
	bottom:0;
	top:0;
	background-color:rgba(0,0,0,.8);
	z-index:100
}
.zoom-close{
	position:absolute;
	right:12px;
	top:12px;
	cursor:pointer;
  width: 25px;
  height: 25px;
  font-size:0;
  background-image: url('https://cloudcache.tencent-cloud.cn/qcloud/ui/community-pc/build/base/images/dialog-close_fb6.svg');
  background-size: 100% auto;
}
.zoom-close:hover {
	background-image:url('https://cloudcache.tencent-cloud.cn/qcloud/ui/community-pc/build/base/images/dialog-close-blue_2e8.svg');
}
.zoom-wrap {
	overflow:auto;
	position:absolute;
	left:50%;
	top:50%;
	-webkit-transform:translate(-50%,-50%);
	transform:translate(-50%,-50%);
	text-align:center
}
.zoom-wrap>img {
	display:inline
}
.zoom-wrap .zoom-in {
	cursor:zoom-in
}
.zoom-wrap .zoom-out {
	cursor:zoom-out
}
.zoom-wrap::-webkit-scrollbar-thumb {
	background-color:#fff;
	border-radius:6px
}
.zoom-wrap::-webkit-scrollbar {
	width:5px;
	height:12px;
	background-color:#666
}
.zoom-wrap::-webkit-scrollbar-track {
	background-color:#666
}
@media only screen and (max-width:768px) {
	.zoom-wrap {
    width:96%;
    height:auto;
    background-color:transparent
  }
  .zoom-wrap .zoom-in {
    width:100%
  }
}
</style><style id="dynamic-inserted-css-avatar-upload-loading">
.com-user-avatar .uploading {
	width: 100%;
	height: 100%;
	top: 0;
	left: 0;
	position: absolute;
	opacity: 0;
	background-size: cover;
	background-position: center;
	border-radius: 100%;
	transition: opacity 2s ease;
}
.com-user-avatar .uploading.spin {
	top: -2px;
	left: -2px;
	border: 2px solid #056ce5;
	border-left-color: transparent;
	animation: upload-rotate 4s linear infinite;
}
.com-user-avatar .uploading.active {
	transition: opacity 0.6s ease;
	opacity: 1;
}
.com-user-avatar .uploading.active.holder {
	opacity: 0.6;
}
@keyframes upload-rotate {
	from { transform: rotateZ(0) }
	to { transform: rotateZ(360deg) }
}
</style><style id="dynamic-inserted-css-transition-slide391298858">
.transition-slide391298858-enter {
	opacity: 0 !important;
	transform: translate3d(0px, -44px, 0);
}
.transition-slide391298858-enter-active {
	opacity: 1 !important;
	transform: translate3d(0, 0, 0);
	transition: opacity 300ms ease, transform 300ms ease;
}
.transition-slide391298858-leave {
	opacity: 1 !important;
	transform: translate3d(0, 0, 0);
}
.transition-slide391298858-leave-active {
	opacity: 0 !important;
	transform: translate3d(0px, -44px, 0);
	transition: opacity 300ms ease, transform 300ms ease;
}
</style><style id="dynamic-inserted-css-transition-fade-312660078">
.transition-fade-312660078-enter {
	opacity: 0 !important;
}
.transition-fade-312660078-enter-active {
	opacity: 0.7 !important;
	transition: opacity 300ms ease;
}
.transition-fade-312660078-leave {
	opacity: 0.7 !important;
}
.transition-fade-312660078-leave-active {
	opacity: 0 !important;
	transition: opacity 300.0001ms ease;
}
</style><style id="dynamic-inserted-css-transition-slide-1496561436">
.transition-slide-1496561436-enter {
	opacity: 0 !important;
	transform: translate3d(0px, -30px, 0);
}
.transition-slide-1496561436-enter-active {
	opacity: 1 !important;
	transform: translate3d(0, 0, 0);
	transition: opacity 300ms ease, transform 300ms ease;
}
.transition-slide-1496561436-leave {
	opacity: 1 !important;
	transform: translate3d(0, 0, 0);
}
.transition-slide-1496561436-leave-active {
	opacity: 0 !important;
	transform: translate3d(0px, -30px, 0);
	transition: opacity 300ms ease, transform 300ms ease;
}
</style><style id="dynamic-inserted-css-article-sharing!.extra-cnt">.extra-cnt .com-share-options .qr-img img {
					width: 130px;
					height: 130px;
				}</style><script type="text/javascript" async="" src="./Kubernetes 1.8.x 全手动安装教程 - 腾讯云开发者社区-腾讯云_files/MathJax.js.下载"></script><style type="text/css">.MathJax_Preview {color: #888}
#MathJax_Message {position: fixed; left: 1em; bottom: 1.5em; background-color: #E6E6E6; border: 1px solid #959595; margin: 0px; padding: 2px 8px; z-index: 102; color: black; font-size: 80%; width: auto; white-space: nowrap}
#MathJax_MSIE_Frame {position: absolute; top: 0; left: 0; width: 0px; z-index: 101; border: 0px; margin: 0px; padding: 0px}
.MathJax_Error {color: #CC0000; font-style: italic}
</style><meta http-equiv="origin-trial" content="A751Xsk4ZW3DVQ8WZng2Dk5s3YzAyqncTzgv+VaE6wavgTY0QHkDvUTET1o7HanhuJO8lgv1Vvc88Ij78W1FIAAAAAB7eyJvcmlnaW4iOiJodHRwczovL3d3dy5nb29nbGV0YWdtYW5hZ2VyLmNvbTo0NDMiLCJmZWF0dXJlIjoiUHJpdmFjeVNhbmRib3hBZHNBUElzIiwiZXhwaXJ5IjoxNjgwNjUyNzk5LCJpc1RoaXJkUGFydHkiOnRydWV9"><script type="text/javascript" async="" src="./Kubernetes 1.8.x 全手动安装教程 - 腾讯云开发者社区-腾讯云_files/f.txt"></script><script type="text/javascript" async="" src="./Kubernetes 1.8.x 全手动安装教程 - 腾讯云开发者社区-腾讯云_files/f(1).txt"></script></head><body class="bg-color" style="position:initial"><div id="MathJax_Message" style="display: none;"></div><div id="react-root"><div class="col-2-article-page"><div class="cdc-header cdc-header--block"><div class="cdc-header__top"><a href="https://cloud.tencent.com/" class="cdc-header__top-logo"><i>腾讯云</i></a><div class="cdc-header__top-operates"><a href="https://cloud.tencent.com/product/ba" class="cdc-header__link">备案</a><a href="https://console.cloud.tencent.com/" class="cdc-header__link">控制台</a></div></div><div class="cdc-header__bottom"><a href="https://cloud.tencent.com/developer" class="cdc-header__bottom-logo"><i>开发者社区</i></a><div class="cdc-header__bottom-nav"><div class="cdc-header__nav-list"><div class="cdc-header__nav-item">学习</div><div class="cdc-header__nav-item">实践</div><div class="cdc-header__nav-item">活动</div><div class="cdc-header__nav-item">专区</div><div class="cdc-header__nav-item">工具</div></div><a href="https://cloud.tencent.com/tvp?from=19173" class="cdc-header__tvp">TVP</a></div><div class="cdc-header__bottom-operates"><div class="cdc-header__search"><div class="cdc-search__wrap"><div class="cdc-search"><span class="cdc-search__text">文章/答案/技术大牛</span><button class="cdc-search__btn">搜索<i class="cdc-search__i search"></i></button></div><div class="cdc-search__dropdown"><div class="cdc-search__bar"><input type="text" class="cdc-search__bar-input" placeholder="文章/答案/技术大牛" value=""><div class="cdc-search__bar-btns"><button class="cdc-search__btn">搜索<i class="cdc-search__i search"></i></button><button class="cdc-search__btn">关闭<i class="cdc-search__i clear"></i></button></div></div></div></div></div><div class="cdc-header__create"><span class="cdc-header__create-btn">写文章</span></div><div class="cdc-header__ask"><button class="cdc-btn size-s cdc-header__ask-btn cdc-btn--hole">提问</button></div><div class="cdc-header__account"><div class="cdc-header__account-inner"><button class="cdc-btn cdc-header__account-btn cdc-btn--primary">登录/注册</button></div></div></div></div></div><div class="com-sticky-header col-2-sticky-header" style="left: 0px;"><div class="com-inner"><div class="com-sticky-header-main"><div class="com-media author-media"><div class="com-media-object"><a href="https://cloud.tencent.com/developer/user/1220175" class="author-media-avatar" style="background-image:url(https://ask.qcloudimg.com/avatar/1220175/3yhsgao20a.png?imageView2/2/w/80)"></a></div><div class="com-media-body"><h3 class="author-media-name" title="菲宇"><a href="https://cloud.tencent.com/developer/user/1220175" class="author-media-name-inner">菲宇</a></h3><a href="https://cloud.tencent.com/developer/column/77743" class="com-arrow-link author-media-link gray">741<!-- --> 篇文章</a></div></div><span class="header-split"></span><h3 class="header-title" title="Kubernetes 1.8.x 全手动安装教程">Kubernetes 1.8.x 全手动安装教程</h3></div><div class="com-sticky-header-extra"><button type="button" class="l c-btn"><span class="text">转到我的清单</span></button></div></div></div><div class="J-body col-body pg-2-article"><div class="com-crumb theme2 no-pd"><div class="com-inner"><a href="https://cloud.tencent.com/developer/column" class="crumb-item" hotrep="community.column.article2.crumb.0">专栏首页</a><span class="crumb-split"></span><a href="https://cloud.tencent.com/developer/column/77743" class="crumb-item" hotrep="community.column.article2.crumb.2" title="菲宇">菲宇</a><span class="crumb-split"></span><span class="crumb-item current" title="Kubernetes 1.8.x 全手动安装教程">Kubernetes 1.8.x 全手动安装教程</span></div></div><div class="com-3-layout"><div class="layout-main"><div class="com-widget-operations2 theme2 J-sharingBar" style=""><div class="main-cnt"><a href="javascript:;" class="com-opt-link link-add is-actived"><i class="com-i-add"></i></a><a href="javascript:;" class="com-opt-link link-like"><i class="com-i-like"></i><span class="text">2</span></a><a href="javascript:;" class="com-opt-link link-bookmark"><i class="com-i-bookmark"></i><span class="text">0</span></a><div><a href="javascript:;" class="com-opt-link link-share"><i class="com-i-share"></i></a><div class="extra-cnt" style="visibility:hidden"><span class="com-opt-text share-text">分享</span><ul class="com-share-options"><li><div class="c-bubble-trigger"><a href="javascript:;" class="opt-item"><i class="opt-icon wechat"></i></a><div class="c-bubble c-bubble-left "><div class="c-bubble-inner"><div class="qr-img" title="https://cloud.tencent.com/developer/article/2197170?shareByChannel=wechat"><canvas width="130" height="130" style="display: none;"></canvas><img alt="Scan me!" style="display: block;" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIIAAACCCAYAAACKAxD9AAAAAXNSR0IArs4c6QAACyRJREFUeF7tndt240oIRJP//+ic5RNrLNvQuwok58Y8Tkt9gaIoUCS/v729fbwd8O/j43ma9/f31sz7OZ251L1E82dr0pzReHT4/TnUey7zbPdVbUKOuHhqgCAY+s8AwUHnhi5CdxbF21p0/x7FxAjkqP1c6rUOY2zzZ3Y8KqIdxkIW2DH2P0YYIDynsQECQek6ThE9jHAz5I9kBJWGjwRChD2iwWz9aP9qdFeYcS/mshSkAoHEoGMTx6ZhahggiJS4u6wDPgKPMh7prm8JhEqkOaklMhYxluPuKKIjMUsRTWtSxGcCeoAQWLZSlZCDBggNQ3cjchjhVslQyfstGUHVGEfSnNNzoOhfjVOfILuXWIoYJ5o3CjTH9vtrTxGLzmZWzanKPJmC7zifmlHKmgOERWoZRrh1978lI6jRQxqAxrN1VKNQH8FR4Ctm2kc8VQW0pqN7qNKq2jc668tazHQoKsXUHKk4bbWXKri2/f14IKgsQGLIcUTV6JV8S8LqzDlfYZOu/055DE3t1O9s9O8ITgVIA4SrBdRnCZfLV0D8s0D4cJK3CLtq2fcoYqpb66zviLmorKS1s1KU7qvaQnTZ2/sA4d5UAwQVOsJ1XXSr5SOVn4qwfbxmgLCzSGQM6nVHRqdSynGkU79HdbKA3+UlqsAl8J0FNNofnT9MDQOEZ7ORoVUW/JFAoAcsTsSrhtq7gO4hlBOLZMItmldNV91uH50psw89fSSxuWSEAcLN7AOEAKJqw8iJ7ooGoegZRrhZSGYEasFSzUwLrej2MkZOI6DQ/SRmSWDS+Sg4tvlpn10Wdhpid4G69REGCJ9mITFHlY7jaFWU7/dFumyAsHv3UhWZxDJdMUmOpvEotZ4GhO3dR5X6Hmm8orArwov0gEr9WXRR6qL5CXwq6MjRju6iPd/NNUDIIeY417l2pUe+HAgODUYHURG/ZxSn5qZrHY3TFW4qC56xJ2JG0iiZn8O/R6A0MUB4dgdVDdTwUcE5QNi9wk3sc5TR1YCoqnrK4ZRuuvffsUf0oQzHACuEOgch51IkHGmUinCMItrZs1NBqDaP0kSWOlqpgQ46QCAL3cYHCFdbDCOsP9ShQsppKO2vbf2FktOF66p+ByjqtU4K7IrBSLeQwnf2RwKeGGeAIIbarwdCpaFEwoi0AUVsRfWTPykiOgIx641ENTsx4/6eo+yozCm/6eQY8qgDVObJAOHsP6JZAhqBl1JDBYhqQA0QdhYYIHwaIwuu5ZtOJGYi6lMikpBM0UfjanRSpND5adxJDSpQiSUzn0Qa5+78qy+vVg46QIgtQKlhgHC1m4P0YQSywOc4dRZLjEBLO46k+phorCKsonsqKYpYMjsbnalbnnbPJ2uEAUIeZYpW+vZAiN59rKDTiRR1fkfMEVCJRYil1Pu7fYKKHZWzk4CW32uIDkh9bUfBkgFVMaUYZbuG1qS5HJsQkLbxAYLx9waR0chp5Ig/zwhRi5mEn2q0bB5VpFWjQ52fBFaXhej+yniXZbGhREZXBNGjYQcI2m9AkHMztqPykFJXWD4OEHpVAaWeMzTAoUBQqwZS8ESzZ9zvgDeKOkqBdCYn4qizeJSAzex8WNVwhiNJ4DnNGcepZJTVvjLw0Zw/BgiEbhKITilGIimKjkpEE5BI99CZaFxNF5fryL6qTSi4svF/fYQBwvp3K6kSeZUjHQHugGKAcLVWxdG/ihHU9xqcHEwiSxVGzpqOgnYi5cxrVRa57MGxRVSh0Dnk9xoqGzkyB9NBBgjPFrKANoxAEDtv3HJU4Xe2rfkrQKAFVPYgVX/kuJrPv+pBmmpT9ToFvncsOkC4N9mfB4KTY6k5QoygNl8I1Y7TqA9BeyIBfFRvhBp31YYWCcjlj3s5izrtXjI60R9VHRUg0p4GCFcLOA2niiOowqAuXReIfx4I0ef1iJIpYlWapHUymqTmT0SDZ4tF5ywrRlODKFuPOo/p3yMMEI4Ri78aCA7dkiFIjBL1V3I07ckZp9RBAprWIiag+8k+qKtWjDBAuJl3gBCIxS46N/RXtEYmKs+IKCo5aZzOR6Vixc4kutOS+6iGUreqIAF4ZGpZRXeVBbupQXU69U4IfAOEnaUHCJ/GOKXFPIzw+YctapmqMsDjdaczgkOJKg1WN63me9pzpTNKdbiT14mmHTCovRmyeaqxOi+4EPppU5mhBgjPEHkZENQ6NEMxbZRSB6ndKBIp4irRTXN2o5juPzs4Uv+pX0yhAwwQtCgmOw4QAlVP7EPRO4zw/MpdatPKb0NTDlfFJDk6G6f5qWFF7LWKWvXsjxXENmdFwCoClYJimwMfOhFlKZt5PCyJyQHCLWIJ3OTIAcLVQk7ncRgh0DOrT/BWaZAe0FCFQo5y9uUwXUbnl//vnkndB51NnWe/Z+We5Sd4aVNOvqPNVJtDBCpa93GcBCbZZD+fStdO2nXO46wfvvJGwsbZTDQX3U+MULmf7qGIJ6NGArWqkaK9EgBVjZHqsq/4ewRyygAhyOHwgssAIUAVRc8qnVBqoEqH0iUFAc2fjbeBcNTvNTg0qEY8zek4TV2THOFoGYfio9RDbXmnUiIAHvZ7DeQ0EkSqIWieTC0PENZQGCBQqFzHSQyqorjKYkT91E2lY7aAQJN386XDMkfSsFo1OSxGjNR1JJ0fq56ORhgg6J/b+ZFAOAqdWUSTqncijSJBrRAwYgrfJ9ivrZ6JUodjO7r2Tm+t/kKJjEOMMEC4WWiAcLUFlV2V6KFS78ia24muFQtlVY/a2aR9OHaWGSFzTiXfdWtiMkC01+49ahRf1lbT6VdRP51l+X2EAYIvBimdDhCC32MgDVGlOaLZjoB09uwIWXXPXZtkqUl++hhNQJv6quigdR0HuY0i6p1U0lU19VA6uPOp+vRxgPCcJhybqBFP6ZhATk24DIjLT/BWVTmVlVGUOQdQjUrRmdEk7e+MqkCdk2xbZpyIERzU0cZW41VHDRByqw4QAttUgTaMsAhfhyVIpKhzZdcR6mn9lQCkqiDL4dv/V++n3kx3fhLIy6qBDp3lWHLEAOHTcpWqqwq0AcLVAq+KuKqjXrW/LHhbvw1NXTISko7RaK6IvSiF0JxOxJIjaZz20j3LKh1exgYIoi4iR3bHvxwIlZdgu5tWyz9aJxvvaBSH5Rzn05lpnCI6EpORfTKWC38kvOoAdzNH0d3jfgcIuQcHCPAj5ARiAlcUsZEGIsah4FArLoUt92stNYLDDBHSnE1X7s8UMO07omGi5leNZ3vfnEZNMgJaqWogg0ZK/X8Feo2+AcLNQiqQBggft6d7KpCGEdYf2sgCNUqD8nsNEVLpiaHjKKrZo0NRH4Jo1DlTJXc7GoGqAjU4KDWkNlPfa3CMRtc6Zc3q2gHCs3UOBYKKfmIEx1ERezgs0QWXer/DMqodM+bsnt9i0e/85dWuIc64f4Cwg9eq/HLQnVUVVCqp1cwAYV213NnnDEYgSiRHVoCmzukIWEd1k9iLlPqRvRPVZtn55fcarHxz0HuCjgYZIPg/ExB2Fh0aJfQNI+SwrApoqsTIJ3T/yxih2mWMKLUb/asuH+mWbG31fI7YpHM6AYf7e5VGwI3AQ6HuodXmzgBh1+IlJJLwOSqKHWFXARppEFq/kk6pquoC3tnz3bVndhbPPhSpesfoDpCiCoHOGs2vslQ3HSl2OvVZAxlH2aDKLo4ju8LqVwNBTQcOOgkIJJyIuh0FXok+iuLIFl2NQc8KMvt3m3Cn/GFKJYrJUeQUas7Q/KpTHXBTvqbeTIUxHd0SaoRhhGcLEPhU8FyuUwH0VYzwHxim8UzyukNbAAAAAElFTkSuQmCC"></div><p class="qr-txt">分享文章到朋友圈</p></div></div></div></li><li><div class="c-bubble-trigger"><a href="javascript:;" class="opt-item"><i class="opt-icon qq"></i></a><div class="c-bubble c-bubble-left "><div class="c-bubble-inner"><span>分享文章到 QQ</span></div></div></div></li><li><div class="c-bubble-trigger"><a href="javascript:;" class="opt-item"><i class="opt-icon weibo"></i></a><div class="c-bubble c-bubble-left "><div class="c-bubble-inner"><span>分享文章到微博</span></div></div></div></li><li><div class="c-bubble-trigger"><a class="opt-item" href="javascript:;"><i class="opt-icon copy"></i></a><div class="c-bubble c-bubble-left "><div class="c-bubble-inner"><span>复制文章链接到剪贴板</span></div></div></div></li></ul><div class="c-bubble-trigger com-widget-poster"><button class="scan-btn">海报分享</button><div class="c-bubble c-bubble-left "><div class="c-bubble-inner"><div class="qr-img" title="https://cloud.tencent.com/developer/article-sharing/2197170"><canvas width="130" height="130" style="display: none;"></canvas><img alt="Scan me!" style="display: block;" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIIAAACCCAYAAACKAxD9AAAAAXNSR0IArs4c6QAACoBJREFUeF7tne12GjEMRJP3f+j0FHYL7EqeO5ahCVF/Fq8sS6PRhxfy+fHx8fWx8N/X103c5+fnRXL0f8f/z1TYZdD1u5z75+5lE12yZ3c5mQxiRrJ/dIbKnkSvv55qIAzAGhmx4pRvD4R7BQmC7tdkUasYYVWkRrqrqD6ekTh3X0NYiuyf2TyyG7F3xW//GKGBcE5pGVgaCAnkmhHOhnkLRnAPQSJkdQGkGIzopACcUa3a26Xo4/rZ1FDxW5gaKgKVkWaNP8rpkeEbCDEcs1qogbDZixSLUftYjf4RiFUxOWrNCZvdB8tTgaCYRbHHyMgrZLusoZxOWkN3vqFmFw6AR8BpIASMkLVqDYTAAhX0r6DYZoSrFd+OEVzKVAZQn6voHn1ekT377IrA+xGpoYEwhmYDIbjEIpQ4G3mEKSqyZ5/9L0AgxsgKKueg5HBkH6Uv6Q6cfYg8skbpnX2+SrZsH10FZ4dEDQTX0tf1DYTt/YZjalDmdA2n1qvPVzorOhvZX9nkqOO3eR+BsIpikBUyRk6M7gCeuSeRTRxO1jQQNispkN0DxFk7KmyVnAaC2SmoF0aIQZVT3h4IX5WBP+GcwRo1HayIJ44lVfn9GmUqkrvJmsq5Z5/9bCCcTUeGW7NFXAMhsFwzwtL3hmfJ4NqSKkYgCCZrdi1Jvs7oWO3jyi5ZLniYDNNIyoq6EzeNERver2kgLETDWwBBRduMvRSyyZ6z+drVt6LLvpcqJo86kT0Vk5JzkhT8jxEcpcjmWbv1QEdgUthAuFqs4p8GAkUsNLQy6NsxAik0SD6M/ECKJcIakVNcnTLHKYcTfFXOuSLVZD7MbBumhgbC9cu7lX8NBGG9ioFUxKvPj6o1I9wAH146uQZSznWpluRaVTytmilEulRkE9uqPQlTkX0e0kT0tXhXSAPhXNlnziK2bSBs1mtGOI+eV7FqJsf6WrxLidH1sEtrZE8VQQRYpFOJdFcp6jgDcKp5wh4Ve4apgRiLOCU6aAXNZM8GwhgOpIhuRghsSKJ8f4ysdaejzmj+qYwwG4VHGlSpgbBQdlCXZdSQZvbMq4Cg5BD9KqCQX4JVHcFx80hhNyLIgRoIvFPJ6pJ7GzYQNiuRiJutRUgg/HdG2F9MIcpmlbWKYMIq7v6qgifVuZt2VKojkefOF6JahMggjPnglwbC2awKlLaR767biRMdkK8Cn3Xp1IxwHfS8JRCcEbNKAVnhSPpYkj4UEIkMUguotPIqILi6Kr1Hhb116dRA4JU6Ab9yXANh8hW2ZoQbtMiM5qF9fMXr7Kr4OuZdcghVUBEZrl4uI+7rCUCVbMIOlX1e8jq7a3DixAbCOU01EDZUqKHMqFiqtGEqmisOiuYIRJ5tCyc1qOImo/gKIxBKjChYOafSBs4yFtHpXq9V19DZvuFAKVtMnJi1dWoSV0F2pJfroNk20N2HAuAY/d8KCKp3dw+J0GlO4naHrmjZ3MJ1Fkx/93Ec7awdyc78KYvFBsL4G8sNhFVUsMmpRHMzwtkZJH3JOQJBOamyVY1A0oSqP5zPR9h1aiGy1ilyCZUTecT5aS0YdQ0NhJu5IuM2EBI4qeq/Aiwn4t3emdQ/vwYIzu2j61Cnv3ejTJUobs2h5D2bvmdtuyq9WrePs8qS3NVAqH/xNqvbCKs2EAgVBJ1N9FiloJsNsuWM4FJpJcpVynDZQeni1g6OU54x6NntU9Hb1Uu+xewijhRgDQRGQw2EZMSsupO0RwYvujgAdnMxWe+kmso5M7ab/lFu4pRo4rfqENH+JL05ej+7U1BFnFtzVNY3EIJC0KFk1/hOILiyK+sbCA2EiwWmbx9VpX4RHuT6Cn1nuXZFla9ompR3brejageHmTJ7k/TWQEi86zogavdc0KpR9mzgNRASJ7sGJevfCggVWiO0Gc0OHEo/Ilulndl2kJzFTW8k7UQs5NpHpZrR2azvPlYUayBcLeBU9hV7O0z2UCM0IxAuuK55S0aIrqG5Sc6GiZ51ouD4/CxA7YgwX5hdcU5ytqj+cO8RSOE6PUdw8lED4XbFPMsmpJMhqSTbv4GwIdo14tsxwuw3nUj6UC+vuhTn0D2JIFLNR2scPYidRkWkSg0kvRBbyMkiiZTssA0ECgP9F1pIeiW1QBp80W8ovSpSS4oHV8vEWCSalRzXPipQXEZw6rMRFO/Paf1NJ0JDKgaIDERlDYRTK6tsP+rIGgiB9X4lI6g5Aml3VlAVqUUcSiYvoKwuFl0mIylDdSezMo7pSLaPDYSbqXdHE0CSNbNOrARNBv4GQjBHUE5Un/8VSdb8KCC4tK9u0SoGWm24SgehKNtNTU6hR1KQI++SJlSN0ECIx8MNBAG1ZoSrgX4cI6gf5c4YwSlYXCpT7VuWg8k+q+YYu11cXYmOitbdPbMC8eH/Gwi1CHad0kDY4Fcp0JQR1efH3pmwndL3bYCwF4tuNe+u341OcuesccnMQzn2CBayPkoTLsic2orYhxT5D3cNDYRzRibMorqGBoJ45asZQb+tFF3fu3abZgRVqY5aIoL+KDVkexLqiwxDaJx0DcoWTsekZI3Siut8cv7U5rMDJWLQaA1RtoHAO5nZNHYExPRksYEwjnUCeNXf/3dGIAq4tO4MYCidjtatOkO0x2zHNKOv6rZILaAAd+mU1M/rudSj1hPabyCcf2HtGa3xA0AaCOP28dcwgnqdPaMVQr2qWFTscaEs4/ePSDXvdDjHTml1eiNR7rBjJWXJ19kbCOef6V+V3hoIG7pItJM1o168UqD9Skao0CqpSmcpjrSpCghuK6fOQ+Q5ep96evGTQxWWzp6Vv4+QObCSjxQoCGVG+1eMn+mk6hznuYxhvgUQVlw6KQc49H4sEEmfvMt/JjgdPY4On2Vb9zkStGl900BQ/HT+nACOsJpyXAMB/ARvlOuIg3y3/xIgOHME14gK0bOzCEK9RDbJ7+qWU51xpKvDGm6B6q635ggNhOvo13FgAyH55dWs6HKHNMoZzQjjv1d5LMqta2jCCE5bp4ql0X5OW0dApoBFzk5ATs6szkbOQ/R9OLPzYoorfF9P8ihpz6ICkTxHDNdA+PjQHEIQsK1pRrgawgWWWk9SXSXgwj/lY/j9stQdGEXySdSq6CeGcKvpSFciQ7HXUa4KILJnxQ8NhMDTClDEKQ2Er7lM04zAr7szxl7OCCoiaG+8olgkAFG06qY6p/onuZuwg6oR3DMQ1rq37ZI/96eQSIBFjO8Y3d3zmW1dA2GzgOsU4vDV4GsgbO2jS02us3ZDr9pndQdBUpDTQSigEqp3A4iAOa0vomtookAD4TwvyFIAydeqpSbAaSAEncozwazY6BmzlR8NhKhrcJmErFfRRCIyA060P5FHWjxSIKt0RABP9nl510AcS/K1coaboxsITywWmxHO8ewAjuT8pzKCm49U9LkRruQdc3DUkbiF2+yehHYVe5E0MiuD+vIldw0NhLVjd+pcZ10DYbNWM8KL30dwi0W3VVNpIksZhOIj2ZWcn9G9k/eJPUmafPmrakRxYlzlUJJTyT7RGjIdddeo87iFIwHZg46vflWtgXBzKXGWyvPEnoQR/gByqLNtZcbp9AAAAABJRU5ErkJggg=="></div><p class="qr-txt">海报分享</p></div></div></div></div></div></div></div><section class="com-2-panel col-2-article J-articlePanel"><div class="col-2-article-header"><h1 class="article-title J-articleTitle"><span>Kubernetes 1.8.x 全手动安装教程</span></h1><div class="article-infos-wrap"><div class="article-infos"><span class="article-info">发布于2022-12-21 18:30:39</span><span class="article-info">阅读 <!-- -->38</span>0</div><div class="article-infos-extra"></div></div></div><div class="com-markdown-collpase"><div class="com-markdown-collpase-main" style="max-height: 1e+07px;"><div><div class="rno-markdown J-articleContent rno-"><p>Kubernetes 提供了许多云端平台与操作系统的安装方式，本章将以全手动安装方式来部署，主要是学习与了解 Kubernetes 创建流程。若想要了解更多平台的部署可以参考&nbsp;<a data-from="10680" href="http://docs.kubernetes.org.cn/282.html" target="_blank" rel="nofollow noopener noreferrer">Picking the Right Solution</a>来选择自己最喜欢的方式。</p><p><strong>本次安装版本为：</strong></p><ul class="ul-level-0"><li>Kubernetes v1.8.2</li><li>Etcd v3.2.9</li><li>Calico v2.6.2</li><li><a data-text-link="445_2197170" data-from="10680" href="https://cloud.tencent.com/product/tke?from=10680" target="_blank">Docker</a> v17.10.0-ce</li></ul><h2 id="%E9%A2%84%E5%85%88%E5%87%86%E5%A4%87%E4%BF%A1%E6%81%AF" name="%E9%A2%84%E5%85%88%E5%87%86%E5%A4%87%E4%BF%A1%E6%81%AF">预先准备信息</h2><p>本教程将以下列节点数与规格来进行部署 Kubernetes 集群，操作系统可采用Ubuntu 16.x与CentOS 7.x：</p><div class="table-wrapper"><table><thead><tr><th style="text-align:left"><div><div class="table-header"><p>IP Address</p></div></div></th><th style="text-align:left"><div><div class="table-header"><p>Role</p></div></div></th><th style="text-align:left"><div><div class="table-header"><p>CPU</p></div></div></th><th style="text-align:left"><div><div class="table-header"><p>Memory</p></div></div></th></tr></thead><tbody><tr><td style="text-align:left"><div><div class="table-cell"><p>172.16.35.12</p></div></div></td><td style="text-align:left"><div><div class="table-cell"><p>master1</p></div></div></td><td style="text-align:left"><div><div class="table-cell"><p>1</p></div></div></td><td style="text-align:left"><div><div class="table-cell"><p>2G</p></div></div></td></tr><tr><td style="text-align:left"><div><div class="table-cell"><p>172.16.35.10</p></div></div></td><td style="text-align:left"><div><div class="table-cell"><p>node1</p></div></div></td><td style="text-align:left"><div><div class="table-cell"><p>1</p></div></div></td><td style="text-align:left"><div><div class="table-cell"><p>2G</p></div></div></td></tr></tbody></table></div><ul class="ul-level-0"><li>这边 master 为主要控制节点也是部署节点，node 为应用程序工作节点。</li><li>所有操作全部用root使用者进行，以 SRE 来说不推荐。</li><li>可以下载&nbsp;<a data-from="10680" href="https://kairen.github.io/files/manual-v1.8/Vagrantfile" target="_blank" rel="nofollow noopener noreferrer">Vagrantfile</a>&nbsp;来建立 Virtual box 虚拟机集群。</li></ul><p>首先安装前要确认以下几项都已将准备完成：</p><ul class="ul-level-0"><li>所有节点彼此网络互通，并且master1&nbsp;SSH 登入其他节点为 passwdless。</li><li>所有防火墙与 SELinux 已关闭。如 CentOS：</li></ul><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0">$ systemctl stop firewalld <span class="token operator">&amp;&amp;</span> systemctl disable firewalld
$ setenforce <span class="token number">0</span>
$ vim <span class="token operator">/</span>etc<span class="token operator">/</span>selinux<span class="token operator">/</span>config
<span class="token constant">SELINUX</span><span class="token operator">=</span>disabled<span class="token operator">&amp;&amp;</span> systemctl disable firewalld
$ setenforce <span class="token number">0</span>
$ vim <span class="token operator">/</span>etc<span class="token operator">/</span>selinux<span class="token operator">/</span>config
<span class="token constant">SELINUX</span><span class="token operator">=</span>disabled<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><button class="copy">复制</button></div><ul class="ul-level-0"><li>所有节点需要设定/etc/host解析到所有主机。</li></ul><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0"><span class="token operator">...</span>
<span class="token number">172.16</span><span class="token number">.35</span><span class="token number">.10</span> node1
<span class="token number">172.16</span><span class="token number">.35</span><span class="token number">.12</span> master1
<span class="token number">172.16</span><span class="token number">.35</span><span class="token number">.10</span> node1
<span class="token number">172.16</span><span class="token number">.35</span><span class="token number">.12</span> master1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><button class="copy">复制</button></div><ul class="ul-level-0"><li>所有节点需要安装Docker或rtk引擎。这边采用Docker来当作容器引擎，安装方式如下：</li></ul><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0">$ curl <span class="token operator">-</span>fsSL <span class="token string">"https://get.docker.com/"</span> <span class="token operator">|</span> sh<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><button class="copy">复制</button></div><p>不管是在&nbsp;Ubuntu&nbsp;或&nbsp;CentOS&nbsp;都只需要执行该指令就会自动安装最新版 Docker。
 CentOS 安装完成后，需要再执行以下指令：</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0">$ systemctl enable docker <span class="token operator">&amp;&amp;</span> systemctl start docker<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><button class="copy">复制</button></div><p>编辑/lib/systemd/system/docker.service，在ExecStart=..上面加入：</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0">ExecStartPost<span class="token operator">=</span><span class="token operator">/</span>sbin<span class="token operator">/</span>iptables <span class="token operator">-</span><span class="token constant">I</span> <span class="token constant">FORWARD</span> <span class="token operator">-</span>s <span class="token number">0.0</span><span class="token number">.0</span><span class="token number">.0</span><span class="token operator">/</span><span class="token number">0</span> <span class="token operator">-</span>j <span class="token constant">ACCEPT</span><span class="token operator">=</span><span class="token operator">/</span>sbin<span class="token operator">/</span>iptables <span class="token operator">-</span><span class="token constant">I</span> <span class="token constant">FORWARD</span> <span class="token operator">-</span>s <span class="token number">0.0</span><span class="token number">.0</span><span class="token number">.0</span><span class="token operator">/</span><span class="token number">0</span> <span class="token operator">-</span>j <span class="token constant">ACCEPT</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><button class="copy">复制</button></div><p>完成后，重新启动 docker 服务：</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0">$ systemctl daemon<span class="token operator">-</span>reload <span class="token operator">&amp;&amp;</span> systemctl restart docker<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><button class="copy">复制</button></div><ul class="ul-level-0"><li>所有节点需要设定/etc/sysctl.d/k8s.conf的系统参数。</li></ul><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0">$ cat <span class="token operator">&lt;&lt;</span><span class="token constant">EOF</span> <span class="token operator">&gt;</span> <span class="token operator">/</span>etc<span class="token operator">/</span>sysctl<span class="token punctuation">.</span>d<span class="token operator">/</span>k8s<span class="token punctuation">.</span>conf
net<span class="token punctuation">.</span>ipv4<span class="token punctuation">.</span>ip_forward <span class="token operator">=</span> <span class="token number">1</span>
net<span class="token punctuation">.</span>bridge<span class="token punctuation">.</span>bridge<span class="token operator">-</span>nf<span class="token operator">-</span>call<span class="token operator">-</span>ip6tables <span class="token operator">=</span> <span class="token number">1</span>
net<span class="token punctuation">.</span>bridge<span class="token punctuation">.</span>bridge<span class="token operator">-</span>nf<span class="token operator">-</span>call<span class="token operator">-</span>iptables <span class="token operator">=</span> <span class="token number">1</span>
<span class="token constant">EOF</span>

$ sysctl <span class="token operator">-</span>p <span class="token operator">/</span>etc<span class="token operator">/</span>sysctl<span class="token punctuation">.</span>d<span class="token operator">/</span>k8s<span class="token punctuation">.</span>conf<span class="token operator">&lt;&lt;</span><span class="token constant">EOF</span> <span class="token operator">&gt;</span> <span class="token operator">/</span>etc<span class="token operator">/</span>sysctl<span class="token punctuation">.</span>d<span class="token operator">/</span>k8s<span class="token punctuation">.</span>conf
net<span class="token punctuation">.</span>ipv4<span class="token punctuation">.</span>ip_forward <span class="token operator">=</span> <span class="token number">1</span>
net<span class="token punctuation">.</span>bridge<span class="token punctuation">.</span>bridge<span class="token operator">-</span>nf<span class="token operator">-</span>call<span class="token operator">-</span>ip6tables <span class="token operator">=</span> <span class="token number">1</span>
net<span class="token punctuation">.</span>bridge<span class="token punctuation">.</span>bridge<span class="token operator">-</span>nf<span class="token operator">-</span>call<span class="token operator">-</span>iptables <span class="token operator">=</span> <span class="token number">1</span>
<span class="token constant">EOF</span>

$ sysctl <span class="token operator">-</span>p <span class="token operator">/</span>etc<span class="token operator">/</span>sysctl<span class="token punctuation">.</span>d<span class="token operator">/</span>k8s<span class="token punctuation">.</span>conf<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><button class="copy">复制</button></div><ul class="ul-level-0"><li>在master1需要安装CFSSL工具，这将会用来建立 TLS certificates。</li></ul><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0">$ <span class="token keyword">export</span> <span class="token constant">CFSSL_URL</span><span class="token operator">=</span><span class="token string">"https://pkg.cfssl.org/R1.2"</span>
$ wget <span class="token string">"${CFSSL_URL}/cfssl_linux-amd64"</span> <span class="token operator">-</span><span class="token constant">O</span> <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>bin<span class="token operator">/</span>cfssl
$ wget <span class="token string">"${CFSSL_URL}/cfssljson_linux-amd64"</span> <span class="token operator">-</span><span class="token constant">O</span> <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>bin<span class="token operator">/</span>cfssljson
$ chmod <span class="token operator">+</span>x <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>bin<span class="token operator">/</span>cfssl <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>bin<span class="token operator">/</span>cfssljsonexport <span class="token constant">CFSSL_URL</span><span class="token operator">=</span><span class="token string">"https://pkg.cfssl.org/R1.2"</span>
$ wget <span class="token string">"${CFSSL_URL}/cfssl_linux-amd64"</span> <span class="token operator">-</span><span class="token constant">O</span> <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>bin<span class="token operator">/</span>cfssl
$ wget <span class="token string">"${CFSSL_URL}/cfssljson_linux-amd64"</span> <span class="token operator">-</span><span class="token constant">O</span> <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>bin<span class="token operator">/</span>cfssljson
$ chmod <span class="token operator">+</span>x <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>bin<span class="token operator">/</span>cfssl <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>bin<span class="token operator">/</span>cfssljson<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><button class="copy">复制</button></div><h2 id="Etcd" name="Etcd">Etcd</h2><p>在开始安装 Kubernetes 之前，需要先将一些必要系统创建完成，其中 Etcd 就是 Kubernetes 最重要的一环，Kubernetes 会将大部分信息储存于 Etcd 上，来提供给其他节点索取，以确保整个集群运作与沟通正常。</p><h3 id="%E5%88%9B%E5%BB%BA%E9%9B%86%E7%BE%A4-CA-%E4%B8%8E-Certificates" name="%E5%88%9B%E5%BB%BA%E9%9B%86%E7%BE%A4-CA-%E4%B8%8E-Certificates">创建集群 CA 与 Certificates</h3><p>在这部分，将会需要产生 client 与 server 的各组件 certificates，并且替 Kubernetes admin user 产生 client 证书。</p><p>建立/etc/etcd/ssl文件夹，然后进入目录完成以下操作。</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0">$ mkdir <span class="token operator">-</span>p <span class="token operator">/</span>etc<span class="token operator">/</span>etcd<span class="token operator">/</span>ssl <span class="token operator">&amp;&amp;</span> cd <span class="token operator">/</span>etc<span class="token operator">/</span>etcd<span class="token operator">/</span>ssl
$ <span class="token keyword">export</span> <span class="token constant">PKI_URL</span><span class="token operator">=</span><span class="token string">"https://kairen.github.io/files/manual-v1.8/pki"</span><span class="token operator">-</span>p <span class="token operator">/</span>etc<span class="token operator">/</span>etcd<span class="token operator">/</span>ssl <span class="token operator">&amp;&amp;</span> cd <span class="token operator">/</span>etc<span class="token operator">/</span>etcd<span class="token operator">/</span>ssl
$ <span class="token keyword">export</span> <span class="token constant">PKI_URL</span><span class="token operator">=</span><span class="token string">"https://kairen.github.io/files/manual-v1.8/pki"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><button class="copy">复制</button></div><p>下载ca-config.json与etcd-ca-csr.json文件，并产生 CA 密钥：</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0">$ wget <span class="token string">"${PKI_URL}/ca-config.json"</span> <span class="token string">"${PKI_URL}/etcd-ca-csr.json"</span>
$ cfssl gencert <span class="token operator">-</span>initca etcd<span class="token operator">-</span>ca<span class="token operator">-</span>csr<span class="token punctuation">.</span>json <span class="token operator">|</span> cfssljson <span class="token operator">-</span>bare etcd<span class="token operator">-</span>ca
$ ls etcd<span class="token operator">-</span>ca<span class="token operator">*</span><span class="token punctuation">.</span>pem
etcd<span class="token operator">-</span>ca<span class="token operator">-</span>key<span class="token punctuation">.</span>pem  etcd<span class="token operator">-</span>ca<span class="token punctuation">.</span>pem<span class="token string">"${PKI_URL}/ca-config.json"</span> <span class="token string">"${PKI_URL}/etcd-ca-csr.json"</span>
$ cfssl gencert <span class="token operator">-</span>initca etcd<span class="token operator">-</span>ca<span class="token operator">-</span>csr<span class="token punctuation">.</span>json <span class="token operator">|</span> cfssljson <span class="token operator">-</span>bare etcd<span class="token operator">-</span>ca
$ ls etcd<span class="token operator">-</span>ca<span class="token operator">*</span><span class="token punctuation">.</span>pem
etcd<span class="token operator">-</span>ca<span class="token operator">-</span>key<span class="token punctuation">.</span>pem  etcd<span class="token operator">-</span>ca<span class="token punctuation">.</span>pem<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><button class="copy">复制</button></div><p>下载etcd-csr.json文件，并产生 kube-apiserver certificate 证书：</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0">$ wget <span class="token string">"${PKI_URL}/etcd-csr.json"</span>
$ cfssl gencert \
  <span class="token operator">-</span>ca<span class="token operator">=</span>etcd<span class="token operator">-</span>ca<span class="token punctuation">.</span>pem \
  <span class="token operator">-</span>ca<span class="token operator">-</span>key<span class="token operator">=</span>etcd<span class="token operator">-</span>ca<span class="token operator">-</span>key<span class="token punctuation">.</span>pem \
  <span class="token operator">-</span>config<span class="token operator">=</span>ca<span class="token operator">-</span>config<span class="token punctuation">.</span>json \
  <span class="token operator">-</span>profile<span class="token operator">=</span>kubernetes \
  etcd<span class="token operator">-</span>csr<span class="token punctuation">.</span>json <span class="token operator">|</span> cfssljson <span class="token operator">-</span>bare etcd

$ ls etcd<span class="token operator">*</span><span class="token punctuation">.</span>pem
etcd<span class="token operator">-</span>ca<span class="token operator">-</span>key<span class="token punctuation">.</span>pem  etcd<span class="token operator">-</span>ca<span class="token punctuation">.</span>pem  etcd<span class="token operator">-</span>key<span class="token punctuation">.</span>pem  etcd<span class="token punctuation">.</span>pe<span class="token string">"${PKI_URL}/etcd-csr.json"</span>
$ cfssl gencert \
  <span class="token operator">-</span>ca<span class="token operator">=</span>etcd<span class="token operator">-</span>ca<span class="token punctuation">.</span>pem \
  <span class="token operator">-</span>ca<span class="token operator">-</span>key<span class="token operator">=</span>etcd<span class="token operator">-</span>ca<span class="token operator">-</span>key<span class="token punctuation">.</span>pem \
  <span class="token operator">-</span>config<span class="token operator">=</span>ca<span class="token operator">-</span>config<span class="token punctuation">.</span>json \
  <span class="token operator">-</span>profile<span class="token operator">=</span>kubernetes \
  etcd<span class="token operator">-</span>csr<span class="token punctuation">.</span>json <span class="token operator">|</span> cfssljson <span class="token operator">-</span>bare etcd

$ ls etcd<span class="token operator">*</span><span class="token punctuation">.</span>pem
etcd<span class="token operator">-</span>ca<span class="token operator">-</span>key<span class="token punctuation">.</span>pem  etcd<span class="token operator">-</span>ca<span class="token punctuation">.</span>pem  etcd<span class="token operator">-</span>key<span class="token punctuation">.</span>pem  etcd<span class="token punctuation">.</span>pe<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><button class="copy">复制</button></div><blockquote><p> 若节点 IP 不同，需要修改etcd-csr.json的hosts。
 </p></blockquote><p>完成后删除不必要文件：</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0">$ rm <span class="token operator">-</span>rf <span class="token operator">*</span><span class="token punctuation">.</span>json<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><button class="copy">复制</button></div><p>确认/etc/etcd/ssl有以下文件：</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0">$ ls <span class="token operator">/</span>etc<span class="token operator">/</span>etcd<span class="token operator">/</span>ssl
etcd<span class="token operator">-</span>ca<span class="token punctuation">.</span>csr  etcd<span class="token operator">-</span>ca<span class="token operator">-</span>key<span class="token punctuation">.</span>pem  etcd<span class="token operator">-</span>ca<span class="token punctuation">.</span>pem  etcd<span class="token punctuation">.</span>csr  etcd<span class="token operator">-</span>key<span class="token punctuation">.</span>pem  etcd<span class="token punctuation">.</span>pem<span class="token operator">/</span>etc<span class="token operator">/</span>etcd<span class="token operator">/</span>ssl
etcd<span class="token operator">-</span>ca<span class="token punctuation">.</span>csr  etcd<span class="token operator">-</span>ca<span class="token operator">-</span>key<span class="token punctuation">.</span>pem  etcd<span class="token operator">-</span>ca<span class="token punctuation">.</span>pem  etcd<span class="token punctuation">.</span>csr  etcd<span class="token operator">-</span>key<span class="token punctuation">.</span>pem  etcd<span class="token punctuation">.</span>pem<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><button class="copy">复制</button></div><h3 id="Etcd-%E5%AE%89%E8%A3%85%E4%B8%8E%E8%AE%BE%E5%AE%9A" name="Etcd-%E5%AE%89%E8%A3%85%E4%B8%8E%E8%AE%BE%E5%AE%9A">Etcd 安装与设定</h3><p>首先在master1节点下载 Etcd，并解压缩放到 /opt 底下与安装：</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0">$ <span class="token keyword">export</span> <span class="token constant">ETCD_URL</span><span class="token operator">=</span><span class="token string">"https://github.com/coreos/etcd/releases/download"</span>
$ cd <span class="token operator">&amp;&amp;</span> wget <span class="token operator">-</span>qO<span class="token operator">-</span> <span class="token operator">--</span>show<span class="token operator">-</span>progress <span class="token string">"${ETCD_URL}/v3.2.9/etcd-v3.2.9-linux-amd64.tar.gz"</span> <span class="token operator">|</span> tar <span class="token operator">-</span>zx
$ mv etcd<span class="token operator">-</span>v3<span class="token punctuation">.</span><span class="token number">2.9</span><span class="token operator">-</span>linux<span class="token operator">-</span>amd64<span class="token operator">/</span>etcd<span class="token operator">*</span> <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>bin<span class="token operator">/</span> <span class="token operator">&amp;&amp;</span> rm <span class="token operator">-</span>rf etcd<span class="token operator">-</span>v3<span class="token punctuation">.</span><span class="token number">2.9</span><span class="token operator">-</span>linux<span class="token operator">-</span>amd64export <span class="token constant">ETCD_URL</span><span class="token operator">=</span><span class="token string">"https://github.com/coreos/etcd/releases/download"</span>
$ cd <span class="token operator">&amp;&amp;</span> wget <span class="token operator">-</span>qO<span class="token operator">-</span> <span class="token operator">--</span>show<span class="token operator">-</span>progress <span class="token string">"${ETCD_URL}/v3.2.9/etcd-v3.2.9-linux-amd64.tar.gz"</span> <span class="token operator">|</span> tar <span class="token operator">-</span>zx
$ mv etcd<span class="token operator">-</span>v3<span class="token punctuation">.</span><span class="token number">2.9</span><span class="token operator">-</span>linux<span class="token operator">-</span>amd64<span class="token operator">/</span>etcd<span class="token operator">*</span> <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>bin<span class="token operator">/</span> <span class="token operator">&amp;&amp;</span> rm <span class="token operator">-</span>rf etcd<span class="token operator">-</span>v3<span class="token punctuation">.</span><span class="token number">2.9</span><span class="token operator">-</span>linux<span class="token operator">-</span>amd64<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><button class="copy">复制</button></div><p>完成后新建 Etcd Group 与 User，并建立 Etcd 配置文件目录：</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0">$ groupadd etcd <span class="token operator">&amp;&amp;</span> useradd <span class="token operator">-</span>c <span class="token string">"Etcd user"</span> <span class="token operator">-</span>g etcd <span class="token operator">-</span>s <span class="token operator">/</span>sbin<span class="token operator">/</span>nologin <span class="token operator">-</span>r etcd<span class="token operator">&amp;&amp;</span> useradd <span class="token operator">-</span>c <span class="token string">"Etcd user"</span> <span class="token operator">-</span>g etcd <span class="token operator">-</span>s <span class="token operator">/</span>sbin<span class="token operator">/</span>nologin <span class="token operator">-</span>r etcd<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><button class="copy">复制</button></div><p>下载etcd相关文件，我们将来管理 Etcd：</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0">$ <span class="token keyword">export</span> <span class="token constant">ETCD_CONF_URL</span><span class="token operator">=</span><span class="token string">"https://kairen.github.io/files/manual-v1.8/master"</span>
$ wget <span class="token string">"${ETCD_CONF_URL}/etcd.conf"</span> <span class="token operator">-</span><span class="token constant">O</span> <span class="token operator">/</span>etc<span class="token operator">/</span>etcd<span class="token operator">/</span>etcd<span class="token punctuation">.</span>conf
$ wget <span class="token string">"${ETCD_CONF_URL}/etcd.service"</span> <span class="token operator">-</span><span class="token constant">O</span> <span class="token operator">/</span>lib<span class="token operator">/</span>systemd<span class="token operator">/</span>system<span class="token operator">/</span>etcd<span class="token punctuation">.</span>serviceexport <span class="token constant">ETCD_CONF_URL</span><span class="token operator">=</span><span class="token string">"https://kairen.github.io/files/manual-v1.8/master"</span>
$ wget <span class="token string">"${ETCD_CONF_URL}/etcd.conf"</span> <span class="token operator">-</span><span class="token constant">O</span> <span class="token operator">/</span>etc<span class="token operator">/</span>etcd<span class="token operator">/</span>etcd<span class="token punctuation">.</span>conf
$ wget <span class="token string">"${ETCD_CONF_URL}/etcd.service"</span> <span class="token operator">-</span><span class="token constant">O</span> <span class="token operator">/</span>lib<span class="token operator">/</span>systemd<span class="token operator">/</span>system<span class="token operator">/</span>etcd<span class="token punctuation">.</span>service<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><button class="copy">复制</button></div><blockquote><p> 若与该教程 IP 不同的话，请用自己 IP 取代172.16.35.12。
 </p></blockquote><p>建立 var 存放信息，然后启动 Etcd 服务:</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0">$ mkdir <span class="token operator">-</span>p <span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>lib<span class="token operator">/</span>etcd <span class="token operator">&amp;&amp;</span> chown etcd<span class="token operator">:</span>etcd <span class="token operator">-</span><span class="token constant">R</span> <span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>lib<span class="token operator">/</span>etcd <span class="token operator">/</span>etc<span class="token operator">/</span>etcd
$ systemctl enable etcd<span class="token punctuation">.</span>service <span class="token operator">&amp;&amp;</span> systemctl start etcd<span class="token punctuation">.</span>service<span class="token operator">-</span>p <span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>lib<span class="token operator">/</span>etcd <span class="token operator">&amp;&amp;</span> chown etcd<span class="token operator">:</span>etcd <span class="token operator">-</span><span class="token constant">R</span> <span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>lib<span class="token operator">/</span>etcd <span class="token operator">/</span>etc<span class="token operator">/</span>etcd
$ systemctl enable etcd<span class="token punctuation">.</span>service <span class="token operator">&amp;&amp;</span> systemctl start etcd<span class="token punctuation">.</span>service<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><button class="copy">复制</button></div><p>通过简单指令验证：</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0">$ <span class="token keyword">export</span> <span class="token constant">CA</span><span class="token operator">=</span><span class="token string">"/etc/etcd/ssl"</span>
$ <span class="token constant">ETCDCTL_API</span><span class="token operator">=</span><span class="token number">3</span> etcdctl \
    <span class="token operator">--</span>cacert<span class="token operator">=</span>$<span class="token punctuation">{</span><span class="token constant">CA</span><span class="token punctuation">}</span><span class="token operator">/</span>etcd<span class="token operator">-</span>ca<span class="token punctuation">.</span>pem \
    <span class="token operator">--</span>cert<span class="token operator">=</span>$<span class="token punctuation">{</span><span class="token constant">CA</span><span class="token punctuation">}</span><span class="token operator">/</span>etcd<span class="token punctuation">.</span>pem \
    <span class="token operator">--</span>key<span class="token operator">=</span>$<span class="token punctuation">{</span><span class="token constant">CA</span><span class="token punctuation">}</span><span class="token operator">/</span>etcd<span class="token operator">-</span>key<span class="token punctuation">.</span>pem \
    <span class="token operator">--</span>endpoints<span class="token operator">=</span><span class="token string">"https://172.16.35.12:2379"</span> \
    endpoint health
# output
<span class="token literal-property property">https</span><span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">172.16</span><span class="token number">.35</span><span class="token number">.12</span><span class="token operator">:</span><span class="token number">2379</span> is healthy<span class="token operator">:</span> successfully committed proposal<span class="token operator">:</span> took <span class="token operator">=</span> <span class="token number">641.36</span>µsexport <span class="token constant">CA</span><span class="token operator">=</span><span class="token string">"/etc/etcd/ssl"</span>
$ <span class="token constant">ETCDCTL_API</span><span class="token operator">=</span><span class="token number">3</span> etcdctl \
    <span class="token operator">--</span>cacert<span class="token operator">=</span>$<span class="token punctuation">{</span><span class="token constant">CA</span><span class="token punctuation">}</span><span class="token operator">/</span>etcd<span class="token operator">-</span>ca<span class="token punctuation">.</span>pem \
    <span class="token operator">--</span>cert<span class="token operator">=</span>$<span class="token punctuation">{</span><span class="token constant">CA</span><span class="token punctuation">}</span><span class="token operator">/</span>etcd<span class="token punctuation">.</span>pem \
    <span class="token operator">--</span>key<span class="token operator">=</span>$<span class="token punctuation">{</span><span class="token constant">CA</span><span class="token punctuation">}</span><span class="token operator">/</span>etcd<span class="token operator">-</span>key<span class="token punctuation">.</span>pem \
    <span class="token operator">--</span>endpoints<span class="token operator">=</span><span class="token string">"https://172.16.35.12:2379"</span> \
    endpoint health
# output
<span class="token literal-property property">https</span><span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">172.16</span><span class="token number">.35</span><span class="token number">.12</span><span class="token operator">:</span><span class="token number">2379</span> is healthy<span class="token operator">:</span> successfully committed proposal<span class="token operator">:</span> took <span class="token operator">=</span> <span class="token number">641.36</span>µs<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><button class="copy">复制</button></div><h2 id="Kubernetes-Master" name="Kubernetes-Master">Kubernetes Master</h2><p><a data-from="10680" href="http://docs.kubernetes.org.cn/306.html" target="_blank" rel="nofollow noopener noreferrer">Master</a> 是 Kubernetes 的大总管，主要创建apiserver、Controller manager与Scheduler来组件管理所有 Node。本步骤将下载 Kubernetes 并安装至&nbsp;master1上，然后产生相关 TLS Cert 与 CA 密钥，提供给集群组件认证使用。</p><h3 id="%E4%B8%8B%E8%BD%BD-Kubernetes-%E7%BB%84%E4%BB%B6" name="%E4%B8%8B%E8%BD%BD-Kubernetes-%E7%BB%84%E4%BB%B6">下载 Kubernetes 组件</h3><p>首先通过网络取得所有需要的执行文件：</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0"># Download Kubernetes
$ <span class="token keyword">export</span> <span class="token constant">KUBE_URL</span><span class="token operator">=</span><span class="token string">"https://storage.googleapis.com/kubernetes-release/release/v1.8.2/bin/linux/amd64"</span>
$ wget <span class="token string">"${KUBE_URL}/kubelet"</span> <span class="token operator">-</span><span class="token constant">O</span> <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>bin<span class="token operator">/</span>kubelet
$ wget <span class="token string">"${KUBE_URL}/kubectl"</span> <span class="token operator">-</span><span class="token constant">O</span> <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>bin<span class="token operator">/</span>kubectl
$ chmod <span class="token operator">+</span>x <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>bin<span class="token operator">/</span>kubelet <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>bin<span class="token operator">/</span>kubectl

# Download <span class="token constant">CNI</span>
$ mkdir <span class="token operator">-</span>p <span class="token operator">/</span>opt<span class="token operator">/</span>cni<span class="token operator">/</span>bin <span class="token operator">&amp;&amp;</span> cd <span class="token operator">/</span>opt<span class="token operator">/</span>cni<span class="token operator">/</span>bin
$ <span class="token keyword">export</span> <span class="token constant">CNI_URL</span><span class="token operator">=</span><span class="token string">"https://github.com/containernetworking/plugins/releases/download"</span>
$ wget <span class="token operator">-</span>qO<span class="token operator">-</span> <span class="token operator">--</span>show<span class="token operator">-</span>progress <span class="token string">"${CNI_URL}/v0.6.0/cni-plugins-amd64-v0.6.0.tgz"</span> <span class="token operator">|</span> tar <span class="token operator">-</span>zx
$ <span class="token keyword">export</span> <span class="token constant">KUBE_URL</span><span class="token operator">=</span><span class="token string">"https://storage.googleapis.com/kubernetes-release/release/v1.8.2/bin/linux/amd64"</span>
$ wget <span class="token string">"${KUBE_URL}/kubelet"</span> <span class="token operator">-</span><span class="token constant">O</span> <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>bin<span class="token operator">/</span>kubelet
$ wget <span class="token string">"${KUBE_URL}/kubectl"</span> <span class="token operator">-</span><span class="token constant">O</span> <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>bin<span class="token operator">/</span>kubectl
$ chmod <span class="token operator">+</span>x <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>bin<span class="token operator">/</span>kubelet <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>bin<span class="token operator">/</span>kubectl

# Download <span class="token constant">CNI</span>
$ mkdir <span class="token operator">-</span>p <span class="token operator">/</span>opt<span class="token operator">/</span>cni<span class="token operator">/</span>bin <span class="token operator">&amp;&amp;</span> cd <span class="token operator">/</span>opt<span class="token operator">/</span>cni<span class="token operator">/</span>bin
$ <span class="token keyword">export</span> <span class="token constant">CNI_URL</span><span class="token operator">=</span><span class="token string">"https://github.com/containernetworking/plugins/releases/download"</span>
$ wget <span class="token operator">-</span>qO<span class="token operator">-</span> <span class="token operator">--</span>show<span class="token operator">-</span>progress <span class="token string">"${CNI_URL}/v0.6.0/cni-plugins-amd64-v0.6.0.tgz"</span> <span class="token operator">|</span> tar <span class="token operator">-</span>zx<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><button class="copy">复制</button></div><h3 id="%E5%88%9B%E5%BB%BA%E9%9B%86%E7%BE%A4-CA-%E4%B8%8E-Certificates" name="%E5%88%9B%E5%BB%BA%E9%9B%86%E7%BE%A4-CA-%E4%B8%8E-Certificates">创建集群 CA 与 Certificates</h3><p>在这部分，将会需要生成 client 与 server 的各组件 certificates，并且替 Kubernetes admin user 生成 client 证书。</p><p>创建pki文件夹，然后进入目录完成以下操作。</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0">$ mkdir <span class="token operator">-</span>p <span class="token operator">/</span>etc<span class="token operator">/</span>kubernetes<span class="token operator">/</span>pki <span class="token operator">&amp;&amp;</span> cd <span class="token operator">/</span>etc<span class="token operator">/</span>kubernetes<span class="token operator">/</span>pki
$ <span class="token keyword">export</span> <span class="token constant">PKI_URL</span><span class="token operator">=</span><span class="token string">"https://kairen.github.io/files/manual-v1.8/pki"</span>
$ <span class="token keyword">export</span> <span class="token constant">KUBE_APISERVER</span><span class="token operator">=</span><span class="token string">"https://172.16.35.12:6443"</span><span class="token operator">-</span>p <span class="token operator">/</span>etc<span class="token operator">/</span>kubernetes<span class="token operator">/</span>pki <span class="token operator">&amp;&amp;</span> cd <span class="token operator">/</span>etc<span class="token operator">/</span>kubernetes<span class="token operator">/</span>pki
$ <span class="token keyword">export</span> <span class="token constant">PKI_URL</span><span class="token operator">=</span><span class="token string">"https://kairen.github.io/files/manual-v1.8/pki"</span>
$ <span class="token keyword">export</span> <span class="token constant">KUBE_APISERVER</span><span class="token operator">=</span><span class="token string">"https://172.16.35.12:6443"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><button class="copy">复制</button></div><p>下载ca-config.json与ca-csr.json文件，并生成 CA 密钥：</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0">$ wget <span class="token string">"${PKI_URL}/ca-config.json"</span> <span class="token string">"${PKI_URL}/ca-csr.json"</span>
$ cfssl gencert <span class="token operator">-</span>initca ca<span class="token operator">-</span>csr<span class="token punctuation">.</span>json <span class="token operator">|</span> cfssljson <span class="token operator">-</span>bare ca
$ ls ca<span class="token operator">*</span><span class="token punctuation">.</span>pem
ca<span class="token operator">-</span>key<span class="token punctuation">.</span>pem  ca<span class="token punctuation">.</span>pem<span class="token string">"${PKI_URL}/ca-config.json"</span> <span class="token string">"${PKI_URL}/ca-csr.json"</span>
$ cfssl gencert <span class="token operator">-</span>initca ca<span class="token operator">-</span>csr<span class="token punctuation">.</span>json <span class="token operator">|</span> cfssljson <span class="token operator">-</span>bare ca
$ ls ca<span class="token operator">*</span><span class="token punctuation">.</span>pem
ca<span class="token operator">-</span>key<span class="token punctuation">.</span>pem  ca<span class="token punctuation">.</span>pem<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><button class="copy">复制</button></div><p>API server certificate</p><p>下载apiserver-csr.json文件，并生成 kube-apiserver certificate 证书：</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0">$ wget <span class="token string">"${PKI_URL}/apiserver-csr.json"</span>
$ cfssl gencert \
  <span class="token operator">-</span>ca<span class="token operator">=</span>ca<span class="token punctuation">.</span>pem \
  <span class="token operator">-</span>ca<span class="token operator">-</span>key<span class="token operator">=</span>ca<span class="token operator">-</span>key<span class="token punctuation">.</span>pem \
  <span class="token operator">-</span>config<span class="token operator">=</span>ca<span class="token operator">-</span>config<span class="token punctuation">.</span>json \
  <span class="token operator">-</span>hostname<span class="token operator">=</span><span class="token number">10.96</span><span class="token number">.0</span><span class="token number">.1</span><span class="token punctuation">,</span><span class="token number">172.16</span><span class="token number">.35</span><span class="token number">.12</span><span class="token punctuation">,</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token punctuation">,</span>kubernetes<span class="token punctuation">.</span>default \
  <span class="token operator">-</span>profile<span class="token operator">=</span>kubernetes \
  apiserver<span class="token operator">-</span>csr<span class="token punctuation">.</span>json <span class="token operator">|</span> cfssljson <span class="token operator">-</span>bare apiserver

$ ls apiserver<span class="token operator">*</span><span class="token punctuation">.</span>pem
apiserver<span class="token operator">-</span>key<span class="token punctuation">.</span>pem  apiserver<span class="token punctuation">.</span>pem<span class="token string">"${PKI_URL}/apiserver-csr.json"</span>
$ cfssl gencert \
  <span class="token operator">-</span>ca<span class="token operator">=</span>ca<span class="token punctuation">.</span>pem \
  <span class="token operator">-</span>ca<span class="token operator">-</span>key<span class="token operator">=</span>ca<span class="token operator">-</span>key<span class="token punctuation">.</span>pem \
  <span class="token operator">-</span>config<span class="token operator">=</span>ca<span class="token operator">-</span>config<span class="token punctuation">.</span>json \
  <span class="token operator">-</span>hostname<span class="token operator">=</span><span class="token number">10.96</span><span class="token number">.0</span><span class="token number">.1</span><span class="token punctuation">,</span><span class="token number">172.16</span><span class="token number">.35</span><span class="token number">.12</span><span class="token punctuation">,</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token punctuation">,</span>kubernetes<span class="token punctuation">.</span>default \
  <span class="token operator">-</span>profile<span class="token operator">=</span>kubernetes \
  apiserver<span class="token operator">-</span>csr<span class="token punctuation">.</span>json <span class="token operator">|</span> cfssljson <span class="token operator">-</span>bare apiserver

$ ls apiserver<span class="token operator">*</span><span class="token punctuation">.</span>pem
apiserver<span class="token operator">-</span>key<span class="token punctuation">.</span>pem  apiserver<span class="token punctuation">.</span>pem<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><button class="copy">复制</button></div><blockquote><p> 若节点 IP 不同，需要修改apiserver-csr.json的hosts。
 </p></blockquote><p>Front proxy certificate</p><p>下载front-proxy-ca-csr.json文件，并生成 Front proxy CA 密钥，Front proxy 主要是用在 API aggregator 上:</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0">$ wget <span class="token string">"${PKI_URL}/front-proxy-ca-csr.json"</span>
$ cfssl gencert \
  <span class="token operator">-</span>initca front<span class="token operator">-</span>proxy<span class="token operator">-</span>ca<span class="token operator">-</span>csr<span class="token punctuation">.</span>json <span class="token operator">|</span> cfssljson <span class="token operator">-</span>bare front<span class="token operator">-</span>proxy<span class="token operator">-</span>ca

$ ls front<span class="token operator">-</span>proxy<span class="token operator">-</span>ca<span class="token operator">*</span><span class="token punctuation">.</span>pem
front<span class="token operator">-</span>proxy<span class="token operator">-</span>ca<span class="token operator">-</span>key<span class="token punctuation">.</span>pem  front<span class="token operator">-</span>proxy<span class="token operator">-</span>ca<span class="token punctuation">.</span>pem<span class="token string">"${PKI_URL}/front-proxy-ca-csr.json"</span>
$ cfssl gencert \
  <span class="token operator">-</span>initca front<span class="token operator">-</span>proxy<span class="token operator">-</span>ca<span class="token operator">-</span>csr<span class="token punctuation">.</span>json <span class="token operator">|</span> cfssljson <span class="token operator">-</span>bare front<span class="token operator">-</span>proxy<span class="token operator">-</span>ca

$ ls front<span class="token operator">-</span>proxy<span class="token operator">-</span>ca<span class="token operator">*</span><span class="token punctuation">.</span>pem
front<span class="token operator">-</span>proxy<span class="token operator">-</span>ca<span class="token operator">-</span>key<span class="token punctuation">.</span>pem  front<span class="token operator">-</span>proxy<span class="token operator">-</span>ca<span class="token punctuation">.</span>pem<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><button class="copy">复制</button></div><p>下载front-proxy-client-csr.json文件，并生成 front-proxy-client 证书：</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0">$ wget <span class="token string">"${PKI_URL}/front-proxy-client-csr.json"</span>
$ cfssl gencert \
  <span class="token operator">-</span>ca<span class="token operator">=</span>front<span class="token operator">-</span>proxy<span class="token operator">-</span>ca<span class="token punctuation">.</span>pem \
  <span class="token operator">-</span>ca<span class="token operator">-</span>key<span class="token operator">=</span>front<span class="token operator">-</span>proxy<span class="token operator">-</span>ca<span class="token operator">-</span>key<span class="token punctuation">.</span>pem \
  <span class="token operator">-</span>config<span class="token operator">=</span>ca<span class="token operator">-</span>config<span class="token punctuation">.</span>json \
  <span class="token operator">-</span>profile<span class="token operator">=</span>kubernetes \
  front<span class="token operator">-</span>proxy<span class="token operator">-</span>client<span class="token operator">-</span>csr<span class="token punctuation">.</span>json <span class="token operator">|</span> cfssljson <span class="token operator">-</span>bare front<span class="token operator">-</span>proxy<span class="token operator">-</span>client

$ ls front<span class="token operator">-</span>proxy<span class="token operator">-</span>client<span class="token operator">*</span><span class="token punctuation">.</span>pem
front<span class="token operator">-</span>proxy<span class="token operator">-</span>client<span class="token operator">-</span>key<span class="token punctuation">.</span>pem  front<span class="token operator">-</span>proxy<span class="token operator">-</span>client<span class="token punctuation">.</span>pem<span class="token string">"${PKI_URL}/front-proxy-client-csr.json"</span>
$ cfssl gencert \
  <span class="token operator">-</span>ca<span class="token operator">=</span>front<span class="token operator">-</span>proxy<span class="token operator">-</span>ca<span class="token punctuation">.</span>pem \
  <span class="token operator">-</span>ca<span class="token operator">-</span>key<span class="token operator">=</span>front<span class="token operator">-</span>proxy<span class="token operator">-</span>ca<span class="token operator">-</span>key<span class="token punctuation">.</span>pem \
  <span class="token operator">-</span>config<span class="token operator">=</span>ca<span class="token operator">-</span>config<span class="token punctuation">.</span>json \
  <span class="token operator">-</span>profile<span class="token operator">=</span>kubernetes \
  front<span class="token operator">-</span>proxy<span class="token operator">-</span>client<span class="token operator">-</span>csr<span class="token punctuation">.</span>json <span class="token operator">|</span> cfssljson <span class="token operator">-</span>bare front<span class="token operator">-</span>proxy<span class="token operator">-</span>client

$ ls front<span class="token operator">-</span>proxy<span class="token operator">-</span>client<span class="token operator">*</span><span class="token punctuation">.</span>pem
front<span class="token operator">-</span>proxy<span class="token operator">-</span>client<span class="token operator">-</span>key<span class="token punctuation">.</span>pem  front<span class="token operator">-</span>proxy<span class="token operator">-</span>client<span class="token punctuation">.</span>pem<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><button class="copy">复制</button></div><p><a data-from="10680" href="http://docs.kubernetes.org.cn/713.html" target="_blank" rel="nofollow noopener noreferrer">Bootstrap Token</a></p><p>由于通过手动创建 CA 方式太过繁杂，只适合少量机器，因为每次签证时都需要绑定 Node IP，随机器增加会带来很多困扰，因此这边使用 TLS Bootstrapping 方式进行授权，由 apiserver 自动给符合条件的 Node 发送证书来授权加入集群。</p><p>主要做法是 kubelet 启动时，向 kube-apiserver 传送 TLS Bootstrapping 请求，而 kube-apiserver 验证 kubelet 请求的 token 是否与设定的一样，若一样就自动产生 kubelet 证书与密钥。具体作法可以参考&nbsp;<a data-from="10680" href="http://docs.kubernetes.org.cn/698.html" target="_blank" rel="nofollow noopener noreferrer">TLS bootstrapping</a>。</p><p>首先建立一个变量来产生BOOTSTRAP_TOKEN，并建立&nbsp;bootstrap.conf&nbsp;的 kubeconfig 文件：</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0">$ <span class="token keyword">export</span> <span class="token constant">BOOTSTRAP_TOKEN</span><span class="token operator">=</span><span class="token function">$</span><span class="token punctuation">(</span>head <span class="token operator">-</span>c <span class="token number">16</span> <span class="token operator">/</span>dev<span class="token operator">/</span>urandom <span class="token operator">|</span> od <span class="token operator">-</span>An <span class="token operator">-</span>t x <span class="token operator">|</span> tr <span class="token operator">-</span>d <span class="token string">' '</span><span class="token punctuation">)</span>
$ cat <span class="token operator">&lt;&lt;</span><span class="token constant">EOF</span> <span class="token operator">&gt;</span> <span class="token operator">/</span>etc<span class="token operator">/</span>kubernetes<span class="token operator">/</span>token<span class="token punctuation">.</span>csv
$<span class="token punctuation">{</span><span class="token constant">BOOTSTRAP_TOKEN</span><span class="token punctuation">}</span><span class="token punctuation">,</span>kubelet<span class="token operator">-</span>bootstrap<span class="token punctuation">,</span><span class="token number">10001</span><span class="token punctuation">,</span><span class="token string">"system:kubelet-bootstrap"</span>
<span class="token constant">EOF</span>

# bootstrap set<span class="token operator">-</span>cluster
$ kubectl config set<span class="token operator">-</span>cluster kubernetes \
    <span class="token operator">--</span>certificate<span class="token operator">-</span>authority<span class="token operator">=</span>ca<span class="token punctuation">.</span>pem \
    <span class="token operator">--</span>embed<span class="token operator">-</span>certs<span class="token operator">=</span><span class="token boolean">true</span> \
    <span class="token operator">--</span>server<span class="token operator">=</span>$<span class="token punctuation">{</span><span class="token constant">KUBE_APISERVER</span><span class="token punctuation">}</span> \
    <span class="token operator">--</span>kubeconfig<span class="token operator">=</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>bootstrap<span class="token punctuation">.</span>conf

# bootstrap set<span class="token operator">-</span>credentials
$ kubectl config set<span class="token operator">-</span>credentials kubelet<span class="token operator">-</span>bootstrap \
    <span class="token operator">--</span>token<span class="token operator">=</span>$<span class="token punctuation">{</span><span class="token constant">BOOTSTRAP_TOKEN</span><span class="token punctuation">}</span> \
    <span class="token operator">--</span>kubeconfig<span class="token operator">=</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>bootstrap<span class="token punctuation">.</span>conf

# bootstrap set<span class="token operator">-</span>context
$ kubectl config set<span class="token operator">-</span>context <span class="token keyword">default</span> \
    <span class="token operator">--</span>cluster<span class="token operator">=</span>kubernetes \
    <span class="token operator">--</span>user<span class="token operator">=</span>kubelet<span class="token operator">-</span>bootstrap \
   <span class="token operator">--</span>kubeconfig<span class="token operator">=</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>bootstrap<span class="token punctuation">.</span>conf

# bootstrap <span class="token keyword">set</span> <span class="token keyword">default</span> context
$ kubectl config use<span class="token operator">-</span>context <span class="token keyword">default</span> <span class="token operator">--</span>kubeconfig<span class="token operator">=</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>bootstrap<span class="token punctuation">.</span>confexport <span class="token constant">BOOTSTRAP_TOKEN</span><span class="token operator">=</span><span class="token function">$</span><span class="token punctuation">(</span>head <span class="token operator">-</span>c <span class="token number">16</span> <span class="token operator">/</span>dev<span class="token operator">/</span>urandom <span class="token operator">|</span> od <span class="token operator">-</span>An <span class="token operator">-</span>t x <span class="token operator">|</span> tr <span class="token operator">-</span>d <span class="token string">' '</span><span class="token punctuation">)</span>
$ cat <span class="token operator">&lt;&lt;</span><span class="token constant">EOF</span> <span class="token operator">&gt;</span> <span class="token operator">/</span>etc<span class="token operator">/</span>kubernetes<span class="token operator">/</span>token<span class="token punctuation">.</span>csv
$<span class="token punctuation">{</span><span class="token constant">BOOTSTRAP_TOKEN</span><span class="token punctuation">}</span><span class="token punctuation">,</span>kubelet<span class="token operator">-</span>bootstrap<span class="token punctuation">,</span><span class="token number">10001</span><span class="token punctuation">,</span><span class="token string">"system:kubelet-bootstrap"</span>
<span class="token constant">EOF</span>

# bootstrap set<span class="token operator">-</span>cluster
$ kubectl config set<span class="token operator">-</span>cluster kubernetes \
    <span class="token operator">--</span>certificate<span class="token operator">-</span>authority<span class="token operator">=</span>ca<span class="token punctuation">.</span>pem \
    <span class="token operator">--</span>embed<span class="token operator">-</span>certs<span class="token operator">=</span><span class="token boolean">true</span> \
    <span class="token operator">--</span>server<span class="token operator">=</span>$<span class="token punctuation">{</span><span class="token constant">KUBE_APISERVER</span><span class="token punctuation">}</span> \
    <span class="token operator">--</span>kubeconfig<span class="token operator">=</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>bootstrap<span class="token punctuation">.</span>conf

# bootstrap set<span class="token operator">-</span>credentials
$ kubectl config set<span class="token operator">-</span>credentials kubelet<span class="token operator">-</span>bootstrap \
    <span class="token operator">--</span>token<span class="token operator">=</span>$<span class="token punctuation">{</span><span class="token constant">BOOTSTRAP_TOKEN</span><span class="token punctuation">}</span> \
    <span class="token operator">--</span>kubeconfig<span class="token operator">=</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>bootstrap<span class="token punctuation">.</span>conf

# bootstrap set<span class="token operator">-</span>context
$ kubectl config set<span class="token operator">-</span>context <span class="token keyword">default</span> \
    <span class="token operator">--</span>cluster<span class="token operator">=</span>kubernetes \
    <span class="token operator">--</span>user<span class="token operator">=</span>kubelet<span class="token operator">-</span>bootstrap \
   <span class="token operator">--</span>kubeconfig<span class="token operator">=</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>bootstrap<span class="token punctuation">.</span>conf

# bootstrap <span class="token keyword">set</span> <span class="token keyword">default</span> context
$ kubectl config use<span class="token operator">-</span>context <span class="token keyword">default</span> <span class="token operator">--</span>kubeconfig<span class="token operator">=</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>bootstrap<span class="token punctuation">.</span>conf<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><button class="copy">复制</button></div><blockquote><p> 若想要用 CA 方式来认证，可以参考&nbsp;<a data-from="10680" href="https://gist.github.com/kairen/60ad8545b79e8e7aa9bdc8a2893df7a0" target="_blank" rel="nofollow noopener noreferrer">Kubelet certificate</a>。
 </p></blockquote><p>Admin certificate</p><p>下载admin-csr.json文件，并生成 admin certificate 证书：</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0">$ wget <span class="token string">"${PKI_URL}/admin-csr.json"</span>
$ cfssl gencert \
  <span class="token operator">-</span>ca<span class="token operator">=</span>ca<span class="token punctuation">.</span>pem \
  <span class="token operator">-</span>ca<span class="token operator">-</span>key<span class="token operator">=</span>ca<span class="token operator">-</span>key<span class="token punctuation">.</span>pem \
  <span class="token operator">-</span>config<span class="token operator">=</span>ca<span class="token operator">-</span>config<span class="token punctuation">.</span>json \
  <span class="token operator">-</span>profile<span class="token operator">=</span>kubernetes \
  admin<span class="token operator">-</span>csr<span class="token punctuation">.</span>json <span class="token operator">|</span> cfssljson <span class="token operator">-</span>bare admin

$ ls admin<span class="token operator">*</span><span class="token punctuation">.</span>pem
admin<span class="token operator">-</span>key<span class="token punctuation">.</span>pem  admin<span class="token punctuation">.</span>pem<span class="token string">"${PKI_URL}/admin-csr.json"</span>
$ cfssl gencert \
  <span class="token operator">-</span>ca<span class="token operator">=</span>ca<span class="token punctuation">.</span>pem \
  <span class="token operator">-</span>ca<span class="token operator">-</span>key<span class="token operator">=</span>ca<span class="token operator">-</span>key<span class="token punctuation">.</span>pem \
  <span class="token operator">-</span>config<span class="token operator">=</span>ca<span class="token operator">-</span>config<span class="token punctuation">.</span>json \
  <span class="token operator">-</span>profile<span class="token operator">=</span>kubernetes \
  admin<span class="token operator">-</span>csr<span class="token punctuation">.</span>json <span class="token operator">|</span> cfssljson <span class="token operator">-</span>bare admin

$ ls admin<span class="token operator">*</span><span class="token punctuation">.</span>pem
admin<span class="token operator">-</span>key<span class="token punctuation">.</span>pem  admin<span class="token punctuation">.</span>pem<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><button class="copy">复制</button></div><p>接着通过以下指令生成名称为&nbsp;admin.conf&nbsp;的 kubeconfig 文件：</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0"># admin set<span class="token operator">-</span>cluster
$ kubectl config set<span class="token operator">-</span>cluster kubernetes \
    <span class="token operator">--</span>certificate<span class="token operator">-</span>authority<span class="token operator">=</span>ca<span class="token punctuation">.</span>pem \
    <span class="token operator">--</span>embed<span class="token operator">-</span>certs<span class="token operator">=</span><span class="token boolean">true</span> \
    <span class="token operator">--</span>server<span class="token operator">=</span>$<span class="token punctuation">{</span><span class="token constant">KUBE_APISERVER</span><span class="token punctuation">}</span> \
    <span class="token operator">--</span>kubeconfig<span class="token operator">=</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>admin<span class="token punctuation">.</span>conf

# admin set<span class="token operator">-</span>credentials
$ kubectl config set<span class="token operator">-</span>credentials kubernetes<span class="token operator">-</span>admin \
    <span class="token operator">--</span>client<span class="token operator">-</span>certificate<span class="token operator">=</span>admin<span class="token punctuation">.</span>pem \
    <span class="token operator">--</span>client<span class="token operator">-</span>key<span class="token operator">=</span>admin<span class="token operator">-</span>key<span class="token punctuation">.</span>pem \
    <span class="token operator">--</span>embed<span class="token operator">-</span>certs<span class="token operator">=</span><span class="token boolean">true</span> \
    <span class="token operator">--</span>kubeconfig<span class="token operator">=</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>admin<span class="token punctuation">.</span>conf

# admin set<span class="token operator">-</span>context
$ kubectl config set<span class="token operator">-</span>context kubernetes<span class="token operator">-</span>admin@kubernetes \
    <span class="token operator">--</span>cluster<span class="token operator">=</span>kubernetes \
    <span class="token operator">--</span>user<span class="token operator">=</span>kubernetes<span class="token operator">-</span>admin \
    <span class="token operator">--</span>kubeconfig<span class="token operator">=</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>admin<span class="token punctuation">.</span>conf

# admin <span class="token keyword">set</span> <span class="token keyword">default</span> context
$ kubectl config use<span class="token operator">-</span>context kubernetes<span class="token operator">-</span>admin@kubernetes \
    <span class="token operator">--</span>kubeconfig<span class="token operator">=</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>admin<span class="token punctuation">.</span>conf
$ kubectl config set<span class="token operator">-</span>cluster kubernetes \
    <span class="token operator">--</span>certificate<span class="token operator">-</span>authority<span class="token operator">=</span>ca<span class="token punctuation">.</span>pem \
    <span class="token operator">--</span>embed<span class="token operator">-</span>certs<span class="token operator">=</span><span class="token boolean">true</span> \
    <span class="token operator">--</span>server<span class="token operator">=</span>$<span class="token punctuation">{</span><span class="token constant">KUBE_APISERVER</span><span class="token punctuation">}</span> \
    <span class="token operator">--</span>kubeconfig<span class="token operator">=</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>admin<span class="token punctuation">.</span>conf

# admin set<span class="token operator">-</span>credentials
$ kubectl config set<span class="token operator">-</span>credentials kubernetes<span class="token operator">-</span>admin \
    <span class="token operator">--</span>client<span class="token operator">-</span>certificate<span class="token operator">=</span>admin<span class="token punctuation">.</span>pem \
    <span class="token operator">--</span>client<span class="token operator">-</span>key<span class="token operator">=</span>admin<span class="token operator">-</span>key<span class="token punctuation">.</span>pem \
    <span class="token operator">--</span>embed<span class="token operator">-</span>certs<span class="token operator">=</span><span class="token boolean">true</span> \
    <span class="token operator">--</span>kubeconfig<span class="token operator">=</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>admin<span class="token punctuation">.</span>conf

# admin set<span class="token operator">-</span>context
$ kubectl config set<span class="token operator">-</span>context kubernetes<span class="token operator">-</span>admin@kubernetes \
    <span class="token operator">--</span>cluster<span class="token operator">=</span>kubernetes \
    <span class="token operator">--</span>user<span class="token operator">=</span>kubernetes<span class="token operator">-</span>admin \
    <span class="token operator">--</span>kubeconfig<span class="token operator">=</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>admin<span class="token punctuation">.</span>conf

# admin <span class="token keyword">set</span> <span class="token keyword">default</span> context
$ kubectl config use<span class="token operator">-</span>context kubernetes<span class="token operator">-</span>admin@kubernetes \
    <span class="token operator">--</span>kubeconfig<span class="token operator">=</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>admin<span class="token punctuation">.</span>conf<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><button class="copy">复制</button></div><p>Controller manager certificate</p><p>下载manager-csr.json文件，并生成 kube-controller-manager certificate 证书：</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0">$ wget <span class="token string">"${PKI_URL}/manager-csr.json"</span>
$ cfssl gencert \
  <span class="token operator">-</span>ca<span class="token operator">=</span>ca<span class="token punctuation">.</span>pem \
  <span class="token operator">-</span>ca<span class="token operator">-</span>key<span class="token operator">=</span>ca<span class="token operator">-</span>key<span class="token punctuation">.</span>pem \
  <span class="token operator">-</span>config<span class="token operator">=</span>ca<span class="token operator">-</span>config<span class="token punctuation">.</span>json \
  <span class="token operator">-</span>profile<span class="token operator">=</span>kubernetes \
  manager<span class="token operator">-</span>csr<span class="token punctuation">.</span>json <span class="token operator">|</span> cfssljson <span class="token operator">-</span>bare controller<span class="token operator">-</span>manager

$ ls controller<span class="token operator">-</span>manager<span class="token operator">*</span><span class="token punctuation">.</span>pem<span class="token string">"${PKI_URL}/manager-csr.json"</span>
$ cfssl gencert \
  <span class="token operator">-</span>ca<span class="token operator">=</span>ca<span class="token punctuation">.</span>pem \
  <span class="token operator">-</span>ca<span class="token operator">-</span>key<span class="token operator">=</span>ca<span class="token operator">-</span>key<span class="token punctuation">.</span>pem \
  <span class="token operator">-</span>config<span class="token operator">=</span>ca<span class="token operator">-</span>config<span class="token punctuation">.</span>json \
  <span class="token operator">-</span>profile<span class="token operator">=</span>kubernetes \
  manager<span class="token operator">-</span>csr<span class="token punctuation">.</span>json <span class="token operator">|</span> cfssljson <span class="token operator">-</span>bare controller<span class="token operator">-</span>manager

$ ls controller<span class="token operator">-</span>manager<span class="token operator">*</span><span class="token punctuation">.</span>pem<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><button class="copy">复制</button></div><blockquote><p> 若节点 IP 不同，需要修改manager-csr.json的hosts。
 </p></blockquote><p>接着通过以下指令生成名称为controller-manager.conf的 kubeconfig 文件：</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0"># controller<span class="token operator">-</span>manager set<span class="token operator">-</span>cluster
$ kubectl config set<span class="token operator">-</span>cluster kubernetes \
    <span class="token operator">--</span>certificate<span class="token operator">-</span>authority<span class="token operator">=</span>ca<span class="token punctuation">.</span>pem \
    <span class="token operator">--</span>embed<span class="token operator">-</span>certs<span class="token operator">=</span><span class="token boolean">true</span> \
    <span class="token operator">--</span>server<span class="token operator">=</span>$<span class="token punctuation">{</span><span class="token constant">KUBE_APISERVER</span><span class="token punctuation">}</span> \
    <span class="token operator">--</span>kubeconfig<span class="token operator">=</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>controller<span class="token operator">-</span>manager<span class="token punctuation">.</span>conf

# controller<span class="token operator">-</span>manager set<span class="token operator">-</span>credentials
$ kubectl config set<span class="token operator">-</span>credentials system<span class="token operator">:</span>kube<span class="token operator">-</span>controller<span class="token operator">-</span>manager \
    <span class="token operator">--</span>client<span class="token operator">-</span>certificate<span class="token operator">=</span>controller<span class="token operator">-</span>manager<span class="token punctuation">.</span>pem \
    <span class="token operator">--</span>client<span class="token operator">-</span>key<span class="token operator">=</span>controller<span class="token operator">-</span>manager<span class="token operator">-</span>key<span class="token punctuation">.</span>pem \
    <span class="token operator">--</span>embed<span class="token operator">-</span>certs<span class="token operator">=</span><span class="token boolean">true</span> \
    <span class="token operator">--</span>kubeconfig<span class="token operator">=</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>controller<span class="token operator">-</span>manager<span class="token punctuation">.</span>conf

# controller<span class="token operator">-</span>manager set<span class="token operator">-</span>context
$ kubectl config set<span class="token operator">-</span>context system<span class="token operator">:</span>kube<span class="token operator">-</span>controller<span class="token operator">-</span>manager@kubernetes \
    <span class="token operator">--</span>cluster<span class="token operator">=</span>kubernetes \
    <span class="token operator">--</span>user<span class="token operator">=</span>system<span class="token operator">:</span>kube<span class="token operator">-</span>controller<span class="token operator">-</span>manager \
    <span class="token operator">--</span>kubeconfig<span class="token operator">=</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>controller<span class="token operator">-</span>manager<span class="token punctuation">.</span>conf

# controller<span class="token operator">-</span>manager <span class="token keyword">set</span> <span class="token keyword">default</span> context
$ kubectl config use<span class="token operator">-</span>context system<span class="token operator">:</span>kube<span class="token operator">-</span>controller<span class="token operator">-</span>manager@kubernetes \
    <span class="token operator">--</span>kubeconfig<span class="token operator">=</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>controller<span class="token operator">-</span>manager<span class="token punctuation">.</span>conf
$ kubectl config set<span class="token operator">-</span>cluster kubernetes \
    <span class="token operator">--</span>certificate<span class="token operator">-</span>authority<span class="token operator">=</span>ca<span class="token punctuation">.</span>pem \
    <span class="token operator">--</span>embed<span class="token operator">-</span>certs<span class="token operator">=</span><span class="token boolean">true</span> \
    <span class="token operator">--</span>server<span class="token operator">=</span>$<span class="token punctuation">{</span><span class="token constant">KUBE_APISERVER</span><span class="token punctuation">}</span> \
    <span class="token operator">--</span>kubeconfig<span class="token operator">=</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>controller<span class="token operator">-</span>manager<span class="token punctuation">.</span>conf

# controller<span class="token operator">-</span>manager set<span class="token operator">-</span>credentials
$ kubectl config set<span class="token operator">-</span>credentials system<span class="token operator">:</span>kube<span class="token operator">-</span>controller<span class="token operator">-</span>manager \
    <span class="token operator">--</span>client<span class="token operator">-</span>certificate<span class="token operator">=</span>controller<span class="token operator">-</span>manager<span class="token punctuation">.</span>pem \
    <span class="token operator">--</span>client<span class="token operator">-</span>key<span class="token operator">=</span>controller<span class="token operator">-</span>manager<span class="token operator">-</span>key<span class="token punctuation">.</span>pem \
    <span class="token operator">--</span>embed<span class="token operator">-</span>certs<span class="token operator">=</span><span class="token boolean">true</span> \
    <span class="token operator">--</span>kubeconfig<span class="token operator">=</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>controller<span class="token operator">-</span>manager<span class="token punctuation">.</span>conf

# controller<span class="token operator">-</span>manager set<span class="token operator">-</span>context
$ kubectl config set<span class="token operator">-</span>context system<span class="token operator">:</span>kube<span class="token operator">-</span>controller<span class="token operator">-</span>manager@kubernetes \
    <span class="token operator">--</span>cluster<span class="token operator">=</span>kubernetes \
    <span class="token operator">--</span>user<span class="token operator">=</span>system<span class="token operator">:</span>kube<span class="token operator">-</span>controller<span class="token operator">-</span>manager \
    <span class="token operator">--</span>kubeconfig<span class="token operator">=</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>controller<span class="token operator">-</span>manager<span class="token punctuation">.</span>conf

# controller<span class="token operator">-</span>manager <span class="token keyword">set</span> <span class="token keyword">default</span> context
$ kubectl config use<span class="token operator">-</span>context system<span class="token operator">:</span>kube<span class="token operator">-</span>controller<span class="token operator">-</span>manager@kubernetes \
    <span class="token operator">--</span>kubeconfig<span class="token operator">=</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>controller<span class="token operator">-</span>manager<span class="token punctuation">.</span>conf<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><button class="copy">复制</button></div><p>Scheduler certificate</p><p>下载scheduler-csr.json文件，并生成 kube-scheduler certificate 证书：</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0">$ wget <span class="token string">"${PKI_URL}/scheduler-csr.json"</span>
$ cfssl gencert \
  <span class="token operator">-</span>ca<span class="token operator">=</span>ca<span class="token punctuation">.</span>pem \
  <span class="token operator">-</span>ca<span class="token operator">-</span>key<span class="token operator">=</span>ca<span class="token operator">-</span>key<span class="token punctuation">.</span>pem \
  <span class="token operator">-</span>config<span class="token operator">=</span>ca<span class="token operator">-</span>config<span class="token punctuation">.</span>json \
  <span class="token operator">-</span>profile<span class="token operator">=</span>kubernetes \
  scheduler<span class="token operator">-</span>csr<span class="token punctuation">.</span>json <span class="token operator">|</span> cfssljson <span class="token operator">-</span>bare scheduler

$ ls scheduler<span class="token operator">*</span><span class="token punctuation">.</span>pem
scheduler<span class="token operator">-</span>key<span class="token punctuation">.</span>pem  scheduler<span class="token punctuation">.</span>pem<span class="token string">"${PKI_URL}/scheduler-csr.json"</span>
$ cfssl gencert \
  <span class="token operator">-</span>ca<span class="token operator">=</span>ca<span class="token punctuation">.</span>pem \
  <span class="token operator">-</span>ca<span class="token operator">-</span>key<span class="token operator">=</span>ca<span class="token operator">-</span>key<span class="token punctuation">.</span>pem \
  <span class="token operator">-</span>config<span class="token operator">=</span>ca<span class="token operator">-</span>config<span class="token punctuation">.</span>json \
  <span class="token operator">-</span>profile<span class="token operator">=</span>kubernetes \
  scheduler<span class="token operator">-</span>csr<span class="token punctuation">.</span>json <span class="token operator">|</span> cfssljson <span class="token operator">-</span>bare scheduler

$ ls scheduler<span class="token operator">*</span><span class="token punctuation">.</span>pem
scheduler<span class="token operator">-</span>key<span class="token punctuation">.</span>pem  scheduler<span class="token punctuation">.</span>pem<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><button class="copy">复制</button></div><blockquote><p> 若节点 IP 不同，需要修改scheduler-csr.json的hosts。
 </p></blockquote><p>接着通过以下指令生成名称为&nbsp;scheduler.conf&nbsp;的 kubeconfig 文件：</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0"># scheduler set<span class="token operator">-</span>cluster
$ kubectl config set<span class="token operator">-</span>cluster kubernetes \
    <span class="token operator">--</span>certificate<span class="token operator">-</span>authority<span class="token operator">=</span>ca<span class="token punctuation">.</span>pem \
    <span class="token operator">--</span>embed<span class="token operator">-</span>certs<span class="token operator">=</span><span class="token boolean">true</span> \
    <span class="token operator">--</span>server<span class="token operator">=</span>$<span class="token punctuation">{</span><span class="token constant">KUBE_APISERVER</span><span class="token punctuation">}</span> \
    <span class="token operator">--</span>kubeconfig<span class="token operator">=</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>scheduler<span class="token punctuation">.</span>conf

# scheduler set<span class="token operator">-</span>credentials
$ kubectl config set<span class="token operator">-</span>credentials system<span class="token operator">:</span>kube<span class="token operator">-</span>scheduler \
    <span class="token operator">--</span>client<span class="token operator">-</span>certificate<span class="token operator">=</span>scheduler<span class="token punctuation">.</span>pem \
    <span class="token operator">--</span>client<span class="token operator">-</span>key<span class="token operator">=</span>scheduler<span class="token operator">-</span>key<span class="token punctuation">.</span>pem \
    <span class="token operator">--</span>embed<span class="token operator">-</span>certs<span class="token operator">=</span><span class="token boolean">true</span> \
    <span class="token operator">--</span>kubeconfig<span class="token operator">=</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>scheduler<span class="token punctuation">.</span>conf

# scheduler set<span class="token operator">-</span>context
$ kubectl config set<span class="token operator">-</span>context system<span class="token operator">:</span>kube<span class="token operator">-</span>scheduler@kubernetes \
    <span class="token operator">--</span>cluster<span class="token operator">=</span>kubernetes \
    <span class="token operator">--</span>user<span class="token operator">=</span>system<span class="token operator">:</span>kube<span class="token operator">-</span>scheduler \
    <span class="token operator">--</span>kubeconfig<span class="token operator">=</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>scheduler<span class="token punctuation">.</span>conf

# scheduler <span class="token keyword">set</span> <span class="token keyword">default</span> context
$ kubectl config use<span class="token operator">-</span>context system<span class="token operator">:</span>kube<span class="token operator">-</span>scheduler@kubernetes \
    <span class="token operator">--</span>kubeconfig<span class="token operator">=</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>scheduler<span class="token punctuation">.</span>conf
$ kubectl config set<span class="token operator">-</span>cluster kubernetes \
    <span class="token operator">--</span>certificate<span class="token operator">-</span>authority<span class="token operator">=</span>ca<span class="token punctuation">.</span>pem \
    <span class="token operator">--</span>embed<span class="token operator">-</span>certs<span class="token operator">=</span><span class="token boolean">true</span> \
    <span class="token operator">--</span>server<span class="token operator">=</span>$<span class="token punctuation">{</span><span class="token constant">KUBE_APISERVER</span><span class="token punctuation">}</span> \
    <span class="token operator">--</span>kubeconfig<span class="token operator">=</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>scheduler<span class="token punctuation">.</span>conf

# scheduler set<span class="token operator">-</span>credentials
$ kubectl config set<span class="token operator">-</span>credentials system<span class="token operator">:</span>kube<span class="token operator">-</span>scheduler \
    <span class="token operator">--</span>client<span class="token operator">-</span>certificate<span class="token operator">=</span>scheduler<span class="token punctuation">.</span>pem \
    <span class="token operator">--</span>client<span class="token operator">-</span>key<span class="token operator">=</span>scheduler<span class="token operator">-</span>key<span class="token punctuation">.</span>pem \
    <span class="token operator">--</span>embed<span class="token operator">-</span>certs<span class="token operator">=</span><span class="token boolean">true</span> \
    <span class="token operator">--</span>kubeconfig<span class="token operator">=</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>scheduler<span class="token punctuation">.</span>conf

# scheduler set<span class="token operator">-</span>context
$ kubectl config set<span class="token operator">-</span>context system<span class="token operator">:</span>kube<span class="token operator">-</span>scheduler@kubernetes \
    <span class="token operator">--</span>cluster<span class="token operator">=</span>kubernetes \
    <span class="token operator">--</span>user<span class="token operator">=</span>system<span class="token operator">:</span>kube<span class="token operator">-</span>scheduler \
    <span class="token operator">--</span>kubeconfig<span class="token operator">=</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>scheduler<span class="token punctuation">.</span>conf

# scheduler <span class="token keyword">set</span> <span class="token keyword">default</span> context
$ kubectl config use<span class="token operator">-</span>context system<span class="token operator">:</span>kube<span class="token operator">-</span>scheduler@kubernetes \
    <span class="token operator">--</span>kubeconfig<span class="token operator">=</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>scheduler<span class="token punctuation">.</span>conf<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><button class="copy">复制</button></div><p>Kubelet master certificate</p><p>下载kubelet-csr.json文件，并生成 master node certificate 证书：</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0">$ wget <span class="token string">"${PKI_URL}/kubelet-csr.json"</span>
$ sed <span class="token operator">-</span>i <span class="token string">'s/$NODE/master1/g'</span> kubelet<span class="token operator">-</span>csr<span class="token punctuation">.</span>json
$ cfssl gencert \
  <span class="token operator">-</span>ca<span class="token operator">=</span>ca<span class="token punctuation">.</span>pem \
  <span class="token operator">-</span>ca<span class="token operator">-</span>key<span class="token operator">=</span>ca<span class="token operator">-</span>key<span class="token punctuation">.</span>pem \
  <span class="token operator">-</span>config<span class="token operator">=</span>ca<span class="token operator">-</span>config<span class="token punctuation">.</span>json \
  <span class="token operator">-</span>hostname<span class="token operator">=</span>master1<span class="token punctuation">,</span><span class="token number">172.16</span><span class="token number">.35</span><span class="token number">.12</span><span class="token punctuation">,</span><span class="token number">172.16</span><span class="token number">.35</span><span class="token number">.12</span> \
  <span class="token operator">-</span>profile<span class="token operator">=</span>kubernetes \
  kubelet<span class="token operator">-</span>csr<span class="token punctuation">.</span>json <span class="token operator">|</span> cfssljson <span class="token operator">-</span>bare kubelet

$ ls kubelet<span class="token operator">*</span><span class="token punctuation">.</span>pem
kubelet<span class="token operator">-</span>key<span class="token punctuation">.</span>pem  kubelet<span class="token punctuation">.</span>pem<span class="token string">"${PKI_URL}/kubelet-csr.json"</span>
$ sed <span class="token operator">-</span>i <span class="token string">'s/$NODE/master1/g'</span> kubelet<span class="token operator">-</span>csr<span class="token punctuation">.</span>json
$ cfssl gencert \
  <span class="token operator">-</span>ca<span class="token operator">=</span>ca<span class="token punctuation">.</span>pem \
  <span class="token operator">-</span>ca<span class="token operator">-</span>key<span class="token operator">=</span>ca<span class="token operator">-</span>key<span class="token punctuation">.</span>pem \
  <span class="token operator">-</span>config<span class="token operator">=</span>ca<span class="token operator">-</span>config<span class="token punctuation">.</span>json \
  <span class="token operator">-</span>hostname<span class="token operator">=</span>master1<span class="token punctuation">,</span><span class="token number">172.16</span><span class="token number">.35</span><span class="token number">.12</span><span class="token punctuation">,</span><span class="token number">172.16</span><span class="token number">.35</span><span class="token number">.12</span> \
  <span class="token operator">-</span>profile<span class="token operator">=</span>kubernetes \
  kubelet<span class="token operator">-</span>csr<span class="token punctuation">.</span>json <span class="token operator">|</span> cfssljson <span class="token operator">-</span>bare kubelet

$ ls kubelet<span class="token operator">*</span><span class="token punctuation">.</span>pem
kubelet<span class="token operator">-</span>key<span class="token punctuation">.</span>pem  kubelet<span class="token punctuation">.</span>pem<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><button class="copy">复制</button></div><blockquote><p> 这边$NODE需要随节点名称不同而改变。
 </p></blockquote><p>接着通过以下指令生成名称为&nbsp;kubelet.conf&nbsp;的 kubeconfig 文件：</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0"># kubelet set<span class="token operator">-</span>cluster
$ kubectl config set<span class="token operator">-</span>cluster kubernetes \
    <span class="token operator">--</span>certificate<span class="token operator">-</span>authority<span class="token operator">=</span>ca<span class="token punctuation">.</span>pem \
    <span class="token operator">--</span>embed<span class="token operator">-</span>certs<span class="token operator">=</span><span class="token boolean">true</span> \
    <span class="token operator">--</span>server<span class="token operator">=</span>$<span class="token punctuation">{</span><span class="token constant">KUBE_APISERVER</span><span class="token punctuation">}</span> \
    <span class="token operator">--</span>kubeconfig<span class="token operator">=</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>kubelet<span class="token punctuation">.</span>conf

# kubelet set<span class="token operator">-</span>credentials
$ kubectl config set<span class="token operator">-</span>credentials system<span class="token operator">:</span>node<span class="token operator">:</span>master1 \
    <span class="token operator">--</span>client<span class="token operator">-</span>certificate<span class="token operator">=</span>kubelet<span class="token punctuation">.</span>pem \
    <span class="token operator">--</span>client<span class="token operator">-</span>key<span class="token operator">=</span>kubelet<span class="token operator">-</span>key<span class="token punctuation">.</span>pem \
    <span class="token operator">--</span>embed<span class="token operator">-</span>certs<span class="token operator">=</span><span class="token boolean">true</span> \
    <span class="token operator">--</span>kubeconfig<span class="token operator">=</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>kubelet<span class="token punctuation">.</span>conf

# kubelet set<span class="token operator">-</span>context
$ kubectl config set<span class="token operator">-</span>context system<span class="token operator">:</span>node<span class="token operator">:</span>master1@kubernetes \
    <span class="token operator">--</span>cluster<span class="token operator">=</span>kubernetes \
    <span class="token operator">--</span>user<span class="token operator">=</span>system<span class="token operator">:</span>node<span class="token operator">:</span>master1 \
    <span class="token operator">--</span>kubeconfig<span class="token operator">=</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>kubelet<span class="token punctuation">.</span>conf

# kubelet <span class="token keyword">set</span> <span class="token keyword">default</span> context
$ kubectl config use<span class="token operator">-</span>context system<span class="token operator">:</span>node<span class="token operator">:</span>master1@kubernetes \
    <span class="token operator">--</span>kubeconfig<span class="token operator">=</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>kubelet<span class="token punctuation">.</span>conf
$ kubectl config set<span class="token operator">-</span>cluster kubernetes \
    <span class="token operator">--</span>certificate<span class="token operator">-</span>authority<span class="token operator">=</span>ca<span class="token punctuation">.</span>pem \
    <span class="token operator">--</span>embed<span class="token operator">-</span>certs<span class="token operator">=</span><span class="token boolean">true</span> \
    <span class="token operator">--</span>server<span class="token operator">=</span>$<span class="token punctuation">{</span><span class="token constant">KUBE_APISERVER</span><span class="token punctuation">}</span> \
    <span class="token operator">--</span>kubeconfig<span class="token operator">=</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>kubelet<span class="token punctuation">.</span>conf

# kubelet set<span class="token operator">-</span>credentials
$ kubectl config set<span class="token operator">-</span>credentials system<span class="token operator">:</span>node<span class="token operator">:</span>master1 \
    <span class="token operator">--</span>client<span class="token operator">-</span>certificate<span class="token operator">=</span>kubelet<span class="token punctuation">.</span>pem \
    <span class="token operator">--</span>client<span class="token operator">-</span>key<span class="token operator">=</span>kubelet<span class="token operator">-</span>key<span class="token punctuation">.</span>pem \
    <span class="token operator">--</span>embed<span class="token operator">-</span>certs<span class="token operator">=</span><span class="token boolean">true</span> \
    <span class="token operator">--</span>kubeconfig<span class="token operator">=</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>kubelet<span class="token punctuation">.</span>conf

# kubelet set<span class="token operator">-</span>context
$ kubectl config set<span class="token operator">-</span>context system<span class="token operator">:</span>node<span class="token operator">:</span>master1@kubernetes \
    <span class="token operator">--</span>cluster<span class="token operator">=</span>kubernetes \
    <span class="token operator">--</span>user<span class="token operator">=</span>system<span class="token operator">:</span>node<span class="token operator">:</span>master1 \
    <span class="token operator">--</span>kubeconfig<span class="token operator">=</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>kubelet<span class="token punctuation">.</span>conf

# kubelet <span class="token keyword">set</span> <span class="token keyword">default</span> context
$ kubectl config use<span class="token operator">-</span>context system<span class="token operator">:</span>node<span class="token operator">:</span>master1@kubernetes \
    <span class="token operator">--</span>kubeconfig<span class="token operator">=</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>kubelet<span class="token punctuation">.</span>conf<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><button class="copy">复制</button></div><p>Service account key</p><p>Service account 不是通过 CA 进行认证，因此不要通过 CA 来做 Service account key 的检查，这边建立一组 Private 与 Public 密钥提供给 Service account key 使用：</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0">$ openssl genrsa <span class="token operator">-</span>out sa<span class="token punctuation">.</span>key <span class="token number">2048</span>
$ openssl rsa <span class="token operator">-</span><span class="token keyword">in</span> sa<span class="token punctuation">.</span>key <span class="token operator">-</span>pubout <span class="token operator">-</span>out sa<span class="token punctuation">.</span>pub
$ ls sa<span class="token punctuation">.</span><span class="token operator">*</span>
sa<span class="token punctuation">.</span>key  sa<span class="token punctuation">.</span>pub<span class="token operator">-</span>out sa<span class="token punctuation">.</span>key <span class="token number">2048</span>
$ openssl rsa <span class="token operator">-</span><span class="token keyword">in</span> sa<span class="token punctuation">.</span>key <span class="token operator">-</span>pubout <span class="token operator">-</span>out sa<span class="token punctuation">.</span>pub
$ ls sa<span class="token punctuation">.</span><span class="token operator">*</span>
sa<span class="token punctuation">.</span>key  sa<span class="token punctuation">.</span>pub<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><button class="copy">复制</button></div><p>完成后删除不必要文件：</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0">$ rm <span class="token operator">-</span>rf <span class="token operator">*</span><span class="token punctuation">.</span>json <span class="token operator">*</span><span class="token punctuation">.</span>csr<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><button class="copy">复制</button></div><p>确认/etc/kubernetes与/etc/kubernetes/pki有以下文件：</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0">$ ls <span class="token operator">/</span>etc<span class="token operator">/</span>kubernetes<span class="token operator">/</span>
admin<span class="token punctuation">.</span>conf  bootstrap<span class="token punctuation">.</span>conf  controller<span class="token operator">-</span>manager<span class="token punctuation">.</span>conf  kubelet<span class="token punctuation">.</span>conf  pki  scheduler<span class="token punctuation">.</span>conf  token<span class="token punctuation">.</span>csv

$ ls <span class="token operator">/</span>etc<span class="token operator">/</span>kubernetes<span class="token operator">/</span>pki
admin<span class="token operator">-</span>key<span class="token punctuation">.</span>pem  apiserver<span class="token operator">-</span>key<span class="token punctuation">.</span>pem  ca<span class="token operator">-</span>key<span class="token punctuation">.</span>pem  controller<span class="token operator">-</span>manager<span class="token operator">-</span>key<span class="token punctuation">.</span>pem  front<span class="token operator">-</span>proxy<span class="token operator">-</span>ca<span class="token operator">-</span>key<span class="token punctuation">.</span>pem  front<span class="token operator">-</span>proxy<span class="token operator">-</span>client<span class="token operator">-</span>key<span class="token punctuation">.</span>pem  kubelet<span class="token operator">-</span>key<span class="token punctuation">.</span>pem  sa<span class="token punctuation">.</span>key  scheduler<span class="token operator">-</span>key<span class="token punctuation">.</span>pem
admin<span class="token punctuation">.</span>pem      apiserver<span class="token punctuation">.</span>pem      ca<span class="token punctuation">.</span>pem      controller<span class="token operator">-</span>manager<span class="token punctuation">.</span>pem      front<span class="token operator">-</span>proxy<span class="token operator">-</span>ca<span class="token punctuation">.</span>pem      front<span class="token operator">-</span>proxy<span class="token operator">-</span>client<span class="token punctuation">.</span>pem      kubelet<span class="token punctuation">.</span>pem      sa<span class="token punctuation">.</span>pub  scheduler<span class="token punctuation">.</span>pem<span class="token operator">/</span>etc<span class="token operator">/</span>kubernetes<span class="token operator">/</span>
admin<span class="token punctuation">.</span>conf  bootstrap<span class="token punctuation">.</span>conf  controller<span class="token operator">-</span>manager<span class="token punctuation">.</span>conf  kubelet<span class="token punctuation">.</span>conf  pki  scheduler<span class="token punctuation">.</span>conf  token<span class="token punctuation">.</span>csv

$ ls <span class="token operator">/</span>etc<span class="token operator">/</span>kubernetes<span class="token operator">/</span>pki
admin<span class="token operator">-</span>key<span class="token punctuation">.</span>pem  apiserver<span class="token operator">-</span>key<span class="token punctuation">.</span>pem  ca<span class="token operator">-</span>key<span class="token punctuation">.</span>pem  controller<span class="token operator">-</span>manager<span class="token operator">-</span>key<span class="token punctuation">.</span>pem  front<span class="token operator">-</span>proxy<span class="token operator">-</span>ca<span class="token operator">-</span>key<span class="token punctuation">.</span>pem  front<span class="token operator">-</span>proxy<span class="token operator">-</span>client<span class="token operator">-</span>key<span class="token punctuation">.</span>pem  kubelet<span class="token operator">-</span>key<span class="token punctuation">.</span>pem  sa<span class="token punctuation">.</span>key  scheduler<span class="token operator">-</span>key<span class="token punctuation">.</span>pem
admin<span class="token punctuation">.</span>pem      apiserver<span class="token punctuation">.</span>pem      ca<span class="token punctuation">.</span>pem      controller<span class="token operator">-</span>manager<span class="token punctuation">.</span>pem      front<span class="token operator">-</span>proxy<span class="token operator">-</span>ca<span class="token punctuation">.</span>pem      front<span class="token operator">-</span>proxy<span class="token operator">-</span>client<span class="token punctuation">.</span>pem      kubelet<span class="token punctuation">.</span>pem      sa<span class="token punctuation">.</span>pub  scheduler<span class="token punctuation">.</span>pem<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><button class="copy">复制</button></div><h3 id="%E5%AE%89%E8%A3%85-Kubernetes-%E6%A0%B8%E5%BF%83%E7%BB%84%E4%BB%B6" name="%E5%AE%89%E8%A3%85-Kubernetes-%E6%A0%B8%E5%BF%83%E7%BB%84%E4%BB%B6">安装 Kubernetes 核心组件</h3><p>首先下载 Kubernetes 核心组件 YAML 文件，这边我们不透过 Binary 方案来创建 Master 核心组件，而是利用 Kubernetes Static Pod 来创建，因此需下载所有核心组件的Static Pod文件到/etc/kubernetes/manifests目录：</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0">$ <span class="token keyword">export</span> <span class="token constant">CORE_URL</span><span class="token operator">=</span><span class="token string">"https://kairen.github.io/files/manual-v1.8/master"</span>
$ mkdir <span class="token operator">-</span>p <span class="token operator">/</span>etc<span class="token operator">/</span>kubernetes<span class="token operator">/</span>manifests <span class="token operator">&amp;&amp;</span> cd <span class="token operator">/</span>etc<span class="token operator">/</span>kubernetes<span class="token operator">/</span>manifests
$ <span class="token keyword">for</span> <span class="token constant">FILE</span> <span class="token keyword">in</span> apiserver manager scheduler<span class="token punctuation">;</span> <span class="token keyword">do</span>
    wget <span class="token string">"${CORE_URL}/${FILE}.yml.conf"</span> <span class="token operator">-</span><span class="token constant">O</span> $<span class="token punctuation">{</span><span class="token constant">FILE</span><span class="token punctuation">}</span><span class="token punctuation">.</span>yml
  doneexport <span class="token constant">CORE_URL</span><span class="token operator">=</span><span class="token string">"https://kairen.github.io/files/manual-v1.8/master"</span>
$ mkdir <span class="token operator">-</span>p <span class="token operator">/</span>etc<span class="token operator">/</span>kubernetes<span class="token operator">/</span>manifests <span class="token operator">&amp;&amp;</span> cd <span class="token operator">/</span>etc<span class="token operator">/</span>kubernetes<span class="token operator">/</span>manifests
$ <span class="token keyword">for</span> <span class="token constant">FILE</span> <span class="token keyword">in</span> apiserver manager scheduler<span class="token punctuation">;</span> <span class="token keyword">do</span>
    wget <span class="token string">"${CORE_URL}/${FILE}.yml.conf"</span> <span class="token operator">-</span><span class="token constant">O</span> $<span class="token punctuation">{</span><span class="token constant">FILE</span><span class="token punctuation">}</span><span class="token punctuation">.</span>yml
  done<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><button class="copy">复制</button></div><blockquote><p> 若IP与教程设定不同的话，请记得修改apiserver.yml、manager.yml、scheduler.yml。
 apiserver 中的&nbsp;NodeRestriction&nbsp;请参考&nbsp;<a data-from="10680" href="http://docs.kubernetes.org.cn/156.html" target="_blank" rel="nofollow noopener noreferrer">Using Node Authorization</a>。
 </p></blockquote><p>生成一个用来加密 Etcd 的 Key：</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0">$ head <span class="token operator">-</span>c <span class="token number">32</span> <span class="token operator">/</span>dev<span class="token operator">/</span>urandom <span class="token operator">|</span> base64
SUpbL4juUYyvxj3<span class="token operator">/</span>gonV5xVEx8j769<span class="token operator">/</span>99TSAf8YT<span class="token operator">/</span>sQ<span class="token operator">=</span><span class="token operator">-</span>c <span class="token number">32</span> <span class="token operator">/</span>dev<span class="token operator">/</span>urandom <span class="token operator">|</span> base64
SUpbL4juUYyvxj3<span class="token operator">/</span>gonV5xVEx8j769<span class="token operator">/</span>99TSAf8YT<span class="token operator">/</span>sQ<span class="token operator">=</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><button class="copy">复制</button></div><p>在/etc/kubernetes/目录下，创建encryption.yml的加密 YAML 文件：</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0">$ cat <span class="token operator">&lt;&lt;</span><span class="token constant">EOF</span> <span class="token operator">&gt;</span> <span class="token operator">/</span>etc<span class="token operator">/</span>kubernetes<span class="token operator">/</span>encryption<span class="token punctuation">.</span>yml
<span class="token literal-property property">kind</span><span class="token operator">:</span> EncryptionConfig
<span class="token literal-property property">apiVersion</span><span class="token operator">:</span> v1
<span class="token literal-property property">resources</span><span class="token operator">:</span>
  <span class="token operator">-</span> resources<span class="token operator">:</span>
      <span class="token operator">-</span> secrets
    <span class="token literal-property property">providers</span><span class="token operator">:</span>
      <span class="token operator">-</span> aescbc<span class="token operator">:</span>
          <span class="token literal-property property">keys</span><span class="token operator">:</span>
            <span class="token operator">-</span> name<span class="token operator">:</span> key1
              <span class="token literal-property property">secret</span><span class="token operator">:</span> SUpbL4juUYyvxj3<span class="token operator">/</span>gonV5xVEx8j769<span class="token operator">/</span>99TSAf8YT<span class="token operator">/</span>sQ<span class="token operator">=</span>
      <span class="token operator">-</span> identity<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token constant">EOF</span><span class="token operator">&lt;&lt;</span><span class="token constant">EOF</span> <span class="token operator">&gt;</span> <span class="token operator">/</span>etc<span class="token operator">/</span>kubernetes<span class="token operator">/</span>encryption<span class="token punctuation">.</span>yml
<span class="token literal-property property">kind</span><span class="token operator">:</span> EncryptionConfig
<span class="token literal-property property">apiVersion</span><span class="token operator">:</span> v1
<span class="token literal-property property">resources</span><span class="token operator">:</span>
  <span class="token operator">-</span> resources<span class="token operator">:</span>
      <span class="token operator">-</span> secrets
    <span class="token literal-property property">providers</span><span class="token operator">:</span>
      <span class="token operator">-</span> aescbc<span class="token operator">:</span>
          <span class="token literal-property property">keys</span><span class="token operator">:</span>
            <span class="token operator">-</span> name<span class="token operator">:</span> key1
              <span class="token literal-property property">secret</span><span class="token operator">:</span> SUpbL4juUYyvxj3<span class="token operator">/</span>gonV5xVEx8j769<span class="token operator">/</span>99TSAf8YT<span class="token operator">/</span>sQ<span class="token operator">=</span>
      <span class="token operator">-</span> identity<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token constant">EOF</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><button class="copy">复制</button></div><blockquote><p> Etcd <a data-text-link="2356_2197170" data-from="10680" href="https://cloud.tencent.com/solution/domesticencryption?from=10680" target="_blank">数据加密</a>可参考这篇&nbsp;<a data-from="10680" href="https://kubernetes.io/docs/tasks/administer-cluster/encrypt-data/" target="_blank" rel="nofollow noopener noreferrer">Encrypting data at rest</a>。
 </p></blockquote><p>在/etc/kubernetes/目录下，创建audit-policy.yml的进阶审核策略 YAML 文件：</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0">$ cat <span class="token operator">&lt;&lt;</span><span class="token constant">EOF</span> <span class="token operator">&gt;</span> <span class="token operator">/</span>etc<span class="token operator">/</span>kubernetes<span class="token operator">/</span>audit<span class="token operator">-</span>policy<span class="token punctuation">.</span>yml
<span class="token literal-property property">apiVersion</span><span class="token operator">:</span> audit<span class="token punctuation">.</span>k8s<span class="token punctuation">.</span>io<span class="token operator">/</span>v1beta1
<span class="token literal-property property">kind</span><span class="token operator">:</span> Policy
<span class="token literal-property property">rules</span><span class="token operator">:</span>
<span class="token operator">-</span> level<span class="token operator">:</span> Metadata
<span class="token constant">EOF</span><span class="token operator">&lt;&lt;</span><span class="token constant">EOF</span> <span class="token operator">&gt;</span> <span class="token operator">/</span>etc<span class="token operator">/</span>kubernetes<span class="token operator">/</span>audit<span class="token operator">-</span>policy<span class="token punctuation">.</span>yml
<span class="token literal-property property">apiVersion</span><span class="token operator">:</span> audit<span class="token punctuation">.</span>k8s<span class="token punctuation">.</span>io<span class="token operator">/</span>v1beta1
<span class="token literal-property property">kind</span><span class="token operator">:</span> Policy
<span class="token literal-property property">rules</span><span class="token operator">:</span>
<span class="token operator">-</span> level<span class="token operator">:</span> Metadata
<span class="token constant">EOF</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><button class="copy">复制</button></div><blockquote><p> Audit Policy 请参考这篇&nbsp;<a data-from="10680" href="https://kubernetes.io/docs/tasks/debug-application-cluster/audit/" target="_blank" rel="nofollow noopener noreferrer">Auditing</a>。
 </p></blockquote><p>下载kubelet.service相关文件来管理 kubelet：</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0">$ <span class="token keyword">export</span> <span class="token constant">KUBELET_URL</span><span class="token operator">=</span><span class="token string">"https://kairen.github.io/files/manual-v1.8/master"</span>
$ mkdir <span class="token operator">-</span>p <span class="token operator">/</span>etc<span class="token operator">/</span>systemd<span class="token operator">/</span>system<span class="token operator">/</span>kubelet<span class="token punctuation">.</span>service<span class="token punctuation">.</span>d
$ wget <span class="token string">"${KUBELET_URL}/kubelet.service"</span> <span class="token operator">-</span><span class="token constant">O</span> <span class="token operator">/</span>lib<span class="token operator">/</span>systemd<span class="token operator">/</span>system<span class="token operator">/</span>kubelet<span class="token punctuation">.</span>service
$ wget <span class="token string">"${KUBELET_URL}/10-kubelet.conf"</span> <span class="token operator">-</span><span class="token constant">O</span> <span class="token operator">/</span>etc<span class="token operator">/</span>systemd<span class="token operator">/</span>system<span class="token operator">/</span>kubelet<span class="token punctuation">.</span>service<span class="token punctuation">.</span>d<span class="token operator">/</span><span class="token number">10</span><span class="token operator">-</span>kubelet<span class="token punctuation">.</span>confexport <span class="token constant">KUBELET_URL</span><span class="token operator">=</span><span class="token string">"https://kairen.github.io/files/manual-v1.8/master"</span>
$ mkdir <span class="token operator">-</span>p <span class="token operator">/</span>etc<span class="token operator">/</span>systemd<span class="token operator">/</span>system<span class="token operator">/</span>kubelet<span class="token punctuation">.</span>service<span class="token punctuation">.</span>d
$ wget <span class="token string">"${KUBELET_URL}/kubelet.service"</span> <span class="token operator">-</span><span class="token constant">O</span> <span class="token operator">/</span>lib<span class="token operator">/</span>systemd<span class="token operator">/</span>system<span class="token operator">/</span>kubelet<span class="token punctuation">.</span>service
$ wget <span class="token string">"${KUBELET_URL}/10-kubelet.conf"</span> <span class="token operator">-</span><span class="token constant">O</span> <span class="token operator">/</span>etc<span class="token operator">/</span>systemd<span class="token operator">/</span>system<span class="token operator">/</span>kubelet<span class="token punctuation">.</span>service<span class="token punctuation">.</span>d<span class="token operator">/</span><span class="token number">10</span><span class="token operator">-</span>kubelet<span class="token punctuation">.</span>conf<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><button class="copy">复制</button></div><p>最后创建 var 存放信息，然后启动 kubelet 服务:</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0">$ mkdir <span class="token operator">-</span>p <span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>lib<span class="token operator">/</span>kubelet <span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>log<span class="token operator">/</span>kubernetes
$ systemctl enable kubelet<span class="token punctuation">.</span>service <span class="token operator">&amp;&amp;</span> systemctl start kubelet<span class="token punctuation">.</span>service<span class="token operator">-</span>p <span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>lib<span class="token operator">/</span>kubelet <span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>log<span class="token operator">/</span>kubernetes
$ systemctl enable kubelet<span class="token punctuation">.</span>service <span class="token operator">&amp;&amp;</span> systemctl start kubelet<span class="token punctuation">.</span>service<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><button class="copy">复制</button></div><p>完成后会需要一段时间来下载镜像文件与启动组件，可以利用该指令来查看：</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0">$ watch netstat <span class="token operator">-</span>ntlp
tcp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">:</span><span class="token number">10248</span>         <span class="token number">0.0</span><span class="token number">.0</span><span class="token number">.0</span><span class="token operator">:</span><span class="token operator">*</span>               <span class="token constant">LISTEN</span>      <span class="token number">23012</span><span class="token operator">/</span>kubelet
tcp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">:</span><span class="token number">10251</span>         <span class="token number">0.0</span><span class="token number">.0</span><span class="token number">.0</span><span class="token operator">:</span><span class="token operator">*</span>               <span class="token constant">LISTEN</span>      <span class="token number">22305</span><span class="token operator">/</span>kube<span class="token operator">-</span>schedule
tcp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">:</span><span class="token number">10252</span>         <span class="token number">0.0</span><span class="token number">.0</span><span class="token number">.0</span><span class="token operator">:</span><span class="token operator">*</span>               <span class="token constant">LISTEN</span>      <span class="token number">22529</span><span class="token operator">/</span>kube<span class="token operator">-</span>controll
tcp6       <span class="token number">0</span>      <span class="token number">0</span> <span class="token operator">:</span><span class="token operator">:</span><span class="token operator">:</span><span class="token number">6443</span>                 <span class="token operator">:</span><span class="token operator">:</span><span class="token operator">:</span><span class="token operator">*</span>                    <span class="token constant">LISTEN</span>      <span class="token number">22956</span><span class="token operator">/</span>kube<span class="token operator">-</span>apiserve<span class="token operator">-</span>ntlp
tcp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">:</span><span class="token number">10248</span>         <span class="token number">0.0</span><span class="token number">.0</span><span class="token number">.0</span><span class="token operator">:</span><span class="token operator">*</span>               <span class="token constant">LISTEN</span>      <span class="token number">23012</span><span class="token operator">/</span>kubelet
tcp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">:</span><span class="token number">10251</span>         <span class="token number">0.0</span><span class="token number">.0</span><span class="token number">.0</span><span class="token operator">:</span><span class="token operator">*</span>               <span class="token constant">LISTEN</span>      <span class="token number">22305</span><span class="token operator">/</span>kube<span class="token operator">-</span>schedule
tcp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">:</span><span class="token number">10252</span>         <span class="token number">0.0</span><span class="token number">.0</span><span class="token number">.0</span><span class="token operator">:</span><span class="token operator">*</span>               <span class="token constant">LISTEN</span>      <span class="token number">22529</span><span class="token operator">/</span>kube<span class="token operator">-</span>controll
tcp6       <span class="token number">0</span>      <span class="token number">0</span> <span class="token operator">:</span><span class="token operator">:</span><span class="token operator">:</span><span class="token number">6443</span>                 <span class="token operator">:</span><span class="token operator">:</span><span class="token operator">:</span><span class="token operator">*</span>                    <span class="token constant">LISTEN</span>      <span class="token number">22956</span><span class="token operator">/</span>kube<span class="token operator">-</span>apiserve<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><button class="copy">复制</button></div><blockquote><p> 若看到以上信息表示服务正常启动，若发生问题可以用docker cli来查看。
 </p></blockquote><p>完成后，复制 admin kubeconfig 文件，并通过简单指令验证：</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0">$ cp <span class="token operator">/</span>etc<span class="token operator">/</span>kubernetes<span class="token operator">/</span>admin<span class="token punctuation">.</span>conf <span class="token operator">~</span><span class="token operator">/</span><span class="token punctuation">.</span>kube<span class="token operator">/</span>config
$ kubectl <span class="token keyword">get</span> cs
<span class="token constant">NAME</span>                 <span class="token constant">STATUS</span>    <span class="token constant">MESSAGE</span>              <span class="token constant">ERROR</span>
etcd<span class="token operator">-</span><span class="token number">0</span>               Healthy   <span class="token punctuation">{</span><span class="token string-property property">"health"</span><span class="token operator">:</span> <span class="token string">"true"</span><span class="token punctuation">}</span>
scheduler            Healthy   ok
controller<span class="token operator">-</span>manager   Healthy   ok

$ kubectl <span class="token keyword">get</span> node
<span class="token constant">NAME</span>      <span class="token constant">STATUS</span>     <span class="token constant">ROLES</span>     <span class="token constant">AGE</span>       <span class="token constant">VERSION</span>
master1   NotReady   master    4m        v1<span class="token punctuation">.</span><span class="token number">8.2</span>

$ kubectl <span class="token operator">-</span>n kube<span class="token operator">-</span>system <span class="token keyword">get</span> po
<span class="token constant">NAME</span>                              <span class="token constant">READY</span>     <span class="token constant">STATUS</span>    <span class="token constant">RESTARTS</span>   <span class="token constant">AGE</span>
kube<span class="token operator">-</span>apiserver<span class="token operator">-</span>master1            <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>       Running   <span class="token number">0</span>          4m
kube<span class="token operator">-</span>controller<span class="token operator">-</span>manager<span class="token operator">-</span>master1   <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>       Running   <span class="token number">0</span>          4m
kube<span class="token operator">-</span>scheduler<span class="token operator">-</span>master1            <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>       Running   <span class="token number">0</span>          4m<span class="token operator">/</span>etc<span class="token operator">/</span>kubernetes<span class="token operator">/</span>admin<span class="token punctuation">.</span>conf <span class="token operator">~</span><span class="token operator">/</span><span class="token punctuation">.</span>kube<span class="token operator">/</span>config
$ kubectl <span class="token keyword">get</span> cs
<span class="token constant">NAME</span>                 <span class="token constant">STATUS</span>    <span class="token constant">MESSAGE</span>              <span class="token constant">ERROR</span>
etcd<span class="token operator">-</span><span class="token number">0</span>               Healthy   <span class="token punctuation">{</span><span class="token string-property property">"health"</span><span class="token operator">:</span> <span class="token string">"true"</span><span class="token punctuation">}</span>
scheduler            Healthy   ok
controller<span class="token operator">-</span>manager   Healthy   ok

$ kubectl <span class="token keyword">get</span> node
<span class="token constant">NAME</span>      <span class="token constant">STATUS</span>     <span class="token constant">ROLES</span>     <span class="token constant">AGE</span>       <span class="token constant">VERSION</span>
master1   NotReady   master    4m        v1<span class="token punctuation">.</span><span class="token number">8.2</span>

$ kubectl <span class="token operator">-</span>n kube<span class="token operator">-</span>system <span class="token keyword">get</span> po
<span class="token constant">NAME</span>                              <span class="token constant">READY</span>     <span class="token constant">STATUS</span>    <span class="token constant">RESTARTS</span>   <span class="token constant">AGE</span>
kube<span class="token operator">-</span>apiserver<span class="token operator">-</span>master1            <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>       Running   <span class="token number">0</span>          4m
kube<span class="token operator">-</span>controller<span class="token operator">-</span>manager<span class="token operator">-</span>master1   <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>       Running   <span class="token number">0</span>          4m
kube<span class="token operator">-</span>scheduler<span class="token operator">-</span>master1            <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>       Running   <span class="token number">0</span>          4m<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><button class="copy">复制</button></div><p>确认服务能够执行 logs 等指令：</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0">$ kubectl <span class="token operator">-</span>n kube<span class="token operator">-</span>system logs <span class="token operator">-</span>f kube<span class="token operator">-</span>scheduler<span class="token operator">-</span>master1
Error from <span class="token function">server</span> <span class="token punctuation">(</span>Forbidden<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token function">Forbidden</span> <span class="token punctuation">(</span>user<span class="token operator">=</span>kube<span class="token operator">-</span>apiserver<span class="token punctuation">,</span> verb<span class="token operator">=</span>get<span class="token punctuation">,</span> resource<span class="token operator">=</span>nodes<span class="token punctuation">,</span> subresource<span class="token operator">=</span>proxy<span class="token punctuation">)</span> <span class="token punctuation">(</span> pods<span class="token operator">/</span>log kube<span class="token operator">-</span>apiserver<span class="token operator">-</span>master1<span class="token punctuation">)</span><span class="token operator">-</span>n kube<span class="token operator">-</span>system logs <span class="token operator">-</span>f kube<span class="token operator">-</span>scheduler<span class="token operator">-</span>master1
Error from <span class="token function">server</span> <span class="token punctuation">(</span>Forbidden<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token function">Forbidden</span> <span class="token punctuation">(</span>user<span class="token operator">=</span>kube<span class="token operator">-</span>apiserver<span class="token punctuation">,</span> verb<span class="token operator">=</span>get<span class="token punctuation">,</span> resource<span class="token operator">=</span>nodes<span class="token punctuation">,</span> subresource<span class="token operator">=</span>proxy<span class="token punctuation">)</span> <span class="token punctuation">(</span> pods<span class="token operator">/</span>log kube<span class="token operator">-</span>apiserver<span class="token operator">-</span>master1<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><button class="copy">复制</button></div><blockquote><p> 这边会发现出现 403 Forbidden 问题，这是因为&nbsp;kube-apiserver&nbsp;user 并没有 nodes 的资源权限，属于正常。
 </p></blockquote><p>由于上述权限问题，我们必需创建一个&nbsp;apiserver-to-kubelet-rbac.yml&nbsp;来定义权限，以供我们执行 logs、exec 等指令：</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0">$ cd <span class="token operator">/</span>etc<span class="token operator">/</span>kubernetes<span class="token operator">/</span>
$ <span class="token keyword">export</span> <span class="token constant">URL</span><span class="token operator">=</span><span class="token string">"https://kairen.github.io/files/manual-v1.8/master"</span>
$ wget <span class="token string">"${URL}/apiserver-to-kubelet-rbac.yml.conf"</span> <span class="token operator">-</span><span class="token constant">O</span> apiserver<span class="token operator">-</span>to<span class="token operator">-</span>kubelet<span class="token operator">-</span>rbac<span class="token punctuation">.</span>yml
$ kubectl apply <span class="token operator">-</span>f apiserver<span class="token operator">-</span>to<span class="token operator">-</span>kubelet<span class="token operator">-</span>rbac<span class="token punctuation">.</span>yml

# 測試 logs
$ kubectl <span class="token operator">-</span>n kube<span class="token operator">-</span>system logs <span class="token operator">-</span>f kube<span class="token operator">-</span>scheduler<span class="token operator">-</span>master1
<span class="token operator">...</span>
<span class="token constant">I1031</span> <span class="token number">03</span><span class="token operator">:</span><span class="token number">22</span><span class="token operator">:</span><span class="token number">42.527697</span>       <span class="token number">1</span> leaderelection<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">184</span><span class="token punctuation">]</span> successfully acquired lease kube<span class="token operator">-</span>system<span class="token operator">/</span>kube<span class="token operator">-</span>scheduler<span class="token operator">/</span>etc<span class="token operator">/</span>kubernetes<span class="token operator">/</span>
$ <span class="token keyword">export</span> <span class="token constant">URL</span><span class="token operator">=</span><span class="token string">"https://kairen.github.io/files/manual-v1.8/master"</span>
$ wget <span class="token string">"${URL}/apiserver-to-kubelet-rbac.yml.conf"</span> <span class="token operator">-</span><span class="token constant">O</span> apiserver<span class="token operator">-</span>to<span class="token operator">-</span>kubelet<span class="token operator">-</span>rbac<span class="token punctuation">.</span>yml
$ kubectl apply <span class="token operator">-</span>f apiserver<span class="token operator">-</span>to<span class="token operator">-</span>kubelet<span class="token operator">-</span>rbac<span class="token punctuation">.</span>yml

# 測試 logs
$ kubectl <span class="token operator">-</span>n kube<span class="token operator">-</span>system logs <span class="token operator">-</span>f kube<span class="token operator">-</span>scheduler<span class="token operator">-</span>master1
<span class="token operator">...</span>
<span class="token constant">I1031</span> <span class="token number">03</span><span class="token operator">:</span><span class="token number">22</span><span class="token operator">:</span><span class="token number">42.527697</span>       <span class="token number">1</span> leaderelection<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">184</span><span class="token punctuation">]</span> successfully acquired lease kube<span class="token operator">-</span>system<span class="token operator">/</span>kube<span class="token operator">-</span>scheduler<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><button class="copy">复制</button></div><h2 id="Kubernetes-Node" name="Kubernetes-Node">Kubernetes Node</h2><p>Node 是主要执行容器实例的节点，可视为工作节点。在这步骤我们会下载 Kubernetes binary 文件，并创建 node 的 certificate 来提供给节点注册认证用。Kubernetes 使用Node Authorizer来提供<a data-from="10680" href="http://docs.kubernetes.org.cn/156.html" target="_blank" rel="nofollow noopener noreferrer">Authorization mode</a>，这种授权模式会替 Kubelet 生成 API request。</p><p>在开始前，我们先在master1将需要的 ca 与 cert 复制到 Node 节点上：</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0">$ <span class="token keyword">for</span> <span class="token constant">NODE</span> <span class="token keyword">in</span> node1 node2<span class="token punctuation">;</span> <span class="token keyword">do</span>
    ssh $<span class="token punctuation">{</span><span class="token constant">NODE</span><span class="token punctuation">}</span> <span class="token string">"mkdir -p /etc/kubernetes/pki/"</span>
    ssh $<span class="token punctuation">{</span><span class="token constant">NODE</span><span class="token punctuation">}</span> <span class="token string">"mkdir -p /etc/etcd/ssl"</span>
    # Etcd ca and cert
    <span class="token keyword">for</span> <span class="token constant">FILE</span> <span class="token keyword">in</span> etcd<span class="token operator">-</span>ca<span class="token punctuation">.</span>pem etcd<span class="token punctuation">.</span>pem etcd<span class="token operator">-</span>key<span class="token punctuation">.</span>pem<span class="token punctuation">;</span> <span class="token keyword">do</span>
      scp <span class="token operator">/</span>etc<span class="token operator">/</span>etcd<span class="token operator">/</span>ssl<span class="token operator">/</span>$<span class="token punctuation">{</span><span class="token constant">FILE</span><span class="token punctuation">}</span> $<span class="token punctuation">{</span><span class="token constant">NODE</span><span class="token punctuation">}</span><span class="token operator">:</span><span class="token operator">/</span>etc<span class="token operator">/</span>etcd<span class="token operator">/</span>ssl<span class="token operator">/</span>$<span class="token punctuation">{</span><span class="token constant">FILE</span><span class="token punctuation">}</span>
    done
    # Kubernetes ca and cert
    <span class="token keyword">for</span> <span class="token constant">FILE</span> <span class="token keyword">in</span> pki<span class="token operator">/</span>ca<span class="token punctuation">.</span>pem pki<span class="token operator">/</span>ca<span class="token operator">-</span>key<span class="token punctuation">.</span>pem bootstrap<span class="token punctuation">.</span>conf<span class="token punctuation">;</span> <span class="token keyword">do</span>
      scp <span class="token operator">/</span>etc<span class="token operator">/</span>kubernetes<span class="token operator">/</span>$<span class="token punctuation">{</span><span class="token constant">FILE</span><span class="token punctuation">}</span> $<span class="token punctuation">{</span><span class="token constant">NODE</span><span class="token punctuation">}</span><span class="token operator">:</span><span class="token operator">/</span>etc<span class="token operator">/</span>kubernetes<span class="token operator">/</span>$<span class="token punctuation">{</span><span class="token constant">FILE</span><span class="token punctuation">}</span>
    done
  donefor <span class="token constant">NODE</span> <span class="token keyword">in</span> node1 node2<span class="token punctuation">;</span> <span class="token keyword">do</span>
    ssh $<span class="token punctuation">{</span><span class="token constant">NODE</span><span class="token punctuation">}</span> <span class="token string">"mkdir -p /etc/kubernetes/pki/"</span>
    ssh $<span class="token punctuation">{</span><span class="token constant">NODE</span><span class="token punctuation">}</span> <span class="token string">"mkdir -p /etc/etcd/ssl"</span>
    # Etcd ca and cert
    <span class="token keyword">for</span> <span class="token constant">FILE</span> <span class="token keyword">in</span> etcd<span class="token operator">-</span>ca<span class="token punctuation">.</span>pem etcd<span class="token punctuation">.</span>pem etcd<span class="token operator">-</span>key<span class="token punctuation">.</span>pem<span class="token punctuation">;</span> <span class="token keyword">do</span>
      scp <span class="token operator">/</span>etc<span class="token operator">/</span>etcd<span class="token operator">/</span>ssl<span class="token operator">/</span>$<span class="token punctuation">{</span><span class="token constant">FILE</span><span class="token punctuation">}</span> $<span class="token punctuation">{</span><span class="token constant">NODE</span><span class="token punctuation">}</span><span class="token operator">:</span><span class="token operator">/</span>etc<span class="token operator">/</span>etcd<span class="token operator">/</span>ssl<span class="token operator">/</span>$<span class="token punctuation">{</span><span class="token constant">FILE</span><span class="token punctuation">}</span>
    done
    # Kubernetes ca and cert
    <span class="token keyword">for</span> <span class="token constant">FILE</span> <span class="token keyword">in</span> pki<span class="token operator">/</span>ca<span class="token punctuation">.</span>pem pki<span class="token operator">/</span>ca<span class="token operator">-</span>key<span class="token punctuation">.</span>pem bootstrap<span class="token punctuation">.</span>conf<span class="token punctuation">;</span> <span class="token keyword">do</span>
      scp <span class="token operator">/</span>etc<span class="token operator">/</span>kubernetes<span class="token operator">/</span>$<span class="token punctuation">{</span><span class="token constant">FILE</span><span class="token punctuation">}</span> $<span class="token punctuation">{</span><span class="token constant">NODE</span><span class="token punctuation">}</span><span class="token operator">:</span><span class="token operator">/</span>etc<span class="token operator">/</span>kubernetes<span class="token operator">/</span>$<span class="token punctuation">{</span><span class="token constant">FILE</span><span class="token punctuation">}</span>
    done
  done<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><button class="copy">复制</button></div><h3 id="%E4%B8%8B%E8%BD%BD-Kubernetes-%E7%BB%84%E4%BB%B6" name="%E4%B8%8B%E8%BD%BD-Kubernetes-%E7%BB%84%E4%BB%B6">下载 Kubernetes 组件</h3><p>首先通过网络取得所有需要的执行文件：</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0"># Download Kubernetes
$ <span class="token keyword">export</span> <span class="token constant">KUBE_URL</span><span class="token operator">=</span><span class="token string">"https://storage.googleapis.com/kubernetes-release/release/v1.8.2/bin/linux/amd64"</span>
$ wget <span class="token string">"${KUBE_URL}/kubelet"</span> <span class="token operator">-</span><span class="token constant">O</span> <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>bin<span class="token operator">/</span>kubelet
$ chmod <span class="token operator">+</span>x <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>bin<span class="token operator">/</span>kubelet

# Download <span class="token constant">CNI</span>
$ mkdir <span class="token operator">-</span>p <span class="token operator">/</span>opt<span class="token operator">/</span>cni<span class="token operator">/</span>bin <span class="token operator">&amp;&amp;</span> cd <span class="token operator">/</span>opt<span class="token operator">/</span>cni<span class="token operator">/</span>bin
$ <span class="token keyword">export</span> <span class="token constant">CNI_URL</span><span class="token operator">=</span><span class="token string">"https://github.com/containernetworking/plugins/releases/download"</span>
$ wget <span class="token operator">-</span>qO<span class="token operator">-</span> <span class="token operator">--</span>show<span class="token operator">-</span>progress <span class="token string">"${CNI_URL}/v0.6.0/cni-plugins-amd64-v0.6.0.tgz"</span> <span class="token operator">|</span> tar <span class="token operator">-</span>zx
$ <span class="token keyword">export</span> <span class="token constant">KUBE_URL</span><span class="token operator">=</span><span class="token string">"https://storage.googleapis.com/kubernetes-release/release/v1.8.2/bin/linux/amd64"</span>
$ wget <span class="token string">"${KUBE_URL}/kubelet"</span> <span class="token operator">-</span><span class="token constant">O</span> <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>bin<span class="token operator">/</span>kubelet
$ chmod <span class="token operator">+</span>x <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>bin<span class="token operator">/</span>kubelet

# Download <span class="token constant">CNI</span>
$ mkdir <span class="token operator">-</span>p <span class="token operator">/</span>opt<span class="token operator">/</span>cni<span class="token operator">/</span>bin <span class="token operator">&amp;&amp;</span> cd <span class="token operator">/</span>opt<span class="token operator">/</span>cni<span class="token operator">/</span>bin
$ <span class="token keyword">export</span> <span class="token constant">CNI_URL</span><span class="token operator">=</span><span class="token string">"https://github.com/containernetworking/plugins/releases/download"</span>
$ wget <span class="token operator">-</span>qO<span class="token operator">-</span> <span class="token operator">--</span>show<span class="token operator">-</span>progress <span class="token string">"${CNI_URL}/v0.6.0/cni-plugins-amd64-v0.6.0.tgz"</span> <span class="token operator">|</span> tar <span class="token operator">-</span>zx<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><button class="copy">复制</button></div><h3 id="%E8%AE%BE%E5%AE%9A-Kubernetes-node" name="%E8%AE%BE%E5%AE%9A-Kubernetes-node">设定 Kubernetes node</h3><p>接着下载 Kubernetes 相关文件，包含 drop-in file、systemd service 档案等：</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0">$ <span class="token keyword">export</span> <span class="token constant">KUBELET_URL</span><span class="token operator">=</span><span class="token string">"https://kairen.github.io/files/manual-v1.8/node"</span>
$ mkdir <span class="token operator">-</span>p <span class="token operator">/</span>etc<span class="token operator">/</span>systemd<span class="token operator">/</span>system<span class="token operator">/</span>kubelet<span class="token punctuation">.</span>service<span class="token punctuation">.</span>d
$ wget <span class="token string">"${KUBELET_URL}/kubelet.service"</span> <span class="token operator">-</span><span class="token constant">O</span> <span class="token operator">/</span>lib<span class="token operator">/</span>systemd<span class="token operator">/</span>system<span class="token operator">/</span>kubelet<span class="token punctuation">.</span>service
$ wget <span class="token string">"${KUBELET_URL}/10-kubelet.conf"</span> <span class="token operator">-</span><span class="token constant">O</span> <span class="token operator">/</span>etc<span class="token operator">/</span>systemd<span class="token operator">/</span>system<span class="token operator">/</span>kubelet<span class="token punctuation">.</span>service<span class="token punctuation">.</span>d<span class="token operator">/</span><span class="token number">10</span><span class="token operator">-</span>kubelet<span class="token punctuation">.</span>confexport <span class="token constant">KUBELET_URL</span><span class="token operator">=</span><span class="token string">"https://kairen.github.io/files/manual-v1.8/node"</span>
$ mkdir <span class="token operator">-</span>p <span class="token operator">/</span>etc<span class="token operator">/</span>systemd<span class="token operator">/</span>system<span class="token operator">/</span>kubelet<span class="token punctuation">.</span>service<span class="token punctuation">.</span>d
$ wget <span class="token string">"${KUBELET_URL}/kubelet.service"</span> <span class="token operator">-</span><span class="token constant">O</span> <span class="token operator">/</span>lib<span class="token operator">/</span>systemd<span class="token operator">/</span>system<span class="token operator">/</span>kubelet<span class="token punctuation">.</span>service
$ wget <span class="token string">"${KUBELET_URL}/10-kubelet.conf"</span> <span class="token operator">-</span><span class="token constant">O</span> <span class="token operator">/</span>etc<span class="token operator">/</span>systemd<span class="token operator">/</span>system<span class="token operator">/</span>kubelet<span class="token punctuation">.</span>service<span class="token punctuation">.</span>d<span class="token operator">/</span><span class="token number">10</span><span class="token operator">-</span>kubelet<span class="token punctuation">.</span>conf<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><button class="copy">复制</button></div><p>接着在所有node创建 var 存放信息，然后启动 kubelet 服务:</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0">$ mkdir <span class="token operator">-</span>p <span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>lib<span class="token operator">/</span>kubelet <span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>log<span class="token operator">/</span>kubernetes <span class="token operator">/</span>etc<span class="token operator">/</span>kubernetes<span class="token operator">/</span>manifests
$ systemctl enable kubelet<span class="token punctuation">.</span>service <span class="token operator">&amp;&amp;</span> systemctl start kubelet<span class="token punctuation">.</span>service<span class="token operator">-</span>p <span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>lib<span class="token operator">/</span>kubelet <span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>log<span class="token operator">/</span>kubernetes <span class="token operator">/</span>etc<span class="token operator">/</span>kubernetes<span class="token operator">/</span>manifests
$ systemctl enable kubelet<span class="token punctuation">.</span>service <span class="token operator">&amp;&amp;</span> systemctl start kubelet<span class="token punctuation">.</span>service<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><button class="copy">复制</button></div><p>P.S. 重复一样动作来完成其他节点。</p><h3 id="%E6%8E%88%E6%9D%83-Kubernetes-Node" name="%E6%8E%88%E6%9D%83-Kubernetes-Node">授权 Kubernetes Node</h3><p>当所有节点都完成后，在master节点，因为我们采用 TLS Bootstrapping，所需要创建一个 ClusterRoleBinding：</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0">$ kubectl create clusterrolebinding kubelet<span class="token operator">-</span>bootstrap \
    <span class="token operator">--</span>clusterrole<span class="token operator">=</span>system<span class="token operator">:</span>node<span class="token operator">-</span>bootstrapper \
    <span class="token operator">--</span>user<span class="token operator">=</span>kubelet<span class="token operator">-</span>bootstrap<span class="token operator">-</span>bootstrap \
    <span class="token operator">--</span>clusterrole<span class="token operator">=</span>system<span class="token operator">:</span>node<span class="token operator">-</span>bootstrapper \
    <span class="token operator">--</span>user<span class="token operator">=</span>kubelet<span class="token operator">-</span>bootstrap<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><button class="copy">复制</button></div><p>在master通过简单指令验证，会看到节点处于pending：</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0">$ kubectl <span class="token keyword">get</span> csr
<span class="token constant">NAME</span>                                                   <span class="token constant">AGE</span>       <span class="token constant">REQUESTOR</span>           <span class="token constant">CONDITION</span>
node<span class="token operator">-</span>csr<span class="token operator">-</span>YWf97ZrLCTlr2hmXsNLfjVLwaLfZRsu52FRKOYjpcBE   2s        kubelet<span class="token operator">-</span>bootstrap   Pending
node<span class="token operator">-</span>csr<span class="token operator">-</span>eq4q6ffOwT4yqYQNU6sT7mphPOQdFN6yulMVZeu6pkE   2s        kubelet<span class="token operator">-</span>bootstrap   Pendingget csr
<span class="token constant">NAME</span>                                                   <span class="token constant">AGE</span>       <span class="token constant">REQUESTOR</span>           <span class="token constant">CONDITION</span>
node<span class="token operator">-</span>csr<span class="token operator">-</span>YWf97ZrLCTlr2hmXsNLfjVLwaLfZRsu52FRKOYjpcBE   2s        kubelet<span class="token operator">-</span>bootstrap   Pending
node<span class="token operator">-</span>csr<span class="token operator">-</span>eq4q6ffOwT4yqYQNU6sT7mphPOQdFN6yulMVZeu6pkE   2s        kubelet<span class="token operator">-</span>bootstrap   Pending<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><button class="copy">复制</button></div><p>通过 kubectl 来允许节点加入集群：</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0">$ kubectl <span class="token keyword">get</span> csr <span class="token operator">|</span> awk <span class="token string">'/Pending/ {print $1}'</span> <span class="token operator">|</span> xargs kubectl certificate approve
certificatesigningrequest <span class="token string">"node-csr-YWf97ZrLCTlr2hmXsNLfjVLwaLfZRsu52FRKOYjpcBE"</span> approved
certificatesigningrequest <span class="token string">"node-csr-eq4q6ffOwT4yqYQNU6sT7mphPOQdFN6yulMVZeu6pkE"</span> approved

$ kubectl <span class="token keyword">get</span> csr
<span class="token constant">NAME</span>                                                   <span class="token constant">AGE</span>       <span class="token constant">REQUESTOR</span>           <span class="token constant">CONDITION</span>
node<span class="token operator">-</span>csr<span class="token operator">-</span>YWf97ZrLCTlr2hmXsNLfjVLwaLfZRsu52FRKOYjpcBE   30s       kubelet<span class="token operator">-</span>bootstrap   Approved<span class="token punctuation">,</span>Issued
node<span class="token operator">-</span>csr<span class="token operator">-</span>eq4q6ffOwT4yqYQNU6sT7mphPOQdFN6yulMVZeu6pkE   30s       kubelet<span class="token operator">-</span>bootstrap   Approved<span class="token punctuation">,</span>Issued

$ kubectl <span class="token keyword">get</span> no
<span class="token constant">NAME</span>      <span class="token constant">STATUS</span>     <span class="token constant">ROLES</span>     <span class="token constant">AGE</span>       <span class="token constant">VERSION</span>
master1   NotReady   master    15m       v1<span class="token punctuation">.</span><span class="token number">8.2</span>
node1     NotReady   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>    8m        v1<span class="token punctuation">.</span><span class="token number">8.2</span>
node2     NotReady   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>    6s        v1<span class="token punctuation">.</span><span class="token number">8</span><span class="token punctuation">.</span>2get csr <span class="token operator">|</span> awk <span class="token string">'/Pending/ {print $1}'</span> <span class="token operator">|</span> xargs kubectl certificate approve
certificatesigningrequest <span class="token string">"node-csr-YWf97ZrLCTlr2hmXsNLfjVLwaLfZRsu52FRKOYjpcBE"</span> approved
certificatesigningrequest <span class="token string">"node-csr-eq4q6ffOwT4yqYQNU6sT7mphPOQdFN6yulMVZeu6pkE"</span> approved

$ kubectl <span class="token keyword">get</span> csr
<span class="token constant">NAME</span>                                                   <span class="token constant">AGE</span>       <span class="token constant">REQUESTOR</span>           <span class="token constant">CONDITION</span>
node<span class="token operator">-</span>csr<span class="token operator">-</span>YWf97ZrLCTlr2hmXsNLfjVLwaLfZRsu52FRKOYjpcBE   30s       kubelet<span class="token operator">-</span>bootstrap   Approved<span class="token punctuation">,</span>Issued
node<span class="token operator">-</span>csr<span class="token operator">-</span>eq4q6ffOwT4yqYQNU6sT7mphPOQdFN6yulMVZeu6pkE   30s       kubelet<span class="token operator">-</span>bootstrap   Approved<span class="token punctuation">,</span>Issued

$ kubectl <span class="token keyword">get</span> no
<span class="token constant">NAME</span>      <span class="token constant">STATUS</span>     <span class="token constant">ROLES</span>     <span class="token constant">AGE</span>       <span class="token constant">VERSION</span>
master1   NotReady   master    15m       v1<span class="token punctuation">.</span><span class="token number">8.2</span>
node1     NotReady   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>    8m        v1<span class="token punctuation">.</span><span class="token number">8.2</span>
node2     NotReady   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>    6s        v1<span class="token punctuation">.</span><span class="token number">8.2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><button class="copy">复制</button></div><h2 id="Kubernetes-Core-Addons-%E9%83%A8%E7%BD%B2" name="Kubernetes-Core-Addons-%E9%83%A8%E7%BD%B2">Kubernetes Core Addons 部署</h2><p>当完成上面所有步骤后，接着我们需要安装一些插件，而这些有部分是非常重要跟好用的，如Kube-dns与Kube-proxy等。</p><h3 id="Kube-proxy-addon" name="Kube-proxy-addon">Kube-proxy addon</h3><p><a data-from="10680" href="https://github.com/kubernetes/kubernetes/tree/master/cluster/addons/kube-proxy" target="_blank" rel="nofollow noopener noreferrer">Kube-proxy</a>&nbsp;是实现 Service 的关键组件，kube-proxy 会在每台节点上执行，然后监听 API Server 的 Service 与 Endpoint 资源对象的改变，然后来依据变化执行 iptables 来实现网络的转发。这边我们会需要建议一个 DaemonSet 来执行，并且创建一些需要的 certificate。<a data-from="10680" href="https://www.kubernetes.org.cn/3025.html" target="_blank" rel="nofollow noopener noreferrer">Kubernetes 1.8 kube-proxy 开启 ipvs</a></p><p>首先在master1下载kube-proxy-csr.json文件，并产生 kube-proxy certificate 证书：</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0">$ <span class="token keyword">export</span> <span class="token constant">PKI_URL</span><span class="token operator">=</span><span class="token string">"https://kairen.github.io/files/manual-v1.8/pki"</span>
$ cd <span class="token operator">/</span>etc<span class="token operator">/</span>kubernetes<span class="token operator">/</span>pki
$ wget <span class="token string">"${PKI_URL}/kube-proxy-csr.json"</span> <span class="token string">"${PKI_URL}/ca-config.json"</span>
$ cfssl gencert \
  <span class="token operator">-</span>ca<span class="token operator">=</span>ca<span class="token punctuation">.</span>pem \
  <span class="token operator">-</span>ca<span class="token operator">-</span>key<span class="token operator">=</span>ca<span class="token operator">-</span>key<span class="token punctuation">.</span>pem \
  <span class="token operator">-</span>config<span class="token operator">=</span>ca<span class="token operator">-</span>config<span class="token punctuation">.</span>json \
  <span class="token operator">-</span>profile<span class="token operator">=</span>kubernetes \
  kube<span class="token operator">-</span>proxy<span class="token operator">-</span>csr<span class="token punctuation">.</span>json <span class="token operator">|</span> cfssljson <span class="token operator">-</span>bare kube<span class="token operator">-</span>proxy

$ ls kube<span class="token operator">-</span>proxy<span class="token operator">*</span><span class="token punctuation">.</span>pem
kube<span class="token operator">-</span>proxy<span class="token operator">-</span>key<span class="token punctuation">.</span>pem  kube<span class="token operator">-</span>proxy<span class="token punctuation">.</span>pemexport <span class="token constant">PKI_URL</span><span class="token operator">=</span><span class="token string">"https://kairen.github.io/files/manual-v1.8/pki"</span>
$ cd <span class="token operator">/</span>etc<span class="token operator">/</span>kubernetes<span class="token operator">/</span>pki
$ wget <span class="token string">"${PKI_URL}/kube-proxy-csr.json"</span> <span class="token string">"${PKI_URL}/ca-config.json"</span>
$ cfssl gencert \
  <span class="token operator">-</span>ca<span class="token operator">=</span>ca<span class="token punctuation">.</span>pem \
  <span class="token operator">-</span>ca<span class="token operator">-</span>key<span class="token operator">=</span>ca<span class="token operator">-</span>key<span class="token punctuation">.</span>pem \
  <span class="token operator">-</span>config<span class="token operator">=</span>ca<span class="token operator">-</span>config<span class="token punctuation">.</span>json \
  <span class="token operator">-</span>profile<span class="token operator">=</span>kubernetes \
  kube<span class="token operator">-</span>proxy<span class="token operator">-</span>csr<span class="token punctuation">.</span>json <span class="token operator">|</span> cfssljson <span class="token operator">-</span>bare kube<span class="token operator">-</span>proxy

$ ls kube<span class="token operator">-</span>proxy<span class="token operator">*</span><span class="token punctuation">.</span>pem
kube<span class="token operator">-</span>proxy<span class="token operator">-</span>key<span class="token punctuation">.</span>pem  kube<span class="token operator">-</span>proxy<span class="token punctuation">.</span>pem<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><button class="copy">复制</button></div><p>接着透过以下指令生成名称为&nbsp;kube-proxy.conf&nbsp;的 kubeconfig 文件：</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0"># kube<span class="token operator">-</span>proxy set<span class="token operator">-</span>cluster
$ kubectl config set<span class="token operator">-</span>cluster kubernetes \
    <span class="token operator">--</span>certificate<span class="token operator">-</span>authority<span class="token operator">=</span>ca<span class="token punctuation">.</span>pem \
    <span class="token operator">--</span>embed<span class="token operator">-</span>certs<span class="token operator">=</span><span class="token boolean">true</span> \
    <span class="token operator">--</span>server<span class="token operator">=</span><span class="token string">"https://172.16.35.12:6443"</span> \
    <span class="token operator">--</span>kubeconfig<span class="token operator">=</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>kube<span class="token operator">-</span>proxy<span class="token punctuation">.</span>conf

# kube<span class="token operator">-</span>proxy set<span class="token operator">-</span>credentials
$ kubectl config set<span class="token operator">-</span>credentials system<span class="token operator">:</span>kube<span class="token operator">-</span>proxy \
    <span class="token operator">--</span>client<span class="token operator">-</span>key<span class="token operator">=</span>kube<span class="token operator">-</span>proxy<span class="token operator">-</span>key<span class="token punctuation">.</span>pem \
    <span class="token operator">--</span>client<span class="token operator">-</span>certificate<span class="token operator">=</span>kube<span class="token operator">-</span>proxy<span class="token punctuation">.</span>pem \
    <span class="token operator">--</span>embed<span class="token operator">-</span>certs<span class="token operator">=</span><span class="token boolean">true</span> \
    <span class="token operator">--</span>kubeconfig<span class="token operator">=</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>kube<span class="token operator">-</span>proxy<span class="token punctuation">.</span>conf

# kube<span class="token operator">-</span>proxy set<span class="token operator">-</span>context
$ kubectl config set<span class="token operator">-</span>context system<span class="token operator">:</span>kube<span class="token operator">-</span>proxy@kubernetes \
    <span class="token operator">--</span>cluster<span class="token operator">=</span>kubernetes \
    <span class="token operator">--</span>user<span class="token operator">=</span>system<span class="token operator">:</span>kube<span class="token operator">-</span>proxy \
    <span class="token operator">--</span>kubeconfig<span class="token operator">=</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>kube<span class="token operator">-</span>proxy<span class="token punctuation">.</span>conf

# kube<span class="token operator">-</span>proxy <span class="token keyword">set</span> <span class="token keyword">default</span> context
$ kubectl config use<span class="token operator">-</span>context system<span class="token operator">:</span>kube<span class="token operator">-</span>proxy@kubernetes \
    <span class="token operator">--</span>kubeconfig<span class="token operator">=</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>kube<span class="token operator">-</span>proxy<span class="token punctuation">.</span>conf
$ kubectl config set<span class="token operator">-</span>cluster kubernetes \
    <span class="token operator">--</span>certificate<span class="token operator">-</span>authority<span class="token operator">=</span>ca<span class="token punctuation">.</span>pem \
    <span class="token operator">--</span>embed<span class="token operator">-</span>certs<span class="token operator">=</span><span class="token boolean">true</span> \
    <span class="token operator">--</span>server<span class="token operator">=</span><span class="token string">"https://172.16.35.12:6443"</span> \
    <span class="token operator">--</span>kubeconfig<span class="token operator">=</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>kube<span class="token operator">-</span>proxy<span class="token punctuation">.</span>conf

# kube<span class="token operator">-</span>proxy set<span class="token operator">-</span>credentials
$ kubectl config set<span class="token operator">-</span>credentials system<span class="token operator">:</span>kube<span class="token operator">-</span>proxy \
    <span class="token operator">--</span>client<span class="token operator">-</span>key<span class="token operator">=</span>kube<span class="token operator">-</span>proxy<span class="token operator">-</span>key<span class="token punctuation">.</span>pem \
    <span class="token operator">--</span>client<span class="token operator">-</span>certificate<span class="token operator">=</span>kube<span class="token operator">-</span>proxy<span class="token punctuation">.</span>pem \
    <span class="token operator">--</span>embed<span class="token operator">-</span>certs<span class="token operator">=</span><span class="token boolean">true</span> \
    <span class="token operator">--</span>kubeconfig<span class="token operator">=</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>kube<span class="token operator">-</span>proxy<span class="token punctuation">.</span>conf

# kube<span class="token operator">-</span>proxy set<span class="token operator">-</span>context
$ kubectl config set<span class="token operator">-</span>context system<span class="token operator">:</span>kube<span class="token operator">-</span>proxy@kubernetes \
    <span class="token operator">--</span>cluster<span class="token operator">=</span>kubernetes \
    <span class="token operator">--</span>user<span class="token operator">=</span>system<span class="token operator">:</span>kube<span class="token operator">-</span>proxy \
    <span class="token operator">--</span>kubeconfig<span class="token operator">=</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>kube<span class="token operator">-</span>proxy<span class="token punctuation">.</span>conf

# kube<span class="token operator">-</span>proxy <span class="token keyword">set</span> <span class="token keyword">default</span> context
$ kubectl config use<span class="token operator">-</span>context system<span class="token operator">:</span>kube<span class="token operator">-</span>proxy@kubernetes \
    <span class="token operator">--</span>kubeconfig<span class="token operator">=</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>kube<span class="token operator">-</span>proxy<span class="token punctuation">.</span>conf<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><button class="copy">复制</button></div><p>完成后删除不必要文件：</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0">$ rm <span class="token operator">-</span>rf <span class="token operator">*</span><span class="token punctuation">.</span>json<span class="token operator">-</span>rf <span class="token operator">*</span><span class="token punctuation">.</span>json<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><button class="copy">复制</button></div><p>确认/etc/kubernetes有以下文件：</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0">$ ls <span class="token operator">/</span>etc<span class="token operator">/</span>kubernetes<span class="token operator">/</span>
admin<span class="token punctuation">.</span>conf        bootstrap<span class="token punctuation">.</span>conf           encryption<span class="token punctuation">.</span>yml  kube<span class="token operator">-</span>proxy<span class="token punctuation">.</span>conf  pki             token<span class="token punctuation">.</span>csv
audit<span class="token operator">-</span>policy<span class="token punctuation">.</span>yml  controller<span class="token operator">-</span>manager<span class="token punctuation">.</span>conf  kubelet<span class="token punctuation">.</span>conf    manifests        scheduler<span class="token punctuation">.</span>conf<span class="token operator">/</span>etc<span class="token operator">/</span>kubernetes<span class="token operator">/</span>
admin<span class="token punctuation">.</span>conf        bootstrap<span class="token punctuation">.</span>conf           encryption<span class="token punctuation">.</span>yml  kube<span class="token operator">-</span>proxy<span class="token punctuation">.</span>conf  pki             token<span class="token punctuation">.</span>csv
audit<span class="token operator">-</span>policy<span class="token punctuation">.</span>yml  controller<span class="token operator">-</span>manager<span class="token punctuation">.</span>conf  kubelet<span class="token punctuation">.</span>conf    manifests        scheduler<span class="token punctuation">.</span>conf<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><button class="copy">复制</button></div><p>在master1将kube-proxy相关文件复制到 Node 节点上：</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0">$ <span class="token keyword">for</span> <span class="token constant">NODE</span> <span class="token keyword">in</span> node1 node2<span class="token punctuation">;</span> <span class="token keyword">do</span>
    <span class="token keyword">for</span> <span class="token constant">FILE</span> <span class="token keyword">in</span> pki<span class="token operator">/</span>kube<span class="token operator">-</span>proxy<span class="token punctuation">.</span>pem pki<span class="token operator">/</span>kube<span class="token operator">-</span>proxy<span class="token operator">-</span>key<span class="token punctuation">.</span>pem kube<span class="token operator">-</span>proxy<span class="token punctuation">.</span>conf<span class="token punctuation">;</span> <span class="token keyword">do</span>
      scp <span class="token operator">/</span>etc<span class="token operator">/</span>kubernetes<span class="token operator">/</span>$<span class="token punctuation">{</span><span class="token constant">FILE</span><span class="token punctuation">}</span> $<span class="token punctuation">{</span><span class="token constant">NODE</span><span class="token punctuation">}</span><span class="token operator">:</span><span class="token operator">/</span>etc<span class="token operator">/</span>kubernetes<span class="token operator">/</span>$<span class="token punctuation">{</span><span class="token constant">FILE</span><span class="token punctuation">}</span>
    done
  donefor <span class="token constant">NODE</span> <span class="token keyword">in</span> node1 node2<span class="token punctuation">;</span> <span class="token keyword">do</span>
    <span class="token keyword">for</span> <span class="token constant">FILE</span> <span class="token keyword">in</span> pki<span class="token operator">/</span>kube<span class="token operator">-</span>proxy<span class="token punctuation">.</span>pem pki<span class="token operator">/</span>kube<span class="token operator">-</span>proxy<span class="token operator">-</span>key<span class="token punctuation">.</span>pem kube<span class="token operator">-</span>proxy<span class="token punctuation">.</span>conf<span class="token punctuation">;</span> <span class="token keyword">do</span>
      scp <span class="token operator">/</span>etc<span class="token operator">/</span>kubernetes<span class="token operator">/</span>$<span class="token punctuation">{</span><span class="token constant">FILE</span><span class="token punctuation">}</span> $<span class="token punctuation">{</span><span class="token constant">NODE</span><span class="token punctuation">}</span><span class="token operator">:</span><span class="token operator">/</span>etc<span class="token operator">/</span>kubernetes<span class="token operator">/</span>$<span class="token punctuation">{</span><span class="token constant">FILE</span><span class="token punctuation">}</span>
    done
  done<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><button class="copy">复制</button></div><p>完成后，在master1通过 kubectl 来创建 kube-proxy daemon：</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0">$ <span class="token keyword">export</span> <span class="token constant">ADDON_URL</span><span class="token operator">=</span><span class="token string">"https://kairen.github.io/files/manual-v1.8/addon"</span>
$ mkdir <span class="token operator">-</span>p <span class="token operator">/</span>etc<span class="token operator">/</span>kubernetes<span class="token operator">/</span>addons <span class="token operator">&amp;&amp;</span> cd <span class="token operator">/</span>etc<span class="token operator">/</span>kubernetes<span class="token operator">/</span>addons
$ wget <span class="token string">"${ADDON_URL}/kube-proxy.yml.conf"</span> <span class="token operator">-</span><span class="token constant">O</span> kube<span class="token operator">-</span>proxy<span class="token punctuation">.</span>yml
$ kubectl apply <span class="token operator">-</span>f kube<span class="token operator">-</span>proxy<span class="token punctuation">.</span>yml
$ kubectl <span class="token operator">-</span>n kube<span class="token operator">-</span>system <span class="token keyword">get</span> po <span class="token operator">-</span>l k8s<span class="token operator">-</span>app<span class="token operator">=</span>kube<span class="token operator">-</span>proxy
<span class="token constant">NAME</span>               <span class="token constant">READY</span>     <span class="token constant">STATUS</span>    <span class="token constant">RESTARTS</span>   <span class="token constant">AGE</span>
kube<span class="token operator">-</span>proxy<span class="token operator">-</span>bpp7q   <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>       Running   <span class="token number">0</span>          47s
kube<span class="token operator">-</span>proxy<span class="token operator">-</span>cztvh   <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>       Running   <span class="token number">0</span>          47s
kube<span class="token operator">-</span>proxy<span class="token operator">-</span>q7mm4   <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>       Running   <span class="token number">0</span>          47sexport <span class="token constant">ADDON_URL</span><span class="token operator">=</span><span class="token string">"https://kairen.github.io/files/manual-v1.8/addon"</span>
$ mkdir <span class="token operator">-</span>p <span class="token operator">/</span>etc<span class="token operator">/</span>kubernetes<span class="token operator">/</span>addons <span class="token operator">&amp;&amp;</span> cd <span class="token operator">/</span>etc<span class="token operator">/</span>kubernetes<span class="token operator">/</span>addons
$ wget <span class="token string">"${ADDON_URL}/kube-proxy.yml.conf"</span> <span class="token operator">-</span><span class="token constant">O</span> kube<span class="token operator">-</span>proxy<span class="token punctuation">.</span>yml
$ kubectl apply <span class="token operator">-</span>f kube<span class="token operator">-</span>proxy<span class="token punctuation">.</span>yml
$ kubectl <span class="token operator">-</span>n kube<span class="token operator">-</span>system <span class="token keyword">get</span> po <span class="token operator">-</span>l k8s<span class="token operator">-</span>app<span class="token operator">=</span>kube<span class="token operator">-</span>proxy
<span class="token constant">NAME</span>               <span class="token constant">READY</span>     <span class="token constant">STATUS</span>    <span class="token constant">RESTARTS</span>   <span class="token constant">AGE</span>
kube<span class="token operator">-</span>proxy<span class="token operator">-</span>bpp7q   <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>       Running   <span class="token number">0</span>          47s
kube<span class="token operator">-</span>proxy<span class="token operator">-</span>cztvh   <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>       Running   <span class="token number">0</span>          47s
kube<span class="token operator">-</span>proxy<span class="token operator">-</span>q7mm4   <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>       Running   <span class="token number">0</span>          47s<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><button class="copy">复制</button></div><h3 id="Kube-dns-addon" name="Kube-dns-addon">Kube-dns addon</h3><p><a data-from="10680" href="http://docs.kubernetes.org.cn/733.html" target="_blank" rel="nofollow noopener noreferrer">Kube DNS</a>&nbsp;是 Kubernetes 集群内部 Pod 之间互相沟通的重要 Addon，它允许 Pod 可以通过 Domain Name 方式来连接 Service，其主要由 Kube DNS 与 Sky DNS 组合而成，通过 Kube DNS 监听 Service 与 Endpoint 变化，来提供给 Sky DNS 信息，已更新解析地址。</p><p>安装只需要在master1通过 kubectl 来创建 kube-dns deployment 即可：</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0">$ <span class="token keyword">export</span> <span class="token constant">ADDON_URL</span><span class="token operator">=</span><span class="token string">"https://kairen.github.io/files/manual-v1.8/addon"</span>
$ wget <span class="token string">"${ADDON_URL}/kube-dns.yml.conf"</span> <span class="token operator">-</span><span class="token constant">O</span> kube<span class="token operator">-</span>dns<span class="token punctuation">.</span>yml
$ kubectl apply <span class="token operator">-</span>f kube<span class="token operator">-</span>dns<span class="token punctuation">.</span>yml
$ kubectl <span class="token operator">-</span>n kube<span class="token operator">-</span>system <span class="token keyword">get</span> po <span class="token operator">-</span>l k8s<span class="token operator">-</span>app<span class="token operator">=</span>kube<span class="token operator">-</span>dns
<span class="token constant">NAME</span>                        <span class="token constant">READY</span>     <span class="token constant">STATUS</span>    <span class="token constant">RESTARTS</span>   <span class="token constant">AGE</span>
kube<span class="token operator">-</span>dns<span class="token operator">-</span>6cb549f55f<span class="token operator">-</span>h4zr5   <span class="token number">0</span><span class="token operator">/</span><span class="token number">3</span>       Pending   <span class="token number">0</span>          40sexport <span class="token constant">ADDON_URL</span><span class="token operator">=</span><span class="token string">"https://kairen.github.io/files/manual-v1.8/addon"</span>
$ wget <span class="token string">"${ADDON_URL}/kube-dns.yml.conf"</span> <span class="token operator">-</span><span class="token constant">O</span> kube<span class="token operator">-</span>dns<span class="token punctuation">.</span>yml
$ kubectl apply <span class="token operator">-</span>f kube<span class="token operator">-</span>dns<span class="token punctuation">.</span>yml
$ kubectl <span class="token operator">-</span>n kube<span class="token operator">-</span>system <span class="token keyword">get</span> po <span class="token operator">-</span>l k8s<span class="token operator">-</span>app<span class="token operator">=</span>kube<span class="token operator">-</span>dns
<span class="token constant">NAME</span>                        <span class="token constant">READY</span>     <span class="token constant">STATUS</span>    <span class="token constant">RESTARTS</span>   <span class="token constant">AGE</span>
kube<span class="token operator">-</span>dns<span class="token operator">-</span>6cb549f55f<span class="token operator">-</span>h4zr5   <span class="token number">0</span><span class="token operator">/</span><span class="token number">3</span>       Pending   <span class="token number">0</span>          40s<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><button class="copy">复制</button></div><h2 id="Calico-Network-%E5%AE%89%E8%A3%85%E4%B8%8E%E8%AE%BE%E5%AE%9A" name="Calico-Network-%E5%AE%89%E8%A3%85%E4%B8%8E%E8%AE%BE%E5%AE%9A">Calico Network 安装与设定</h2><p>Calico 是一款纯 Layer 3 的数据中心网络方案(不需要 Overlay 网络)，Calico 好处是他已与各种云原生平台有良好的整合，而 Calico 在每一个节点利用 Linux Kernel 实现高效的 vRouter 来负责数据的转发，而当数据中心复杂度增加时，可以用 BGP route reflector 来达成。</p><p>首先在master1通过 kubectl 建立 Calico policy controller：</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0">$ <span class="token keyword">export</span> <span class="token constant">CALICO_CONF_URL</span><span class="token operator">=</span><span class="token string">"https://kairen.github.io/files/manual-v1.8/network"</span>
$ wget <span class="token string">"${CALICO_CONF_URL}/calico-controller.yml.conf"</span> <span class="token operator">-</span><span class="token constant">O</span> calico<span class="token operator">-</span>controller<span class="token punctuation">.</span>yml
$ kubectl apply <span class="token operator">-</span>f calico<span class="token operator">-</span>controller<span class="token punctuation">.</span>yml
$ kubectl <span class="token operator">-</span>n kube<span class="token operator">-</span>system <span class="token keyword">get</span> po <span class="token operator">-</span>l k8s<span class="token operator">-</span>app<span class="token operator">=</span>calico<span class="token operator">-</span>policy
<span class="token constant">NAME</span>                                        <span class="token constant">READY</span>     <span class="token constant">STATUS</span>    <span class="token constant">RESTARTS</span>   <span class="token constant">AGE</span>
calico<span class="token operator">-</span>policy<span class="token operator">-</span>controller<span class="token operator">-</span>5ff8b4549d<span class="token operator">-</span>tctmm   <span class="token number">0</span><span class="token operator">/</span><span class="token number">1</span>       Pending   <span class="token number">0</span>          5sexport <span class="token constant">CALICO_CONF_URL</span><span class="token operator">=</span><span class="token string">"https://kairen.github.io/files/manual-v1.8/network"</span>
$ wget <span class="token string">"${CALICO_CONF_URL}/calico-controller.yml.conf"</span> <span class="token operator">-</span><span class="token constant">O</span> calico<span class="token operator">-</span>controller<span class="token punctuation">.</span>yml
$ kubectl apply <span class="token operator">-</span>f calico<span class="token operator">-</span>controller<span class="token punctuation">.</span>yml
$ kubectl <span class="token operator">-</span>n kube<span class="token operator">-</span>system <span class="token keyword">get</span> po <span class="token operator">-</span>l k8s<span class="token operator">-</span>app<span class="token operator">=</span>calico<span class="token operator">-</span>policy
<span class="token constant">NAME</span>                                        <span class="token constant">READY</span>     <span class="token constant">STATUS</span>    <span class="token constant">RESTARTS</span>   <span class="token constant">AGE</span>
calico<span class="token operator">-</span>policy<span class="token operator">-</span>controller<span class="token operator">-</span>5ff8b4549d<span class="token operator">-</span>tctmm   <span class="token number">0</span><span class="token operator">/</span><span class="token number">1</span>       Pending   <span class="token number">0</span>          5s<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><button class="copy">复制</button></div><p>在master1下载 Calico CLI 工具：</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0">$ wget https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>github<span class="token punctuation">.</span>com<span class="token operator">/</span>projectcalico<span class="token operator">/</span>calicoctl<span class="token operator">/</span>releases<span class="token operator">/</span>download<span class="token operator">/</span>v1<span class="token punctuation">.</span><span class="token number">6.1</span><span class="token operator">/</span>calicoctl
$ chmod <span class="token operator">+</span>x calicoctl <span class="token operator">&amp;&amp;</span> mv calicoctl <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>bin<span class="token operator">/</span><span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>github<span class="token punctuation">.</span>com<span class="token operator">/</span>projectcalico<span class="token operator">/</span>calicoctl<span class="token operator">/</span>releases<span class="token operator">/</span>download<span class="token operator">/</span>v1<span class="token punctuation">.</span><span class="token number">6.1</span><span class="token operator">/</span>calicoctl
$ chmod <span class="token operator">+</span>x calicoctl <span class="token operator">&amp;&amp;</span> mv calicoctl <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>bin<span class="token operator">/</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><button class="copy">复制</button></div><p>然后在所有节点下载 Calico，并执行以下步骤：</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0">$ <span class="token keyword">export</span> <span class="token constant">CALICO_URL</span><span class="token operator">=</span><span class="token string">"https://github.com/projectcalico/cni-plugin/releases/download/v1.11.0"</span>
$ wget <span class="token operator">-</span><span class="token constant">N</span> <span class="token operator">-</span><span class="token constant">P</span> <span class="token operator">/</span>opt<span class="token operator">/</span>cni<span class="token operator">/</span>bin $<span class="token punctuation">{</span><span class="token constant">CALICO_URL</span><span class="token punctuation">}</span><span class="token operator">/</span>calico
$ wget <span class="token operator">-</span><span class="token constant">N</span> <span class="token operator">-</span><span class="token constant">P</span> <span class="token operator">/</span>opt<span class="token operator">/</span>cni<span class="token operator">/</span>bin $<span class="token punctuation">{</span><span class="token constant">CALICO_URL</span><span class="token punctuation">}</span><span class="token operator">/</span>calico<span class="token operator">-</span>ipam
$ chmod <span class="token operator">+</span>x <span class="token operator">/</span>opt<span class="token operator">/</span>cni<span class="token operator">/</span>bin<span class="token operator">/</span>calico <span class="token operator">/</span>opt<span class="token operator">/</span>cni<span class="token operator">/</span>bin<span class="token operator">/</span>calico<span class="token operator">-</span>ipamexport <span class="token constant">CALICO_URL</span><span class="token operator">=</span><span class="token string">"https://github.com/projectcalico/cni-plugin/releases/download/v1.11.0"</span>
$ wget <span class="token operator">-</span><span class="token constant">N</span> <span class="token operator">-</span><span class="token constant">P</span> <span class="token operator">/</span>opt<span class="token operator">/</span>cni<span class="token operator">/</span>bin $<span class="token punctuation">{</span><span class="token constant">CALICO_URL</span><span class="token punctuation">}</span><span class="token operator">/</span>calico
$ wget <span class="token operator">-</span><span class="token constant">N</span> <span class="token operator">-</span><span class="token constant">P</span> <span class="token operator">/</span>opt<span class="token operator">/</span>cni<span class="token operator">/</span>bin $<span class="token punctuation">{</span><span class="token constant">CALICO_URL</span><span class="token punctuation">}</span><span class="token operator">/</span>calico<span class="token operator">-</span>ipam
$ chmod <span class="token operator">+</span>x <span class="token operator">/</span>opt<span class="token operator">/</span>cni<span class="token operator">/</span>bin<span class="token operator">/</span>calico <span class="token operator">/</span>opt<span class="token operator">/</span>cni<span class="token operator">/</span>bin<span class="token operator">/</span>calico<span class="token operator">-</span>ipam<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><button class="copy">复制</button></div><p>接着在所有节点下载 CNI plugins配置文件，以及 calico-node.service：</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0">$ mkdir <span class="token operator">-</span>p <span class="token operator">/</span>etc<span class="token operator">/</span>cni<span class="token operator">/</span>net<span class="token punctuation">.</span>d
$ <span class="token keyword">export</span> <span class="token constant">CALICO_CONF_URL</span><span class="token operator">=</span><span class="token string">"https://kairen.github.io/files/manual-v1.8/network"</span>
$ wget <span class="token string">"${CALICO_CONF_URL}/10-calico.conf"</span> <span class="token operator">-</span><span class="token constant">O</span> <span class="token operator">/</span>etc<span class="token operator">/</span>cni<span class="token operator">/</span>net<span class="token punctuation">.</span>d<span class="token operator">/</span><span class="token number">10</span><span class="token operator">-</span>calico<span class="token punctuation">.</span>conf
$ wget <span class="token string">"${CALICO_CONF_URL}/calico-node.service"</span> <span class="token operator">-</span><span class="token constant">O</span> <span class="token operator">/</span>lib<span class="token operator">/</span>systemd<span class="token operator">/</span>system<span class="token operator">/</span>calico<span class="token operator">-</span>node<span class="token punctuation">.</span>service<span class="token operator">-</span>p <span class="token operator">/</span>etc<span class="token operator">/</span>cni<span class="token operator">/</span>net<span class="token punctuation">.</span>d
$ <span class="token keyword">export</span> <span class="token constant">CALICO_CONF_URL</span><span class="token operator">=</span><span class="token string">"https://kairen.github.io/files/manual-v1.8/network"</span>
$ wget <span class="token string">"${CALICO_CONF_URL}/10-calico.conf"</span> <span class="token operator">-</span><span class="token constant">O</span> <span class="token operator">/</span>etc<span class="token operator">/</span>cni<span class="token operator">/</span>net<span class="token punctuation">.</span>d<span class="token operator">/</span><span class="token number">10</span><span class="token operator">-</span>calico<span class="token punctuation">.</span>conf
$ wget <span class="token string">"${CALICO_CONF_URL}/calico-node.service"</span> <span class="token operator">-</span><span class="token constant">O</span> <span class="token operator">/</span>lib<span class="token operator">/</span>systemd<span class="token operator">/</span>system<span class="token operator">/</span>calico<span class="token operator">-</span>node<span class="token punctuation">.</span>service<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><button class="copy">复制</button></div><blockquote><p> 若部署的机器是使用虚拟机，如 Virtualbox 等的话，请修改calico-node.service文件，并在IP_AUTODETECTION_METHOD(包含 IP6)部分指定绑定的网卡，以避免默认绑定到 NAT 网络上。
 </p></blockquote><p>之后在所有节点启动 Calico-node:</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0">$ systemctl enable calico<span class="token operator">-</span>node<span class="token punctuation">.</span>service <span class="token operator">&amp;&amp;</span> systemctl start calico<span class="token operator">-</span>node<span class="token punctuation">.</span>service<span class="token operator">-</span>node<span class="token punctuation">.</span>service <span class="token operator">&amp;&amp;</span> systemctl start calico<span class="token operator">-</span>node<span class="token punctuation">.</span>service<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><button class="copy">复制</button></div><p>在master1查看 Calico nodes:</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0">$ cat <span class="token operator">&lt;&lt;</span><span class="token constant">EOF</span> <span class="token operator">&gt;</span> <span class="token operator">~</span><span class="token operator">/</span>calico<span class="token operator">-</span>rc
<span class="token keyword">export</span> <span class="token constant">ETCD_ENDPOINTS</span><span class="token operator">=</span><span class="token string">"https://172.16.35.12:2379"</span>
<span class="token keyword">export</span> <span class="token constant">ETCD_CA_CERT_FILE</span><span class="token operator">=</span><span class="token string">"/etc/etcd/ssl/etcd-ca.pem"</span>
<span class="token keyword">export</span> <span class="token constant">ETCD_CERT_FILE</span><span class="token operator">=</span><span class="token string">"/etc/etcd/ssl/etcd.pem"</span>
<span class="token keyword">export</span> <span class="token constant">ETCD_KEY_FILE</span><span class="token operator">=</span><span class="token string">"/etc/etcd/ssl/etcd-key.pem"</span>
<span class="token constant">EOF</span>

$ <span class="token punctuation">.</span> <span class="token operator">~</span><span class="token operator">/</span>calico<span class="token operator">-</span>rc
$ calicoctl <span class="token keyword">get</span> node <span class="token operator">-</span>o wide
<span class="token constant">NAME</span>      <span class="token constant">ASN</span>       <span class="token constant">IPV4</span>              <span class="token constant">IPV6</span>
<span class="token function">master1</span>   <span class="token punctuation">(</span><span class="token number">64512</span><span class="token punctuation">)</span>   <span class="token number">172.16</span><span class="token number">.35</span><span class="token number">.12</span><span class="token operator">/</span><span class="token number">24</span>
<span class="token function">node1</span>     <span class="token punctuation">(</span><span class="token number">64512</span><span class="token punctuation">)</span>   <span class="token number">172.16</span><span class="token number">.35</span><span class="token number">.10</span><span class="token operator">/</span><span class="token number">24</span>
<span class="token function">node2</span>     <span class="token punctuation">(</span><span class="token number">64512</span><span class="token punctuation">)</span>   <span class="token number">172.16</span><span class="token number">.35</span><span class="token number">.11</span><span class="token operator">/</span><span class="token number">24</span><span class="token operator">&lt;&lt;</span><span class="token constant">EOF</span> <span class="token operator">&gt;</span> <span class="token operator">~</span><span class="token operator">/</span>calico<span class="token operator">-</span>rc
<span class="token keyword">export</span> <span class="token constant">ETCD_ENDPOINTS</span><span class="token operator">=</span><span class="token string">"https://172.16.35.12:2379"</span>
<span class="token keyword">export</span> <span class="token constant">ETCD_CA_CERT_FILE</span><span class="token operator">=</span><span class="token string">"/etc/etcd/ssl/etcd-ca.pem"</span>
<span class="token keyword">export</span> <span class="token constant">ETCD_CERT_FILE</span><span class="token operator">=</span><span class="token string">"/etc/etcd/ssl/etcd.pem"</span>
<span class="token keyword">export</span> <span class="token constant">ETCD_KEY_FILE</span><span class="token operator">=</span><span class="token string">"/etc/etcd/ssl/etcd-key.pem"</span>
<span class="token constant">EOF</span>

$ <span class="token punctuation">.</span> <span class="token operator">~</span><span class="token operator">/</span>calico<span class="token operator">-</span>rc
$ calicoctl <span class="token keyword">get</span> node <span class="token operator">-</span>o wide
<span class="token constant">NAME</span>      <span class="token constant">ASN</span>       <span class="token constant">IPV4</span>              <span class="token constant">IPV6</span>
<span class="token function">master1</span>   <span class="token punctuation">(</span><span class="token number">64512</span><span class="token punctuation">)</span>   <span class="token number">172.16</span><span class="token number">.35</span><span class="token number">.12</span><span class="token operator">/</span><span class="token number">24</span>
<span class="token function">node1</span>     <span class="token punctuation">(</span><span class="token number">64512</span><span class="token punctuation">)</span>   <span class="token number">172.16</span><span class="token number">.35</span><span class="token number">.10</span><span class="token operator">/</span><span class="token number">24</span>
<span class="token function">node2</span>     <span class="token punctuation">(</span><span class="token number">64512</span><span class="token punctuation">)</span>   <span class="token number">172.16</span><span class="token number">.35</span><span class="token number">.11</span><span class="token operator">/</span><span class="token number">24</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><button class="copy">复制</button></div><p>查看 pending 的 pod 是否已执行：</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0">$ kubectl <span class="token operator">-</span>n kube<span class="token operator">-</span>system <span class="token keyword">get</span> po
<span class="token constant">NAME</span>                                        <span class="token constant">READY</span>     <span class="token constant">STATUS</span>    <span class="token constant">RESTARTS</span>   <span class="token constant">AGE</span>
calico<span class="token operator">-</span>policy<span class="token operator">-</span>controller<span class="token operator">-</span>5ff8b4549d<span class="token operator">-</span>tctmm   <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>       Running   <span class="token number">0</span>          4m
kube<span class="token operator">-</span>apiserver<span class="token operator">-</span>master1                      <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>       Running   <span class="token number">0</span>          20m
kube<span class="token operator">-</span>controller<span class="token operator">-</span>manager<span class="token operator">-</span>master1             <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>       Running   <span class="token number">0</span>          20m
kube<span class="token operator">-</span>dns<span class="token operator">-</span>6cb549f55f<span class="token operator">-</span>h4zr5                   <span class="token number">3</span><span class="token operator">/</span><span class="token number">3</span>       Running   <span class="token number">0</span>          5m
kube<span class="token operator">-</span>proxy<span class="token operator">-</span>fnrkb                            <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>       Running   <span class="token number">0</span>          6m
kube<span class="token operator">-</span>proxy<span class="token operator">-</span>l72bq                            <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>       Running   <span class="token number">0</span>          6m
kube<span class="token operator">-</span>proxy<span class="token operator">-</span>m6rfw                            <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>       Running   <span class="token number">0</span>          6m
kube<span class="token operator">-</span>scheduler<span class="token operator">-</span>master1                      <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>       Running   <span class="token number">0</span>          20m<span class="token operator">-</span>n kube<span class="token operator">-</span>system <span class="token keyword">get</span> po
<span class="token constant">NAME</span>                                        <span class="token constant">READY</span>     <span class="token constant">STATUS</span>    <span class="token constant">RESTARTS</span>   <span class="token constant">AGE</span>
calico<span class="token operator">-</span>policy<span class="token operator">-</span>controller<span class="token operator">-</span>5ff8b4549d<span class="token operator">-</span>tctmm   <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>       Running   <span class="token number">0</span>          4m
kube<span class="token operator">-</span>apiserver<span class="token operator">-</span>master1                      <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>       Running   <span class="token number">0</span>          20m
kube<span class="token operator">-</span>controller<span class="token operator">-</span>manager<span class="token operator">-</span>master1             <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>       Running   <span class="token number">0</span>          20m
kube<span class="token operator">-</span>dns<span class="token operator">-</span>6cb549f55f<span class="token operator">-</span>h4zr5                   <span class="token number">3</span><span class="token operator">/</span><span class="token number">3</span>       Running   <span class="token number">0</span>          5m
kube<span class="token operator">-</span>proxy<span class="token operator">-</span>fnrkb                            <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>       Running   <span class="token number">0</span>          6m
kube<span class="token operator">-</span>proxy<span class="token operator">-</span>l72bq                            <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>       Running   <span class="token number">0</span>          6m
kube<span class="token operator">-</span>proxy<span class="token operator">-</span>m6rfw                            <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>       Running   <span class="token number">0</span>          6m
kube<span class="token operator">-</span>scheduler<span class="token operator">-</span>master1                      <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>       Running   <span class="token number">0</span>          20m<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><button class="copy">复制</button></div><p>最后若想省事，可以直接用&nbsp;<a data-from="10680" href="https://docs.projectcalico.org/v2.6/getting-started/kubernetes/installation/hosted/hosted" target="_blank" rel="nofollow noopener noreferrer">Standard Hosted</a>&nbsp;方式安装。</p><h2 id="Kubernetes-Extra-Addons-%E9%83%A8%E7%BD%B2" name="Kubernetes-Extra-Addons-%E9%83%A8%E7%BD%B2">Kubernetes Extra Addons 部署</h2><p>本节说明如何部署一些官方常用的 Addons，如 Dashboard、Heapster 等。</p><h3 id="Dashboard-addon" name="Dashboard-addon">Dashboard addon</h3><p>Dashboard&nbsp;是 Kubernetes 社区官方开发的仪表板，有了仪表板后管理者就能够透过 Web-based 方式来管理 Kubernetes 集群，除了提升管理方便，也让资源可视化，让人更直觉看见系统信息的呈现结果。</p><p>首先我们要建立kubernetes-dashboard-certs，来提供给 Dashboard TLS 使用：</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0">$ mkdir <span class="token operator">-</span>p <span class="token operator">/</span>etc<span class="token operator">/</span>kubernetes<span class="token operator">/</span>addons<span class="token operator">/</span>certs <span class="token operator">&amp;&amp;</span> cd <span class="token operator">/</span>etc<span class="token operator">/</span>kubernetes<span class="token operator">/</span>addons
$ openssl genrsa <span class="token operator">-</span>des3 <span class="token operator">-</span>passout pass<span class="token operator">:</span>x <span class="token operator">-</span>out certs<span class="token operator">/</span>dashboard<span class="token punctuation">.</span>pass<span class="token punctuation">.</span>key <span class="token number">2048</span>
$ openssl rsa <span class="token operator">-</span>passin pass<span class="token operator">:</span>x <span class="token operator">-</span><span class="token keyword">in</span> certs<span class="token operator">/</span>dashboard<span class="token punctuation">.</span>pass<span class="token punctuation">.</span>key <span class="token operator">-</span>out certs<span class="token operator">/</span>dashboard<span class="token punctuation">.</span>key
$ openssl req <span class="token operator">-</span><span class="token keyword">new</span> <span class="token operator">-</span>key certs<span class="token operator">/</span>dashboard<span class="token punctuation">.</span>key <span class="token operator">-</span>out certs<span class="token operator">/</span>dashboard<span class="token punctuation">.</span>csr <span class="token operator">-</span>subj <span class="token string">'/CN=kube-dashboard'</span>
$ openssl x509 <span class="token operator">-</span>req <span class="token operator">-</span>sha256 <span class="token operator">-</span>days <span class="token number">365</span> <span class="token operator">-</span><span class="token keyword">in</span> certs<span class="token operator">/</span>dashboard<span class="token punctuation">.</span>csr <span class="token operator">-</span>signkey certs<span class="token operator">/</span>dashboard<span class="token punctuation">.</span>key <span class="token operator">-</span>out certs<span class="token operator">/</span>dashboard<span class="token punctuation">.</span>crt
$ rm certs<span class="token operator">/</span>dashboard<span class="token punctuation">.</span>pass<span class="token punctuation">.</span>key
$ kubectl create secret generic kubernetes<span class="token operator">-</span>dashboard<span class="token operator">-</span>certs\
    <span class="token operator">--</span>from<span class="token operator">-</span>file<span class="token operator">=</span>certs <span class="token operator">-</span>n kube<span class="token operator">-</span>system<span class="token operator">-</span>p <span class="token operator">/</span>etc<span class="token operator">/</span>kubernetes<span class="token operator">/</span>addons<span class="token operator">/</span>certs <span class="token operator">&amp;&amp;</span> cd <span class="token operator">/</span>etc<span class="token operator">/</span>kubernetes<span class="token operator">/</span>addons
$ openssl genrsa <span class="token operator">-</span>des3 <span class="token operator">-</span>passout pass<span class="token operator">:</span>x <span class="token operator">-</span>out certs<span class="token operator">/</span>dashboard<span class="token punctuation">.</span>pass<span class="token punctuation">.</span>key <span class="token number">2048</span>
$ openssl rsa <span class="token operator">-</span>passin pass<span class="token operator">:</span>x <span class="token operator">-</span><span class="token keyword">in</span> certs<span class="token operator">/</span>dashboard<span class="token punctuation">.</span>pass<span class="token punctuation">.</span>key <span class="token operator">-</span>out certs<span class="token operator">/</span>dashboard<span class="token punctuation">.</span>key
$ openssl req <span class="token operator">-</span><span class="token keyword">new</span> <span class="token operator">-</span>key certs<span class="token operator">/</span>dashboard<span class="token punctuation">.</span>key <span class="token operator">-</span>out certs<span class="token operator">/</span>dashboard<span class="token punctuation">.</span>csr <span class="token operator">-</span>subj <span class="token string">'/CN=kube-dashboard'</span>
$ openssl x509 <span class="token operator">-</span>req <span class="token operator">-</span>sha256 <span class="token operator">-</span>days <span class="token number">365</span> <span class="token operator">-</span><span class="token keyword">in</span> certs<span class="token operator">/</span>dashboard<span class="token punctuation">.</span>csr <span class="token operator">-</span>signkey certs<span class="token operator">/</span>dashboard<span class="token punctuation">.</span>key <span class="token operator">-</span>out certs<span class="token operator">/</span>dashboard<span class="token punctuation">.</span>crt
$ rm certs<span class="token operator">/</span>dashboard<span class="token punctuation">.</span>pass<span class="token punctuation">.</span>key
$ kubectl create secret generic kubernetes<span class="token operator">-</span>dashboard<span class="token operator">-</span>certs\
    <span class="token operator">--</span>from<span class="token operator">-</span>file<span class="token operator">=</span>certs <span class="token operator">-</span>n kube<span class="token operator">-</span>system<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><button class="copy">复制</button></div><p>接着在master1通过 kubectl 来建立 kubernetes dashboard 即可：</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0">$ <span class="token keyword">export</span> <span class="token constant">ADDON_URL</span><span class="token operator">=</span><span class="token string">"https://kairen.github.io/files/manual-v1.8/addon"</span>
$ wget $<span class="token punctuation">{</span><span class="token constant">ADDON_URL</span><span class="token punctuation">}</span><span class="token operator">/</span>kube<span class="token operator">-</span>dashboard<span class="token punctuation">.</span>yml<span class="token punctuation">.</span>conf <span class="token operator">-</span><span class="token constant">O</span> kube<span class="token operator">-</span>dashboard<span class="token punctuation">.</span>yml
$ kubectl apply <span class="token operator">-</span>f kube<span class="token operator">-</span>dashboard<span class="token punctuation">.</span>yml
$ kubectl <span class="token operator">-</span>n kube<span class="token operator">-</span>system <span class="token keyword">get</span> po<span class="token punctuation">,</span>svc <span class="token operator">-</span>l k8s<span class="token operator">-</span>app<span class="token operator">=</span>kubernetes<span class="token operator">-</span>dashboard
<span class="token constant">NAME</span>                                      <span class="token constant">READY</span>     <span class="token constant">STATUS</span>    <span class="token constant">RESTARTS</span>   <span class="token constant">AGE</span>
po<span class="token operator">/</span>kubernetes<span class="token operator">-</span>dashboard<span class="token operator">-</span>747c4f7cf<span class="token operator">-</span>md5m8   <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>       Running   <span class="token number">0</span>          56s

<span class="token constant">NAME</span>                       <span class="token constant">TYPE</span>        <span class="token constant">CLUSTER</span><span class="token operator">-</span><span class="token constant">IP</span>      <span class="token constant">EXTERNAL</span><span class="token operator">-</span><span class="token constant">IP</span>   <span class="token constant">PORT</span><span class="token punctuation">(</span><span class="token constant">S</span><span class="token punctuation">)</span>   <span class="token constant">AGE</span>
svc<span class="token operator">/</span>kubernetes<span class="token operator">-</span>dashboard   ClusterIP   <span class="token number">10.98</span><span class="token number">.120</span><span class="token number">.209</span>   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">443</span><span class="token operator">/</span><span class="token constant">TCP</span>   56sexport <span class="token constant">ADDON_URL</span><span class="token operator">=</span><span class="token string">"https://kairen.github.io/files/manual-v1.8/addon"</span>
$ wget $<span class="token punctuation">{</span><span class="token constant">ADDON_URL</span><span class="token punctuation">}</span><span class="token operator">/</span>kube<span class="token operator">-</span>dashboard<span class="token punctuation">.</span>yml<span class="token punctuation">.</span>conf <span class="token operator">-</span><span class="token constant">O</span> kube<span class="token operator">-</span>dashboard<span class="token punctuation">.</span>yml
$ kubectl apply <span class="token operator">-</span>f kube<span class="token operator">-</span>dashboard<span class="token punctuation">.</span>yml
$ kubectl <span class="token operator">-</span>n kube<span class="token operator">-</span>system <span class="token keyword">get</span> po<span class="token punctuation">,</span>svc <span class="token operator">-</span>l k8s<span class="token operator">-</span>app<span class="token operator">=</span>kubernetes<span class="token operator">-</span>dashboard
<span class="token constant">NAME</span>                                      <span class="token constant">READY</span>     <span class="token constant">STATUS</span>    <span class="token constant">RESTARTS</span>   <span class="token constant">AGE</span>
po<span class="token operator">/</span>kubernetes<span class="token operator">-</span>dashboard<span class="token operator">-</span>747c4f7cf<span class="token operator">-</span>md5m8   <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>       Running   <span class="token number">0</span>          56s

<span class="token constant">NAME</span>                       <span class="token constant">TYPE</span>        <span class="token constant">CLUSTER</span><span class="token operator">-</span><span class="token constant">IP</span>      <span class="token constant">EXTERNAL</span><span class="token operator">-</span><span class="token constant">IP</span>   <span class="token constant">PORT</span><span class="token punctuation">(</span><span class="token constant">S</span><span class="token punctuation">)</span>   <span class="token constant">AGE</span>
svc<span class="token operator">/</span>kubernetes<span class="token operator">-</span>dashboard   ClusterIP   <span class="token number">10.98</span><span class="token number">.120</span><span class="token number">.209</span>   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">443</span><span class="token operator">/</span><span class="token constant">TCP</span>   56s<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><button class="copy">复制</button></div><blockquote><p> P.S. 这边会额外创建一个名称为anonymous-open-door&nbsp;Cluster Role Binding，这仅作为方便测试时使用，在一般情况下不要开启，不然就会直接被存取所有 API。
 </p></blockquote><p>完成后，就可以透过浏览器访问&nbsp;Dashboard，https://172.16.35.12:6443/api/v1/namespaces/kube-system/services/https:kubernetes-dashboard:/proxy/</p><h3 id="Heapster-addon" name="Heapster-addon">Heapster addon</h3><p><a data-from="10680" href="https://www.kubernetes.org.cn/932.html" target="_blank" rel="nofollow noopener noreferrer">Heapster</a>&nbsp;是 Kubernetes 社区维护的容器集群监控分析工具。Heapster 会从 Kubernetes apiserver 获得所有 Node 信息，然后再通过这些 Node 来获得 kubelet 上的数据，最后再将所有收集到数据送到 Heapster 的后台储存 InfluxDB，最后利用 <a data-text-link="2136_2197170" data-from="10680" href="https://cloud.tencent.com/product/tcmg?from=10680" target="_blank">Grafana</a> 来抓取 InfluxDB 的数据源来进行可视化。</p><p>在master1通过 kubectl 来创建 kubernetes monitor 即可：</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0">$ <span class="token keyword">export</span> <span class="token constant">ADDON_URL</span><span class="token operator">=</span><span class="token string">"https://kairen.github.io/files/manual-v1.8/addon"</span>
$ wget $<span class="token punctuation">{</span><span class="token constant">ADDON_URL</span><span class="token punctuation">}</span><span class="token operator">/</span>kube<span class="token operator">-</span>monitor<span class="token punctuation">.</span>yml<span class="token punctuation">.</span>conf <span class="token operator">-</span><span class="token constant">O</span> kube<span class="token operator">-</span>monitor<span class="token punctuation">.</span>yml
$ kubectl apply <span class="token operator">-</span>f kube<span class="token operator">-</span>monitor<span class="token punctuation">.</span>yml
$ kubectl <span class="token operator">-</span>n kube<span class="token operator">-</span>system <span class="token keyword">get</span> po<span class="token punctuation">,</span>svc
<span class="token constant">NAME</span>                                           <span class="token constant">READY</span>     <span class="token constant">STATUS</span>    <span class="token constant">RESTARTS</span>   <span class="token constant">AGE</span>
<span class="token operator">...</span>
po<span class="token operator">/</span>heapster<span class="token operator">-</span>74fb5c8cdc<span class="token operator">-</span>62xzc                   <span class="token number">4</span><span class="token operator">/</span><span class="token number">4</span>       Running   <span class="token number">0</span>          7m
po<span class="token operator">/</span>influxdb<span class="token operator">-</span>grafana<span class="token operator">-</span>55bd7df44<span class="token operator">-</span>nw4nc            <span class="token number">2</span><span class="token operator">/</span><span class="token number">2</span>       Running   <span class="token number">0</span>          7m

<span class="token constant">NAME</span>                       <span class="token constant">TYPE</span>        <span class="token constant">CLUSTER</span><span class="token operator">-</span><span class="token constant">IP</span>       <span class="token constant">EXTERNAL</span><span class="token operator">-</span><span class="token constant">IP</span>   <span class="token constant">PORT</span><span class="token punctuation">(</span><span class="token constant">S</span><span class="token punctuation">)</span>             <span class="token constant">AGE</span>
<span class="token operator">...</span>
svc<span class="token operator">/</span>heapster               ClusterIP   <span class="token number">10.100</span><span class="token number">.242</span><span class="token number">.225</span>   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">80</span><span class="token operator">/</span><span class="token constant">TCP</span>              7m
svc<span class="token operator">/</span>monitoring<span class="token operator">-</span>grafana     ClusterIP   <span class="token number">10.101</span><span class="token number">.106</span><span class="token number">.180</span>   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">80</span><span class="token operator">/</span><span class="token constant">TCP</span>              7m
svc<span class="token operator">/</span>monitoring<span class="token operator">-</span>influxdb    ClusterIP   <span class="token number">10.109</span><span class="token number">.245</span><span class="token number">.142</span>   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">8083</span><span class="token operator">/</span><span class="token constant">TCP</span><span class="token punctuation">,</span><span class="token number">8086</span><span class="token operator">/</span><span class="token constant">TCP</span>   7m
···<span class="token keyword">export</span> <span class="token constant">ADDON_URL</span><span class="token operator">=</span><span class="token string">"https://kairen.github.io/files/manual-v1.8/addon"</span>
$ wget $<span class="token punctuation">{</span><span class="token constant">ADDON_URL</span><span class="token punctuation">}</span><span class="token operator">/</span>kube<span class="token operator">-</span>monitor<span class="token punctuation">.</span>yml<span class="token punctuation">.</span>conf <span class="token operator">-</span><span class="token constant">O</span> kube<span class="token operator">-</span>monitor<span class="token punctuation">.</span>yml
$ kubectl apply <span class="token operator">-</span>f kube<span class="token operator">-</span>monitor<span class="token punctuation">.</span>yml
$ kubectl <span class="token operator">-</span>n kube<span class="token operator">-</span>system <span class="token keyword">get</span> po<span class="token punctuation">,</span>svc
<span class="token constant">NAME</span>                                           <span class="token constant">READY</span>     <span class="token constant">STATUS</span>    <span class="token constant">RESTARTS</span>   <span class="token constant">AGE</span>
<span class="token operator">...</span>
po<span class="token operator">/</span>heapster<span class="token operator">-</span>74fb5c8cdc<span class="token operator">-</span>62xzc                   <span class="token number">4</span><span class="token operator">/</span><span class="token number">4</span>       Running   <span class="token number">0</span>          7m
po<span class="token operator">/</span>influxdb<span class="token operator">-</span>grafana<span class="token operator">-</span>55bd7df44<span class="token operator">-</span>nw4nc            <span class="token number">2</span><span class="token operator">/</span><span class="token number">2</span>       Running   <span class="token number">0</span>          7m

<span class="token constant">NAME</span>                       <span class="token constant">TYPE</span>        <span class="token constant">CLUSTER</span><span class="token operator">-</span><span class="token constant">IP</span>       <span class="token constant">EXTERNAL</span><span class="token operator">-</span><span class="token constant">IP</span>   <span class="token constant">PORT</span><span class="token punctuation">(</span><span class="token constant">S</span><span class="token punctuation">)</span>             <span class="token constant">AGE</span>
<span class="token operator">...</span>
svc<span class="token operator">/</span>heapster               ClusterIP   <span class="token number">10.100</span><span class="token number">.242</span><span class="token number">.225</span>   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">80</span><span class="token operator">/</span><span class="token constant">TCP</span>              7m
svc<span class="token operator">/</span>monitoring<span class="token operator">-</span>grafana     ClusterIP   <span class="token number">10.101</span><span class="token number">.106</span><span class="token number">.180</span>   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">80</span><span class="token operator">/</span><span class="token constant">TCP</span>              7m
svc<span class="token operator">/</span>monitoring<span class="token operator">-</span>influxdb    ClusterIP   <span class="token number">10.109</span><span class="token number">.245</span><span class="token number">.142</span>   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">8083</span><span class="token operator">/</span><span class="token constant">TCP</span><span class="token punctuation">,</span><span class="token number">8086</span><span class="token operator">/</span><span class="token constant">TCP</span>   7m
···<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><button class="copy">复制</button></div><p>完成后，就可以透过浏览器存取&nbsp;Grafana Dashboard，https://172.16.35.12:6443/api/v1/proxy/namespaces/kube-system/services/monitoring-grafana</p><h2 id="%E7%AE%80%E5%8D%95%E9%83%A8%E7%BD%B2-Nginx-%E6%9C%8D%E5%8A%A1" name="%E7%AE%80%E5%8D%95%E9%83%A8%E7%BD%B2-Nginx-%E6%9C%8D%E5%8A%A1">简单部署 Nginx 服务</h2><p>Kubernetes 可以选择使用指令直接创建应用程序与服务，或者撰写 YAML 与 JSON 档案来描述部署应用程序的配置，以下将创建一个简单的 Nginx 服务：</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0">$ kubectl run nginx <span class="token operator">--</span>image<span class="token operator">=</span>nginx <span class="token operator">--</span>port<span class="token operator">=</span><span class="token number">80</span>
$ kubectl expose deploy nginx <span class="token operator">--</span>port<span class="token operator">=</span><span class="token number">80</span> <span class="token operator">--</span>type<span class="token operator">=</span>LoadBalancer <span class="token operator">--</span>external<span class="token operator">-</span>ip<span class="token operator">=</span><span class="token number">172.16</span><span class="token number">.35</span><span class="token number">.12</span>
$ kubectl <span class="token keyword">get</span> svc<span class="token punctuation">,</span>po
<span class="token constant">NAME</span>             <span class="token constant">TYPE</span>           <span class="token constant">CLUSTER</span><span class="token operator">-</span><span class="token constant">IP</span>      <span class="token constant">EXTERNAL</span><span class="token operator">-</span><span class="token constant">IP</span>    <span class="token constant">PORT</span><span class="token punctuation">(</span><span class="token constant">S</span><span class="token punctuation">)</span>        <span class="token constant">AGE</span>
svc<span class="token operator">/</span>kubernetes   ClusterIP      <span class="token number">10.96</span><span class="token number">.0</span><span class="token number">.1</span>       <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>         <span class="token number">443</span><span class="token operator">/</span><span class="token constant">TCP</span>        1h
svc<span class="token operator">/</span>nginx        LoadBalancer   <span class="token number">10.97</span><span class="token number">.121</span><span class="token number">.243</span>   <span class="token number">172.16</span><span class="token number">.35</span><span class="token number">.12</span>   <span class="token number">80</span><span class="token operator">:</span><span class="token number">30344</span><span class="token operator">/</span><span class="token constant">TCP</span>   22s

<span class="token constant">NAME</span>                        <span class="token constant">READY</span>     <span class="token constant">STATUS</span>    <span class="token constant">RESTARTS</span>   <span class="token constant">AGE</span>
po<span class="token operator">/</span>nginx<span class="token operator">-</span>7cbc4b4d9c<span class="token operator">-</span>7796l   <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>       Running   <span class="token number">0</span>          28s       <span class="token number">192.160</span><span class="token number">.57</span><span class="token number">.181</span>   <span class="token punctuation">,</span><span class="token number">172.16</span><span class="token number">.35</span><span class="token number">.12</span>   <span class="token number">80</span><span class="token operator">:</span><span class="token number">32054</span><span class="token operator">/</span><span class="token constant">TCP</span>   21s<span class="token operator">--</span>image<span class="token operator">=</span>nginx <span class="token operator">--</span>port<span class="token operator">=</span><span class="token number">80</span>
$ kubectl expose deploy nginx <span class="token operator">--</span>port<span class="token operator">=</span><span class="token number">80</span> <span class="token operator">--</span>type<span class="token operator">=</span>LoadBalancer <span class="token operator">--</span>external<span class="token operator">-</span>ip<span class="token operator">=</span><span class="token number">172.16</span><span class="token number">.35</span><span class="token number">.12</span>
$ kubectl <span class="token keyword">get</span> svc<span class="token punctuation">,</span>po
<span class="token constant">NAME</span>             <span class="token constant">TYPE</span>           <span class="token constant">CLUSTER</span><span class="token operator">-</span><span class="token constant">IP</span>      <span class="token constant">EXTERNAL</span><span class="token operator">-</span><span class="token constant">IP</span>    <span class="token constant">PORT</span><span class="token punctuation">(</span><span class="token constant">S</span><span class="token punctuation">)</span>        <span class="token constant">AGE</span>
svc<span class="token operator">/</span>kubernetes   ClusterIP      <span class="token number">10.96</span><span class="token number">.0</span><span class="token number">.1</span>       <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>         <span class="token number">443</span><span class="token operator">/</span><span class="token constant">TCP</span>        1h
svc<span class="token operator">/</span>nginx        LoadBalancer   <span class="token number">10.97</span><span class="token number">.121</span><span class="token number">.243</span>   <span class="token number">172.16</span><span class="token number">.35</span><span class="token number">.12</span>   <span class="token number">80</span><span class="token operator">:</span><span class="token number">30344</span><span class="token operator">/</span><span class="token constant">TCP</span>   22s

<span class="token constant">NAME</span>                        <span class="token constant">READY</span>     <span class="token constant">STATUS</span>    <span class="token constant">RESTARTS</span>   <span class="token constant">AGE</span>
po<span class="token operator">/</span>nginx<span class="token operator">-</span>7cbc4b4d9c<span class="token operator">-</span>7796l   <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>       Running   <span class="token number">0</span>          28s       <span class="token number">192.160</span><span class="token number">.57</span><span class="token number">.181</span>   <span class="token punctuation">,</span><span class="token number">172.16</span><span class="token number">.35</span><span class="token number">.12</span>   <span class="token number">80</span><span class="token operator">:</span><span class="token number">32054</span><span class="token operator">/</span><span class="token constant">TCP</span>   21s<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><button class="copy">复制</button></div><blockquote><p> 这边type可以选择 NodePort 与 LoadBalancer，在本地裸机部署，两者差异在于NodePort只映射 Host port 到 Container port，而LoadBalancer则继承NodePort额外多出映射 Host target port 到 Container port。
 </p></blockquote><p>确认没问题后即可在浏览器存取&nbsp;http://172.16.35.12</p><h3 id="%E6%89%A9%E5%B1%95%E6%9C%8D%E5%8A%A1%E6%95%B0%E9%87%8F" name="%E6%89%A9%E5%B1%95%E6%9C%8D%E5%8A%A1%E6%95%B0%E9%87%8F">扩展服务数量</h3><p>若集群node节点增加了，而想让 Nginx 服务提供可靠性的话，可以通过以下方式来扩展服务的副本：</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0">$ kubectl scale deploy nginx <span class="token operator">--</span>replicas<span class="token operator">=</span><span class="token number">2</span>

$ kubectl <span class="token keyword">get</span> pods <span class="token operator">-</span>o wide
<span class="token constant">NAME</span>                    <span class="token constant">READY</span>     <span class="token constant">STATUS</span>    <span class="token constant">RESTARTS</span>   <span class="token constant">AGE</span>       <span class="token constant">IP</span>             <span class="token constant">NODE</span>
nginx<span class="token operator">-</span><span class="token number">158599303</span><span class="token operator">-</span>0h9lr   <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>       Running   <span class="token number">0</span>          25s       <span class="token number">10.244</span><span class="token number">.100</span><span class="token number">.5</span>   node2
nginx<span class="token operator">-</span><span class="token number">158599303</span><span class="token operator">-</span>k7cbt   <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>       Running   <span class="token number">0</span>          1m        <span class="token number">10.244</span><span class="token number">.24</span><span class="token number">.3</span>    node1<span class="token operator">--</span>replicas<span class="token operator">=</span><span class="token number">2</span>

$ kubectl <span class="token keyword">get</span> pods <span class="token operator">-</span>o wide
<span class="token constant">NAME</span>                    <span class="token constant">READY</span>     <span class="token constant">STATUS</span>    <span class="token constant">RESTARTS</span>   <span class="token constant">AGE</span>       <span class="token constant">IP</span>             <span class="token constant">NODE</span>
nginx<span class="token operator">-</span><span class="token number">158599303</span><span class="token operator">-</span>0h9lr   <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>       Running   <span class="token number">0</span>          25s       <span class="token number">10.244</span><span class="token number">.100</span><span class="token number">.5</span>   node2
nginx<span class="token operator">-</span><span class="token number">158599303</span><span class="token operator">-</span>k7cbt   <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>       Running   <span class="token number">0</span>          1m        <span class="token number">10.244</span><span class="token number">.24</span><span class="token number">.3</span>    node1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><button class="copy">复制</button></div></div></div><div id="J-viewLargeImageBox" class="zoom-mask" style="display: none; width: 100%; height: 100%; z-index: 1002;"><div class="zoom-close"></div><div class="zoom-wrap"><img></div></div><div class="col-2-article-source"><div class="col-2-author-info"><div class="col-2-author-info-inner"><div class="col-2-author-info-title">本文参与<a href="https://cloud.tencent.com/developer/support-plan" target="_blank"> 腾讯云自媒体分享计划</a>  ，欢迎热爱写作的你一起参与！</div><div class="col-2-author-info-address"><div class="col-2-article-reprint"><div class="article-reprint-source"><span>本文分享自作者个人站点/博客：<!-- -->https://blog.csdn.net/bbwangj</span><a class="source-copy" data-clipboard-text="https://blog.csdn.net/bbwangj" href="javascript:void(0);"><span class="text">复制</span></a></div><div class="article-reprint-contact">如有侵权，请联系 <!-- -->cloudcommunity@tencent.com<!-- --> 删除。</div></div></div></div></div></div></div><div class="com-markdown-collpase-toggle"><a href="javascript:;" class="toggle-link">展开阅读全文</a></div></div><div class="col-2-article-tags"><nav class="col-tags"><a href="https://cloud.tencent.com/developer/tag/10681?entry=article" class="col-tag">网络安全</a><a href="https://cloud.tencent.com/developer/tag/10207?entry=article" class="col-tag">JSON</a><a href="https://cloud.tencent.com/developer/tag/10987?entry=article" class="col-tag">etcd</a><a href="https://cloud.tencent.com/developer/tag/10750?entry=article" class="col-tag">TCP/IP</a><a href="https://cloud.tencent.com/developer/tag/10802?entry=article" class="col-tag">数据分析</a></nav><div class="extra-part"><div class="com-operations"><a href="javascript:;" class="com-opt-link link-warn"><i class="com-i-warn"></i>举报</a></div></div></div><div class="col-2-article-opts"><button type="button" class="c-btn"><span class="text"><i class="opt-icon like"></i>点赞 2</span></button><button type="button" class="c-btn c-btn-weak"><span class="text"><i class="opt-icon share"></i>分享</span></button></div><section class="group-comments"><div class="com-comment-single-edit theme2"><div class="edit-body"><div class="edit-textarea"></div><div class="edit-tip"><a href="javascript:;">登录</a> 后参与评论</div></div></div><div class="col-2-article-filter"><div class="article-filter-main"><em>0</em> 条评论</div></div><section class="com-comment-popup"><div class="popup-bd"></div><div class="c-loading c-loading-tip">加载失败，请点击 <a href="javascript:;">重试</a></div></section></section></section><section class="com-2-panel"><header class="com-2-panel-hd"><h3 class="com-2-panel-title">相关文章</h3></header><ul class="com-3-article-panels without-padding-top"><li class="panel-cell"><div class="com-3-article-panel theme2"><a href="https://cloud.tencent.com/developer/article/1136829?from=article.detail.2197170&amp;areaSource=106000.1&amp;traceId=ijFPtLQ0SLl1sLBbbhFXf" target="_blank" class="panel-link" hotrep=""></a><div class="com-3-article-panel-media"><div class="com-3-article-panel-body"><h3 class="com-3-article-panel-title">IT苦工指南 | Kubernetes v1.8.x全手动安装</h3><p class="com-3-article-panel-desc">觉得Rainbond提供的既简洁、又易用、而且生产就绪的Kubernets体验不过瘾……</p><div class="com-3-article-panel-infos"><div class="com-3-article-panel-source"><a href="https://cloud.tencent.com/developer/user/2188477" target="_blank" class="item author"><span class="com-2-avatar"><span class="com-2-avatar-inner" style="background-image:url(https://ask.qcloudimg.com/http-save/yehe-2188477/e910c8af7162e69473aa0f34838e152a.jpg?imageView2/2/w/64)"></span></span>Rainbond开源</a></div></div></div></div></div></li><li class="panel-cell"><div class="com-3-article-panel theme2"><a href="https://cloud.tencent.com/developer/article/1472288?from=article.detail.2197170&amp;areaSource=106000.2&amp;traceId=ijFPtLQ0SLl1sLBbbhFXf" target="_blank" class="panel-link" hotrep=""></a><div class="com-3-article-panel-media"><div class="com-3-article-panel-body"><h3 class="com-3-article-panel-title">kubernetes1.13.0 HA安装教程</h3><p class="com-3-article-panel-desc">sealos是一个轻量级kubernetes HA安装项目，重点关注功能的收敛而非庞大复杂厚重，旨在容易定制。除kubelet以外其它任何组件均在容器中运行 这...</p><div class="com-3-article-panel-infos"><div class="com-3-article-panel-source"><a href="https://cloud.tencent.com/developer/user/5891535" target="_blank" class="item author"><span class="com-2-avatar"><span class="com-2-avatar-inner" style="background-image:url(https://ask.qcloudimg.com/custom-avatar/5891535/vgx0jqjt9t.jpg)"></span></span>sealyun</a></div></div></div></div></div></li><li class="panel-cell"><div class="com-3-article-panel theme2"><a href="https://cloud.tencent.com/developer/article/1704686?from=article.detail.2197170&amp;areaSource=106000.3&amp;traceId=ijFPtLQ0SLl1sLBbbhFXf" target="_blank" class="panel-link" hotrep=""></a><div class="com-3-article-panel-media"><div class="com-3-article-panel-body"><h3 class="com-3-article-panel-title">centos7安装kubernetes教程</h3><p class="com-3-article-panel-desc">Kubernetes默认CRI（容器运行时）为Docker，因此先安装Docker。</p><div class="com-3-article-panel-infos"><div class="com-3-article-panel-source"><a href="https://cloud.tencent.com/developer/user/3081251" target="_blank" class="item author"><span class="com-2-avatar"><span class="com-2-avatar-inner" style="background-image:url(https://ask.qcloudimg.com/http-save/yehe-3081251/6sx1qcqg4k.jpeg?imageView2/2/w/64)"></span></span>gang_luo</a></div></div></div><div class="com-3-article-panel-object"><span class="com-thumbnail com-3-article-panel-thumbnail" style="background-image:url(https://ask.qcloudimg.com/http-save/yehe-3081251/kxehsleukn.png?imageView2/2/w/240)"></span></div></div></div></li><li class="panel-cell"><div class="com-3-article-panel theme2"><a href="https://cloud.tencent.com/developer/article/1149268?from=article.detail.2197170&amp;areaSource=106000.4&amp;traceId=ijFPtLQ0SLl1sLBbbhFXf" target="_blank" class="panel-link" hotrep=""></a><div class="com-3-article-panel-media"><div class="com-3-article-panel-body"><h3 class="com-3-article-panel-title">轻松加愉快的 Kubernetes 安装教程</h3><div class="com-3-article-panel-infos"><div class="com-3-article-panel-source"><a href="https://cloud.tencent.com/developer/user/1751832" target="_blank" class="item author"><span class="com-2-avatar"><span class="com-2-avatar-inner" style="background-image:url(https://ask.qcloudimg.com/custom-avatar/1751832/v8eezkecko.jpg)"></span></span>小小科</a></div></div></div></div></div></li><li class="panel-cell"><div class="com-3-article-panel theme2"><a href="https://cloud.tencent.com/developer/article/1995684?from=article.detail.2197170&amp;areaSource=106000.5&amp;traceId=ijFPtLQ0SLl1sLBbbhFXf" target="_blank" class="panel-link" hotrep=""></a><div class="com-3-article-panel-media"><div class="com-3-article-panel-body"><h3 class="com-3-article-panel-title">使用Kubespray部署Kubernetes集群</h3><p class="com-3-article-panel-desc">Kubespray是Google开源的一个部署生产级别的Kubernetes服务器集群的开源项目，它整合了Ansible作为部署的工具。项目地址：https:/...</p><div class="com-3-article-panel-infos"><div class="com-3-article-panel-source"><a href="https://cloud.tencent.com/developer/user/1128701" target="_blank" class="item author"><span class="com-2-avatar"><span class="com-2-avatar-inner" style="background-image:url(https://ask.qcloudimg.com/custom-avatar/1128701/1b2913hlhx.jpg)"></span></span>方志朋</a></div></div></div></div></div></li><li class="panel-cell"><div class="com-3-article-panel theme2"><a href="https://cloud.tencent.com/developer/article/1910787?from=article.detail.2197170&amp;areaSource=106000.6&amp;traceId=ijFPtLQ0SLl1sLBbbhFXf" target="_blank" class="panel-link" hotrep=""></a><div class="com-3-article-panel-media"><div class="com-3-article-panel-body"><h3 class="com-3-article-panel-title">Mesh7# wasm扩展Envoy使用详解</h3><p class="com-3-article-panel-desc">引言
我们想要网格的服务发现、路由、熔断降级、负载均衡，这些流量治理都在数据面Envoy中执行才行。Envoy也提供的Filter机制来做这些功能，通常有以下方...</p><div class="com-3-article-panel-infos"><div class="com-3-article-panel-source"><a href="https://cloud.tencent.com/developer/user/3911980" target="_blank" class="item author"><span class="com-2-avatar"><span class="com-2-avatar-inner" style="background-image:url(https://ask.qcloudimg.com/http-save/yehe-3911980/3j3gigc52g.jpeg?imageView2/2/w/64)"></span></span>瓜农老梁</a></div></div></div><div class="com-3-article-panel-object"><span class="com-thumbnail com-3-article-panel-thumbnail" style="background-image:url(https://ask.qcloudimg.com/http-save/yehe-3911980/2e8acafee88c13c2a8a6c3d7fb3b4574.png?imageView2/2/w/240)"></span></div></div></div></li><li class="panel-cell"><div class="com-3-article-panel theme2"><a href="https://cloud.tencent.com/developer/article/1590037?from=article.detail.2197170&amp;areaSource=106000.7&amp;traceId=ijFPtLQ0SLl1sLBbbhFXf" target="_blank" class="panel-link" hotrep=""></a><div class="com-3-article-panel-media"><div class="com-3-article-panel-body"><h3 class="com-3-article-panel-title">Gitea安装教程/基于宝塔面板的Gitea安装</h3><p class="com-3-article-panel-desc">Gitea经过我测试，不支持1.x版本的git，刚开始我在Centos上面直接使用命令yum -y install git安装后，git版本是1.8.x，然后我...</p><div class="com-3-article-panel-infos"><div class="com-3-article-panel-source"><a href="https://cloud.tencent.com/developer/user/1052078" target="_blank" class="item author"><span class="com-2-avatar"><span class="com-2-avatar-inner" style="background-image:url(https://ask.qcloudimg.com/http-save/yehe-1052078/ks3kkh5gr7.jpeg?imageView2/2/w/64)"></span></span>华创信息技术</a></div></div></div></div></div></li><li class="panel-cell"><div class="com-3-article-panel theme2"><a href="https://cloud.tencent.com/developer/article/1397916?from=article.detail.2197170&amp;areaSource=106000.8&amp;traceId=ijFPtLQ0SLl1sLBbbhFXf" target="_blank" class="panel-link" hotrep=""></a><div class="com-3-article-panel-media"><div class="com-3-article-panel-body"><h3 class="com-3-article-panel-title">基于Unity的AR开发初探：发布AR应用到Android平台</h3><p class="com-3-article-panel-desc">本文接上一篇，介绍一下如何通过Unity发布第一个AR应用至Android平台，在Android手机上使用我们的第一个AR应用。</p><div class="com-3-article-panel-infos"><div class="com-3-article-panel-source"><a href="https://cloud.tencent.com/developer/user/2719971" target="_blank" class="item author"><span class="com-2-avatar"><span class="com-2-avatar-inner" style="background-image:url(https://ask.qcloudimg.com/http-save/yehe-2719971/yyvn9izcbg.jpeg?imageView2/2/w/64)"></span></span>Edison Zhou</a></div></div></div></div></div></li><li class="panel-cell"><div class="com-3-article-panel theme2"><a href="https://cloud.tencent.com/developer/article/1033276?from=article.detail.2197170&amp;areaSource=106000.9&amp;traceId=ijFPtLQ0SLl1sLBbbhFXf" target="_blank" class="panel-link" hotrep=""></a><div class="com-3-article-panel-media"><div class="com-3-article-panel-body"><h3 class="com-3-article-panel-title">【新手向】为何要这样安装Django？</h3><p class="com-3-article-panel-desc">專 欄
❈JacobYRJ，做过爬虫，水仙花数，最擅长的领域是数据库和web框架，其中最熟悉的是Django框架。
Github博客地址：JacobYRJ.gi...</p><div class="com-3-article-panel-infos"><div class="com-3-article-panel-source"><a href="https://cloud.tencent.com/developer/user/1227999" target="_blank" class="item author"><span class="com-2-avatar"><span class="com-2-avatar-inner" style="background-image:url(https://ask.qcloudimg.com/avatar/1227999/maw5mw6294.jpg?imageView2/2/w/64)"></span></span>Python中文社区</a></div></div></div><div class="com-3-article-panel-object"><span class="com-thumbnail com-3-article-panel-thumbnail" style="background-image:url(https://ask.qcloudimg.com/http-save/yehe-1227999/npf4bxcv78.jpeg?imageView2/2/w/240)"></span></div></div></div></li><li class="panel-cell"><div class="com-3-article-panel theme2"><a href="https://cloud.tencent.com/developer/article/1400610?from=article.detail.2197170&amp;areaSource=106000.10&amp;traceId=ijFPtLQ0SLl1sLBbbhFXf" target="_blank" class="panel-link" hotrep=""></a><div class="com-3-article-panel-media"><div class="com-3-article-panel-body"><h3 class="com-3-article-panel-title">会了也要看的flink安装部署|适合阅读</h3><p class="com-3-article-panel-desc">Flink支持运行与所有的类linux环境，比如linux，mac os x 和cygwin(windows)，要求一个master节点，一个或者多个worke...</p><div class="com-3-article-panel-infos"><div class="com-3-article-panel-source"><a href="https://cloud.tencent.com/developer/user/1088682" target="_blank" class="item author"><span class="com-2-avatar"><span class="com-2-avatar-inner" style="background-image:url(https://ask.qcloudimg.com/avatar/1088682/perwxxz68n.png?imageView2/2/w/64)"></span></span>Spark学习技巧</a></div></div></div><div class="com-3-article-panel-object"><span class="com-thumbnail com-3-article-panel-thumbnail" style="background-image:url(https://ask.qcloudimg.com/http-save/yehe-1088682/atzdxg9o99.jpeg?imageView2/2/w/240)"></span></div></div></div></li><li class="panel-cell"><div class="com-3-article-panel theme2"><a href="https://cloud.tencent.com/developer/article/2141798?from=article.detail.2197170&amp;areaSource=106000.11&amp;traceId=ijFPtLQ0SLl1sLBbbhFXf" target="_blank" class="panel-link" hotrep=""></a><div class="com-3-article-panel-media"><div class="com-3-article-panel-body"><h3 class="com-3-article-panel-title">Linux下mc服务器自动化管理的两个实现思路</h3><p class="com-3-article-panel-desc">此方法需要具备基础shell知识，且需要全手动编写，较为复杂，推荐有linux使用基础者使用，教程可移步b站大佬的专栏，极为详细。</p><div class="com-3-article-panel-infos"><div class="com-3-article-panel-source"><a href="https://cloud.tencent.com/developer/user/8222933" target="_blank" class="item author"><span class="com-2-avatar"><span class="com-2-avatar-inner" style="background-image:url(https://developer.qcloudimg.com/http-save/10011/af4a70381cbc4bcb9945502f4c238d8b.jpg?imageView2/2/w/64)"></span></span>LonelyEnderman</a></div></div></div><div class="com-3-article-panel-object"><span class="com-thumbnail com-3-article-panel-thumbnail" style="background-image:url(https://ask.qcloudimg.com/http-save/yehe-8222933/3e9c73891fe83b0fcc576ed930c5a893.png?imageView2/2/w/240)"></span></div></div></div></li><li class="panel-cell"><div class="com-3-article-panel theme2"><a href="https://cloud.tencent.com/developer/article/1696689?from=article.detail.2197170&amp;areaSource=106000.12&amp;traceId=ijFPtLQ0SLl1sLBbbhFXf" target="_blank" class="panel-link" hotrep=""></a><div class="com-3-article-panel-media"><div class="com-3-article-panel-body"><h3 class="com-3-article-panel-title">Kubernetes之helm部署使用</h3><p class="com-3-article-panel-desc">是一个部署在Kubernetes集群内部的 server，其与 Helm client、Kubernetes API server 进行交互</p><div class="com-3-article-panel-infos"><div class="com-3-article-panel-source"><a href="https://cloud.tencent.com/developer/user/5954574" target="_blank" class="item author"><span class="com-2-avatar"><span class="com-2-avatar-inner" style="background-image:url(https://ask.qcloudimg.com/http-save/yehe-5954574/tiyzxdudvz.jpeg?imageView2/2/w/64)"></span></span>聂伟星</a></div></div></div></div></div></li><li class="panel-cell"><div class="com-3-article-panel theme2"><a href="https://cloud.tencent.com/developer/article/1359628?from=article.detail.2197170&amp;areaSource=106000.13&amp;traceId=ijFPtLQ0SLl1sLBbbhFXf" target="_blank" class="panel-link" hotrep=""></a><div class="com-3-article-panel-media"><div class="com-3-article-panel-body"><h3 class="com-3-article-panel-title">如何使用Helm软件包管理器在Kubernetes集群上安装软件</h3><p class="com-3-article-panel-desc">Helm是Kubernetes的软件包管理器，允许开发人员和操作员更轻松地在Kubernetes集群上配置和部署应用程序。</p><div class="com-3-article-panel-infos"><div class="com-3-article-panel-source"><a href="https://cloud.tencent.com/developer/user/1221461" target="_blank" class="item author"><span class="com-2-avatar"><span class="com-2-avatar-inner" style="background-image:url(https://ask.qcloudimg.com/avatar/1221461/vsq9cks58w.png?imageView2/2/w/64)"></span></span>姚啊姚</a></div></div></div></div></div></li><li class="panel-cell"><div class="com-3-article-panel theme2"><a href="https://cloud.tencent.com/developer/article/1450258?from=article.detail.2197170&amp;areaSource=106000.14&amp;traceId=ijFPtLQ0SLl1sLBbbhFXf" target="_blank" class="panel-link" hotrep=""></a><div class="com-3-article-panel-media"><div class="com-3-article-panel-body"><h3 class="com-3-article-panel-title">Kubernetes 基础概述</h3><p class="com-3-article-panel-desc">本互动教程介绍了Kubernetes群集编排系统的基础知识。每个模块都包含Kubernetes的主要功能、概念的一些背景介绍。使用本教程，你可以了解：</p><div class="com-3-article-panel-infos"><div class="com-3-article-panel-source"><a href="https://cloud.tencent.com/developer/user/2309443" target="_blank" class="item author"><span class="com-2-avatar"><span class="com-2-avatar-inner" style="background-image:url(https://ask.qcloudimg.com/custom-avatar/2309443/q6yvlloln4.jpg)"></span></span>kubernetes中文社区</a></div></div></div><div class="com-3-article-panel-object"><span class="com-thumbnail com-3-article-panel-thumbnail" style="background-image:url(https://ask.qcloudimg.com/http-save/yehe-2309443/wsd95nkdfz.jpeg?imageView2/2/w/240)"></span></div></div></div></li><li class="panel-cell"><div class="com-3-article-panel theme2"><a href="https://cloud.tencent.com/developer/article/1549950?from=article.detail.2197170&amp;areaSource=106000.15&amp;traceId=ijFPtLQ0SLl1sLBbbhFXf" target="_blank" class="panel-link" hotrep=""></a><div class="com-3-article-panel-media"><div class="com-3-article-panel-body"><h3 class="com-3-article-panel-title">动手使用Linkerd 2.0</h3><p class="com-3-article-panel-desc">Linkerd 2.0最近宣布一般可用（GA），表明它已经准备好用于生产。在本教程中，我们将向你介绍如何在你的Kubernetes集群上启动和运行Linkerd...</p><div class="com-3-article-panel-infos"><div class="com-3-article-panel-source"><a href="https://cloud.tencent.com/developer/user/6781541" target="_blank" class="item author"><span class="com-2-avatar"><span class="com-2-avatar-inner" style="background-image:url(https://ask.qcloudimg.com/random-avatar/6781541/wv9pzsfejr.png)"></span></span>CNCF</a></div></div></div></div></div></li><li class="panel-cell"><div class="com-3-article-panel theme2"><a href="https://cloud.tencent.com/developer/article/1742960?from=article.detail.2197170&amp;areaSource=106000.16&amp;traceId=ijFPtLQ0SLl1sLBbbhFXf" target="_blank" class="panel-link" hotrep=""></a><div class="com-3-article-panel-media"><div class="com-3-article-panel-body"><h3 class="com-3-article-panel-title">Docker（2）- Centos 7.x 下安装 Docker</h3><p class="com-3-article-panel-desc">https://www.cnblogs.com/poloyy/category/1870863.html</p><div class="com-3-article-panel-infos"><div class="com-3-article-panel-source"><a href="https://cloud.tencent.com/developer/user/7440717" target="_blank" class="item author"><span class="com-2-avatar"><span class="com-2-avatar-inner" style="background-image:url(https://ask.qcloudimg.com/http-save/yehe-7440717/o5gpqsdhfd.jpeg?imageView2/2/w/64)"></span></span>小菠萝测试笔记</a></div></div></div><div class="com-3-article-panel-object"><span class="com-thumbnail com-3-article-panel-thumbnail" style="background-image:url(https://ask.qcloudimg.com/http-save/yehe-7440717/fk5gfv56av.png?imageView2/2/w/240)"></span></div></div></div></li></ul><div class="com-list-enter"><a href="https://cloud.tencent.com/developer/column" class="com-arrow-link">更多文章</a></div></section></div><div class="layout-side"><section class="com-2-panel side J-authorPanel"><header class="com-2-panel-hd"><h3 class="com-2-panel-title">作者介绍</h3></header><div class="com-2-panel-bd"><div class="com-author-intro"><div class="com-author-intro-object"><a href="https://cloud.tencent.com/developer/user/1220175" class="com-author-intro-avatar" style="background-image:url(https://ask.qcloudimg.com/avatar/1220175/3yhsgao20a.png?imageView2/2/w/160)" target="_blank"></a></div><h3 class="com-author-intro-name"><a href="https://cloud.tencent.com/developer/user/1220175" class="com-author-intro-name-inner" title="菲宇" target="_blank">菲宇</a></h3><div class="com-author-intro-btns"><button type="button" class="c-btn c-btn" hotrep="community.column.article2.follow"><span class="text">关注</span></button><a href="https://cloud.tencent.com/developer/column/77743" target="_blank" class="c-btn c-btn-hole" hotrep="community.column.article2.column"><span class="text">专栏</span></a></div><ul class="com-author-intro-infos"><li class="com-author-intro-info"><a href="https://cloud.tencent.com/developer/user/1220175" target="_blank" class="com-author-intro-info-link"><div class="com-author-intro-info-title">文章</div><div class="com-author-intro-info-num">741</div></a></li><li class="com-author-intro-info"><a href="https://cloud.tencent.com/developer/user/1220175" target="_blank" class="com-author-intro-info-link"><div class="com-author-intro-info-title">阅读量</div><div class="com-author-intro-info-num">831.9K</div></a></li><li class="com-author-intro-info"><a href="https://cloud.tencent.com/developer/user/1220175" target="_blank" class="com-author-intro-info-link"><div class="com-author-intro-info-title">获赞</div><div class="com-author-intro-info-num">2K</div></a></li><li class="com-author-intro-info"><a href="https://cloud.tencent.com/developer/rank" target="_blank" class="com-author-intro-info-link"><div class="com-author-intro-info-title">作者排名</div><div class="com-author-intro-info-num">265</div></a></li></ul></div></div></section><section class="com-2-panel side J-specialTopicPanel"><header class="com-2-panel-hd"><h3 class="com-2-panel-title">精选专题</h3></header><div class="com-2-panel-bd"><ul class="com-2-side-topics without-margin"><li><a href="https://cloud.tencent.com/developer/special/TencentCloudNative" class="com-media com-side-topic" hotrep="community.column.article2.side_topic.0.link"><div class="com-media-object"><span class="com-thumbnail" style="background-image:url(https://ask.qcloudimg.com/raw/yehe-1b54603d7b98/k8pfdhqi7p.jpg?imageView2/2/w/120)"></span></div><div class="com-media-body"><h3 class="com-side-topic-title" title="腾讯云原生专题">腾讯云原生专题</h3><div class="com-side-topic-desc" title="云原生技术干货，业务实践落地。">云原生技术干货，业务实践落地。</div></div></a></li></ul></div></section><section class="com-2-panel side J-activityRecommend"><header class="com-2-panel-hd"><h3 class="com-2-panel-title">活动推荐</h3></header><div class="com-2-panel-bd"><ul class="com-2-side-activities"><li><a href="https://cloud.tencent.com/developer/article/2210043" class="com-media com-2-side-activity" hotrep="community.column.article2.side_activity.0.link"><div class="com-media-body"><h3 class="com-2-side-activity-title" title="社区创作者年终回顾">社区创作者年终回顾</h3><div class="com-2-side-activity-desc" title="参与活动，赢取限量周边礼品">参与活动，赢取限量周边礼品</div></div><div class="com-media-object"><button type="button" class="s com-2-side-activity-btn c-btn c-btn-hole" hotrep="community.column.article2.side_activity.0.btn"><span class="text">立即参加</span></button></div></a></li><li><a href="https://cloud.tencent.com/developer/support-plan-invitation" class="com-media com-2-side-activity" hotrep="community.column.article2.side_activity.1.link"><div class="com-media-body"><h3 class="com-2-side-activity-title" title="邀请好友加入自媒体分享计划">邀请好友加入自媒体分享计划</h3><div class="com-2-side-activity-desc" title="邀请好友，同享奖励 30 / 100 / 180 元云服务器代金券">邀请好友，同享奖励 30 / 100 / 180 元云服务器代金券</div></div><div class="com-media-object"><button type="button" class="s com-2-side-activity-btn c-btn c-btn-hole" hotrep="community.column.article2.side_activity.1.btn"><span class="text">立即邀请</span></button></div></a></li></ul><header class="com-2-panel-subhd"><h3 class="com-2-panel-subtitle">运营活动</h3></header><div class="com-event-panel com-event-panel-l theme2 without-margin"><div class="com-event-panel-inner"><div class="com-event-panel-object"><a href="https://cloud.tencent.com/product/tmf?from=19500"><img class="com-event-panel-img" alt="活动名称" src="./Kubernetes 1.8.x 全手动安装教程 - 腾讯云开发者社区-腾讯云_files/w1dedj1rgs.jpg"></a><div class="com-event-panel-sign-wrap"><span class="com-event-panel-sign">广告</span><a href="javascript:;" class="com-event-panel-close">关闭</a></div></div></div></div></div></section><section class="com-2-section com-side-public" style="width:300px"><header class="com-2-section-hd"><h2 class="com-2-section-title without-icon"><span>关注</span></h2></header><div class="com-2-section-bd"><div class="com-side-public__title">腾讯云<em>开发者</em>公众号</div><div class="com-side-public__content"><div class="com-side-public__content-tag">将获得</div><div class="com-side-public__content-inner"><div class="com-side-public__content-detail"><div class="com-side-public__content-prize">10元无门槛代金券</div><div class="com-side-public__content-desc">洞察腾讯核心技术</div><div class="com-side-public__content-desc">剖析业界实践案例</div></div><div class="com-side-public__content-qr"><img src="./Kubernetes 1.8.x 全手动安装教程 - 腾讯云开发者社区-腾讯云_files/37c294ec38218c34a57e6644033d3e02.png" alt="腾讯云开发者公众号二维码"></div></div></div></div></section><div style="height:20px"></div><div class="com-nav-bar absolute" style="max-width: 300px; max-height: none; overflow-y: auto;"><h3 class="com-nav-bar-title">目录</h3><ul class="com-nav-bar-menu"><li data-key="2.1" class="menu-item"><a href="javascript:;" title="预先准备信息">预先准备信息</a></li><li data-key="2.2" class="menu-item"><a href="javascript:;" title="Etcd">Etcd</a><ul class="level-2"><li data-key="3.1" class="menu-item"><a href="javascript:;" title="创建集群 CA 与 Certificates">创建集群 CA 与 Certificates</a></li><li data-key="3.2" class="menu-item"><a href="javascript:;" title="Etcd 安装与设定">Etcd 安装与设定</a></li></ul></li><li data-key="2.3" class="menu-item"><a href="javascript:;" title="Kubernetes Master">Kubernetes Master</a><ul class="level-2"><li data-key="3.3" class="menu-item"><a href="javascript:;" title="下载 Kubernetes 组件">下载 Kubernetes 组件</a></li><li data-key="3.4" class="menu-item"><a href="javascript:;" title="创建集群 CA 与 Certificates">创建集群 CA 与 Certificates</a></li><li data-key="3.5" class="menu-item"><a href="javascript:;" title="安装 Kubernetes 核心组件">安装 Kubernetes 核心组件</a></li></ul></li><li data-key="2.4" class="menu-item"><a href="javascript:;" title="Kubernetes Node">Kubernetes Node</a><ul class="level-2"><li data-key="3.6" class="menu-item"><a href="javascript:;" title="下载 Kubernetes 组件">下载 Kubernetes 组件</a></li><li data-key="3.7" class="menu-item"><a href="javascript:;" title="设定 Kubernetes node">设定 Kubernetes node</a></li><li data-key="3.8" class="menu-item"><a href="javascript:;" title="授权 Kubernetes Node">授权 Kubernetes Node</a></li></ul></li><li data-key="2.5" class="menu-item"><a href="javascript:;" title="Kubernetes Core Addons 部署">Kubernetes Core Addons 部署</a><ul class="level-2"><li data-key="3.9" class="menu-item"><a href="javascript:;" title="Kube-proxy addon">Kube-proxy addon</a></li><li data-key="3.10" class="menu-item"><a href="javascript:;" title="Kube-dns addon">Kube-dns addon</a></li></ul></li><li data-key="2.6" class="menu-item"><a href="javascript:;" title="Calico Network 安装与设定">Calico Network 安装与设定</a></li><li data-key="2.7" class="menu-item"><a href="javascript:;" title="Kubernetes Extra Addons 部署">Kubernetes Extra Addons 部署</a><ul class="level-2"><li data-key="3.11" class="menu-item"><a href="javascript:;" title="Dashboard addon">Dashboard addon</a></li><li data-key="3.12" class="menu-item"><a href="javascript:;" title="Heapster addon">Heapster addon</a></li></ul></li><li data-key="2.8" class="menu-item"><a href="javascript:;" title="简单部署 Nginx 服务">简单部署 Nginx 服务</a><ul class="level-2"><li data-key="3.13" class="menu-item"><a href="javascript:;" title="扩展服务数量">扩展服务数量</a></li></ul></li></ul></div></div></div></div><div class="J-footer com-2-footer"><div class="com-2-footer-inner"><div class="com-2-footer-main"><div class="com-2-footer-main-ctn"><div class="com-2-footer-main-inner"><div class="com-2-footer-website"><ul class="com-2-footer-website-group"><li class="com-2-footer-website-column"><div class="com-2-footer-website-box"><h3 class="com-2-footer-website-title">社区</h3><ul class="com-2-footer-website-list"><li class="com-2-footer-website-item"><a href="https://cloud.tencent.com/developer/column" hotrep="community.footer.community.article">专栏文章</a></li><li class="com-2-footer-website-item"><a href="https://cloud.tencent.com/developer/inventory" hotrep="community.footer.community.inventory">阅读清单</a></li><li class="com-2-footer-website-item"><a href="https://cloud.tencent.com/developer/ask" hotrep="community.footer.community.ask">互动问答</a></li><li class="com-2-footer-website-item"><a href="https://cloud.tencent.com/developer/salon" hotrep="community.footer.community.salon">技术沙龙</a></li><li class="com-2-footer-website-item"><a href="https://cloud.tencent.com/developer/video" hotrep="community.footer.community.video">技术视频</a></li><li class="com-2-footer-website-item"><a href="https://cloud.tencent.com/developer/teams" hotrep="community.footer.community.teams">团队主页</a></li><li class="com-2-footer-website-item"><a href="https://cloud.tencent.com/developer/timl" hotrep="community.footer.community.timl">腾讯云TI平台</a></li></ul></div></li><li class="com-2-footer-website-column"><div class="com-2-footer-website-box"><h3 class="com-2-footer-website-title">活动</h3><ul class="com-2-footer-website-list"><li class="com-2-footer-website-item"><a href="https://cloud.tencent.com/developer/support-plan" hotrep="community.footer.activity.support-plan">自媒体分享计划</a></li><li class="com-2-footer-website-item"><a href="https://cloud.tencent.com/developer/support-plan-invitation" hotrep="community.footer.activity.support-plan-invitation">邀请作者入驻</a></li><li class="com-2-footer-website-item"><a href="https://cloud.tencent.com/developer/article/1535830" hotrep="community.footer.activity.article-1535830">自荐上首页</a></li><li class="com-2-footer-website-item"><a href="https://cloud.tencent.com/developer/competition" hotrep="community.footer.activity.competition">技术竞赛</a></li></ul></div></li><li class="com-2-footer-website-column"><div class="com-2-footer-website-box"><h3 class="com-2-footer-website-title">资源</h3><ul class="com-2-footer-website-list"><li class="com-2-footer-website-item"><a href="https://cloud.tencent.com/developer/specials" hotrep="community.footer.resource.specials">技术周刊</a></li><li class="com-2-footer-website-item"><a href="https://cloud.tencent.com/developer/tags" hotrep="community.footer.resource.tags">社区标签</a></li><li class="com-2-footer-website-item"><a href="https://cloud.tencent.com/developer/devdocs" hotrep="community.footer.community.devdocs">开发者手册</a></li><li class="com-2-footer-website-item"><a href="https://cloud.tencent.com/developer/labs" target="_blank" hotrep="community.footer.resource.labs">开发者实验室</a></li></ul></div></li><li class="com-2-footer-website-column"><div class="com-2-footer-website-box"><h3 class="com-2-footer-website-title">关于</h3><ul class="com-2-footer-website-list"><li class="com-2-footer-website-item"><a href="javascript:;" hotrep="community.footer.about.video">视频介绍</a></li><li class="com-2-footer-website-item"><a href="https://cloud.tencent.com/developer/article/1006434" hotrep="community.footer.about.spec">社区规范</a></li><li class="com-2-footer-website-item"><a href="https://cloud.tencent.com/developer/article/1006435" hotrep="community.footer.about.disclaimer">免责声明</a></li><li class="com-2-footer-website-item"><a href="mailto:cloudcommunity@tencent.com" hotrep="community.footer.about.contact">联系我们</a></li><li class="com-2-footer-website-item"><a href="https://cloud.tencent.com/developer/friendlink" target="_blank" hotrep="community.footer.about.friendlink">友情链接</a></li></ul></div></li><li class="com-2-footer-website-column com-v-box"><div class="com-2-footer-website-box"><h3 class="com-2-footer-website-title">归档</h3><ul class="com-2-footer-website-list"><li class="com-2-footer-website-item"><a href="https://cloud.tencent.com/developer/ask/archives.html">问题归档</a></li><li class="com-2-footer-website-item"><a href="https://cloud.tencent.com/developer/column/archives.html">专栏文章归档</a></li><li class="com-2-footer-website-item"><a href="https://cloud.tencent.com/developer/news/archives.html">快讯文章归档</a></li><li class="com-2-footer-website-item"><a href="https://cloud.tencent.com/developer/information/all.html">关键词归档</a></li><li class="com-2-footer-website-item"><a href="https://cloud.tencent.com/developer/devdocs/archives.html">开发者手册归档</a></li><li class="com-2-footer-website-item"><a href="https://cloud.tencent.com/developer/devdocs/sections_p1.html">开发者手册 Section 归档</a></li></ul></div></li></ul></div><div class="com-2-footer-copyright"><h3 class="com-2-footer-copyright-title">腾讯云开发者</h3><div class="com-2-footer-qr"><div class="com-2-footer-qr-object"><img class="com-2-footer-qr-image" src="./Kubernetes 1.8.x 全手动安装教程 - 腾讯云开发者社区-腾讯云_files/a8907230cd5be483497c7e90b061b861.png" alt=""></div><p class="com-2-footer-qr-info"><span class="com-2-footer-qr-text">扫码关注腾讯云开发者</span></p><p class="com-2-footer-qr-info"><span class="com-2-footer-qr-text">领取腾讯云代金券</span></p></div></div></div></div></div></div><div class="com-2-footer-recommend"><div class="com-2-footer-inner"><div class="com-2-footer-recommend-rows"><div class="com-2-footer-recommend-cell"><h3 class="com-2-footer-recommend-tit">热门产品</h3><div class="com-2-footer-recommend-list-wrap"><ul class="com-2-footer-recommend-list"><li class="com-2-footer-recommend-item"><a href="https://dnspod.cloud.tencent.com/" class="com-2-footer-recommend-link" target="_blank" hotrep="community.footer.rmcp.ymzc">域名注册</a></li><li class="com-2-footer-recommend-item"><a href="https://cloud.tencent.com/product/cvm" class="com-2-footer-recommend-link" target="_blank" hotrep="community.footer.rmcp.cvm">云服务器</a></li><li class="com-2-footer-recommend-item"><a href="https://cloud.tencent.com/product/tbaas" class="com-2-footer-recommend-link" target="_blank" hotrep="community.footer.rmcp.tbaas">区块链服务</a></li><li class="com-2-footer-recommend-item"><a href="https://cloud.tencent.com/product/mq" class="com-2-footer-recommend-link" target="_blank" hotrep="community.footer.rmcp.mq">消息队列</a></li><li class="com-2-footer-recommend-item"><a href="https://cloud.tencent.com/product/dsa" class="com-2-footer-recommend-link" target="_blank" hotrep="community.footer.rmcp.dsa"> 网络加速</a></li><li class="com-2-footer-recommend-item"><a href="https://cloud.tencent.com/product/tencentdb-catalog" class="com-2-footer-recommend-link" target="_blank" hotrep="community.footer.rmcp.tencentdb-catalog">云数据库</a></li><li class="com-2-footer-recommend-item"><a href="https://cloud.tencent.com/product/cns" class="com-2-footer-recommend-link" target="_blank" hotrep="community.footer.rmcp.rmjx">域名解析</a></li><li class="com-2-footer-recommend-item"><a href="https://cloud.tencent.com/product/cos" class="com-2-footer-recommend-link" target="_blank" hotrep="community.footer.rmcp.cos">云存储</a></li><li class="com-2-footer-recommend-item"><a href="https://cloud.tencent.com/product/css" class="com-2-footer-recommend-link" target="_blank" hotrep="community.footer.rmcp.css">视频直播</a></li></ul></div></div><div class="com-2-footer-recommend-cell"><h3 class="com-2-footer-recommend-tit">热门推荐</h3><div class="com-2-footer-recommend-list-wrap"><ul class="com-2-footer-recommend-list"><li class="com-2-footer-recommend-item"><a href="https://cloud.tencent.com/product/facerecognition" class="com-2-footer-recommend-link" target="_blank" hotrep="community.footer.rmtj.facerecognition">人脸识别</a></li><li class="com-2-footer-recommend-item"><a href="https://cloud.tencent.com/product/tm" class="com-2-footer-recommend-link" target="_blank" hotrep="community.footer.rmtj.tm">腾讯会议</a></li><li class="com-2-footer-recommend-item"><a href="https://cloud.tencent.com/act/pro/enterprise2019" class="com-2-footer-recommend-link" target="_blank" hotrep="community.footer.rmtj.enterprise2019">企业云</a></li><li class="com-2-footer-recommend-item"><a href="https://cloud.tencent.com/product/cdn-scd" class="com-2-footer-recommend-link" target="_blank" hotrep="community.footer.rmtj.cdn-scd">CDN 加速</a></li><li class="com-2-footer-recommend-item"><a href="https://cloud.tencent.com/product/trtc" class="com-2-footer-recommend-link" target="_blank" hotrep="community.footer.rmtj.trtc">视频通话</a></li><li class="com-2-footer-recommend-item"><a href="https://cloud.tencent.com/product/tiia" class="com-2-footer-recommend-link" target="_blank" hotrep="community.footer.rmtj.tiia">图像分析</a></li><li class="com-2-footer-recommend-item"><a href="https://cloud.tencent.com/product/cdb" class="com-2-footer-recommend-link" target="_blank" hotrep="community.footer.rmtj.cdb">MySQL 数据库</a></li><li class="com-2-footer-recommend-item"><a href="https://cloud.tencent.com/product/symantecssl" class="com-2-footer-recommend-link" target="_blank" hotrep="community.footer.rmtj.symantecssl">SSL 证书</a></li><li class="com-2-footer-recommend-item"><a href="https://cloud.tencent.com/product/asr" class="com-2-footer-recommend-link" target="_blank" hotrep="community.footer.rmtj.asr">语音识别</a></li></ul></div></div><div class="com-2-footer-recommend-cell"><h3 class="com-2-footer-recommend-tit">更多推荐</h3><div class="com-2-footer-recommend-list-wrap"><ul class="com-2-footer-recommend-list"><li class="com-2-footer-recommend-item"><a href="https://cloud.tencent.com/solution/data_protection" class="com-2-footer-recommend-link" target="_blank" hotrep="community.footer.gdtj.data_protection">数据安全</a></li><li class="com-2-footer-recommend-item"><a href="https://cloud.tencent.com/product/clb" class="com-2-footer-recommend-link" target="_blank" hotrep="community.footer.gdtj.clb">负载均衡</a></li><li class="com-2-footer-recommend-item"><a href="https://cloud.tencent.com/product/sms" class="com-2-footer-recommend-link" target="_blank" hotrep="community.footer.gdtj.sms">短信</a></li><li class="com-2-footer-recommend-item"><a href="https://cloud.tencent.com/product/ocr" class="com-2-footer-recommend-link" target="_blank" hotrep="community.footer.gdtj.ocr">文字识别</a></li><li class="com-2-footer-recommend-item"><a href="https://cloud.tencent.com/product/vod" class="com-2-footer-recommend-link" target="_blank" hotrep="community.footer.gdtj.vod">云点播</a></li><li class="com-2-footer-recommend-item"><a href="https://tm.cloud.tencent.com/" class="com-2-footer-recommend-link" target="_blank" hotrep="community.footer.gdtj.tm">商标注册</a></li><li class="com-2-footer-recommend-item"><a href="https://cloud.tencent.com/solution/la" class="com-2-footer-recommend-link" target="_blank" hotrep="community.footer.gdtj.la">小程序开发</a></li><li class="com-2-footer-recommend-item"><a href="https://cloud.tencent.com/product/cat" class="com-2-footer-recommend-link" target="_blank" hotrep="community.footer.gdtj.cat">网站监控</a></li><li class="com-2-footer-recommend-item"><a href="https://cloud.tencent.com/product/cdm" class="com-2-footer-recommend-link" target="_blank" hotrep="community.footer.gdtj.cdm">数据迁移</a></li></ul></div></div></div></div></div><div class="com-2-footer-copyright-cnt"><div class="com-2-footer-inner"><p>Copyright © 2013 - 2023 Tencent Cloud. All Rights Reserved. 腾讯云 版权所有 <a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=11010802020287" hotrep="community.footer.link.beian" target="_blank">京公网安备 11010802017518 </a><a href="http://beian.miit.gov.cn/" target="_blank" hotrep="community.footer.link.miitbeian">粤B2-20090059-1</a></p></div></div></div></div><div class="com-widget-global"><div style="position:relative;z-index:8088"><div class="c-bubble-trigger com-widget-qr"><button class="scan-btn" hotrep="community.edge-widget.follow-oa">扫描二维码</button><div class="c-bubble c-bubble-right "><div class="c-bubble-inner"><div class="qr-img"><img src="./Kubernetes 1.8.x 全手动安装教程 - 腾讯云开发者社区-腾讯云_files/dad61ae6b851b4580d23ffcc4823aef5.png" alt=""></div><p class="qr-txt">扫码关注腾讯云开发者</p><p class="qr-txt">领取腾讯云代金券</p></div></div></div></div><button class="widget-btn widget-back2top" title="返回顶部" hotrep="community.edge-widget.back2top" style="outline: none;">返回顶部</button></div><div id="dialog-root"></div><div id="rno-dialog-root" class="rno-modal-wrap"></div></div><script>window.isServerContext = false; window.isClientContext = true;</script><script>window.$serverTime = 1675498397127; window.$clientTime = 1675498397127;</script><script>window.$ua = {"browser":{"name":"Chrome","version":"109.0.0.0","major":"109"},"cpu":{"architecture":"amd64"},"device":{},"engine":{"name":"Blink","version":"109.0.0.0"},"os":{"name":"Windows","version":"10"}};</script><script src="./Kubernetes 1.8.x 全手动安装教程 - 腾讯云开发者社区-腾讯云_files/polyfill.6.26.min.js.下载"></script><script src="./Kubernetes 1.8.x 全手动安装教程 - 腾讯云开发者社区-腾讯云_files/react.16.8.6.min.js.下载"></script><script src="./Kubernetes 1.8.x 全手动安装教程 - 腾讯云开发者社区-腾讯云_files/react-dom.16.8.6.min.js.下载"></script><script src="./Kubernetes 1.8.x 全手动安装教程 - 腾讯云开发者社区-腾讯云_files/jquery-3.2.1.min.js.下载"></script><script src="./Kubernetes 1.8.x 全手动安装教程 - 腾讯云开发者社区-腾讯云_files/base.225e98f95c.js.下载" crossorigin="anonymous"></script><script src="./Kubernetes 1.8.x 全手动安装教程 - 腾讯云开发者社区-腾讯云_files/draft-master-v1.4.76.d4s2ddo9sb.js.下载"></script><script src="./Kubernetes 1.8.x 全手动安装教程 - 腾讯云开发者社区-腾讯云_files/api.js.下载"></script><script src="./Kubernetes 1.8.x 全手动安装教程 - 腾讯云开发者社区-腾讯云_files/wechatJsSdk.js.下载"></script><script src="./Kubernetes 1.8.x 全手动安装教程 - 腾讯云开发者社区-腾讯云_files/common.0a8ac09c27.js.下载" crossorigin="anonymous"></script><div id="tea-overlay-root"></div><script src="./Kubernetes 1.8.x 全手动安装教程 - 腾讯云开发者社区-腾讯云_files/hls.min.0.13.2m.js.下载"></script><script src="./Kubernetes 1.8.x 全手动安装教程 - 腾讯云开发者社区-腾讯云_files/tcplayer.v4.1.min.js.下载"></script><script src="./Kubernetes 1.8.x 全手动安装教程 - 腾讯云开发者社区-腾讯云_files/qcloudStatApi.js.下载"></script><script src="./Kubernetes 1.8.x 全手动安装教程 - 腾讯云开发者社区-腾讯云_files/article-detail.01ccbc8fd9.js.下载" crossorigin="anonymous"></script><script>
window.$render({"articleDetail":{"id":2197170,"articleId":2197170,"title":"Kubernetes 1.8.x 全手动安装教程","content":"blocks|key|f18oi|text|Kubernetes+提供了许多云端平台与操作系统的安装方式，本章将以全手动安装方式来部署，主要是学习与了解+Kubernetes+创建流程。若想要了解更多平台的部署可以参考 Picking+the+Right+Solution来选择自己最喜欢的方式。|type|unstyled|depth|inlineStyleRanges|entityRanges|offset|length|data|14d6u|本次安装版本为：|style|BOLD|b6dh4|Kubernetes+v1.8.2|unordered-list-item|d9cmn|Etcd+v3.2.9|dmg4t|Calico+v2.6.2|ac1sh|Docker+v17.10.0-ce|1doc0|预先准备信息|header-two|5q5bq|本教程将以下列节点数与规格来进行部署+Kubernetes+集群，操作系统可采用Ubuntu+16.x与CentOS+7.x：|5a3q1|IP+AddressRoleCPUMemory172.16.35.12master112G172.16.35.10node112G|table|aligns|3ui79|align|left|ks9r|44lku|cvu2|rows|6sf70|cells|4c8po|raw|168su|IP+Address|entityMap|1hr98|bdft3|Role|7buf5|chape|CPU|ae2ae|2812q|Memory|1f7e3|7efdu|b6l19|172.16.35.12|4t0b7|fr8fo|master1|1o7id|et2be|1|3ddqr|2ehdp|2G|esqut|6kbi7|d65i0|172.16.35.10|fgkms|cj1l1|node1|djl3p|ccoh9|60doq|6a3d7|cnbfa|这边+master+为主要控制节点也是部署节点，node+为应用程序工作节点。|fri5f|所有操作全部用root使用者进行，以+SRE+来说不推荐。|cii7t|可以下载 Vagrantfile 来建立+Virtual+box+虚拟机集群。|32tgn|首先安装前要确认以下几项都已将准备完成：|ccqjh|所有节点彼此网络互通，并且master1 SSH+登入其他节点为+passwdless。|5mke5|所有防火墙与+SELinux+已关闭。如+CentOS：|antle|$+systemctl+stop+firewalld+&&+systemctl+disable+firewalld\n$+setenforce+0\n$+vim+/etc/selinux/config\nSELINUX=disabled&&+systemctl+disable+firewalld\n$+setenforce+0\n$+vim+/etc/selinux/config\nSELINUX=disabled|code-block|syntax|javascript|bu3pi|所有节点需要设定/etc/host解析到所有主机。|c1mna|...\n172.16.35.10+node1\n172.16.35.12+master1\n172.16.35.10+node1\n172.16.35.12+master1|9sk2b|所有节点需要安装Docker或rtk引擎。这边采用Docker来当作容器引擎，安装方式如下：|73tjb|$+curl+-fsSL+\"https://get.docker.com/\"+%7C+sh|5qgu|不管是在 Ubuntu 或 CentOS 都只需要执行该指令就会自动安装最新版+Docker。\n+CentOS+安装完成后，需要再执行以下指令：|c880o|$+systemctl+enable+docker+&&+systemctl+start+docker|e4c2k|编辑/lib/systemd/system/docker.service，在ExecStart=..上面加入：|6ppnk|ExecStartPost=/sbin/iptables+-I+FORWARD+-s+0.0.0.0/0+-j+ACCEPT=/sbin/iptables+-I+FORWARD+-s+0.0.0.0/0+-j+ACCEPT|935o1|完成后，重新启动+docker+服务：|68a5o|$+systemctl+daemon-reload+&&+systemctl+restart+docker|6jgp6|所有节点需要设定/etc/sysctl.d/k8s.conf的系统参数。|f8c8j|$+cat+\u003C\u003CEOF+\u003E+/etc/sysctl.d/k8s.conf\nnet.ipv4.ip_forward+=+1\nnet.bridge.bridge-nf-call-ip6tables+=+1\nnet.bridge.bridge-nf-call-iptables+=+1\nEOF\n\n$+sysctl+-p+/etc/sysctl.d/k8s.conf\u003C\u003CEOF+\u003E+/etc/sysctl.d/k8s.conf\nnet.ipv4.ip_forward+=+1\nnet.bridge.bridge-nf-call-ip6tables+=+1\nnet.bridge.bridge-nf-call-iptables+=+1\nEOF\n\n$+sysctl+-p+/etc/sysctl.d/k8s.conf|b9b9v|在master1需要安装CFSSL工具，这将会用来建立+TLS+certificates。|ek4k6|$+export+CFSSL_URL=\"https://pkg.cfssl.org/R1.2\"\n$+wget+\"${CFSSL_URL}/cfssl_linux-amd64\"+-O+/usr/local/bin/cfssl\n$+wget+\"${CFSSL_URL}/cfssljson_linux-amd64\"+-O+/usr/local/bin/cfssljson\n$+chmod+%2Bx+/usr/local/bin/cfssl+/usr/local/bin/cfssljsonexport+CFSSL_URL=\"https://pkg.cfssl.org/R1.2\"\n$+wget+\"${CFSSL_URL}/cfssl_linux-amd64\"+-O+/usr/local/bin/cfssl\n$+wget+\"${CFSSL_URL}/cfssljson_linux-amd64\"+-O+/usr/local/bin/cfssljson\n$+chmod+%2Bx+/usr/local/bin/cfssl+/usr/local/bin/cfssljson|3qfo|Etcd|7t7fd|在开始安装+Kubernetes+之前，需要先将一些必要系统创建完成，其中+Etcd+就是+Kubernetes+最重要的一环，Kubernetes+会将大部分信息储存于+Etcd+上，来提供给其他节点索取，以确保整个集群运作与沟通正常。|dhdga|创建集群+CA+与+Certificates|header-three|3egtv|在这部分，将会需要产生+client+与+server+的各组件+certificates，并且替+Kubernetes+admin+user+产生+client+证书。|250dg|建立/etc/etcd/ssl文件夹，然后进入目录完成以下操作。|6jhv0|$+mkdir+-p+/etc/etcd/ssl+&&+cd+/etc/etcd/ssl\n$+export+PKI_URL=\"https://kairen.github.io/files/manual-v1.8/pki\"-p+/etc/etcd/ssl+&&+cd+/etc/etcd/ssl\n$+export+PKI_URL=\"https://kairen.github.io/files/manual-v1.8/pki\"|8l5te|下载ca-config.json与etcd-ca-csr.json文件，并产生+CA+密钥：|7pgc2|$+wget+\"${PKI_URL}/ca-config.json\"+\"${PKI_URL}/etcd-ca-csr.json\"\n$+cfssl+gencert+-initca+etcd-ca-csr.json+%7C+cfssljson+-bare+etcd-ca\n$+ls+etcd-ca*.pem\netcd-ca-key.pem++etcd-ca.pem\"${PKI_URL}/ca-config.json\"+\"${PKI_URL}/etcd-ca-csr.json\"\n$+cfssl+gencert+-initca+etcd-ca-csr.json+%7C+cfssljson+-bare+etcd-ca\n$+ls+etcd-ca*.pem\netcd-ca-key.pem++etcd-ca.pem|15hdj|下载etcd-csr.json文件，并产生+kube-apiserver+certificate+证书：|f5315|$+wget+\"${PKI_URL}/etcd-csr.json\"\n$+cfssl+gencert+\\\n++-ca=etcd-ca.pem+\\\n++-ca-key=etcd-ca-key.pem+\\\n++-config=ca-config.json+\\\n++-profile=kubernetes+\\\n++etcd-csr.json+%7C+cfssljson+-bare+etcd\n\n$+ls+etcd*.pem\netcd-ca-key.pem++etcd-ca.pem++etcd-key.pem++etcd.pe\"${PKI_URL}/etcd-csr.json\"\n$+cfssl+gencert+\\\n++-ca=etcd-ca.pem+\\\n++-ca-key=etcd-ca-key.pem+\\\n++-config=ca-config.json+\\\n++-profile=kubernetes+\\\n++etcd-csr.json+%7C+cfssljson+-bare+etcd\n\n$+ls+etcd*.pem\netcd-ca-key.pem++etcd-ca.pem++etcd-key.pem++etcd.pe|9icd0|+若节点+IP+不同，需要修改etcd-csr.json的hosts。\n+|blockquote|9lclb|完成后删除不必要文件：|1tu41|$+rm+-rf+*.json|9rm3v|确认/etc/etcd/ssl有以下文件：|7p8uh|$+ls+/etc/etcd/ssl\netcd-ca.csr++etcd-ca-key.pem++etcd-ca.pem++etcd.csr++etcd-key.pem++etcd.pem/etc/etcd/ssl\netcd-ca.csr++etcd-ca-key.pem++etcd-ca.pem++etcd.csr++etcd-key.pem++etcd.pem|cjecs|Etcd+安装与设定|647bo|首先在master1节点下载+Etcd，并解压缩放到+/opt+底下与安装：|5cu38|$+export+ETCD_URL=\"https://github.com/coreos/etcd/releases/download\"\n$+cd+&&+wget+-qO-+--show-progress+\"${ETCD_URL}/v3.2.9/etcd-v3.2.9-linux-amd64.tar.gz\"+%7C+tar+-zx\n$+mv+etcd-v3.2.9-linux-amd64/etcd*+/usr/local/bin/+&&+rm+-rf+etcd-v3.2.9-linux-amd64export+ETCD_URL=\"https://github.com/coreos/etcd/releases/download\"\n$+cd+&&+wget+-qO-+--show-progress+\"${ETCD_URL}/v3.2.9/etcd-v3.2.9-linux-amd64.tar.gz\"+%7C+tar+-zx\n$+mv+etcd-v3.2.9-linux-amd64/etcd*+/usr/local/bin/+&&+rm+-rf+etcd-v3.2.9-linux-amd64|a0hvk|完成后新建+Etcd+Group+与+User，并建立+Etcd+配置文件目录：|eof9m|$+groupadd+etcd+&&+useradd+-c+\"Etcd+user\"+-g+etcd+-s+/sbin/nologin+-r+etcd&&+useradd+-c+\"Etcd+user\"+-g+etcd+-s+/sbin/nologin+-r+etcd|12pi0|下载etcd相关文件，我们将来管理+Etcd：|aq88d|$+export+ETCD_CONF_URL=\"https://kairen.github.io/files/manual-v1.8/master\"\n$+wget+\"${ETCD_CONF_URL}/etcd.conf\"+-O+/etc/etcd/etcd.conf\n$+wget+\"${ETCD_CONF_URL}/etcd.service\"+-O+/lib/systemd/system/etcd.serviceexport+ETCD_CONF_URL=\"https://kairen.github.io/files/manual-v1.8/master\"\n$+wget+\"${ETCD_CONF_URL}/etcd.conf\"+-O+/etc/etcd/etcd.conf\n$+wget+\"${ETCD_CONF_URL}/etcd.service\"+-O+/lib/systemd/system/etcd.service|ds8ov|+若与该教程+IP+不同的话，请用自己+IP+取代172.16.35.12。\n+|7s4of|建立+var+存放信息，然后启动+Etcd+服务:|akrc|$+mkdir+-p+/var/lib/etcd+&&+chown+etcd:etcd+-R+/var/lib/etcd+/etc/etcd\n$+systemctl+enable+etcd.service+&&+systemctl+start+etcd.service-p+/var/lib/etcd+&&+chown+etcd:etcd+-R+/var/lib/etcd+/etc/etcd\n$+systemctl+enable+etcd.service+&&+systemctl+start+etcd.service|7vcg5|通过简单指令验证：|fjubi|$+export+CA=\"/etc/etcd/ssl\"\n$+ETCDCTL_API=3+etcdctl+\\\n++++--cacert=${CA}/etcd-ca.pem+\\\n++++--cert=${CA}/etcd.pem+\\\n++++--key=${CA}/etcd-key.pem+\\\n++++--endpoints=\"https://172.16.35.12:2379\"+\\\n++++endpoint+health\n#+output\nhttps://172.16.35.12:2379+is+healthy:+successfully+committed+proposal:+took+=+641.36µsexport+CA=\"/etc/etcd/ssl\"\n$+ETCDCTL_API=3+etcdctl+\\\n++++--cacert=${CA}/etcd-ca.pem+\\\n++++--cert=${CA}/etcd.pem+\\\n++++--key=${CA}/etcd-key.pem+\\\n++++--endpoints=\"https://172.16.35.12:2379\"+\\\n++++endpoint+health\n#+output\nhttps://172.16.35.12:2379+is+healthy:+successfully+committed+proposal:+took+=+641.36µs|1ic6u|Kubernetes+Master|am7ng|Master+是+Kubernetes+的大总管，主要创建apiserver、Controller+manager与Scheduler来组件管理所有+Node。本步骤将下载+Kubernetes+并安装至 master1上，然后产生相关+TLS+Cert+与+CA+密钥，提供给集群组件认证使用。|5sbsi|下载+Kubernetes+组件|c3fv2|首先通过网络取得所有需要的执行文件：|4cf41|#+Download+Kubernetes\n$+export+KUBE_URL=\"https://storage.googleapis.com/kubernetes-release/release/v1.8.2/bin/linux/amd64\"\n$+wget+\"${KUBE_URL}/kubelet\"+-O+/usr/local/bin/kubelet\n$+wget+\"${KUBE_URL}/kubectl\"+-O+/usr/local/bin/kubectl\n$+chmod+%2Bx+/usr/local/bin/kubelet+/usr/local/bin/kubectl\n\n#+Download+CNI\n$+mkdir+-p+/opt/cni/bin+&&+cd+/opt/cni/bin\n$+export+CNI_URL=\"https://github.com/containernetworking/plugins/releases/download\"\n$+wget+-qO-+--show-progress+\"${CNI_URL}/v0.6.0/cni-plugins-amd64-v0.6.0.tgz\"+%7C+tar+-zx\n$+export+KUBE_URL=\"https://storage.googleapis.com/kubernetes-release/release/v1.8.2/bin/linux/amd64\"\n$+wget+\"${KUBE_URL}/kubelet\"+-O+/usr/local/bin/kubelet\n$+wget+\"${KUBE_URL}/kubectl\"+-O+/usr/local/bin/kubectl\n$+chmod+%2Bx+/usr/local/bin/kubelet+/usr/local/bin/kubectl\n\n#+Download+CNI\n$+mkdir+-p+/opt/cni/bin+&&+cd+/opt/cni/bin\n$+export+CNI_URL=\"https://github.com/containernetworking/plugins/releases/download\"\n$+wget+-qO-+--show-progress+\"${CNI_URL}/v0.6.0/cni-plugins-amd64-v0.6.0.tgz\"+%7C+tar+-zx|elg1k|创建集群+CA+与+Certificates|elqqq|在这部分，将会需要生成+client+与+server+的各组件+certificates，并且替+Kubernetes+admin+user+生成+client+证书。|cak9q|创建pki文件夹，然后进入目录完成以下操作。|8t6hn|$+mkdir+-p+/etc/kubernetes/pki+&&+cd+/etc/kubernetes/pki\n$+export+PKI_URL=\"https://kairen.github.io/files/manual-v1.8/pki\"\n$+export+KUBE_APISERVER=\"https://172.16.35.12:6443\"-p+/etc/kubernetes/pki+&&+cd+/etc/kubernetes/pki\n$+export+PKI_URL=\"https://kairen.github.io/files/manual-v1.8/pki\"\n$+export+KUBE_APISERVER=\"https://172.16.35.12:6443\"|2hn6c|下载ca-config.json与ca-csr.json文件，并生成+CA+密钥：|3t3bo|$+wget+\"${PKI_URL}/ca-config.json\"+\"${PKI_URL}/ca-csr.json\"\n$+cfssl+gencert+-initca+ca-csr.json+%7C+cfssljson+-bare+ca\n$+ls+ca*.pem\nca-key.pem++ca.pem\"${PKI_URL}/ca-config.json\"+\"${PKI_URL}/ca-csr.json\"\n$+cfssl+gencert+-initca+ca-csr.json+%7C+cfssljson+-bare+ca\n$+ls+ca*.pem\nca-key.pem++ca.pem|fbad8|API+server+certificate|2a80i|下载apiserver-csr.json文件，并生成+kube-apiserver+certificate+证书：|3i2vb|$+wget+\"${PKI_URL}/apiserver-csr.json\"\n$+cfssl+gencert+\\\n++-ca=ca.pem+\\\n++-ca-key=ca-key.pem+\\\n++-config=ca-config.json+\\\n++-hostname=10.96.0.1,172.16.35.12,127.0.0.1,kubernetes.default+\\\n++-profile=kubernetes+\\\n++apiserver-csr.json+%7C+cfssljson+-bare+apiserver\n\n$+ls+apiserver*.pem\napiserver-key.pem++apiserver.pem\"${PKI_URL}/apiserver-csr.json\"\n$+cfssl+gencert+\\\n++-ca=ca.pem+\\\n++-ca-key=ca-key.pem+\\\n++-config=ca-config.json+\\\n++-hostname=10.96.0.1,172.16.35.12,127.0.0.1,kubernetes.default+\\\n++-profile=kubernetes+\\\n++apiserver-csr.json+%7C+cfssljson+-bare+apiserver\n\n$+ls+apiserver*.pem\napiserver-key.pem++apiserver.pem|50jg2|+若节点+IP+不同，需要修改apiserver-csr.json的hosts。\n+|fr3be|Front+proxy+certificate|4hgl9|下载front-proxy-ca-csr.json文件，并生成+Front+proxy+CA+密钥，Front+proxy+主要是用在+API+aggregator+上:|8f50d|$+wget+\"${PKI_URL}/front-proxy-ca-csr.json\"\n$+cfssl+gencert+\\\n++-initca+front-proxy-ca-csr.json+%7C+cfssljson+-bare+front-proxy-ca\n\n$+ls+front-proxy-ca*.pem\nfront-proxy-ca-key.pem++front-proxy-ca.pem\"${PKI_URL}/front-proxy-ca-csr.json\"\n$+cfssl+gencert+\\\n++-initca+front-proxy-ca-csr.json+%7C+cfssljson+-bare+front-proxy-ca\n\n$+ls+front-proxy-ca*.pem\nfront-proxy-ca-key.pem++front-proxy-ca.pem|btb8k|下载front-proxy-client-csr.json文件，并生成+front-proxy-client+证书：|9m5kq|$+wget+\"${PKI_URL}/front-proxy-client-csr.json\"\n$+cfssl+gencert+\\\n++-ca=front-proxy-ca.pem+\\\n++-ca-key=front-proxy-ca-key.pem+\\\n++-config=ca-config.json+\\\n++-profile=kubernetes+\\\n++front-proxy-client-csr.json+%7C+cfssljson+-bare+front-proxy-client\n\n$+ls+front-proxy-client*.pem\nfront-proxy-client-key.pem++front-proxy-client.pem\"${PKI_URL}/front-proxy-client-csr.json\"\n$+cfssl+gencert+\\\n++-ca=front-proxy-ca.pem+\\\n++-ca-key=front-proxy-ca-key.pem+\\\n++-config=ca-config.json+\\\n++-profile=kubernetes+\\\n++front-proxy-client-csr.json+%7C+cfssljson+-bare+front-proxy-client\n\n$+ls+front-proxy-client*.pem\nfront-proxy-client-key.pem++front-proxy-client.pem|8dkff|Bootstrap+Token|865me|由于通过手动创建+CA+方式太过繁杂，只适合少量机器，因为每次签证时都需要绑定+Node+IP，随机器增加会带来很多困扰，因此这边使用+TLS+Bootstrapping+方式进行授权，由+apiserver+自动给符合条件的+Node+发送证书来授权加入集群。|fup5q|主要做法是+kubelet+启动时，向+kube-apiserver+传送+TLS+Bootstrapping+请求，而+kube-apiserver+验证+kubelet+请求的+token+是否与设定的一样，若一样就自动产生+kubelet+证书与密钥。具体作法可以参考 TLS+bootstrapping。|4k2o8|首先建立一个变量来产生BOOTSTRAP_TOKEN，并建立 bootstrap.conf 的+kubeconfig+文件：|bobun|$+export+BOOTSTRAP_TOKEN=$(head+-c+16+/dev/urandom+%7C+od+-An+-t+x+%7C+tr+-d+'+')\n$+cat+\u003C\u003CEOF+\u003E+/etc/kubernetes/token.csv\n${BOOTSTRAP_TOKEN},kubelet-bootstrap,10001,\"system:kubelet-bootstrap\"\nEOF\n\n#+bootstrap+set-cluster\n$+kubectl+config+set-cluster+kubernetes+\\\n++++--certificate-authority=ca.pem+\\\n++++--embed-certs=true+\\\n++++--server=${KUBE_APISERVER}+\\\n++++--kubeconfig=../bootstrap.conf\n\n#+bootstrap+set-credentials\n$+kubectl+config+set-credentials+kubelet-bootstrap+\\\n++++--token=${BOOTSTRAP_TOKEN}+\\\n++++--kubeconfig=../bootstrap.conf\n\n#+bootstrap+set-context\n$+kubectl+config+set-context+default+\\\n++++--cluster=kubernetes+\\\n++++--user=kubelet-bootstrap+\\\n+++--kubeconfig=../bootstrap.conf\n\n#+bootstrap+set+default+context\n$+kubectl+config+use-context+default+--kubeconfig=../bootstrap.confexport+BOOTSTRAP_TOKEN=$(head+-c+16+/dev/urandom+%7C+od+-An+-t+x+%7C+tr+-d+'+')\n$+cat+\u003C\u003CEOF+\u003E+/etc/kubernetes/token.csv\n${BOOTSTRAP_TOKEN},kubelet-bootstrap,10001,\"system:kubelet-bootstrap\"\nEOF\n\n#+bootstrap+set-cluster\n$+kubectl+config+set-cluster+kubernetes+\\\n++++--certificate-authority=ca.pem+\\\n++++--embed-certs=true+\\\n++++--server=${KUBE_APISERVER}+\\\n++++--kubeconfig=../bootstrap.conf\n\n#+bootstrap+set-credentials\n$+kubectl+config+set-credentials+kubelet-bootstrap+\\\n++++--token=${BOOTSTRAP_TOKEN}+\\\n++++--kubeconfig=../bootstrap.conf\n\n#+bootstrap+set-context\n$+kubectl+config+set-context+default+\\\n++++--cluster=kubernetes+\\\n++++--user=kubelet-bootstrap+\\\n+++--kubeconfig=../bootstrap.conf\n\n#+bootstrap+set+default+context\n$+kubectl+config+use-context+default+--kubeconfig=../bootstrap.conf|e35ld|+若想要用+CA+方式来认证，可以参考 Kubelet+certificate。\n+|5qrt|Admin+certificate|9ujco|下载admin-csr.json文件，并生成+admin+certificate+证书：|d9uno|$+wget+\"${PKI_URL}/admin-csr.json\"\n$+cfssl+gencert+\\\n++-ca=ca.pem+\\\n++-ca-key=ca-key.pem+\\\n++-config=ca-config.json+\\\n++-profile=kubernetes+\\\n++admin-csr.json+%7C+cfssljson+-bare+admin\n\n$+ls+admin*.pem\nadmin-key.pem++admin.pem\"${PKI_URL}/admin-csr.json\"\n$+cfssl+gencert+\\\n++-ca=ca.pem+\\\n++-ca-key=ca-key.pem+\\\n++-config=ca-config.json+\\\n++-profile=kubernetes+\\\n++admin-csr.json+%7C+cfssljson+-bare+admin\n\n$+ls+admin*.pem\nadmin-key.pem++admin.pem|2fh8|接着通过以下指令生成名称为 admin.conf 的+kubeconfig+文件：|aoep3|#+admin+set-cluster\n$+kubectl+config+set-cluster+kubernetes+\\\n++++--certificate-authority=ca.pem+\\\n++++--embed-certs=true+\\\n++++--server=${KUBE_APISERVER}+\\\n++++--kubeconfig=../admin.conf\n\n#+admin+set-credentials\n$+kubectl+config+set-credentials+kubernetes-admin+\\\n++++--client-certificate=admin.pem+\\\n++++--client-key=admin-key.pem+\\\n++++--embed-certs=true+\\\n++++--kubeconfig=../admin.conf\n\n#+admin+set-context\n$+kubectl+config+set-context+kubernetes-admin@kubernetes+\\\n++++--cluster=kubernetes+\\\n++++--user=kubernetes-admin+\\\n++++--kubeconfig=../admin.conf\n\n#+admin+set+default+context\n$+kubectl+config+use-context+kubernetes-admin@kubernetes+\\\n++++--kubeconfig=../admin.conf\n$+kubectl+config+set-cluster+kubernetes+\\\n++++--certificate-authority=ca.pem+\\\n++++--embed-certs=true+\\\n++++--server=${KUBE_APISERVER}+\\\n++++--kubeconfig=../admin.conf\n\n#+admin+set-credentials\n$+kubectl+config+set-credentials+kubernetes-admin+\\\n++++--client-certificate=admin.pem+\\\n++++--client-key=admin-key.pem+\\\n++++--embed-certs=true+\\\n++++--kubeconfig=../admin.conf\n\n#+admin+set-context\n$+kubectl+config+set-context+kubernetes-admin@kubernetes+\\\n++++--cluster=kubernetes+\\\n++++--user=kubernetes-admin+\\\n++++--kubeconfig=../admin.conf\n\n#+admin+set+default+context\n$+kubectl+config+use-context+kubernetes-admin@kubernetes+\\\n++++--kubeconfig=../admin.conf|34ntf|Controller+manager+certificate|18lou|下载manager-csr.json文件，并生成+kube-controller-manager+certificate+证书：|89f7p|$+wget+\"${PKI_URL}/manager-csr.json\"\n$+cfssl+gencert+\\\n++-ca=ca.pem+\\\n++-ca-key=ca-key.pem+\\\n++-config=ca-config.json+\\\n++-profile=kubernetes+\\\n++manager-csr.json+%7C+cfssljson+-bare+controller-manager\n\n$+ls+controller-manager*.pem\"${PKI_URL}/manager-csr.json\"\n$+cfssl+gencert+\\\n++-ca=ca.pem+\\\n++-ca-key=ca-key.pem+\\\n++-config=ca-config.json+\\\n++-profile=kubernetes+\\\n++manager-csr.json+%7C+cfssljson+-bare+controller-manager\n\n$+ls+controller-manager*.pem|483oc|+若节点+IP+不同，需要修改manager-csr.json的hosts。\n+|1rq1n|接着通过以下指令生成名称为controller-manager.conf的+kubeconfig+文件：|1vqoh|#+controller-manager+set-cluster\n$+kubectl+config+set-cluster+kubernetes+\\\n++++--certificate-authority=ca.pem+\\\n++++--embed-certs=true+\\\n++++--server=${KUBE_APISERVER}+\\\n++++--kubeconfig=../controller-manager.conf\n\n#+controller-manager+set-credentials\n$+kubectl+config+set-credentials+system:kube-controller-manager+\\\n++++--client-certificate=controller-manager.pem+\\\n++++--client-key=controller-manager-key.pem+\\\n++++--embed-certs=true+\\\n++++--kubeconfig=../controller-manager.conf\n\n#+controller-manager+set-context\n$+kubectl+config+set-context+system:kube-controller-manager@kubernetes+\\\n++++--cluster=kubernetes+\\\n++++--user=system:kube-controller-manager+\\\n++++--kubeconfig=../controller-manager.conf\n\n#+controller-manager+set+default+context\n$+kubectl+config+use-context+system:kube-controller-manager@kubernetes+\\\n++++--kubeconfig=../controller-manager.conf\n$+kubectl+config+set-cluster+kubernetes+\\\n++++--certificate-authority=ca.pem+\\\n++++--embed-certs=true+\\\n++++--server=${KUBE_APISERVER}+\\\n++++--kubeconfig=../controller-manager.conf\n\n#+controller-manager+set-credentials\n$+kubectl+config+set-credentials+system:kube-controller-manager+\\\n++++--client-certificate=controller-manager.pem+\\\n++++--client-key=controller-manager-key.pem+\\\n++++--embed-certs=true+\\\n++++--kubeconfig=../controller-manager.conf\n\n#+controller-manager+set-context\n$+kubectl+config+set-context+system:kube-controller-manager@kubernetes+\\\n++++--cluster=kubernetes+\\\n++++--user=system:kube-controller-manager+\\\n++++--kubeconfig=../controller-manager.conf\n\n#+controller-manager+set+default+context\n$+kubectl+config+use-context+system:kube-controller-manager@kubernetes+\\\n++++--kubeconfig=../controller-manager.conf|1i8v9|Scheduler+certificate|a2u17|下载scheduler-csr.json文件，并生成+kube-scheduler+certificate+证书：|913o0|$+wget+\"${PKI_URL}/scheduler-csr.json\"\n$+cfssl+gencert+\\\n++-ca=ca.pem+\\\n++-ca-key=ca-key.pem+\\\n++-config=ca-config.json+\\\n++-profile=kubernetes+\\\n++scheduler-csr.json+%7C+cfssljson+-bare+scheduler\n\n$+ls+scheduler*.pem\nscheduler-key.pem++scheduler.pem\"${PKI_URL}/scheduler-csr.json\"\n$+cfssl+gencert+\\\n++-ca=ca.pem+\\\n++-ca-key=ca-key.pem+\\\n++-config=ca-config.json+\\\n++-profile=kubernetes+\\\n++scheduler-csr.json+%7C+cfssljson+-bare+scheduler\n\n$+ls+scheduler*.pem\nscheduler-key.pem++scheduler.pem|6ppu6|+若节点+IP+不同，需要修改scheduler-csr.json的hosts。\n+|3nkdg|接着通过以下指令生成名称为 scheduler.conf 的+kubeconfig+文件：|52id9|#+scheduler+set-cluster\n$+kubectl+config+set-cluster+kubernetes+\\\n++++--certificate-authority=ca.pem+\\\n++++--embed-certs=true+\\\n++++--server=${KUBE_APISERVER}+\\\n++++--kubeconfig=../scheduler.conf\n\n#+scheduler+set-credentials\n$+kubectl+config+set-credentials+system:kube-scheduler+\\\n++++--client-certificate=scheduler.pem+\\\n++++--client-key=scheduler-key.pem+\\\n++++--embed-certs=true+\\\n++++--kubeconfig=../scheduler.conf\n\n#+scheduler+set-context\n$+kubectl+config+set-context+system:kube-scheduler@kubernetes+\\\n++++--cluster=kubernetes+\\\n++++--user=system:kube-scheduler+\\\n++++--kubeconfig=../scheduler.conf\n\n#+scheduler+set+default+context\n$+kubectl+config+use-context+system:kube-scheduler@kubernetes+\\\n++++--kubeconfig=../scheduler.conf\n$+kubectl+config+set-cluster+kubernetes+\\\n++++--certificate-authority=ca.pem+\\\n++++--embed-certs=true+\\\n++++--server=${KUBE_APISERVER}+\\\n++++--kubeconfig=../scheduler.conf\n\n#+scheduler+set-credentials\n$+kubectl+config+set-credentials+system:kube-scheduler+\\\n++++--client-certificate=scheduler.pem+\\\n++++--client-key=scheduler-key.pem+\\\n++++--embed-certs=true+\\\n++++--kubeconfig=../scheduler.conf\n\n#+scheduler+set-context\n$+kubectl+config+set-context+system:kube-scheduler@kubernetes+\\\n++++--cluster=kubernetes+\\\n++++--user=system:kube-scheduler+\\\n++++--kubeconfig=../scheduler.conf\n\n#+scheduler+set+default+context\n$+kubectl+config+use-context+system:kube-scheduler@kubernetes+\\\n++++--kubeconfig=../scheduler.conf|dffih|Kubelet+master+certificate|3momj|下载kubelet-csr.json文件，并生成+master+node+certificate+证书：|ccu40|$+wget+\"${PKI_URL}/kubelet-csr.json\"\n$+sed+-i+'s/$NODE/master1/g'+kubelet-csr.json\n$+cfssl+gencert+\\\n++-ca=ca.pem+\\\n++-ca-key=ca-key.pem+\\\n++-config=ca-config.json+\\\n++-hostname=master1,172.16.35.12,172.16.35.12+\\\n++-profile=kubernetes+\\\n++kubelet-csr.json+%7C+cfssljson+-bare+kubelet\n\n$+ls+kubelet*.pem\nkubelet-key.pem++kubelet.pem\"${PKI_URL}/kubelet-csr.json\"\n$+sed+-i+'s/$NODE/master1/g'+kubelet-csr.json\n$+cfssl+gencert+\\\n++-ca=ca.pem+\\\n++-ca-key=ca-key.pem+\\\n++-config=ca-config.json+\\\n++-hostname=master1,172.16.35.12,172.16.35.12+\\\n++-profile=kubernetes+\\\n++kubelet-csr.json+%7C+cfssljson+-bare+kubelet\n\n$+ls+kubelet*.pem\nkubelet-key.pem++kubelet.pem|1t448|+这边$NODE需要随节点名称不同而改变。\n+|1uc57|接着通过以下指令生成名称为 kubelet.conf 的+kubeconfig+文件：|51trb|#+kubelet+set-cluster\n$+kubectl+config+set-cluster+kubernetes+\\\n++++--certificate-authority=ca.pem+\\\n++++--embed-certs=true+\\\n++++--server=${KUBE_APISERVER}+\\\n++++--kubeconfig=../kubelet.conf\n\n#+kubelet+set-credentials\n$+kubectl+config+set-credentials+system:node:master1+\\\n++++--client-certificate=kubelet.pem+\\\n++++--client-key=kubelet-key.pem+\\\n++++--embed-certs=true+\\\n++++--kubeconfig=../kubelet.conf\n\n#+kubelet+set-context\n$+kubectl+config+set-context+system:node:master1@kubernetes+\\\n++++--cluster=kubernetes+\\\n++++--user=system:node:master1+\\\n++++--kubeconfig=../kubelet.conf\n\n#+kubelet+set+default+context\n$+kubectl+config+use-context+system:node:master1@kubernetes+\\\n++++--kubeconfig=../kubelet.conf\n$+kubectl+config+set-cluster+kubernetes+\\\n++++--certificate-authority=ca.pem+\\\n++++--embed-certs=true+\\\n++++--server=${KUBE_APISERVER}+\\\n++++--kubeconfig=../kubelet.conf\n\n#+kubelet+set-credentials\n$+kubectl+config+set-credentials+system:node:master1+\\\n++++--client-certificate=kubelet.pem+\\\n++++--client-key=kubelet-key.pem+\\\n++++--embed-certs=true+\\\n++++--kubeconfig=../kubelet.conf\n\n#+kubelet+set-context\n$+kubectl+config+set-context+system:node:master1@kubernetes+\\\n++++--cluster=kubernetes+\\\n++++--user=system:node:master1+\\\n++++--kubeconfig=../kubelet.conf\n\n#+kubelet+set+default+context\n$+kubectl+config+use-context+system:node:master1@kubernetes+\\\n++++--kubeconfig=../kubelet.conf|2i2hg|Service+account+key|9mk3f|Service+account+不是通过+CA+进行认证，因此不要通过+CA+来做+Service+account+key+的检查，这边建立一组+Private+与+Public+密钥提供给+Service+account+key+使用：|6qhn4|$+openssl+genrsa+-out+sa.key+2048\n$+openssl+rsa+-in+sa.key+-pubout+-out+sa.pub\n$+ls+sa.*\nsa.key++sa.pub-out+sa.key+2048\n$+openssl+rsa+-in+sa.key+-pubout+-out+sa.pub\n$+ls+sa.*\nsa.key++sa.pub|5v4tn|3utea|$+rm+-rf+*.json+*.csr|6d8ol|确认/etc/kubernetes与/etc/kubernetes/pki有以下文件：|e02s4|$+ls+/etc/kubernetes/\nadmin.conf++bootstrap.conf++controller-manager.conf++kubelet.conf++pki++scheduler.conf++token.csv\n\n$+ls+/etc/kubernetes/pki\nadmin-key.pem++apiserver-key.pem++ca-key.pem++controller-manager-key.pem++front-proxy-ca-key.pem++front-proxy-client-key.pem++kubelet-key.pem++sa.key++scheduler-key.pem\nadmin.pem++++++apiserver.pem++++++ca.pem++++++controller-manager.pem++++++front-proxy-ca.pem++++++front-proxy-client.pem++++++kubelet.pem++++++sa.pub++scheduler.pem/etc/kubernetes/\nadmin.conf++bootstrap.conf++controller-manager.conf++kubelet.conf++pki++scheduler.conf++token.csv\n\n$+ls+/etc/kubernetes/pki\nadmin-key.pem++apiserver-key.pem++ca-key.pem++controller-manager-key.pem++front-proxy-ca-key.pem++front-proxy-client-key.pem++kubelet-key.pem++sa.key++scheduler-key.pem\nadmin.pem++++++apiserver.pem++++++ca.pem++++++controller-manager.pem++++++front-proxy-ca.pem++++++front-proxy-client.pem++++++kubelet.pem++++++sa.pub++scheduler.pem|46fgf|安装+Kubernetes+核心组件|af91d|首先下载+Kubernetes+核心组件+YAML+文件，这边我们不透过+Binary+方案来创建+Master+核心组件，而是利用+Kubernetes+Static+Pod+来创建，因此需下载所有核心组件的Static+Pod文件到/etc/kubernetes/manifests目录：|9mdgs|$+export+CORE_URL=\"https://kairen.github.io/files/manual-v1.8/master\"\n$+mkdir+-p+/etc/kubernetes/manifests+&&+cd+/etc/kubernetes/manifests\n$+for+FILE+in+apiserver+manager+scheduler;+do\n++++wget+\"${CORE_URL}/${FILE}.yml.conf\"+-O+${FILE}.yml\n++doneexport+CORE_URL=\"https://kairen.github.io/files/manual-v1.8/master\"\n$+mkdir+-p+/etc/kubernetes/manifests+&&+cd+/etc/kubernetes/manifests\n$+for+FILE+in+apiserver+manager+scheduler;+do\n++++wget+\"${CORE_URL}/${FILE}.yml.conf\"+-O+${FILE}.yml\n++done|31mvc|+若IP与教程设定不同的话，请记得修改apiserver.yml、manager.yml、scheduler.yml。\n+apiserver+中的 NodeRestriction 请参考 Using+Node+Authorization。\n+|f0jbt|生成一个用来加密+Etcd+的+Key：|9n56u|$+head+-c+32+/dev/urandom+%7C+base64\nSUpbL4juUYyvxj3/gonV5xVEx8j769/99TSAf8YT/sQ=-c+32+/dev/urandom+%7C+base64\nSUpbL4juUYyvxj3/gonV5xVEx8j769/99TSAf8YT/sQ=|61mj9|在/etc/kubernetes/目录下，创建encryption.yml的加密+YAML+文件：|6srs1|$+cat+\u003C\u003CEOF+\u003E+/etc/kubernetes/encryption.yml\nkind:+EncryptionConfig\napiVersion:+v1\nresources:\n++-+resources:\n++++++-+secrets\n++++providers:\n++++++-+aescbc:\n++++++++++keys:\n++++++++++++-+name:+key1\n++++++++++++++secret:+SUpbL4juUYyvxj3/gonV5xVEx8j769/99TSAf8YT/sQ=\n++++++-+identity:+{}\nEOF\u003C\u003CEOF+\u003E+/etc/kubernetes/encryption.yml\nkind:+EncryptionConfig\napiVersion:+v1\nresources:\n++-+resources:\n++++++-+secrets\n++++providers:\n++++++-+aescbc:\n++++++++++keys:\n++++++++++++-+name:+key1\n++++++++++++++secret:+SUpbL4juUYyvxj3/gonV5xVEx8j769/99TSAf8YT/sQ=\n++++++-+identity:+{}\nEOF|e7bud|+Etcd+数据加密可参考这篇 Encrypting+data+at+rest。\n+|7l3kl|在/etc/kubernetes/目录下，创建audit-policy.yml的进阶审核策略+YAML+文件：|9ouc8|$+cat+\u003C\u003CEOF+\u003E+/etc/kubernetes/audit-policy.yml\napiVersion:+audit.k8s.io/v1beta1\nkind:+Policy\nrules:\n-+level:+Metadata\nEOF\u003C\u003CEOF+\u003E+/etc/kubernetes/audit-policy.yml\napiVersion:+audit.k8s.io/v1beta1\nkind:+Policy\nrules:\n-+level:+Metadata\nEOF|4tt60|+Audit+Policy+请参考这篇 Auditing。\n+|7at0g|下载kubelet.service相关文件来管理+kubelet：|ftl55|$+export+KUBELET_URL=\"https://kairen.github.io/files/manual-v1.8/master\"\n$+mkdir+-p+/etc/systemd/system/kubelet.service.d\n$+wget+\"${KUBELET_URL}/kubelet.service\"+-O+/lib/systemd/system/kubelet.service\n$+wget+\"${KUBELET_URL}/10-kubelet.conf\"+-O+/etc/systemd/system/kubelet.service.d/10-kubelet.confexport+KUBELET_URL=\"https://kairen.github.io/files/manual-v1.8/master\"\n$+mkdir+-p+/etc/systemd/system/kubelet.service.d\n$+wget+\"${KUBELET_URL}/kubelet.service\"+-O+/lib/systemd/system/kubelet.service\n$+wget+\"${KUBELET_URL}/10-kubelet.conf\"+-O+/etc/systemd/system/kubelet.service.d/10-kubelet.conf|7cmk8|最后创建+var+存放信息，然后启动+kubelet+服务:|75rbn|$+mkdir+-p+/var/lib/kubelet+/var/log/kubernetes\n$+systemctl+enable+kubelet.service+&&+systemctl+start+kubelet.service-p+/var/lib/kubelet+/var/log/kubernetes\n$+systemctl+enable+kubelet.service+&&+systemctl+start+kubelet.service|74kev|完成后会需要一段时间来下载镜像文件与启动组件，可以利用该指令来查看：|7hhob|$+watch+netstat+-ntlp\ntcp++++++++0++++++0+127.0.0.1:10248+++++++++0.0.0.0:*+++++++++++++++LISTEN++++++23012/kubelet\ntcp++++++++0++++++0+127.0.0.1:10251+++++++++0.0.0.0:*+++++++++++++++LISTEN++++++22305/kube-schedule\ntcp++++++++0++++++0+127.0.0.1:10252+++++++++0.0.0.0:*+++++++++++++++LISTEN++++++22529/kube-controll\ntcp6+++++++0++++++0+:::6443+++++++++++++++++:::*++++++++++++++++++++LISTEN++++++22956/kube-apiserve-ntlp\ntcp++++++++0++++++0+127.0.0.1:10248+++++++++0.0.0.0:*+++++++++++++++LISTEN++++++23012/kubelet\ntcp++++++++0++++++0+127.0.0.1:10251+++++++++0.0.0.0:*+++++++++++++++LISTEN++++++22305/kube-schedule\ntcp++++++++0++++++0+127.0.0.1:10252+++++++++0.0.0.0:*+++++++++++++++LISTEN++++++22529/kube-controll\ntcp6+++++++0++++++0+:::6443+++++++++++++++++:::*++++++++++++++++++++LISTEN++++++22956/kube-apiserve|9etkk|+若看到以上信息表示服务正常启动，若发生问题可以用docker+cli来查看。\n+|dspms|完成后，复制+admin+kubeconfig+文件，并通过简单指令验证：|f3ndt|$+cp+/etc/kubernetes/admin.conf+~/.kube/config\n$+kubectl+get+cs\nNAME+++++++++++++++++STATUS++++MESSAGE++++++++++++++ERROR\netcd-0+++++++++++++++Healthy+++{\"health\":+\"true\"}\nscheduler++++++++++++Healthy+++ok\ncontroller-manager+++Healthy+++ok\n\n$+kubectl+get+node\nNAME++++++STATUS+++++ROLES+++++AGE+++++++VERSION\nmaster1+++NotReady+++master++++4m++++++++v1.8.2\n\n$+kubectl+-n+kube-system+get+po\nNAME++++++++++++++++++++++++++++++READY+++++STATUS++++RESTARTS+++AGE\nkube-apiserver-master1++++++++++++1/1+++++++Running+++0++++++++++4m\nkube-controller-manager-master1+++1/1+++++++Running+++0++++++++++4m\nkube-scheduler-master1++++++++++++1/1+++++++Running+++0++++++++++4m/etc/kubernetes/admin.conf+~/.kube/config\n$+kubectl+get+cs\nNAME+++++++++++++++++STATUS++++MESSAGE++++++++++++++ERROR\netcd-0+++++++++++++++Healthy+++{\"health\":+\"true\"}\nscheduler++++++++++++Healthy+++ok\ncontroller-manager+++Healthy+++ok\n\n$+kubectl+get+node\nNAME++++++STATUS+++++ROLES+++++AGE+++++++VERSION\nmaster1+++NotReady+++master++++4m++++++++v1.8.2\n\n$+kubectl+-n+kube-system+get+po\nNAME++++++++++++++++++++++++++++++READY+++++STATUS++++RESTARTS+++AGE\nkube-apiserver-master1++++++++++++1/1+++++++Running+++0++++++++++4m\nkube-controller-manager-master1+++1/1+++++++Running+++0++++++++++4m\nkube-scheduler-master1++++++++++++1/1+++++++Running+++0++++++++++4m|8r0up|确认服务能够执行+logs+等指令：|7fp1e|$+kubectl+-n+kube-system+logs+-f+kube-scheduler-master1\nError+from+server+(Forbidden):+Forbidden+(user=kube-apiserver,+verb=get,+resource=nodes,+subresource=proxy)+(+pods/log+kube-apiserver-master1)-n+kube-system+logs+-f+kube-scheduler-master1\nError+from+server+(Forbidden):+Forbidden+(user=kube-apiserver,+verb=get,+resource=nodes,+subresource=proxy)+(+pods/log+kube-apiserver-master1)|dnlm8|+这边会发现出现+403+Forbidden+问题，这是因为 kube-apiserver user+并没有+nodes+的资源权限，属于正常。\n+|eu88|由于上述权限问题，我们必需创建一个 apiserver-to-kubelet-rbac.yml 来定义权限，以供我们执行+logs、exec+等指令：|cpq5r|$+cd+/etc/kubernetes/\n$+export+URL=\"https://kairen.github.io/files/manual-v1.8/master\"\n$+wget+\"${URL}/apiserver-to-kubelet-rbac.yml.conf\"+-O+apiserver-to-kubelet-rbac.yml\n$+kubectl+apply+-f+apiserver-to-kubelet-rbac.yml\n\n#+測試+logs\n$+kubectl+-n+kube-system+logs+-f+kube-scheduler-master1\n...\nI1031+03:22:42.527697+++++++1+leaderelection.go:184]+successfully+acquired+lease+kube-system/kube-scheduler/etc/kubernetes/\n$+export+URL=\"https://kairen.github.io/files/manual-v1.8/master\"\n$+wget+\"${URL}/apiserver-to-kubelet-rbac.yml.conf\"+-O+apiserver-to-kubelet-rbac.yml\n$+kubectl+apply+-f+apiserver-to-kubelet-rbac.yml\n\n#+測試+logs\n$+kubectl+-n+kube-system+logs+-f+kube-scheduler-master1\n...\nI1031+03:22:42.527697+++++++1+leaderelection.go:184]+successfully+acquired+lease+kube-system/kube-scheduler|cesd0|Kubernetes+Node|11v4o|Node+是主要执行容器实例的节点，可视为工作节点。在这步骤我们会下载+Kubernetes+binary+文件，并创建+node+的+certificate+来提供给节点注册认证用。Kubernetes+使用Node+Authorizer来提供Authorization+mode，这种授权模式会替+Kubelet+生成+API+request。|cfmlf|在开始前，我们先在master1将需要的+ca+与+cert+复制到+Node+节点上：|d0dja|$+for+NODE+in+node1+node2;+do\n++++ssh+${NODE}+\"mkdir+-p+/etc/kubernetes/pki/\"\n++++ssh+${NODE}+\"mkdir+-p+/etc/etcd/ssl\"\n++++#+Etcd+ca+and+cert\n++++for+FILE+in+etcd-ca.pem+etcd.pem+etcd-key.pem;+do\n++++++scp+/etc/etcd/ssl/${FILE}+${NODE}:/etc/etcd/ssl/${FILE}\n++++done\n++++#+Kubernetes+ca+and+cert\n++++for+FILE+in+pki/ca.pem+pki/ca-key.pem+bootstrap.conf;+do\n++++++scp+/etc/kubernetes/${FILE}+${NODE}:/etc/kubernetes/${FILE}\n++++done\n++donefor+NODE+in+node1+node2;+do\n++++ssh+${NODE}+\"mkdir+-p+/etc/kubernetes/pki/\"\n++++ssh+${NODE}+\"mkdir+-p+/etc/etcd/ssl\"\n++++#+Etcd+ca+and+cert\n++++for+FILE+in+etcd-ca.pem+etcd.pem+etcd-key.pem;+do\n++++++scp+/etc/etcd/ssl/${FILE}+${NODE}:/etc/etcd/ssl/${FILE}\n++++done\n++++#+Kubernetes+ca+and+cert\n++++for+FILE+in+pki/ca.pem+pki/ca-key.pem+bootstrap.conf;+do\n++++++scp+/etc/kubernetes/${FILE}+${NODE}:/etc/kubernetes/${FILE}\n++++done\n++done|nk5d|下载+Kubernetes+组件|7gjf0|7apu6|#+Download+Kubernetes\n$+export+KUBE_URL=\"https://storage.googleapis.com/kubernetes-release/release/v1.8.2/bin/linux/amd64\"\n$+wget+\"${KUBE_URL}/kubelet\"+-O+/usr/local/bin/kubelet\n$+chmod+%2Bx+/usr/local/bin/kubelet\n\n#+Download+CNI\n$+mkdir+-p+/opt/cni/bin+&&+cd+/opt/cni/bin\n$+export+CNI_URL=\"https://github.com/containernetworking/plugins/releases/download\"\n$+wget+-qO-+--show-progress+\"${CNI_URL}/v0.6.0/cni-plugins-amd64-v0.6.0.tgz\"+%7C+tar+-zx\n$+export+KUBE_URL=\"https://storage.googleapis.com/kubernetes-release/release/v1.8.2/bin/linux/amd64\"\n$+wget+\"${KUBE_URL}/kubelet\"+-O+/usr/local/bin/kubelet\n$+chmod+%2Bx+/usr/local/bin/kubelet\n\n#+Download+CNI\n$+mkdir+-p+/opt/cni/bin+&&+cd+/opt/cni/bin\n$+export+CNI_URL=\"https://github.com/containernetworking/plugins/releases/download\"\n$+wget+-qO-+--show-progress+\"${CNI_URL}/v0.6.0/cni-plugins-amd64-v0.6.0.tgz\"+%7C+tar+-zx|77oa9|设定+Kubernetes+node|ju4a|接着下载+Kubernetes+相关文件，包含+drop-in+file、systemd+service+档案等：|5rf85|$+export+KUBELET_URL=\"https://kairen.github.io/files/manual-v1.8/node\"\n$+mkdir+-p+/etc/systemd/system/kubelet.service.d\n$+wget+\"${KUBELET_URL}/kubelet.service\"+-O+/lib/systemd/system/kubelet.service\n$+wget+\"${KUBELET_URL}/10-kubelet.conf\"+-O+/etc/systemd/system/kubelet.service.d/10-kubelet.confexport+KUBELET_URL=\"https://kairen.github.io/files/manual-v1.8/node\"\n$+mkdir+-p+/etc/systemd/system/kubelet.service.d\n$+wget+\"${KUBELET_URL}/kubelet.service\"+-O+/lib/systemd/system/kubelet.service\n$+wget+\"${KUBELET_URL}/10-kubelet.conf\"+-O+/etc/systemd/system/kubelet.service.d/10-kubelet.conf|aq17p|接着在所有node创建+var+存放信息，然后启动+kubelet+服务:|8ml94|$+mkdir+-p+/var/lib/kubelet+/var/log/kubernetes+/etc/kubernetes/manifests\n$+systemctl+enable+kubelet.service+&&+systemctl+start+kubelet.service-p+/var/lib/kubelet+/var/log/kubernetes+/etc/kubernetes/manifests\n$+systemctl+enable+kubelet.service+&&+systemctl+start+kubelet.service|8ijpg|P.S.+重复一样动作来完成其他节点。|d555k|授权+Kubernetes+Node|69hh5|当所有节点都完成后，在master节点，因为我们采用+TLS+Bootstrapping，所需要创建一个+ClusterRoleBinding：|2iob8|$+kubectl+create+clusterrolebinding+kubelet-bootstrap+\\\n++++--clusterrole=system:node-bootstrapper+\\\n++++--user=kubelet-bootstrap-bootstrap+\\\n++++--clusterrole=system:node-bootstrapper+\\\n++++--user=kubelet-bootstrap|5cgla|在master通过简单指令验证，会看到节点处于pending：|dd6sj|$+kubectl+get+csr\nNAME+++++++++++++++++++++++++++++++++++++++++++++++++++AGE+++++++REQUESTOR+++++++++++CONDITION\nnode-csr-YWf97ZrLCTlr2hmXsNLfjVLwaLfZRsu52FRKOYjpcBE+++2s++++++++kubelet-bootstrap+++Pending\nnode-csr-eq4q6ffOwT4yqYQNU6sT7mphPOQdFN6yulMVZeu6pkE+++2s++++++++kubelet-bootstrap+++Pendingget+csr\nNAME+++++++++++++++++++++++++++++++++++++++++++++++++++AGE+++++++REQUESTOR+++++++++++CONDITION\nnode-csr-YWf97ZrLCTlr2hmXsNLfjVLwaLfZRsu52FRKOYjpcBE+++2s++++++++kubelet-bootstrap+++Pending\nnode-csr-eq4q6ffOwT4yqYQNU6sT7mphPOQdFN6yulMVZeu6pkE+++2s++++++++kubelet-bootstrap+++Pending|b72c7|通过+kubectl+来允许节点加入集群：|lu7k|$+kubectl+get+csr+%7C+awk+'/Pending/+{print+$1}'+%7C+xargs+kubectl+certificate+approve\ncertificatesigningrequest+\"node-csr-YWf97ZrLCTlr2hmXsNLfjVLwaLfZRsu52FRKOYjpcBE\"+approved\ncertificatesigningrequest+\"node-csr-eq4q6ffOwT4yqYQNU6sT7mphPOQdFN6yulMVZeu6pkE\"+approved\n\n$+kubectl+get+csr\nNAME+++++++++++++++++++++++++++++++++++++++++++++++++++AGE+++++++REQUESTOR+++++++++++CONDITION\nnode-csr-YWf97ZrLCTlr2hmXsNLfjVLwaLfZRsu52FRKOYjpcBE+++30s+++++++kubelet-bootstrap+++Approved,Issued\nnode-csr-eq4q6ffOwT4yqYQNU6sT7mphPOQdFN6yulMVZeu6pkE+++30s+++++++kubelet-bootstrap+++Approved,Issued\n\n$+kubectl+get+no\nNAME++++++STATUS+++++ROLES+++++AGE+++++++VERSION\nmaster1+++NotReady+++master++++15m+++++++v1.8.2\nnode1+++++NotReady+++\u003Cnone\u003E++++8m++++++++v1.8.2\nnode2+++++NotReady+++\u003Cnone\u003E++++6s++++++++v1.8.2get+csr+%7C+awk+'/Pending/+{print+$1}'+%7C+xargs+kubectl+certificate+approve\ncertificatesigningrequest+\"node-csr-YWf97ZrLCTlr2hmXsNLfjVLwaLfZRsu52FRKOYjpcBE\"+approved\ncertificatesigningrequest+\"node-csr-eq4q6ffOwT4yqYQNU6sT7mphPOQdFN6yulMVZeu6pkE\"+approved\n\n$+kubectl+get+csr\nNAME+++++++++++++++++++++++++++++++++++++++++++++++++++AGE+++++++REQUESTOR+++++++++++CONDITION\nnode-csr-YWf97ZrLCTlr2hmXsNLfjVLwaLfZRsu52FRKOYjpcBE+++30s+++++++kubelet-bootstrap+++Approved,Issued\nnode-csr-eq4q6ffOwT4yqYQNU6sT7mphPOQdFN6yulMVZeu6pkE+++30s+++++++kubelet-bootstrap+++Approved,Issued\n\n$+kubectl+get+no\nNAME++++++STATUS+++++ROLES+++++AGE+++++++VERSION\nmaster1+++NotReady+++master++++15m+++++++v1.8.2\nnode1+++++NotReady+++\u003Cnone\u003E++++8m++++++++v1.8.2\nnode2+++++NotReady+++\u003Cnone\u003E++++6s++++++++v1.8.2|k6gv|Kubernetes+Core+Addons+部署|cijuf|当完成上面所有步骤后，接着我们需要安装一些插件，而这些有部分是非常重要跟好用的，如Kube-dns与Kube-proxy等。|13uos|Kube-proxy+addon|3amh1|Kube-proxy 是实现+Service+的关键组件，kube-proxy+会在每台节点上执行，然后监听+API+Server+的+Service+与+Endpoint+资源对象的改变，然后来依据变化执行+iptables+来实现网络的转发。这边我们会需要建议一个+DaemonSet+来执行，并且创建一些需要的+certificate。Kubernetes+1.8+kube-proxy+开启+ipvs|akuap|首先在master1下载kube-proxy-csr.json文件，并产生+kube-proxy+certificate+证书：|7kc81|$+export+PKI_URL=\"https://kairen.github.io/files/manual-v1.8/pki\"\n$+cd+/etc/kubernetes/pki\n$+wget+\"${PKI_URL}/kube-proxy-csr.json\"+\"${PKI_URL}/ca-config.json\"\n$+cfssl+gencert+\\\n++-ca=ca.pem+\\\n++-ca-key=ca-key.pem+\\\n++-config=ca-config.json+\\\n++-profile=kubernetes+\\\n++kube-proxy-csr.json+%7C+cfssljson+-bare+kube-proxy\n\n$+ls+kube-proxy*.pem\nkube-proxy-key.pem++kube-proxy.pemexport+PKI_URL=\"https://kairen.github.io/files/manual-v1.8/pki\"\n$+cd+/etc/kubernetes/pki\n$+wget+\"${PKI_URL}/kube-proxy-csr.json\"+\"${PKI_URL}/ca-config.json\"\n$+cfssl+gencert+\\\n++-ca=ca.pem+\\\n++-ca-key=ca-key.pem+\\\n++-config=ca-config.json+\\\n++-profile=kubernetes+\\\n++kube-proxy-csr.json+%7C+cfssljson+-bare+kube-proxy\n\n$+ls+kube-proxy*.pem\nkube-proxy-key.pem++kube-proxy.pem|2oalu|接着透过以下指令生成名称为 kube-proxy.conf 的+kubeconfig+文件：|dfuj7|#+kube-proxy+set-cluster\n$+kubectl+config+set-cluster+kubernetes+\\\n++++--certificate-authority=ca.pem+\\\n++++--embed-certs=true+\\\n++++--server=\"https://172.16.35.12:6443\"+\\\n++++--kubeconfig=../kube-proxy.conf\n\n#+kube-proxy+set-credentials\n$+kubectl+config+set-credentials+system:kube-proxy+\\\n++++--client-key=kube-proxy-key.pem+\\\n++++--client-certificate=kube-proxy.pem+\\\n++++--embed-certs=true+\\\n++++--kubeconfig=../kube-proxy.conf\n\n#+kube-proxy+set-context\n$+kubectl+config+set-context+system:kube-proxy@kubernetes+\\\n++++--cluster=kubernetes+\\\n++++--user=system:kube-proxy+\\\n++++--kubeconfig=../kube-proxy.conf\n\n#+kube-proxy+set+default+context\n$+kubectl+config+use-context+system:kube-proxy@kubernetes+\\\n++++--kubeconfig=../kube-proxy.conf\n$+kubectl+config+set-cluster+kubernetes+\\\n++++--certificate-authority=ca.pem+\\\n++++--embed-certs=true+\\\n++++--server=\"https://172.16.35.12:6443\"+\\\n++++--kubeconfig=../kube-proxy.conf\n\n#+kube-proxy+set-credentials\n$+kubectl+config+set-credentials+system:kube-proxy+\\\n++++--client-key=kube-proxy-key.pem+\\\n++++--client-certificate=kube-proxy.pem+\\\n++++--embed-certs=true+\\\n++++--kubeconfig=../kube-proxy.conf\n\n#+kube-proxy+set-context\n$+kubectl+config+set-context+system:kube-proxy@kubernetes+\\\n++++--cluster=kubernetes+\\\n++++--user=system:kube-proxy+\\\n++++--kubeconfig=../kube-proxy.conf\n\n#+kube-proxy+set+default+context\n$+kubectl+config+use-context+system:kube-proxy@kubernetes+\\\n++++--kubeconfig=../kube-proxy.conf|2i19b|3dimo|$+rm+-rf+*.json-rf+*.json|20rte|确认/etc/kubernetes有以下文件：|531si|$+ls+/etc/kubernetes/\nadmin.conf++++++++bootstrap.conf+++++++++++encryption.yml++kube-proxy.conf++pki+++++++++++++token.csv\naudit-policy.yml++controller-manager.conf++kubelet.conf++++manifests++++++++scheduler.conf/etc/kubernetes/\nadmin.conf++++++++bootstrap.conf+++++++++++encryption.yml++kube-proxy.conf++pki+++++++++++++token.csv\naudit-policy.yml++controller-manager.conf++kubelet.conf++++manifests++++++++scheduler.conf|1rpf0|在master1将kube-proxy相关文件复制到+Node+节点上：|1ac9e|$+for+NODE+in+node1+node2;+do\n++++for+FILE+in+pki/kube-proxy.pem+pki/kube-proxy-key.pem+kube-proxy.conf;+do\n++++++scp+/etc/kubernetes/${FILE}+${NODE}:/etc/kubernetes/${FILE}\n++++done\n++donefor+NODE+in+node1+node2;+do\n++++for+FILE+in+pki/kube-proxy.pem+pki/kube-proxy-key.pem+kube-proxy.conf;+do\n++++++scp+/etc/kubernetes/${FILE}+${NODE}:/etc/kubernetes/${FILE}\n++++done\n++done|df1kr|完成后，在master1通过+kubectl+来创建+kube-proxy+daemon：|mmo6|$+export+ADDON_URL=\"https://kairen.github.io/files/manual-v1.8/addon\"\n$+mkdir+-p+/etc/kubernetes/addons+&&+cd+/etc/kubernetes/addons\n$+wget+\"${ADDON_URL}/kube-proxy.yml.conf\"+-O+kube-proxy.yml\n$+kubectl+apply+-f+kube-proxy.yml\n$+kubectl+-n+kube-system+get+po+-l+k8s-app=kube-proxy\nNAME+++++++++++++++READY+++++STATUS++++RESTARTS+++AGE\nkube-proxy-bpp7q+++1/1+++++++Running+++0++++++++++47s\nkube-proxy-cztvh+++1/1+++++++Running+++0++++++++++47s\nkube-proxy-q7mm4+++1/1+++++++Running+++0++++++++++47sexport+ADDON_URL=\"https://kairen.github.io/files/manual-v1.8/addon\"\n$+mkdir+-p+/etc/kubernetes/addons+&&+cd+/etc/kubernetes/addons\n$+wget+\"${ADDON_URL}/kube-proxy.yml.conf\"+-O+kube-proxy.yml\n$+kubectl+apply+-f+kube-proxy.yml\n$+kubectl+-n+kube-system+get+po+-l+k8s-app=kube-proxy\nNAME+++++++++++++++READY+++++STATUS++++RESTARTS+++AGE\nkube-proxy-bpp7q+++1/1+++++++Running+++0++++++++++47s\nkube-proxy-cztvh+++1/1+++++++Running+++0++++++++++47s\nkube-proxy-q7mm4+++1/1+++++++Running+++0++++++++++47s|191hs|Kube-dns+addon|8hsrl|Kube+DNS 是+Kubernetes+集群内部+Pod+之间互相沟通的重要+Addon，它允许+Pod+可以通过+Domain+Name+方式来连接+Service，其主要由+Kube+DNS+与+Sky+DNS+组合而成，通过+Kube+DNS+监听+Service+与+Endpoint+变化，来提供给+Sky+DNS+信息，已更新解析地址。|bnv3g|安装只需要在master1通过+kubectl+来创建+kube-dns+deployment+即可：|afio5|$+export+ADDON_URL=\"https://kairen.github.io/files/manual-v1.8/addon\"\n$+wget+\"${ADDON_URL}/kube-dns.yml.conf\"+-O+kube-dns.yml\n$+kubectl+apply+-f+kube-dns.yml\n$+kubectl+-n+kube-system+get+po+-l+k8s-app=kube-dns\nNAME++++++++++++++++++++++++READY+++++STATUS++++RESTARTS+++AGE\nkube-dns-6cb549f55f-h4zr5+++0/3+++++++Pending+++0++++++++++40sexport+ADDON_URL=\"https://kairen.github.io/files/manual-v1.8/addon\"\n$+wget+\"${ADDON_URL}/kube-dns.yml.conf\"+-O+kube-dns.yml\n$+kubectl+apply+-f+kube-dns.yml\n$+kubectl+-n+kube-system+get+po+-l+k8s-app=kube-dns\nNAME++++++++++++++++++++++++READY+++++STATUS++++RESTARTS+++AGE\nkube-dns-6cb549f55f-h4zr5+++0/3+++++++Pending+++0++++++++++40s|90s3u|Calico+Network+安装与设定|9i4oo|Calico+是一款纯+Layer+3+的数据中心网络方案(不需要+Overlay+网络)，Calico+好处是他已与各种云原生平台有良好的整合，而+Calico+在每一个节点利用+Linux+Kernel+实现高效的+vRouter+来负责数据的转发，而当数据中心复杂度增加时，可以用+BGP+route+reflector+来达成。|612ms|首先在master1通过+kubectl+建立+Calico+policy+controller：|agkni|$+export+CALICO_CONF_URL=\"https://kairen.github.io/files/manual-v1.8/network\"\n$+wget+\"${CALICO_CONF_URL}/calico-controller.yml.conf\"+-O+calico-controller.yml\n$+kubectl+apply+-f+calico-controller.yml\n$+kubectl+-n+kube-system+get+po+-l+k8s-app=calico-policy\nNAME++++++++++++++++++++++++++++++++++++++++READY+++++STATUS++++RESTARTS+++AGE\ncalico-policy-controller-5ff8b4549d-tctmm+++0/1+++++++Pending+++0++++++++++5sexport+CALICO_CONF_URL=\"https://kairen.github.io/files/manual-v1.8/network\"\n$+wget+\"${CALICO_CONF_URL}/calico-controller.yml.conf\"+-O+calico-controller.yml\n$+kubectl+apply+-f+calico-controller.yml\n$+kubectl+-n+kube-system+get+po+-l+k8s-app=calico-policy\nNAME++++++++++++++++++++++++++++++++++++++++READY+++++STATUS++++RESTARTS+++AGE\ncalico-policy-controller-5ff8b4549d-tctmm+++0/1+++++++Pending+++0++++++++++5s|ekdb8|在master1下载+Calico+CLI+工具：|51ll|$+wget+https://github.com/projectcalico/calicoctl/releases/download/v1.6.1/calicoctl\n$+chmod+%2Bx+calicoctl+&&+mv+calicoctl+/usr/local/bin/://github.com/projectcalico/calicoctl/releases/download/v1.6.1/calicoctl\n$+chmod+%2Bx+calicoctl+&&+mv+calicoctl+/usr/local/bin/|6ap9s|然后在所有节点下载+Calico，并执行以下步骤：|9s8jm|$+export+CALICO_URL=\"https://github.com/projectcalico/cni-plugin/releases/download/v1.11.0\"\n$+wget+-N+-P+/opt/cni/bin+${CALICO_URL}/calico\n$+wget+-N+-P+/opt/cni/bin+${CALICO_URL}/calico-ipam\n$+chmod+%2Bx+/opt/cni/bin/calico+/opt/cni/bin/calico-ipamexport+CALICO_URL=\"https://github.com/projectcalico/cni-plugin/releases/download/v1.11.0\"\n$+wget+-N+-P+/opt/cni/bin+${CALICO_URL}/calico\n$+wget+-N+-P+/opt/cni/bin+${CALICO_URL}/calico-ipam\n$+chmod+%2Bx+/opt/cni/bin/calico+/opt/cni/bin/calico-ipam|cakcu|接着在所有节点下载+CNI+plugins配置文件，以及+calico-node.service：|bcev9|$+mkdir+-p+/etc/cni/net.d\n$+export+CALICO_CONF_URL=\"https://kairen.github.io/files/manual-v1.8/network\"\n$+wget+\"${CALICO_CONF_URL}/10-calico.conf\"+-O+/etc/cni/net.d/10-calico.conf\n$+wget+\"${CALICO_CONF_URL}/calico-node.service\"+-O+/lib/systemd/system/calico-node.service-p+/etc/cni/net.d\n$+export+CALICO_CONF_URL=\"https://kairen.github.io/files/manual-v1.8/network\"\n$+wget+\"${CALICO_CONF_URL}/10-calico.conf\"+-O+/etc/cni/net.d/10-calico.conf\n$+wget+\"${CALICO_CONF_URL}/calico-node.service\"+-O+/lib/systemd/system/calico-node.service|8ne8n|+若部署的机器是使用虚拟机，如+Virtualbox+等的话，请修改calico-node.service文件，并在IP_AUTODETECTION_METHOD(包含+IP6)部分指定绑定的网卡，以避免默认绑定到+NAT+网络上。\n+|4i7bc|之后在所有节点启动+Calico-node:|lahr|$+systemctl+enable+calico-node.service+&&+systemctl+start+calico-node.service-node.service+&&+systemctl+start+calico-node.service|6bcpc|在master1查看+Calico+nodes:|c5iim|$+cat+\u003C\u003CEOF+\u003E+~/calico-rc\nexport+ETCD_ENDPOINTS=\"https://172.16.35.12:2379\"\nexport+ETCD_CA_CERT_FILE=\"/etc/etcd/ssl/etcd-ca.pem\"\nexport+ETCD_CERT_FILE=\"/etc/etcd/ssl/etcd.pem\"\nexport+ETCD_KEY_FILE=\"/etc/etcd/ssl/etcd-key.pem\"\nEOF\n\n$+.+~/calico-rc\n$+calicoctl+get+node+-o+wide\nNAME++++++ASN+++++++IPV4++++++++++++++IPV6\nmaster1+++(64512)+++172.16.35.12/24\nnode1+++++(64512)+++172.16.35.10/24\nnode2+++++(64512)+++172.16.35.11/24\u003C\u003CEOF+\u003E+~/calico-rc\nexport+ETCD_ENDPOINTS=\"https://172.16.35.12:2379\"\nexport+ETCD_CA_CERT_FILE=\"/etc/etcd/ssl/etcd-ca.pem\"\nexport+ETCD_CERT_FILE=\"/etc/etcd/ssl/etcd.pem\"\nexport+ETCD_KEY_FILE=\"/etc/etcd/ssl/etcd-key.pem\"\nEOF\n\n$+.+~/calico-rc\n$+calicoctl+get+node+-o+wide\nNAME++++++ASN+++++++IPV4++++++++++++++IPV6\nmaster1+++(64512)+++172.16.35.12/24\nnode1+++++(64512)+++172.16.35.10/24\nnode2+++++(64512)+++172.16.35.11/24|4b754|查看+pending+的+pod+是否已执行：|fc8ga|$+kubectl+-n+kube-system+get+po\nNAME++++++++++++++++++++++++++++++++++++++++READY+++++STATUS++++RESTARTS+++AGE\ncalico-policy-controller-5ff8b4549d-tctmm+++1/1+++++++Running+++0++++++++++4m\nkube-apiserver-master1++++++++++++++++++++++1/1+++++++Running+++0++++++++++20m\nkube-controller-manager-master1+++++++++++++1/1+++++++Running+++0++++++++++20m\nkube-dns-6cb549f55f-h4zr5+++++++++++++++++++3/3+++++++Running+++0++++++++++5m\nkube-proxy-fnrkb++++++++++++++++++++++++++++1/1+++++++Running+++0++++++++++6m\nkube-proxy-l72bq++++++++++++++++++++++++++++1/1+++++++Running+++0++++++++++6m\nkube-proxy-m6rfw++++++++++++++++++++++++++++1/1+++++++Running+++0++++++++++6m\nkube-scheduler-master1++++++++++++++++++++++1/1+++++++Running+++0++++++++++20m-n+kube-system+get+po\nNAME++++++++++++++++++++++++++++++++++++++++READY+++++STATUS++++RESTARTS+++AGE\ncalico-policy-controller-5ff8b4549d-tctmm+++1/1+++++++Running+++0++++++++++4m\nkube-apiserver-master1++++++++++++++++++++++1/1+++++++Running+++0++++++++++20m\nkube-controller-manager-master1+++++++++++++1/1+++++++Running+++0++++++++++20m\nkube-dns-6cb549f55f-h4zr5+++++++++++++++++++3/3+++++++Running+++0++++++++++5m\nkube-proxy-fnrkb++++++++++++++++++++++++++++1/1+++++++Running+++0++++++++++6m\nkube-proxy-l72bq++++++++++++++++++++++++++++1/1+++++++Running+++0++++++++++6m\nkube-proxy-m6rfw++++++++++++++++++++++++++++1/1+++++++Running+++0++++++++++6m\nkube-scheduler-master1++++++++++++++++++++++1/1+++++++Running+++0++++++++++20m|dm0r1|最后若想省事，可以直接用 Standard+Hosted 方式安装。|au1be|Kubernetes+Extra+Addons+部署|fvj7|本节说明如何部署一些官方常用的+Addons，如+Dashboard、Heapster+等。|3ed6g|Dashboard+addon|73mhl|Dashboard 是+Kubernetes+社区官方开发的仪表板，有了仪表板后管理者就能够透过+Web-based+方式来管理+Kubernetes+集群，除了提升管理方便，也让资源可视化，让人更直觉看见系统信息的呈现结果。|1qr0a|首先我们要建立kubernetes-dashboard-certs，来提供给+Dashboard+TLS+使用：|7r2ns|$+mkdir+-p+/etc/kubernetes/addons/certs+&&+cd+/etc/kubernetes/addons\n$+openssl+genrsa+-des3+-passout+pass:x+-out+certs/dashboard.pass.key+2048\n$+openssl+rsa+-passin+pass:x+-in+certs/dashboard.pass.key+-out+certs/dashboard.key\n$+openssl+req+-new+-key+certs/dashboard.key+-out+certs/dashboard.csr+-subj+'/CN=kube-dashboard'\n$+openssl+x509+-req+-sha256+-days+365+-in+certs/dashboard.csr+-signkey+certs/dashboard.key+-out+certs/dashboard.crt\n$+rm+certs/dashboard.pass.key\n$+kubectl+create+secret+generic+kubernetes-dashboard-certs\\\n++++--from-file=certs+-n+kube-system-p+/etc/kubernetes/addons/certs+&&+cd+/etc/kubernetes/addons\n$+openssl+genrsa+-des3+-passout+pass:x+-out+certs/dashboard.pass.key+2048\n$+openssl+rsa+-passin+pass:x+-in+certs/dashboard.pass.key+-out+certs/dashboard.key\n$+openssl+req+-new+-key+certs/dashboard.key+-out+certs/dashboard.csr+-subj+'/CN=kube-dashboard'\n$+openssl+x509+-req+-sha256+-days+365+-in+certs/dashboard.csr+-signkey+certs/dashboard.key+-out+certs/dashboard.crt\n$+rm+certs/dashboard.pass.key\n$+kubectl+create+secret+generic+kubernetes-dashboard-certs\\\n++++--from-file=certs+-n+kube-system|el4vo|接着在master1通过+kubectl+来建立+kubernetes+dashboard+即可：|1ecnb|$+export+ADDON_URL=\"https://kairen.github.io/files/manual-v1.8/addon\"\n$+wget+${ADDON_URL}/kube-dashboard.yml.conf+-O+kube-dashboard.yml\n$+kubectl+apply+-f+kube-dashboard.yml\n$+kubectl+-n+kube-system+get+po,svc+-l+k8s-app=kubernetes-dashboard\nNAME++++++++++++++++++++++++++++++++++++++READY+++++STATUS++++RESTARTS+++AGE\npo/kubernetes-dashboard-747c4f7cf-md5m8+++1/1+++++++Running+++0++++++++++56s\n\nNAME+++++++++++++++++++++++TYPE++++++++CLUSTER-IP++++++EXTERNAL-IP+++PORT(S)+++AGE\nsvc/kubernetes-dashboard+++ClusterIP+++10.98.120.209+++\u003Cnone\u003E++++++++443/TCP+++56sexport+ADDON_URL=\"https://kairen.github.io/files/manual-v1.8/addon\"\n$+wget+${ADDON_URL}/kube-dashboard.yml.conf+-O+kube-dashboard.yml\n$+kubectl+apply+-f+kube-dashboard.yml\n$+kubectl+-n+kube-system+get+po,svc+-l+k8s-app=kubernetes-dashboard\nNAME++++++++++++++++++++++++++++++++++++++READY+++++STATUS++++RESTARTS+++AGE\npo/kubernetes-dashboard-747c4f7cf-md5m8+++1/1+++++++Running+++0++++++++++56s\n\nNAME+++++++++++++++++++++++TYPE++++++++CLUSTER-IP++++++EXTERNAL-IP+++PORT(S)+++AGE\nsvc/kubernetes-dashboard+++ClusterIP+++10.98.120.209+++\u003Cnone\u003E++++++++443/TCP+++56s|7mds2|+P.S.+这边会额外创建一个名称为anonymous-open-door Cluster+Role+Binding，这仅作为方便测试时使用，在一般情况下不要开启，不然就会直接被存取所有+API。\n+|2jkld|完成后，就可以透过浏览器访问 Dashboard，https://172.16.35.12:6443/api/v1/namespaces/kube-system/services/https:kubernetes-dashboard:/proxy/|65g9h|Heapster+addon|fvlti|Heapster 是+Kubernetes+社区维护的容器集群监控分析工具。Heapster+会从+Kubernetes+apiserver+获得所有+Node+信息，然后再通过这些+Node+来获得+kubelet+上的数据，最后再将所有收集到数据送到+Heapster+的后台储存+InfluxDB，最后利用+Grafana+来抓取+InfluxDB+的数据源来进行可视化。|9bpf6|在master1通过+kubectl+来创建+kubernetes+monitor+即可：|ao414|$+export+ADDON_URL=\"https://kairen.github.io/files/manual-v1.8/addon\"\n$+wget+${ADDON_URL}/kube-monitor.yml.conf+-O+kube-monitor.yml\n$+kubectl+apply+-f+kube-monitor.yml\n$+kubectl+-n+kube-system+get+po,svc\nNAME+++++++++++++++++++++++++++++++++++++++++++READY+++++STATUS++++RESTARTS+++AGE\n...\npo/heapster-74fb5c8cdc-62xzc+++++++++++++++++++4/4+++++++Running+++0++++++++++7m\npo/influxdb-grafana-55bd7df44-nw4nc++++++++++++2/2+++++++Running+++0++++++++++7m\n\nNAME+++++++++++++++++++++++TYPE++++++++CLUSTER-IP+++++++EXTERNAL-IP+++PORT(S)+++++++++++++AGE\n...\nsvc/heapster+++++++++++++++ClusterIP+++10.100.242.225+++\u003Cnone\u003E++++++++80/TCP++++++++++++++7m\nsvc/monitoring-grafana+++++ClusterIP+++10.101.106.180+++\u003Cnone\u003E++++++++80/TCP++++++++++++++7m\nsvc/monitoring-influxdb++++ClusterIP+++10.109.245.142+++\u003Cnone\u003E++++++++8083/TCP,8086/TCP+++7m\n···export+ADDON_URL=\"https://kairen.github.io/files/manual-v1.8/addon\"\n$+wget+${ADDON_URL}/kube-monitor.yml.conf+-O+kube-monitor.yml\n$+kubectl+apply+-f+kube-monitor.yml\n$+kubectl+-n+kube-system+get+po,svc\nNAME+++++++++++++++++++++++++++++++++++++++++++READY+++++STATUS++++RESTARTS+++AGE\n...\npo/heapster-74fb5c8cdc-62xzc+++++++++++++++++++4/4+++++++Running+++0++++++++++7m\npo/influxdb-grafana-55bd7df44-nw4nc++++++++++++2/2+++++++Running+++0++++++++++7m\n\nNAME+++++++++++++++++++++++TYPE++++++++CLUSTER-IP+++++++EXTERNAL-IP+++PORT(S)+++++++++++++AGE\n...\nsvc/heapster+++++++++++++++ClusterIP+++10.100.242.225+++\u003Cnone\u003E++++++++80/TCP++++++++++++++7m\nsvc/monitoring-grafana+++++ClusterIP+++10.101.106.180+++\u003Cnone\u003E++++++++80/TCP++++++++++++++7m\nsvc/monitoring-influxdb++++ClusterIP+++10.109.245.142+++\u003Cnone\u003E++++++++8083/TCP,8086/TCP+++7m\n···|f0h8c|完成后，就可以透过浏览器存取 Grafana+Dashboard，https://172.16.35.12:6443/api/v1/proxy/namespaces/kube-system/services/monitoring-grafana|12ub4|简单部署+Nginx+服务|eoj4f|Kubernetes+可以选择使用指令直接创建应用程序与服务，或者撰写+YAML+与+JSON+档案来描述部署应用程序的配置，以下将创建一个简单的+Nginx+服务：|7qs98|$+kubectl+run+nginx+--image=nginx+--port=80\n$+kubectl+expose+deploy+nginx+--port=80+--type=LoadBalancer+--external-ip=172.16.35.12\n$+kubectl+get+svc,po\nNAME+++++++++++++TYPE+++++++++++CLUSTER-IP++++++EXTERNAL-IP++++PORT(S)++++++++AGE\nsvc/kubernetes+++ClusterIP++++++10.96.0.1+++++++\u003Cnone\u003E+++++++++443/TCP++++++++1h\nsvc/nginx++++++++LoadBalancer+++10.97.121.243+++172.16.35.12+++80:30344/TCP+++22s\n\nNAME++++++++++++++++++++++++READY+++++STATUS++++RESTARTS+++AGE\npo/nginx-7cbc4b4d9c-7796l+++1/1+++++++Running+++0++++++++++28s+++++++192.160.57.181+++,172.16.35.12+++80:32054/TCP+++21s--image=nginx+--port=80\n$+kubectl+expose+deploy+nginx+--port=80+--type=LoadBalancer+--external-ip=172.16.35.12\n$+kubectl+get+svc,po\nNAME+++++++++++++TYPE+++++++++++CLUSTER-IP++++++EXTERNAL-IP++++PORT(S)++++++++AGE\nsvc/kubernetes+++ClusterIP++++++10.96.0.1+++++++\u003Cnone\u003E+++++++++443/TCP++++++++1h\nsvc/nginx++++++++LoadBalancer+++10.97.121.243+++172.16.35.12+++80:30344/TCP+++22s\n\nNAME++++++++++++++++++++++++READY+++++STATUS++++RESTARTS+++AGE\npo/nginx-7cbc4b4d9c-7796l+++1/1+++++++Running+++0++++++++++28s+++++++192.160.57.181+++,172.16.35.12+++80:32054/TCP+++21s|6g70m|+这边type可以选择+NodePort+与+LoadBalancer，在本地裸机部署，两者差异在于NodePort只映射+Host+port+到+Container+port，而LoadBalancer则继承NodePort额外多出映射+Host+target+port+到+Container+port。\n+|49sla|确认没问题后即可在浏览器存取 http://172.16.35.12|efeh6|扩展服务数量|2o0nr|若集群node节点增加了，而想让+Nginx+服务提供可靠性的话，可以通过以下方式来扩展服务的副本：|977p2|$+kubectl+scale+deploy+nginx+--replicas=2\n\n$+kubectl+get+pods+-o+wide\nNAME++++++++++++++++++++READY+++++STATUS++++RESTARTS+++AGE+++++++IP+++++++++++++NODE\nnginx-158599303-0h9lr+++1/1+++++++Running+++0++++++++++25s+++++++10.244.100.5+++node2\nnginx-158599303-k7cbt+++1/1+++++++Running+++0++++++++++1m++++++++10.244.24.3++++node1--replicas=2\n\n$+kubectl+get+pods+-o+wide\nNAME++++++++++++++++++++READY+++++STATUS++++RESTARTS+++AGE+++++++IP+++++++++++++NODE\nnginx-158599303-0h9lr+++1/1+++++++Running+++0++++++++++25s+++++++10.244.100.5+++node2\nnginx-158599303-k7cbt+++1/1+++++++Running+++0++++++++++1m++++++++10.244.24.3++++node1|0|LINK|mutability|MUTABLE|url|http://docs.kubernetes.org.cn/282.html|https://kairen.github.io/files/manual-v1.8/Vagrantfile|2|http://docs.kubernetes.org.cn/306.html|3|http://docs.kubernetes.org.cn/713.html|4|http://docs.kubernetes.org.cn/698.html|5|https://gist.github.com/kairen/60ad8545b79e8e7aa9bdc8a2893df7a0|6|http://docs.kubernetes.org.cn/156.html|7|https://kubernetes.io/docs/tasks/administer-cluster/encrypt-data/|8|https://kubernetes.io/docs/tasks/debug-application-cluster/audit/|9|10|https://github.com/kubernetes/kubernetes/tree/master/cluster/addons/kube-proxy|11|https://www.kubernetes.org.cn/3025.html|12|http://docs.kubernetes.org.cn/733.html|13|https://docs.projectcalico.org/v2.6/getting-started/kubernetes/installation/hosted/hosted|14|https://www.kubernetes.org.cn/932.html^0|2G|Q|0|0|0|8|0|0|0|0|0|0|0|0|0|0|5|B|1|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|6|2|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|F|3|0|0|3U|H|4|0|0|0|K|J|5|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|2M|O|6|0|0|0|0|0|G|N|7|0|0|0|K|8|8|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|3F|I|9|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|A|A|4R|X|B|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|8|C|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|D|F|D|0|0|0|0|0|0|0|0|0|0|0|0|0|8|E|0|0|0|0|0|0|0|0|0|0|0^^$0|@$1|2|3|4|5|6|7|EY|8|@]|9|@$A|EZ|B|F0|1|F1]]|C|$]]|$1|D|3|E|5|6|7|F2|8|@$A|F3|B|F4|F|G]]|9|@]|C|$]]|$1|H|3|I|5|J|7|F5|8|@]|9|@]|C|$]]|$1|K|3|L|5|J|7|F6|8|@]|9|@]|C|$]]|$1|M|3|N|5|J|7|F7|8|@]|9|@]|C|$]]|$1|O|3|P|5|J|7|F8|8|@]|9|@]|C|$]]|$1|Q|3|R|5|S|7|F9|8|@]|9|@]|C|$]]|$1|T|3|U|5|6|7|FA|8|@]|9|@]|C|$]]|$1|V|3|W|5|X|7|FB|8|@]|9|@]|C|$Y|@$1|Z|10|11]|$1|12|10|11]|$1|13|10|11]|$1|14|10|11]]|15|@$1|16|17|@$1|18|19|$0|@$1|1A|5|6|3|1B|8|@]|9|@]]]|1C|$]]]|$1|1D|19|$0|@$1|1E|5|6|3|1F|8|@]|9|@]]]|1C|$]]]|$1|1G|19|$0|@$1|1H|5|6|3|1I|8|@]|9|@]]]|1C|$]]]|$1|1J|19|$0|@$1|1K|5|6|3|1L|8|@]|9|@]]]|1C|$]]]]]|$1|1M|17|@$1|1N|19|$0|@$1|1O|5|6|3|1P|8|@]|9|@]]]|1C|$]]]|$1|1Q|19|$0|@$1|1R|5|6|3|1S|8|@]|9|@]]]|1C|$]]]|$1|1T|19|$0|@$1|1U|5|6|3|1V|8|@]|9|@]]]|1C|$]]]|$1|1W|19|$0|@$1|1X|5|6|3|1Y|8|@]|9|@]]]|1C|$]]]]]|$1|1Z|17|@$1|20|19|$0|@$1|21|5|6|3|22|8|@]|9|@]]]|1C|$]]]|$1|23|19|$0|@$1|24|5|6|3|25|8|@]|9|@]]]|1C|$]]]|$1|26|19|$0|@$1|27|5|6|3|1V|8|@]|9|@]]]|1C|$]]]|$1|28|19|$0|@$1|29|5|6|3|1Y|8|@]|9|@]]]|1C|$]]]]]]]]|$1|2A|3|2B|5|J|7|FC|8|@]|9|@]|C|$]]|$1|2C|3|2D|5|J|7|FD|8|@]|9|@]|C|$]]|$1|2E|3|2F|5|J|7|FE|8|@]|9|@$A|FF|B|FG|1|FH]]|C|$]]|$1|2G|3|2H|5|6|7|FI|8|@]|9|@]|C|$]]|$1|2I|3|2J|5|J|7|FJ|8|@]|9|@]|C|$]]|$1|2K|3|2L|5|J|7|FK|8|@]|9|@]|C|$]]|$1|2M|3|2N|5|2O|7|FL|8|@]|9|@]|C|$2P|2Q]]|$1|2R|3|2S|5|J|7|FM|8|@]|9|@]|C|$]]|$1|2T|3|2U|5|2O|7|FN|8|@]|9|@]|C|$2P|2Q]]|$1|2V|3|2W|5|J|7|FO|8|@]|9|@]|C|$]]|$1|2X|3|2Y|5|2O|7|FP|8|@]|9|@]|C|$2P|2Q]]|$1|2Z|3|30|5|6|7|FQ|8|@]|9|@]|C|$]]|$1|31|3|32|5|2O|7|FR|8|@]|9|@]|C|$2P|2Q]]|$1|33|3|34|5|6|7|FS|8|@]|9|@]|C|$]]|$1|35|3|36|5|2O|7|FT|8|@]|9|@]|C|$2P|2Q]]|$1|37|3|38|5|6|7|FU|8|@]|9|@]|C|$]]|$1|39|3|3A|5|2O|7|FV|8|@]|9|@]|C|$2P|2Q]]|$1|3B|3|3C|5|J|7|FW|8|@]|9|@]|C|$]]|$1|3D|3|3E|5|2O|7|FX|8|@]|9|@]|C|$2P|2Q]]|$1|3F|3|3G|5|J|7|FY|8|@]|9|@]|C|$]]|$1|3H|3|3I|5|2O|7|FZ|8|@]|9|@]|C|$2P|2Q]]|$1|3J|3|3K|5|S|7|G0|8|@]|9|@]|C|$]]|$1|3L|3|3M|5|6|7|G1|8|@]|9|@]|C|$]]|$1|3N|3|3O|5|3P|7|G2|8|@]|9|@]|C|$]]|$1|3Q|3|3R|5|6|7|G3|8|@]|9|@]|C|$]]|$1|3S|3|3T|5|6|7|G4|8|@]|9|@]|C|$]]|$1|3U|3|3V|5|2O|7|G5|8|@]|9|@]|C|$2P|2Q]]|$1|3W|3|3X|5|6|7|G6|8|@]|9|@]|C|$]]|$1|3Y|3|3Z|5|2O|7|G7|8|@]|9|@]|C|$2P|2Q]]|$1|40|3|41|5|6|7|G8|8|@]|9|@]|C|$]]|$1|42|3|43|5|2O|7|G9|8|@]|9|@]|C|$2P|2Q]]|$1|44|3|45|5|46|7|GA|8|@]|9|@]|C|$]]|$1|47|3|48|5|6|7|GB|8|@]|9|@]|C|$]]|$1|49|3|4A|5|2O|7|GC|8|@]|9|@]|C|$2P|2Q]]|$1|4B|3|4C|5|6|7|GD|8|@]|9|@]|C|$]]|$1|4D|3|4E|5|2O|7|GE|8|@]|9|@]|C|$2P|2Q]]|$1|4F|3|4G|5|3P|7|GF|8|@]|9|@]|C|$]]|$1|4H|3|4I|5|6|7|GG|8|@]|9|@]|C|$]]|$1|4J|3|4K|5|2O|7|GH|8|@]|9|@]|C|$2P|2Q]]|$1|4L|3|4M|5|6|7|GI|8|@]|9|@]|C|$]]|$1|4N|3|4O|5|2O|7|GJ|8|@]|9|@]|C|$2P|2Q]]|$1|4P|3|4Q|5|6|7|GK|8|@]|9|@]|C|$]]|$1|4R|3|4S|5|2O|7|GL|8|@]|9|@]|C|$2P|2Q]]|$1|4T|3|4U|5|46|7|GM|8|@]|9|@]|C|$]]|$1|4V|3|4W|5|6|7|GN|8|@]|9|@]|C|$]]|$1|4X|3|4Y|5|2O|7|GO|8|@]|9|@]|C|$2P|2Q]]|$1|4Z|3|50|5|6|7|GP|8|@]|9|@]|C|$]]|$1|51|3|52|5|2O|7|GQ|8|@]|9|@]|C|$2P|2Q]]|$1|53|3|54|5|S|7|GR|8|@]|9|@]|C|$]]|$1|55|3|56|5|6|7|GS|8|@]|9|@$A|GT|B|GU|1|GV]]|C|$]]|$1|57|3|58|5|3P|7|GW|8|@]|9|@]|C|$]]|$1|59|3|5A|5|6|7|GX|8|@]|9|@]|C|$]]|$1|5B|3|5C|5|2O|7|GY|8|@]|9|@]|C|$2P|2Q]]|$1|5D|3|5E|5|3P|7|GZ|8|@]|9|@]|C|$]]|$1|5F|3|5G|5|6|7|H0|8|@]|9|@]|C|$]]|$1|5H|3|5I|5|6|7|H1|8|@]|9|@]|C|$]]|$1|5J|3|5K|5|2O|7|H2|8|@]|9|@]|C|$2P|2Q]]|$1|5L|3|5M|5|6|7|H3|8|@]|9|@]|C|$]]|$1|5N|3|5O|5|2O|7|H4|8|@]|9|@]|C|$2P|2Q]]|$1|5P|3|5Q|5|6|7|H5|8|@]|9|@]|C|$]]|$1|5R|3|5S|5|6|7|H6|8|@]|9|@]|C|$]]|$1|5T|3|5U|5|2O|7|H7|8|@]|9|@]|C|$2P|2Q]]|$1|5V|3|5W|5|46|7|H8|8|@]|9|@]|C|$]]|$1|5X|3|5Y|5|6|7|H9|8|@]|9|@]|C|$]]|$1|5Z|3|60|5|6|7|HA|8|@]|9|@]|C|$]]|$1|61|3|62|5|2O|7|HB|8|@]|9|@]|C|$2P|2Q]]|$1|63|3|64|5|6|7|HC|8|@]|9|@]|C|$]]|$1|65|3|66|5|2O|7|HD|8|@]|9|@]|C|$2P|2Q]]|$1|67|3|68|5|6|7|HE|8|@]|9|@$A|HF|B|HG|1|HH]]|C|$]]|$1|69|3|6A|5|6|7|HI|8|@]|9|@]|C|$]]|$1|6B|3|6C|5|6|7|HJ|8|@]|9|@$A|HK|B|HL|1|HM]]|C|$]]|$1|6D|3|6E|5|6|7|HN|8|@]|9|@]|C|$]]|$1|6F|3|6G|5|2O|7|HO|8|@]|9|@]|C|$2P|2Q]]|$1|6H|3|6I|5|46|7|HP|8|@]|9|@$A|HQ|B|HR|1|HS]]|C|$]]|$1|6J|3|6K|5|6|7|HT|8|@]|9|@]|C|$]]|$1|6L|3|6M|5|6|7|HU|8|@]|9|@]|C|$]]|$1|6N|3|6O|5|2O|7|HV|8|@]|9|@]|C|$2P|2Q]]|$1|6P|3|6Q|5|6|7|HW|8|@]|9|@]|C|$]]|$1|6R|3|6S|5|2O|7|HX|8|@]|9|@]|C|$2P|2Q]]|$1|6T|3|6U|5|6|7|HY|8|@]|9|@]|C|$]]|$1|6V|3|6W|5|6|7|HZ|8|@]|9|@]|C|$]]|$1|6X|3|6Y|5|2O|7|I0|8|@]|9|@]|C|$2P|2Q]]|$1|6Z|3|70|5|46|7|I1|8|@]|9|@]|C|$]]|$1|71|3|72|5|6|7|I2|8|@]|9|@]|C|$]]|$1|73|3|74|5|2O|7|I3|8|@]|9|@]|C|$2P|2Q]]|$1|75|3|76|5|6|7|I4|8|@]|9|@]|C|$]]|$1|77|3|78|5|6|7|I5|8|@]|9|@]|C|$]]|$1|79|3|7A|5|2O|7|I6|8|@]|9|@]|C|$2P|2Q]]|$1|7B|3|7C|5|46|7|I7|8|@]|9|@]|C|$]]|$1|7D|3|7E|5|6|7|I8|8|@]|9|@]|C|$]]|$1|7F|3|7G|5|2O|7|I9|8|@]|9|@]|C|$2P|2Q]]|$1|7H|3|7I|5|6|7|IA|8|@]|9|@]|C|$]]|$1|7J|3|7K|5|6|7|IB|8|@]|9|@]|C|$]]|$1|7L|3|7M|5|2O|7|IC|8|@]|9|@]|C|$2P|2Q]]|$1|7N|3|7O|5|46|7|ID|8|@]|9|@]|C|$]]|$1|7P|3|7Q|5|6|7|IE|8|@]|9|@]|C|$]]|$1|7R|3|7S|5|2O|7|IF|8|@]|9|@]|C|$2P|2Q]]|$1|7T|3|7U|5|6|7|IG|8|@]|9|@]|C|$]]|$1|7V|3|7W|5|6|7|IH|8|@]|9|@]|C|$]]|$1|7X|3|7Y|5|2O|7|II|8|@]|9|@]|C|$2P|2Q]]|$1|7Z|3|48|5|6|7|IJ|8|@]|9|@]|C|$]]|$1|80|3|81|5|2O|7|IK|8|@]|9|@]|C|$2P|2Q]]|$1|82|3|83|5|6|7|IL|8|@]|9|@]|C|$]]|$1|84|3|85|5|2O|7|IM|8|@]|9|@]|C|$2P|2Q]]|$1|86|3|87|5|3P|7|IN|8|@]|9|@]|C|$]]|$1|88|3|89|5|6|7|IO|8|@]|9|@]|C|$]]|$1|8A|3|8B|5|2O|7|IP|8|@]|9|@]|C|$2P|2Q]]|$1|8C|3|8D|5|46|7|IQ|8|@]|9|@$A|IR|B|IS|1|IT]]|C|$]]|$1|8E|3|8F|5|6|7|IU|8|@]|9|@]|C|$]]|$1|8G|3|8H|5|2O|7|IV|8|@]|9|@]|C|$2P|2Q]]|$1|8I|3|8J|5|6|7|IW|8|@]|9|@]|C|$]]|$1|8K|3|8L|5|2O|7|IX|8|@]|9|@]|C|$2P|2Q]]|$1|8M|3|8N|5|46|7|IY|8|@]|9|@$A|IZ|B|J0|1|J1]]|C|$]]|$1|8O|3|8P|5|6|7|J2|8|@]|9|@]|C|$]]|$1|8Q|3|8R|5|2O|7|J3|8|@]|9|@]|C|$2P|2Q]]|$1|8S|3|8T|5|46|7|J4|8|@]|9|@$A|J5|B|J6|1|J7]]|C|$]]|$1|8U|3|8V|5|6|7|J8|8|@]|9|@]|C|$]]|$1|8W|3|8X|5|2O|7|J9|8|@]|9|@]|C|$2P|2Q]]|$1|8Y|3|8Z|5|6|7|JA|8|@]|9|@]|C|$]]|$1|90|3|91|5|2O|7|JB|8|@]|9|@]|C|$2P|2Q]]|$1|92|3|93|5|6|7|JC|8|@]|9|@]|C|$]]|$1|94|3|95|5|2O|7|JD|8|@]|9|@]|C|$2P|2Q]]|$1|96|3|97|5|46|7|JE|8|@]|9|@]|C|$]]|$1|98|3|99|5|6|7|JF|8|@]|9|@]|C|$]]|$1|9A|3|9B|5|2O|7|JG|8|@]|9|@]|C|$2P|2Q]]|$1|9C|3|9D|5|6|7|JH|8|@]|9|@]|C|$]]|$1|9E|3|9F|5|2O|7|JI|8|@]|9|@]|C|$2P|2Q]]|$1|9G|3|9H|5|46|7|JJ|8|@]|9|@]|C|$]]|$1|9I|3|9J|5|6|7|JK|8|@]|9|@]|C|$]]|$1|9K|3|9L|5|2O|7|JL|8|@]|9|@]|C|$2P|2Q]]|$1|9M|3|9N|5|S|7|JM|8|@]|9|@]|C|$]]|$1|9O|3|9P|5|6|7|JN|8|@]|9|@$A|JO|B|JP|1|JQ]]|C|$]]|$1|9Q|3|9R|5|6|7|JR|8|@]|9|@]|C|$]]|$1|9S|3|9T|5|2O|7|JS|8|@]|9|@]|C|$2P|2Q]]|$1|9U|3|9V|5|3P|7|JT|8|@]|9|@]|C|$]]|$1|9W|3|5A|5|6|7|JU|8|@]|9|@]|C|$]]|$1|9X|3|9Y|5|2O|7|JV|8|@]|9|@]|C|$2P|2Q]]|$1|9Z|3|A0|5|3P|7|JW|8|@]|9|@]|C|$]]|$1|A1|3|A2|5|6|7|JX|8|@]|9|@]|C|$]]|$1|A3|3|A4|5|2O|7|JY|8|@]|9|@]|C|$2P|2Q]]|$1|A5|3|A6|5|6|7|JZ|8|@]|9|@]|C|$]]|$1|A7|3|A8|5|2O|7|K0|8|@]|9|@]|C|$2P|2Q]]|$1|A9|3|AA|5|6|7|K1|8|@]|9|@]|C|$]]|$1|AB|3|AC|5|3P|7|K2|8|@]|9|@]|C|$]]|$1|AD|3|AE|5|6|7|K3|8|@]|9|@]|C|$]]|$1|AF|3|AG|5|2O|7|K4|8|@]|9|@]|C|$2P|2Q]]|$1|AH|3|AI|5|6|7|K5|8|@]|9|@]|C|$]]|$1|AJ|3|AK|5|2O|7|K6|8|@]|9|@]|C|$2P|2Q]]|$1|AL|3|AM|5|6|7|K7|8|@]|9|@]|C|$]]|$1|AN|3|AO|5|2O|7|K8|8|@]|9|@]|C|$2P|2Q]]|$1|AP|3|AQ|5|S|7|K9|8|@]|9|@]|C|$]]|$1|AR|3|AS|5|6|7|KA|8|@]|9|@]|C|$]]|$1|AT|3|AU|5|3P|7|KB|8|@]|9|@]|C|$]]|$1|AV|3|AW|5|6|7|KC|8|@]|9|@$A|KD|B|KE|1|KF]|$A|KG|B|KH|1|KI]]|C|$]]|$1|AX|3|AY|5|6|7|KJ|8|@]|9|@]|C|$]]|$1|AZ|3|B0|5|2O|7|KK|8|@]|9|@]|C|$2P|2Q]]|$1|B1|3|B2|5|6|7|KL|8|@]|9|@]|C|$]]|$1|B3|3|B4|5|2O|7|KM|8|@]|9|@]|C|$2P|2Q]]|$1|B5|3|48|5|6|7|KN|8|@]|9|@]|C|$]]|$1|B6|3|B7|5|2O|7|KO|8|@]|9|@]|C|$2P|2Q]]|$1|B8|3|B9|5|6|7|KP|8|@]|9|@]|C|$]]|$1|BA|3|BB|5|2O|7|KQ|8|@]|9|@]|C|$2P|2Q]]|$1|BC|3|BD|5|6|7|KR|8|@]|9|@]|C|$]]|$1|BE|3|BF|5|2O|7|KS|8|@]|9|@]|C|$2P|2Q]]|$1|BG|3|BH|5|6|7|KT|8|@]|9|@]|C|$]]|$1|BI|3|BJ|5|2O|7|KU|8|@]|9|@]|C|$2P|2Q]]|$1|BK|3|BL|5|3P|7|KV|8|@]|9|@]|C|$]]|$1|BM|3|BN|5|6|7|KW|8|@]|9|@$A|KX|B|KY|1|KZ]]|C|$]]|$1|BO|3|BP|5|6|7|L0|8|@]|9|@]|C|$]]|$1|BQ|3|BR|5|2O|7|L1|8|@]|9|@]|C|$2P|2Q]]|$1|BS|3|BT|5|S|7|L2|8|@]|9|@]|C|$]]|$1|BU|3|BV|5|6|7|L3|8|@]|9|@]|C|$]]|$1|BW|3|BX|5|6|7|L4|8|@]|9|@]|C|$]]|$1|BY|3|BZ|5|2O|7|L5|8|@]|9|@]|C|$2P|2Q]]|$1|C0|3|C1|5|6|7|L6|8|@]|9|@]|C|$]]|$1|C2|3|C3|5|2O|7|L7|8|@]|9|@]|C|$2P|2Q]]|$1|C4|3|C5|5|6|7|L8|8|@]|9|@]|C|$]]|$1|C6|3|C7|5|2O|7|L9|8|@]|9|@]|C|$2P|2Q]]|$1|C8|3|C9|5|6|7|LA|8|@]|9|@]|C|$]]|$1|CA|3|CB|5|2O|7|LB|8|@]|9|@]|C|$2P|2Q]]|$1|CC|3|CD|5|46|7|LC|8|@]|9|@]|C|$]]|$1|CE|3|CF|5|6|7|LD|8|@]|9|@]|C|$]]|$1|CG|3|CH|5|2O|7|LE|8|@]|9|@]|C|$2P|2Q]]|$1|CI|3|CJ|5|6|7|LF|8|@]|9|@]|C|$]]|$1|CK|3|CL|5|2O|7|LG|8|@]|9|@]|C|$2P|2Q]]|$1|CM|3|CN|5|6|7|LH|8|@]|9|@]|C|$]]|$1|CO|3|CP|5|2O|7|LI|8|@]|9|@]|C|$2P|2Q]]|$1|CQ|3|CR|5|6|7|LJ|8|@]|9|@$A|LK|B|LL|1|LM]]|C|$]]|$1|CS|3|CT|5|S|7|LN|8|@]|9|@]|C|$]]|$1|CU|3|CV|5|6|7|LO|8|@]|9|@]|C|$]]|$1|CW|3|CX|5|3P|7|LP|8|@]|9|@]|C|$]]|$1|CY|3|CZ|5|6|7|LQ|8|@]|9|@]|C|$]]|$1|D0|3|D1|5|6|7|LR|8|@]|9|@]|C|$]]|$1|D2|3|D3|5|2O|7|LS|8|@]|9|@]|C|$2P|2Q]]|$1|D4|3|D5|5|6|7|LT|8|@]|9|@]|C|$]]|$1|D6|3|D7|5|2O|7|LU|8|@]|9|@]|C|$2P|2Q]]|$1|D8|3|D9|5|46|7|LV|8|@]|9|@]|C|$]]|$1|DA|3|DB|5|6|7|LW|8|@]|9|@]|C|$]]|$1|DC|3|DD|5|3P|7|LX|8|@]|9|@]|C|$]]|$1|DE|3|DF|5|6|7|LY|8|@]|9|@$A|LZ|B|M0|1|M1]]|C|$]]|$1|DG|3|DH|5|6|7|M2|8|@]|9|@]|C|$]]|$1|DI|3|DJ|5|2O|7|M3|8|@]|9|@]|C|$2P|2Q]]|$1|DK|3|DL|5|6|7|M4|8|@]|9|@]|C|$]]|$1|DM|3|DN|5|S|7|M5|8|@]|9|@]|C|$]]|$1|DO|3|DP|5|6|7|M6|8|@]|9|@]|C|$]]|$1|DQ|3|DR|5|2O|7|M7|8|@]|9|@]|C|$2P|2Q]]|$1|DS|3|DT|5|46|7|M8|8|@]|9|@]|C|$]]|$1|DU|3|DV|5|6|7|M9|8|@]|9|@]|C|$]]|$1|DW|3|DX|5|3P|7|MA|8|@]|9|@]|C|$]]|$1|DY|3|DZ|5|6|7|MB|8|@]|9|@]|C|$]]|$1|E0|3|E1|5|2O|7|MC|8|@]|9|@]|C|$2P|2Q]]]|1C|$E2|$5|E3|E4|E5|C|$E6|E7]]|1V|$5|E3|E4|E5|C|$E6|E8]]|E9|$5|E3|E4|E5|C|$E6|EA]]|EB|$5|E3|E4|E5|C|$E6|EC]]|ED|$5|E3|E4|E5|C|$E6|EE]]|EF|$5|E3|E4|E5|C|$E6|EG]]|EH|$5|E3|E4|E5|C|$E6|EI]]|EJ|$5|E3|E4|E5|C|$E6|EK]]|EL|$5|E3|E4|E5|C|$E6|EM]]|EN|$5|E3|E4|E5|C|$E6|EI]]|EO|$5|E3|E4|E5|C|$E6|EP]]|EQ|$5|E3|E4|E5|C|$E6|ER]]|ES|$5|E3|E4|E5|C|$E6|ET]]|EU|$5|E3|E4|E5|C|$E6|EV]]|EW|$5|E3|E4|E5|C|$E6|EX]]]]","plain":"Kubernetes 提供了许多云端平台与操作系统的安装方式，本章将以全手动安装方式来部署，主要是学习与了解 Kubernetes 创建流程。若想要了解更多平台的部署可以参考 Picking the Right Solution来选择自己最喜欢的方式。\n本次安装版本为：\nKubernetes v1.8.2\nEtcd v3.2.9\nCalico v2.6.2\nDocker v17.10.0-ce\n预先准备信息\n本教程将以下列节点数与规格来进行部署 Kubernetes 集群，操作系统可采用Ubuntu 16.x与CentOS 7.x：\nIP Address\tRole\tCPU\tMemory\n172.16.35.12\tmaster1\t1\t2G\n172.16.35.10\tnode1\t1\t2G\n\n这边 master 为主要控制节点也是部署节点，node 为应用程序工作节点。\n所有操作全部用root使用者进行，以 SRE 来说不推荐。\n可以下载 Vagrantfile 来建立 Virtual box 虚拟机集群。\n首先安装前要确认以下几项都已将准备完成：\n所有节点彼此网络互通，并且master1 SSH 登入其他节点为 passwdless。\n所有防火墙与 SELinux 已关闭。如 CentOS：\n$ systemctl stop firewalld && systemctl disable firewalld\n$ setenforce 0\n$ vim /etc/selinux/config\nSELINUX=disabled&& systemctl disable firewalld\n$ setenforce 0\n$ vim /etc/selinux/config\nSELINUX=disabled\n所有节点需要设定/etc/host解析到所有主机。\n...\n172.16.35.10 node1\n172.16.35.12 master1\n172.16.35.10 node1\n172.16.35.12 master1\n所有节点需要安装Docker或rtk引擎。这边采用Docker来当作容器引擎，安装方式如下：\n$ curl -fsSL \"https://get.docker.com/\" | sh\n不管是在 Ubuntu 或 CentOS 都只需要执行该指令就会自动安装最新版 Docker。\n CentOS 安装完成后，需要再执行以下指令：\n$ systemctl enable docker && systemctl start docker\n编辑/lib/systemd/system/docker.service，在ExecStart=..上面加入：\nExecStartPost=/sbin/iptables -I FORWARD -s 0.0.0.0/0 -j ACCEPT=/sbin/iptables -I FORWARD -s 0.0.0.0/0 -j ACCEPT\n完成后，重新启动 docker 服务：\n$ systemctl daemon-reload && systemctl restart docker\n所有节点需要设定/etc/sysctl.d/k8s.conf的系统参数。\n$ cat \u003C\u003CEOF \u003E /etc/sysctl.d/k8s.conf\nnet.ipv4.ip_forward = 1\nnet.bridge.bridge-nf-call-ip6tables = 1\nnet.bridge.bridge-nf-call-iptables = 1\nEOF\n\n$ sysctl -p /etc/sysctl.d/k8s.conf\u003C\u003CEOF \u003E /etc/sysctl.d/k8s.conf\nnet.ipv4.ip_forward = 1\nnet.bridge.bridge-nf-call-ip6tables = 1\nnet.bridge.bridge-nf-call-iptables = 1\nEOF\n\n$ sysctl -p /etc/sysctl.d/k8s.conf\n在master1需要安装CFSSL工具，这将会用来建立 TLS certificates。\n$ export CFSSL_URL=\"https://pkg.cfssl.org/R1.2\"\n$ wget \"${CFSSL_URL}/cfssl_linux-amd64\" -O /usr/local/bin/cfssl\n$ wget \"${CFSSL_URL}/cfssljson_linux-amd64\" -O /usr/local/bin/cfssljson\n$ chmod +x /usr/local/bin/cfssl /usr/local/bin/cfssljsonexport CFSSL_URL=\"https://pkg.cfssl.org/R1.2\"\n$ wget \"${CFSSL_URL}/cfssl_linux-amd64\" -O /usr/local/bin/cfssl\n$ wget \"${CFSSL_URL}/cfssljson_linux-amd64\" -O /usr/local/bin/cfssljson\n$ chmod +x /usr/local/bin/cfssl /usr/local/bin/cfssljson\nEtcd\n在开始安装 Kubernetes 之前，需要先将一些必要系统创建完成，其中 Etcd 就是 Kubernetes 最重要的一环，Kubernetes 会将大部分信息储存于 Etcd 上，来提供给其他节点索取，以确保整个集群运作与沟通正常。\n创建集群 CA 与 Certificates\n在这部分，将会需要产生 client 与 server 的各组件 certificates，并且替 Kubernetes admin user 产生 client 证书。\n建立/etc/etcd/ssl文件夹，然后进入目录完成以下操作。\n$ mkdir -p /etc/etcd/ssl && cd /etc/etcd/ssl\n$ export PKI_URL=\"https://kairen.github.io/files/manual-v1.8/pki\"-p /etc/etcd/ssl && cd /etc/etcd/ssl\n$ export PKI_URL=\"https://kairen.github.io/files/manual-v1.8/pki\"\n下载ca-config.json与etcd-ca-csr.json文件，并产生 CA 密钥：\n$ wget \"${PKI_URL}/ca-config.json\" \"${PKI_URL}/etcd-ca-csr.json\"\n$ cfssl gencert -initca etcd-ca-csr.json | cfssljson -bare etcd-ca\n$ ls etcd-ca*.pem\netcd-ca-key.pem  etcd-ca.pem\"${PKI_URL}/ca-config.json\" \"${PKI_URL}/etcd-ca-csr.json\"\n$ cfssl gencert -initca etcd-ca-csr.json | cfssljson -bare etcd-ca\n$ ls etcd-ca*.pem\netcd-ca-key.pem  etcd-ca.pem\n下载etcd-csr.json文件，并产生 kube-apiserver certificate 证书：\n$ wget \"${PKI_URL}/etcd-csr.json\"\n$ cfssl gencert \\\n  -ca=etcd-ca.pem \\\n  -ca-key=etcd-ca-key.pem \\\n  -config=ca-config.json \\\n  -profile=kubernetes \\\n  etcd-csr.json | cfssljson -bare etcd\n\n$ ls etcd*.pem\netcd-ca-key.pem  etcd-ca.pem  etcd-key.pem  etcd.pe\"${PKI_URL}/etcd-csr.json\"\n$ cfssl gencert \\\n  -ca=etcd-ca.pem \\\n  -ca-key=etcd-ca-key.pem \\\n  -config=ca-config.json \\\n  -profile=kubernetes \\\n  etcd-csr.json | cfssljson -bare etcd\n\n$ ls etcd*.pem\netcd-ca-key.pem  etcd-ca.pem  etcd-key.pem  etcd.pe\n 若节点 IP 不同，需要修改etcd-csr.json的hosts。\n \n完成后删除不必要文件：\n$ rm -rf *.json\n确认/etc/etcd/ssl有以下文件：\n$ ls /etc/etcd/ssl\netcd-ca.csr  etcd-ca-key.pem  etcd-ca.pem  etcd.csr  etcd-key.pem  etcd.pem/etc/etcd/ssl\netcd-ca.csr  etcd-ca-key.pem  etcd-ca.pem  etcd.csr  etcd-key.pem  etcd.pem\nEtcd 安装与设定\n首先在master1节点下载 Etcd，并解压缩放到 /opt 底下与安装：\n$ export ETCD_URL=\"https://github.com/coreos/etcd/releases/download\"\n$ cd && wget -qO- --show-progress \"${ETCD_URL}/v3.2.9/etcd-v3.2.9-linux-amd64.tar.gz\" | tar -zx\n$ mv etcd-v3.2.9-linux-amd64/etcd* /usr/local/bin/ && rm -rf etcd-v3.2.9-linux-amd64export ETCD_URL=\"https://github.com/coreos/etcd/releases/download\"\n$ cd && wget -qO- --show-progress \"${ETCD_URL}/v3.2.9/etcd-v3.2.9-linux-amd64.tar.gz\" | tar -zx\n$ mv etcd-v3.2.9-linux-amd64/etcd* /usr/local/bin/ && rm -rf etcd-v3.2.9-linux-amd64\n完成后新建 Etcd Group 与 User，并建立 Etcd 配置文件目录：\n$ groupadd etcd && useradd -c \"Etcd user\" -g etcd -s /sbin/nologin -r etcd&& useradd -c \"Etcd user\" -g etcd -s /sbin/nologin -r etcd\n下载etcd相关文件，我们将来管理 Etcd：\n$ export ETCD_CONF_URL=\"https://kairen.github.io/files/manual-v1.8/master\"\n$ wget \"${ETCD_CONF_URL}/etcd.conf\" -O /etc/etcd/etcd.conf\n$ wget \"${ETCD_CONF_URL}/etcd.service\" -O /lib/systemd/system/etcd.serviceexport ETCD_CONF_URL=\"https://kairen.github.io/files/manual-v1.8/master\"\n$ wget \"${ETCD_CONF_URL}/etcd.conf\" -O /etc/etcd/etcd.conf\n$ wget \"${ETCD_CONF_URL}/etcd.service\" -O /lib/systemd/system/etcd.service\n 若与该教程 IP 不同的话，请用自己 IP 取代172.16.35.12。\n \n建立 var 存放信息，然后启动 Etcd 服务:\n$ mkdir -p /var/lib/etcd && chown etcd:etcd -R /var/lib/etcd /etc/etcd\n$ systemctl enable etcd.service && systemctl start etcd.service-p /var/lib/etcd && chown etcd:etcd -R /var/lib/etcd /etc/etcd\n$ systemctl enable etcd.service && systemctl start etcd.service\n通过简单指令验证：\n$ export CA=\"/etc/etcd/ssl\"\n$ ETCDCTL_API=3 etcdctl \\\n    --cacert=${CA}/etcd-ca.pem \\\n    --cert=${CA}/etcd.pem \\\n    --key=${CA}/etcd-key.pem \\\n    --endpoints=\"https://172.16.35.12:2379\" \\\n    endpoint health\n# output\nhttps://172.16.35.12:2379 is healthy: successfully committed proposal: took = 641.36µsexport CA=\"/etc/etcd/ssl\"\n$ ETCDCTL_API=3 etcdctl \\\n    --cacert=${CA}/etcd-ca.pem \\\n    --cert=${CA}/etcd.pem \\\n    --key=${CA}/etcd-key.pem \\\n    --endpoints=\"https://172.16.35.12:2379\" \\\n    endpoint health\n# output\nhttps://172.16.35.12:2379 is healthy: successfully committed proposal: took = 641.36µs\nKubernetes Master\nMaster 是 Kubernetes 的大总管，主要创建apiserver、Controller manager与Scheduler来组件管理所有 Node。本步骤将下载 Kubernetes 并安装至 master1上，然后产生相关 TLS Cert 与 CA 密钥，提供给集群组件认证使用。\n下载 Kubernetes 组件\n首先通过网络取得所有需要的执行文件：\n# Download Kubernetes\n$ export KUBE_URL=\"https://storage.googleapis.com/kubernetes-release/release/v1.8.2/bin/linux/amd64\"\n$ wget \"${KUBE_URL}/kubelet\" -O /usr/local/bin/kubelet\n$ wget \"${KUBE_URL}/kubectl\" -O /usr/local/bin/kubectl\n$ chmod +x /usr/local/bin/kubelet /usr/local/bin/kubectl\n\n# Download CNI\n$ mkdir -p /opt/cni/bin && cd /opt/cni/bin\n$ export CNI_URL=\"https://github.com/containernetworking/plugins/releases/download\"\n$ wget -qO- --show-progress \"${CNI_URL}/v0.6.0/cni-plugins-amd64-v0.6.0.tgz\" | tar -zx\n$ export KUBE_URL=\"https://storage.googleapis.com/kubernetes-release/release/v1.8.2/bin/linux/amd64\"\n$ wget \"${KUBE_URL}/kubelet\" -O /usr/local/bin/kubelet\n$ wget \"${KUBE_URL}/kubectl\" -O /usr/local/bin/kubectl\n$ chmod +x /usr/local/bin/kubelet /usr/local/bin/kubectl\n\n# Download CNI\n$ mkdir -p /opt/cni/bin && cd /opt/cni/bin\n$ export CNI_URL=\"https://github.com/containernetworking/plugins/releases/download\"\n$ wget -qO- --show-progress \"${CNI_URL}/v0.6.0/cni-plugins-amd64-v0.6.0.tgz\" | tar -zx\n创建集群 CA 与 Certificates\n在这部分，将会需要生成 client 与 server 的各组件 certificates，并且替 Kubernetes admin user 生成 client 证书。\n创建pki文件夹，然后进入目录完成以下操作。\n$ mkdir -p /etc/kubernetes/pki && cd /etc/kubernetes/pki\n$ export PKI_URL=\"https://kairen.github.io/files/manual-v1.8/pki\"\n$ export KUBE_APISERVER=\"https://172.16.35.12:6443\"-p /etc/kubernetes/pki && cd /etc/kubernetes/pki\n$ export PKI_URL=\"https://kairen.github.io/files/manual-v1.8/pki\"\n$ export KUBE_APISERVER=\"https://172.16.35.12:6443\"\n下载ca-config.json与ca-csr.json文件，并生成 CA 密钥：\n$ wget \"${PKI_URL}/ca-config.json\" \"${PKI_URL}/ca-csr.json\"\n$ cfssl gencert -initca ca-csr.json | cfssljson -bare ca\n$ ls ca*.pem\nca-key.pem  ca.pem\"${PKI_URL}/ca-config.json\" \"${PKI_URL}/ca-csr.json\"\n$ cfssl gencert -initca ca-csr.json | cfssljson -bare ca\n$ ls ca*.pem\nca-key.pem  ca.pem\nAPI server certificate\n下载apiserver-csr.json文件，并生成 kube-apiserver certificate 证书：\n$ wget \"${PKI_URL}/apiserver-csr.json\"\n$ cfssl gencert \\\n  -ca=ca.pem \\\n  -ca-key=ca-key.pem \\\n  -config=ca-config.json \\\n  -hostname=10.96.0.1,172.16.35.12,127.0.0.1,kubernetes.default \\\n  -profile=kubernetes \\\n  apiserver-csr.json | cfssljson -bare apiserver\n\n$ ls apiserver*.pem\napiserver-key.pem  apiserver.pem\"${PKI_URL}/apiserver-csr.json\"\n$ cfssl gencert \\\n  -ca=ca.pem \\\n  -ca-key=ca-key.pem \\\n  -config=ca-config.json \\\n  -hostname=10.96.0.1,172.16.35.12,127.0.0.1,kubernetes.default \\\n  -profile=kubernetes \\\n  apiserver-csr.json | cfssljson -bare apiserver\n\n$ ls apiserver*.pem\napiserver-key.pem  apiserver.pem\n 若节点 IP 不同，需要修改apiserver-csr.json的hosts。\n \nFront proxy certificate\n下载front-proxy-ca-csr.json文件，并生成 Front proxy CA 密钥，Front proxy 主要是用在 API aggregator 上:\n$ wget \"${PKI_URL}/front-proxy-ca-csr.json\"\n$ cfssl gencert \\\n  -initca front-proxy-ca-csr.json | cfssljson -bare front-proxy-ca\n\n$ ls front-proxy-ca*.pem\nfront-proxy-ca-key.pem  front-proxy-ca.pem\"${PKI_URL}/front-proxy-ca-csr.json\"\n$ cfssl gencert \\\n  -initca front-proxy-ca-csr.json | cfssljson -bare front-proxy-ca\n\n$ ls front-proxy-ca*.pem\nfront-proxy-ca-key.pem  front-proxy-ca.pem\n下载front-proxy-client-csr.json文件，并生成 front-proxy-client 证书：\n$ wget \"${PKI_URL}/front-proxy-client-csr.json\"\n$ cfssl gencert \\\n  -ca=front-proxy-ca.pem \\\n  -ca-key=front-proxy-ca-key.pem \\\n  -config=ca-config.json \\\n  -profile=kubernetes \\\n  front-proxy-client-csr.json | cfssljson -bare front-proxy-client\n\n$ ls front-proxy-client*.pem\nfront-proxy-client-key.pem  front-proxy-client.pem\"${PKI_URL}/front-proxy-client-csr.json\"\n$ cfssl gencert \\\n  -ca=front-proxy-ca.pem \\\n  -ca-key=front-proxy-ca-key.pem \\\n  -config=ca-config.json \\\n  -profile=kubernetes \\\n  front-proxy-client-csr.json | cfssljson -bare front-proxy-client\n\n$ ls front-proxy-client*.pem\nfront-proxy-client-key.pem  front-proxy-client.pem\nBootstrap Token\n由于通过手动创建 CA 方式太过繁杂，只适合少量机器，因为每次签证时都需要绑定 Node IP，随机器增加会带来很多困扰，因此这边使用 TLS Bootstrapping 方式进行授权，由 apiserver 自动给符合条件的 Node 发送证书来授权加入集群。\n主要做法是 kubelet 启动时，向 kube-apiserver 传送 TLS Bootstrapping 请求，而 kube-apiserver 验证 kubelet 请求的 token 是否与设定的一样，若一样就自动产生 kubelet 证书与密钥。具体作法可以参考 TLS bootstrapping。\n首先建立一个变量来产生BOOTSTRAP_TOKEN，并建立 bootstrap.conf 的 kubeconfig 文件：\n$ export BOOTSTRAP_TOKEN=$(head -c 16 /dev/urandom | od -An -t x | tr -d ' ')\n$ cat \u003C\u003CEOF \u003E /etc/kubernetes/token.csv\n${BOOTSTRAP_TOKEN},kubelet-bootstrap,10001,\"system:kubelet-bootstrap\"\nEOF\n\n# bootstrap set-cluster\n$ kubectl config set-cluster kubernetes \\\n    --certificate-authority=ca.pem \\\n    --embed-certs=true \\\n    --server=${KUBE_APISERVER} \\\n    --kubeconfig=../bootstrap.conf\n\n# bootstrap set-credentials\n$ kubectl config set-credentials kubelet-bootstrap \\\n    --token=${BOOTSTRAP_TOKEN} \\\n    --kubeconfig=../bootstrap.conf\n\n# bootstrap set-context\n$ kubectl config set-context default \\\n    --cluster=kubernetes \\\n    --user=kubelet-bootstrap \\\n   --kubeconfig=../bootstrap.conf\n\n# bootstrap set default context\n$ kubectl config use-context default --kubeconfig=../bootstrap.confexport BOOTSTRAP_TOKEN=$(head -c 16 /dev/urandom | od -An -t x | tr -d ' ')\n$ cat \u003C\u003CEOF \u003E /etc/kubernetes/token.csv\n${BOOTSTRAP_TOKEN},kubelet-bootstrap,10001,\"system:kubelet-bootstrap\"\nEOF\n\n# bootstrap set-cluster\n$ kubectl config set-cluster kubernetes \\\n    --certificate-authority=ca.pem \\\n    --embed-certs=true \\\n    --server=${KUBE_APISERVER} \\\n    --kubeconfig=../bootstrap.conf\n\n# bootstrap set-credentials\n$ kubectl config set-credentials kubelet-bootstrap \\\n    --token=${BOOTSTRAP_TOKEN} \\\n    --kubeconfig=../bootstrap.conf\n\n# bootstrap set-context\n$ kubectl config set-context default \\\n    --cluster=kubernetes \\\n    --user=kubelet-bootstrap \\\n   --kubeconfig=../bootstrap.conf\n\n# bootstrap set default context\n$ kubectl config use-context default --kubeconfig=../bootstrap.conf\n 若想要用 CA 方式来认证，可以参考 Kubelet certificate。\n \nAdmin certificate\n下载admin-csr.json文件，并生成 admin certificate 证书：\n$ wget \"${PKI_URL}/admin-csr.json\"\n$ cfssl gencert \\\n  -ca=ca.pem \\\n  -ca-key=ca-key.pem \\\n  -config=ca-config.json \\\n  -profile=kubernetes \\\n  admin-csr.json | cfssljson -bare admin\n\n$ ls admin*.pem\nadmin-key.pem  admin.pem\"${PKI_URL}/admin-csr.json\"\n$ cfssl gencert \\\n  -ca=ca.pem \\\n  -ca-key=ca-key.pem \\\n  -config=ca-config.json \\\n  -profile=kubernetes \\\n  admin-csr.json | cfssljson -bare admin\n\n$ ls admin*.pem\nadmin-key.pem  admin.pem\n接着通过以下指令生成名称为 admin.conf 的 kubeconfig 文件：\n# admin set-cluster\n$ kubectl config set-cluster kubernetes \\\n    --certificate-authority=ca.pem \\\n    --embed-certs=true \\\n    --server=${KUBE_APISERVER} \\\n    --kubeconfig=../admin.conf\n\n# admin set-credentials\n$ kubectl config set-credentials kubernetes-admin \\\n    --client-certificate=admin.pem \\\n    --client-key=admin-key.pem \\\n    --embed-certs=true \\\n    --kubeconfig=../admin.conf\n\n# admin set-context\n$ kubectl config set-context kubernetes-admin@kubernetes \\\n    --cluster=kubernetes \\\n    --user=kubernetes-admin \\\n    --kubeconfig=../admin.conf\n\n# admin set default context\n$ kubectl config use-context kubernetes-admin@kubernetes \\\n    --kubeconfig=../admin.conf\n$ kubectl config set-cluster kubernetes \\\n    --certificate-authority=ca.pem \\\n    --embed-certs=true \\\n    --server=${KUBE_APISERVER} \\\n    --kubeconfig=../admin.conf\n\n# admin set-credentials\n$ kubectl config set-credentials kubernetes-admin \\\n    --client-certificate=admin.pem \\\n    --client-key=admin-key.pem \\\n    --embed-certs=true \\\n    --kubeconfig=../admin.conf\n\n# admin set-context\n$ kubectl config set-context kubernetes-admin@kubernetes \\\n    --cluster=kubernetes \\\n    --user=kubernetes-admin \\\n    --kubeconfig=../admin.conf\n\n# admin set default context\n$ kubectl config use-context kubernetes-admin@kubernetes \\\n    --kubeconfig=../admin.conf\nController manager certificate\n下载manager-csr.json文件，并生成 kube-controller-manager certificate 证书：\n$ wget \"${PKI_URL}/manager-csr.json\"\n$ cfssl gencert \\\n  -ca=ca.pem \\\n  -ca-key=ca-key.pem \\\n  -config=ca-config.json \\\n  -profile=kubernetes \\\n  manager-csr.json | cfssljson -bare controller-manager\n\n$ ls controller-manager*.pem\"${PKI_URL}/manager-csr.json\"\n$ cfssl gencert \\\n  -ca=ca.pem \\\n  -ca-key=ca-key.pem \\\n  -config=ca-config.json \\\n  -profile=kubernetes \\\n  manager-csr.json | cfssljson -bare controller-manager\n\n$ ls controller-manager*.pem\n 若节点 IP 不同，需要修改manager-csr.json的hosts。\n \n接着通过以下指令生成名称为controller-manager.conf的 kubeconfig 文件：\n# controller-manager set-cluster\n$ kubectl config set-cluster kubernetes \\\n    --certificate-authority=ca.pem \\\n    --embed-certs=true \\\n    --server=${KUBE_APISERVER} \\\n    --kubeconfig=../controller-manager.conf\n\n# controller-manager set-credentials\n$ kubectl config set-credentials system:kube-controller-manager \\\n    --client-certificate=controller-manager.pem \\\n    --client-key=controller-manager-key.pem \\\n    --embed-certs=true \\\n    --kubeconfig=../controller-manager.conf\n\n# controller-manager set-context\n$ kubectl config set-context system:kube-controller-manager@kubernetes \\\n    --cluster=kubernetes \\\n    --user=system:kube-controller-manager \\\n    --kubeconfig=../controller-manager.conf\n\n# controller-manager set default context\n$ kubectl config use-context system:kube-controller-manager@kubernetes \\\n    --kubeconfig=../controller-manager.conf\n$ kubectl config set-cluster kubernetes \\\n    --certificate-authority=ca.pem \\\n    --embed-certs=true \\\n    --server=${KUBE_APISERVER} \\\n    --kubeconfig=../controller-manager.conf\n\n# controller-manager set-credentials\n$ kubectl config set-credentials system:kube-controller-manager \\\n    --client-certificate=controller-manager.pem \\\n    --client-key=controller-manager-key.pem \\\n    --embed-certs=true \\\n    --kubeconfig=../controller-manager.conf\n\n# controller-manager set-context\n$ kubectl config set-context system:kube-controller-manager@kubernetes \\\n    --cluster=kubernetes \\\n    --user=system:kube-controller-manager \\\n    --kubeconfig=../controller-manager.conf\n\n# controller-manager set default context\n$ kubectl config use-context system:kube-controller-manager@kubernetes \\\n    --kubeconfig=../controller-manager.conf\nScheduler certificate\n下载scheduler-csr.json文件，并生成 kube-scheduler certificate 证书：\n$ wget \"${PKI_URL}/scheduler-csr.json\"\n$ cfssl gencert \\\n  -ca=ca.pem \\\n  -ca-key=ca-key.pem \\\n  -config=ca-config.json \\\n  -profile=kubernetes \\\n  scheduler-csr.json | cfssljson -bare scheduler\n\n$ ls scheduler*.pem\nscheduler-key.pem  scheduler.pem\"${PKI_URL}/scheduler-csr.json\"\n$ cfssl gencert \\\n  -ca=ca.pem \\\n  -ca-key=ca-key.pem \\\n  -config=ca-config.json \\\n  -profile=kubernetes \\\n  scheduler-csr.json | cfssljson -bare scheduler\n\n$ ls scheduler*.pem\nscheduler-key.pem  scheduler.pem\n 若节点 IP 不同，需要修改scheduler-csr.json的hosts。\n \n接着通过以下指令生成名称为 scheduler.conf 的 kubeconfig 文件：\n# scheduler set-cluster\n$ kubectl config set-cluster kubernetes \\\n    --certificate-authority=ca.pem \\\n    --embed-certs=true \\\n    --server=${KUBE_APISERVER} \\\n    --kubeconfig=../scheduler.conf\n\n# scheduler set-credentials\n$ kubectl config set-credentials system:kube-scheduler \\\n    --client-certificate=scheduler.pem \\\n    --client-key=scheduler-key.pem \\\n    --embed-certs=true \\\n    --kubeconfig=../scheduler.conf\n\n# scheduler set-context\n$ kubectl config set-context system:kube-scheduler@kubernetes \\\n    --cluster=kubernetes \\\n    --user=system:kube-scheduler \\\n    --kubeconfig=../scheduler.conf\n\n# scheduler set default context\n$ kubectl config use-context system:kube-scheduler@kubernetes \\\n    --kubeconfig=../scheduler.conf\n$ kubectl config set-cluster kubernetes \\\n    --certificate-authority=ca.pem \\\n    --embed-certs=true \\\n    --server=${KUBE_APISERVER} \\\n    --kubeconfig=../scheduler.conf\n\n# scheduler set-credentials\n$ kubectl config set-credentials system:kube-scheduler \\\n    --client-certificate=scheduler.pem \\\n    --client-key=scheduler-key.pem \\\n    --embed-certs=true \\\n    --kubeconfig=../scheduler.conf\n\n# scheduler set-context\n$ kubectl config set-context system:kube-scheduler@kubernetes \\\n    --cluster=kubernetes \\\n    --user=system:kube-scheduler \\\n    --kubeconfig=../scheduler.conf\n\n# scheduler set default context\n$ kubectl config use-context system:kube-scheduler@kubernetes \\\n    --kubeconfig=../scheduler.conf\nKubelet master certificate\n下载kubelet-csr.json文件，并生成 master node certificate 证书：\n$ wget \"${PKI_URL}/kubelet-csr.json\"\n$ sed -i 's/$NODE/master1/g' kubelet-csr.json\n$ cfssl gencert \\\n  -ca=ca.pem \\\n  -ca-key=ca-key.pem \\\n  -config=ca-config.json \\\n  -hostname=master1,172.16.35.12,172.16.35.12 \\\n  -profile=kubernetes \\\n  kubelet-csr.json | cfssljson -bare kubelet\n\n$ ls kubelet*.pem\nkubelet-key.pem  kubelet.pem\"${PKI_URL}/kubelet-csr.json\"\n$ sed -i 's/$NODE/master1/g' kubelet-csr.json\n$ cfssl gencert \\\n  -ca=ca.pem \\\n  -ca-key=ca-key.pem \\\n  -config=ca-config.json \\\n  -hostname=master1,172.16.35.12,172.16.35.12 \\\n  -profile=kubernetes \\\n  kubelet-csr.json | cfssljson -bare kubelet\n\n$ ls kubelet*.pem\nkubelet-key.pem  kubelet.pem\n 这边$NODE需要随节点名称不同而改变。\n \n接着通过以下指令生成名称为 kubelet.conf 的 kubeconfig 文件：\n# kubelet set-cluster\n$ kubectl config set-cluster kubernetes \\\n    --certificate-authority=ca.pem \\\n    --embed-certs=true \\\n    --server=${KUBE_APISERVER} \\\n    --kubeconfig=../kubelet.conf\n\n# kubelet set-credentials\n$ kubectl config set-credentials system:node:master1 \\\n    --client-certificate=kubelet.pem \\\n    --client-key=kubelet-key.pem \\\n    --embed-certs=true \\\n    --kubeconfig=../kubelet.conf\n\n# kubelet set-context\n$ kubectl config set-context system:node:master1@kubernetes \\\n    --cluster=kubernetes \\\n    --user=system:node:master1 \\\n    --kubeconfig=../kubelet.conf\n\n# kubelet set default context\n$ kubectl config use-context system:node:master1@kubernetes \\\n    --kubeconfig=../kubelet.conf\n$ kubectl config set-cluster kubernetes \\\n    --certificate-authority=ca.pem \\\n    --embed-certs=true \\\n    --server=${KUBE_APISERVER} \\\n    --kubeconfig=../kubelet.conf\n\n# kubelet set-credentials\n$ kubectl config set-credentials system:node:master1 \\\n    --client-certificate=kubelet.pem \\\n    --client-key=kubelet-key.pem \\\n    --embed-certs=true \\\n    --kubeconfig=../kubelet.conf\n\n# kubelet set-context\n$ kubectl config set-context system:node:master1@kubernetes \\\n    --cluster=kubernetes \\\n    --user=system:node:master1 \\\n    --kubeconfig=../kubelet.conf\n\n# kubelet set default context\n$ kubectl config use-context system:node:master1@kubernetes \\\n    --kubeconfig=../kubelet.conf\nService account key\nService account 不是通过 CA 进行认证，因此不要通过 CA 来做 Service account key 的检查，这边建立一组 Private 与 Public 密钥提供给 Service account key 使用：\n$ openssl genrsa -out sa.key 2048\n$ openssl rsa -in sa.key -pubout -out sa.pub\n$ ls sa.*\nsa.key  sa.pub-out sa.key 2048\n$ openssl rsa -in sa.key -pubout -out sa.pub\n$ ls sa.*\nsa.key  sa.pub\n完成后删除不必要文件：\n$ rm -rf *.json *.csr\n确认/etc/kubernetes与/etc/kubernetes/pki有以下文件：\n$ ls /etc/kubernetes/\nadmin.conf  bootstrap.conf  controller-manager.conf  kubelet.conf  pki  scheduler.conf  token.csv\n\n$ ls /etc/kubernetes/pki\nadmin-key.pem  apiserver-key.pem  ca-key.pem  controller-manager-key.pem  front-proxy-ca-key.pem  front-proxy-client-key.pem  kubelet-key.pem  sa.key  scheduler-key.pem\nadmin.pem      apiserver.pem      ca.pem      controller-manager.pem      front-proxy-ca.pem      front-proxy-client.pem      kubelet.pem      sa.pub  scheduler.pem/etc/kubernetes/\nadmin.conf  bootstrap.conf  controller-manager.conf  kubelet.conf  pki  scheduler.conf  token.csv\n\n$ ls /etc/kubernetes/pki\nadmin-key.pem  apiserver-key.pem  ca-key.pem  controller-manager-key.pem  front-proxy-ca-key.pem  front-proxy-client-key.pem  kubelet-key.pem  sa.key  scheduler-key.pem\nadmin.pem      apiserver.pem      ca.pem      controller-manager.pem      front-proxy-ca.pem      front-proxy-client.pem      kubelet.pem      sa.pub  scheduler.pem\n安装 Kubernetes 核心组件\n首先下载 Kubernetes 核心组件 YAML 文件，这边我们不透过 Binary 方案来创建 Master 核心组件，而是利用 Kubernetes Static Pod 来创建，因此需下载所有核心组件的Static Pod文件到/etc/kubernetes/manifests目录：\n$ export CORE_URL=\"https://kairen.github.io/files/manual-v1.8/master\"\n$ mkdir -p /etc/kubernetes/manifests && cd /etc/kubernetes/manifests\n$ for FILE in apiserver manager scheduler; do\n    wget \"${CORE_URL}/${FILE}.yml.conf\" -O ${FILE}.yml\n  doneexport CORE_URL=\"https://kairen.github.io/files/manual-v1.8/master\"\n$ mkdir -p /etc/kubernetes/manifests && cd /etc/kubernetes/manifests\n$ for FILE in apiserver manager scheduler; do\n    wget \"${CORE_URL}/${FILE}.yml.conf\" -O ${FILE}.yml\n  done\n 若IP与教程设定不同的话，请记得修改apiserver.yml、manager.yml、scheduler.yml。\n apiserver 中的 NodeRestriction 请参考 Using Node Authorization。\n \n生成一个用来加密 Etcd 的 Key：\n$ head -c 32 /dev/urandom | base64\nSUpbL4juUYyvxj3/gonV5xVEx8j769/99TSAf8YT/sQ=-c 32 /dev/urandom | base64\nSUpbL4juUYyvxj3/gonV5xVEx8j769/99TSAf8YT/sQ=\n在/etc/kubernetes/目录下，创建encryption.yml的加密 YAML 文件：\n$ cat \u003C\u003CEOF \u003E /etc/kubernetes/encryption.yml\nkind: EncryptionConfig\napiVersion: v1\nresources:\n  - resources:\n      - secrets\n    providers:\n      - aescbc:\n          keys:\n            - name: key1\n              secret: SUpbL4juUYyvxj3/gonV5xVEx8j769/99TSAf8YT/sQ=\n      - identity: {}\nEOF\u003C\u003CEOF \u003E /etc/kubernetes/encryption.yml\nkind: EncryptionConfig\napiVersion: v1\nresources:\n  - resources:\n      - secrets\n    providers:\n      - aescbc:\n          keys:\n            - name: key1\n              secret: SUpbL4juUYyvxj3/gonV5xVEx8j769/99TSAf8YT/sQ=\n      - identity: {}\nEOF\n Etcd 数据加密可参考这篇 Encrypting data at rest。\n \n在/etc/kubernetes/目录下，创建audit-policy.yml的进阶审核策略 YAML 文件：\n$ cat \u003C\u003CEOF \u003E /etc/kubernetes/audit-policy.yml\napiVersion: audit.k8s.io/v1beta1\nkind: Policy\nrules:\n- level: Metadata\nEOF\u003C\u003CEOF \u003E /etc/kubernetes/audit-policy.yml\napiVersion: audit.k8s.io/v1beta1\nkind: Policy\nrules:\n- level: Metadata\nEOF\n Audit Policy 请参考这篇 Auditing。\n \n下载kubelet.service相关文件来管理 kubelet：\n$ export KUBELET_URL=\"https://kairen.github.io/files/manual-v1.8/master\"\n$ mkdir -p /etc/systemd/system/kubelet.service.d\n$ wget \"${KUBELET_URL}/kubelet.service\" -O /lib/systemd/system/kubelet.service\n$ wget \"${KUBELET_URL}/10-kubelet.conf\" -O /etc/systemd/system/kubelet.service.d/10-kubelet.confexport KUBELET_URL=\"https://kairen.github.io/files/manual-v1.8/master\"\n$ mkdir -p /etc/systemd/system/kubelet.service.d\n$ wget \"${KUBELET_URL}/kubelet.service\" -O /lib/systemd/system/kubelet.service\n$ wget \"${KUBELET_URL}/10-kubelet.conf\" -O /etc/systemd/system/kubelet.service.d/10-kubelet.conf\n最后创建 var 存放信息，然后启动 kubelet 服务:\n$ mkdir -p /var/lib/kubelet /var/log/kubernetes\n$ systemctl enable kubelet.service && systemctl start kubelet.service-p /var/lib/kubelet /var/log/kubernetes\n$ systemctl enable kubelet.service && systemctl start kubelet.service\n完成后会需要一段时间来下载镜像文件与启动组件，可以利用该指令来查看：\n$ watch netstat -ntlp\ntcp        0      0 127.0.0.1:10248         0.0.0.0:*               LISTEN      23012/kubelet\ntcp        0      0 127.0.0.1:10251         0.0.0.0:*               LISTEN      22305/kube-schedule\ntcp        0      0 127.0.0.1:10252         0.0.0.0:*               LISTEN      22529/kube-controll\ntcp6       0      0 :::6443                 :::*                    LISTEN      22956/kube-apiserve-ntlp\ntcp        0      0 127.0.0.1:10248         0.0.0.0:*               LISTEN      23012/kubelet\ntcp        0      0 127.0.0.1:10251         0.0.0.0:*               LISTEN      22305/kube-schedule\ntcp        0      0 127.0.0.1:10252         0.0.0.0:*               LISTEN      22529/kube-controll\ntcp6       0      0 :::6443                 :::*                    LISTEN      22956/kube-apiserve\n 若看到以上信息表示服务正常启动，若发生问题可以用docker cli来查看。\n \n完成后，复制 admin kubeconfig 文件，并通过简单指令验证：\n$ cp /etc/kubernetes/admin.conf ~/.kube/config\n$ kubectl get cs\nNAME                 STATUS    MESSAGE              ERROR\netcd-0               Healthy   {\"health\": \"true\"}\nscheduler            Healthy   ok\ncontroller-manager   Healthy   ok\n\n$ kubectl get node\nNAME      STATUS     ROLES     AGE       VERSION\nmaster1   NotReady   master    4m        v1.8.2\n\n$ kubectl -n kube-system get po\nNAME                              READY     STATUS    RESTARTS   AGE\nkube-apiserver-master1            1/1       Running   0          4m\nkube-controller-manager-master1   1/1       Running   0          4m\nkube-scheduler-master1            1/1       Running   0          4m/etc/kubernetes/admin.conf ~/.kube/config\n$ kubectl get cs\nNAME                 STATUS    MESSAGE              ERROR\netcd-0               Healthy   {\"health\": \"true\"}\nscheduler            Healthy   ok\ncontroller-manager   Healthy   ok\n\n$ kubectl get node\nNAME      STATUS     ROLES     AGE       VERSION\nmaster1   NotReady   master    4m        v1.8.2\n\n$ kubectl -n kube-system get po\nNAME                              READY     STATUS    RESTARTS   AGE\nkube-apiserver-master1            1/1       Running   0          4m\nkube-controller-manager-master1   1/1       Running   0          4m\nkube-scheduler-master1            1/1       Running   0          4m\n确认服务能够执行 logs 等指令：\n$ kubectl -n kube-system logs -f kube-scheduler-master1\nError from server (Forbidden): Forbidden (user=kube-apiserver, verb=get, resource=nodes, subresource=proxy) ( pods/log kube-apiserver-master1)-n kube-system logs -f kube-scheduler-master1\nError from server (Forbidden): Forbidden (user=kube-apiserver, verb=get, resource=nodes, subresource=proxy) ( pods/log kube-apiserver-master1)\n 这边会发现出现 403 Forbidden 问题，这是因为 kube-apiserver user 并没有 nodes 的资源权限，属于正常。\n \n由于上述权限问题，我们必需创建一个 apiserver-to-kubelet-rbac.yml 来定义权限，以供我们执行 logs、exec 等指令：\n$ cd /etc/kubernetes/\n$ export URL=\"https://kairen.github.io/files/manual-v1.8/master\"\n$ wget \"${URL}/apiserver-to-kubelet-rbac.yml.conf\" -O apiserver-to-kubelet-rbac.yml\n$ kubectl apply -f apiserver-to-kubelet-rbac.yml\n\n# 測試 logs\n$ kubectl -n kube-system logs -f kube-scheduler-master1\n...\nI1031 03:22:42.527697       1 leaderelection.go:184] successfully acquired lease kube-system/kube-scheduler/etc/kubernetes/\n$ export URL=\"https://kairen.github.io/files/manual-v1.8/master\"\n$ wget \"${URL}/apiserver-to-kubelet-rbac.yml.conf\" -O apiserver-to-kubelet-rbac.yml\n$ kubectl apply -f apiserver-to-kubelet-rbac.yml\n\n# 測試 logs\n$ kubectl -n kube-system logs -f kube-scheduler-master1\n...\nI1031 03:22:42.527697       1 leaderelection.go:184] successfully acquired lease kube-system/kube-scheduler\nKubernetes Node\nNode 是主要执行容器实例的节点，可视为工作节点。在这步骤我们会下载 Kubernetes binary 文件，并创建 node 的 certificate 来提供给节点注册认证用。Kubernetes 使用Node Authorizer来提供Authorization mode，这种授权模式会替 Kubelet 生成 API request。\n在开始前，我们先在master1将需要的 ca 与 cert 复制到 Node 节点上：\n$ for NODE in node1 node2; do\n    ssh ${NODE} \"mkdir -p /etc/kubernetes/pki/\"\n    ssh ${NODE} \"mkdir -p /etc/etcd/ssl\"\n    # Etcd ca and cert\n    for FILE in etcd-ca.pem etcd.pem etcd-key.pem; do\n      scp /etc/etcd/ssl/${FILE} ${NODE}:/etc/etcd/ssl/${FILE}\n    done\n    # Kubernetes ca and cert\n    for FILE in pki/ca.pem pki/ca-key.pem bootstrap.conf; do\n      scp /etc/kubernetes/${FILE} ${NODE}:/etc/kubernetes/${FILE}\n    done\n  donefor NODE in node1 node2; do\n    ssh ${NODE} \"mkdir -p /etc/kubernetes/pki/\"\n    ssh ${NODE} \"mkdir -p /etc/etcd/ssl\"\n    # Etcd ca and cert\n    for FILE in etcd-ca.pem etcd.pem etcd-key.pem; do\n      scp /etc/etcd/ssl/${FILE} ${NODE}:/etc/etcd/ssl/${FILE}\n    done\n    # Kubernetes ca and cert\n    for FILE in pki/ca.pem pki/ca-key.pem bootstrap.conf; do\n      scp /etc/kubernetes/${FILE} ${NODE}:/etc/kubernetes/${FILE}\n    done\n  done\n下载 Kubernetes 组件\n首先通过网络取得所有需要的执行文件：\n# Download Kubernetes\n$ export KUBE_URL=\"https://storage.googleapis.com/kubernetes-release/release/v1.8.2/bin/linux/amd64\"\n$ wget \"${KUBE_URL}/kubelet\" -O /usr/local/bin/kubelet\n$ chmod +x /usr/local/bin/kubelet\n\n# Download CNI\n$ mkdir -p /opt/cni/bin && cd /opt/cni/bin\n$ export CNI_URL=\"https://github.com/containernetworking/plugins/releases/download\"\n$ wget -qO- --show-progress \"${CNI_URL}/v0.6.0/cni-plugins-amd64-v0.6.0.tgz\" | tar -zx\n$ export KUBE_URL=\"https://storage.googleapis.com/kubernetes-release/release/v1.8.2/bin/linux/amd64\"\n$ wget \"${KUBE_URL}/kubelet\" -O /usr/local/bin/kubelet\n$ chmod +x /usr/local/bin/kubelet\n\n# Download CNI\n$ mkdir -p /opt/cni/bin && cd /opt/cni/bin\n$ export CNI_URL=\"https://github.com/containernetworking/plugins/releases/download\"\n$ wget -qO- --show-progress \"${CNI_URL}/v0.6.0/cni-plugins-amd64-v0.6.0.tgz\" | tar -zx\n设定 Kubernetes node\n接着下载 Kubernetes 相关文件，包含 drop-in file、systemd service 档案等：\n$ export KUBELET_URL=\"https://kairen.github.io/files/manual-v1.8/node\"\n$ mkdir -p /etc/systemd/system/kubelet.service.d\n$ wget \"${KUBELET_URL}/kubelet.service\" -O /lib/systemd/system/kubelet.service\n$ wget \"${KUBELET_URL}/10-kubelet.conf\" -O /etc/systemd/system/kubelet.service.d/10-kubelet.confexport KUBELET_URL=\"https://kairen.github.io/files/manual-v1.8/node\"\n$ mkdir -p /etc/systemd/system/kubelet.service.d\n$ wget \"${KUBELET_URL}/kubelet.service\" -O /lib/systemd/system/kubelet.service\n$ wget \"${KUBELET_URL}/10-kubelet.conf\" -O /etc/systemd/system/kubelet.service.d/10-kubelet.conf\n接着在所有node创建 var 存放信息，然后启动 kubelet 服务:\n$ mkdir -p /var/lib/kubelet /var/log/kubernetes /etc/kubernetes/manifests\n$ systemctl enable kubelet.service && systemctl start kubelet.service-p /var/lib/kubelet /var/log/kubernetes /etc/kubernetes/manifests\n$ systemctl enable kubelet.service && systemctl start kubelet.service\nP.S. 重复一样动作来完成其他节点。\n授权 Kubernetes Node\n当所有节点都完成后，在master节点，因为我们采用 TLS Bootstrapping，所需要创建一个 ClusterRoleBinding：\n$ kubectl create clusterrolebinding kubelet-bootstrap \\\n    --clusterrole=system:node-bootstrapper \\\n    --user=kubelet-bootstrap-bootstrap \\\n    --clusterrole=system:node-bootstrapper \\\n    --user=kubelet-bootstrap\n在master通过简单指令验证，会看到节点处于pending：\n$ kubectl get csr\nNAME                                                   AGE       REQUESTOR           CONDITION\nnode-csr-YWf97ZrLCTlr2hmXsNLfjVLwaLfZRsu52FRKOYjpcBE   2s        kubelet-bootstrap   Pending\nnode-csr-eq4q6ffOwT4yqYQNU6sT7mphPOQdFN6yulMVZeu6pkE   2s        kubelet-bootstrap   Pendingget csr\nNAME                                                   AGE       REQUESTOR           CONDITION\nnode-csr-YWf97ZrLCTlr2hmXsNLfjVLwaLfZRsu52FRKOYjpcBE   2s        kubelet-bootstrap   Pending\nnode-csr-eq4q6ffOwT4yqYQNU6sT7mphPOQdFN6yulMVZeu6pkE   2s        kubelet-bootstrap   Pending\n通过 kubectl 来允许节点加入集群：\n$ kubectl get csr | awk '/Pending/ {print $1}' | xargs kubectl certificate approve\ncertificatesigningrequest \"node-csr-YWf97ZrLCTlr2hmXsNLfjVLwaLfZRsu52FRKOYjpcBE\" approved\ncertificatesigningrequest \"node-csr-eq4q6ffOwT4yqYQNU6sT7mphPOQdFN6yulMVZeu6pkE\" approved\n\n$ kubectl get csr\nNAME                                                   AGE       REQUESTOR           CONDITION\nnode-csr-YWf97ZrLCTlr2hmXsNLfjVLwaLfZRsu52FRKOYjpcBE   30s       kubelet-bootstrap   Approved,Issued\nnode-csr-eq4q6ffOwT4yqYQNU6sT7mphPOQdFN6yulMVZeu6pkE   30s       kubelet-bootstrap   Approved,Issued\n\n$ kubectl get no\nNAME      STATUS     ROLES     AGE       VERSION\nmaster1   NotReady   master    15m       v1.8.2\nnode1     NotReady   \u003Cnone\u003E    8m        v1.8.2\nnode2     NotReady   \u003Cnone\u003E    6s        v1.8.2get csr | awk '/Pending/ {print $1}' | xargs kubectl certificate approve\ncertificatesigningrequest \"node-csr-YWf97ZrLCTlr2hmXsNLfjVLwaLfZRsu52FRKOYjpcBE\" approved\ncertificatesigningrequest \"node-csr-eq4q6ffOwT4yqYQNU6sT7mphPOQdFN6yulMVZeu6pkE\" approved\n\n$ kubectl get csr\nNAME                                                   AGE       REQUESTOR           CONDITION\nnode-csr-YWf97ZrLCTlr2hmXsNLfjVLwaLfZRsu52FRKOYjpcBE   30s       kubelet-bootstrap   Approved,Issued\nnode-csr-eq4q6ffOwT4yqYQNU6sT7mphPOQdFN6yulMVZeu6pkE   30s       kubelet-bootstrap   Approved,Issued\n\n$ kubectl get no\nNAME      STATUS     ROLES     AGE       VERSION\nmaster1   NotReady   master    15m       v1.8.2\nnode1     NotReady   \u003Cnone\u003E    8m        v1.8.2\nnode2     NotReady   \u003Cnone\u003E    6s        v1.8.2\nKubernetes Core Addons 部署\n当完成上面所有步骤后，接着我们需要安装一些插件，而这些有部分是非常重要跟好用的，如Kube-dns与Kube-proxy等。\nKube-proxy addon\nKube-proxy 是实现 Service 的关键组件，kube-proxy 会在每台节点上执行，然后监听 API Server 的 Service 与 Endpoint 资源对象的改变，然后来依据变化执行 iptables 来实现网络的转发。这边我们会需要建议一个 DaemonSet 来执行，并且创建一些需要的 certificate。Kubernetes 1.8 kube-proxy 开启 ipvs\n首先在master1下载kube-proxy-csr.json文件，并产生 kube-proxy certificate 证书：\n$ export PKI_URL=\"https://kairen.github.io/files/manual-v1.8/pki\"\n$ cd /etc/kubernetes/pki\n$ wget \"${PKI_URL}/kube-proxy-csr.json\" \"${PKI_URL}/ca-config.json\"\n$ cfssl gencert \\\n  -ca=ca.pem \\\n  -ca-key=ca-key.pem \\\n  -config=ca-config.json \\\n  -profile=kubernetes \\\n  kube-proxy-csr.json | cfssljson -bare kube-proxy\n\n$ ls kube-proxy*.pem\nkube-proxy-key.pem  kube-proxy.pemexport PKI_URL=\"https://kairen.github.io/files/manual-v1.8/pki\"\n$ cd /etc/kubernetes/pki\n$ wget \"${PKI_URL}/kube-proxy-csr.json\" \"${PKI_URL}/ca-config.json\"\n$ cfssl gencert \\\n  -ca=ca.pem \\\n  -ca-key=ca-key.pem \\\n  -config=ca-config.json \\\n  -profile=kubernetes \\\n  kube-proxy-csr.json | cfssljson -bare kube-proxy\n\n$ ls kube-proxy*.pem\nkube-proxy-key.pem  kube-proxy.pem\n接着透过以下指令生成名称为 kube-proxy.conf 的 kubeconfig 文件：\n# kube-proxy set-cluster\n$ kubectl config set-cluster kubernetes \\\n    --certificate-authority=ca.pem \\\n    --embed-certs=true \\\n    --server=\"https://172.16.35.12:6443\" \\\n    --kubeconfig=../kube-proxy.conf\n\n# kube-proxy set-credentials\n$ kubectl config set-credentials system:kube-proxy \\\n    --client-key=kube-proxy-key.pem \\\n    --client-certificate=kube-proxy.pem \\\n    --embed-certs=true \\\n    --kubeconfig=../kube-proxy.conf\n\n# kube-proxy set-context\n$ kubectl config set-context system:kube-proxy@kubernetes \\\n    --cluster=kubernetes \\\n    --user=system:kube-proxy \\\n    --kubeconfig=../kube-proxy.conf\n\n# kube-proxy set default context\n$ kubectl config use-context system:kube-proxy@kubernetes \\\n    --kubeconfig=../kube-proxy.conf\n$ kubectl config set-cluster kubernetes \\\n    --certificate-authority=ca.pem \\\n    --embed-certs=true \\\n    --server=\"https://172.16.35.12:6443\" \\\n    --kubeconfig=../kube-proxy.conf\n\n# kube-proxy set-credentials\n$ kubectl config set-credentials system:kube-proxy \\\n    --client-key=kube-proxy-key.pem \\\n    --client-certificate=kube-proxy.pem \\\n    --embed-certs=true \\\n    --kubeconfig=../kube-proxy.conf\n\n# kube-proxy set-context\n$ kubectl config set-context system:kube-proxy@kubernetes \\\n    --cluster=kubernetes \\\n    --user=system:kube-proxy \\\n    --kubeconfig=../kube-proxy.conf\n\n# kube-proxy set default context\n$ kubectl config use-context system:kube-proxy@kubernetes \\\n    --kubeconfig=../kube-proxy.conf\n完成后删除不必要文件：\n$ rm -rf *.json-rf *.json\n确认/etc/kubernetes有以下文件：\n$ ls /etc/kubernetes/\nadmin.conf        bootstrap.conf           encryption.yml  kube-proxy.conf  pki             token.csv\naudit-policy.yml  controller-manager.conf  kubelet.conf    manifests        scheduler.conf/etc/kubernetes/\nadmin.conf        bootstrap.conf           encryption.yml  kube-proxy.conf  pki             token.csv\naudit-policy.yml  controller-manager.conf  kubelet.conf    manifests        scheduler.conf\n在master1将kube-proxy相关文件复制到 Node 节点上：\n$ for NODE in node1 node2; do\n    for FILE in pki/kube-proxy.pem pki/kube-proxy-key.pem kube-proxy.conf; do\n      scp /etc/kubernetes/${FILE} ${NODE}:/etc/kubernetes/${FILE}\n    done\n  donefor NODE in node1 node2; do\n    for FILE in pki/kube-proxy.pem pki/kube-proxy-key.pem kube-proxy.conf; do\n      scp /etc/kubernetes/${FILE} ${NODE}:/etc/kubernetes/${FILE}\n    done\n  done\n完成后，在master1通过 kubectl 来创建 kube-proxy daemon：\n$ export ADDON_URL=\"https://kairen.github.io/files/manual-v1.8/addon\"\n$ mkdir -p /etc/kubernetes/addons && cd /etc/kubernetes/addons\n$ wget \"${ADDON_URL}/kube-proxy.yml.conf\" -O kube-proxy.yml\n$ kubectl apply -f kube-proxy.yml\n$ kubectl -n kube-system get po -l k8s-app=kube-proxy\nNAME               READY     STATUS    RESTARTS   AGE\nkube-proxy-bpp7q   1/1       Running   0          47s\nkube-proxy-cztvh   1/1       Running   0          47s\nkube-proxy-q7mm4   1/1       Running   0          47sexport ADDON_URL=\"https://kairen.github.io/files/manual-v1.8/addon\"\n$ mkdir -p /etc/kubernetes/addons && cd /etc/kubernetes/addons\n$ wget \"${ADDON_URL}/kube-proxy.yml.conf\" -O kube-proxy.yml\n$ kubectl apply -f kube-proxy.yml\n$ kubectl -n kube-system get po -l k8s-app=kube-proxy\nNAME               READY     STATUS    RESTARTS   AGE\nkube-proxy-bpp7q   1/1       Running   0          47s\nkube-proxy-cztvh   1/1       Running   0          47s\nkube-proxy-q7mm4   1/1       Running   0          47s\nKube-dns addon\nKube DNS 是 Kubernetes 集群内部 Pod 之间互相沟通的重要 Addon，它允许 Pod 可以通过 Domain Name 方式来连接 Service，其主要由 Kube DNS 与 Sky DNS 组合而成，通过 Kube DNS 监听 Service 与 Endpoint 变化，来提供给 Sky DNS 信息，已更新解析地址。\n安装只需要在master1通过 kubectl 来创建 kube-dns deployment 即可：\n$ export ADDON_URL=\"https://kairen.github.io/files/manual-v1.8/addon\"\n$ wget \"${ADDON_URL}/kube-dns.yml.conf\" -O kube-dns.yml\n$ kubectl apply -f kube-dns.yml\n$ kubectl -n kube-system get po -l k8s-app=kube-dns\nNAME                        READY     STATUS    RESTARTS   AGE\nkube-dns-6cb549f55f-h4zr5   0/3       Pending   0          40sexport ADDON_URL=\"https://kairen.github.io/files/manual-v1.8/addon\"\n$ wget \"${ADDON_URL}/kube-dns.yml.conf\" -O kube-dns.yml\n$ kubectl apply -f kube-dns.yml\n$ kubectl -n kube-system get po -l k8s-app=kube-dns\nNAME                        READY     STATUS    RESTARTS   AGE\nkube-dns-6cb549f55f-h4zr5   0/3       Pending   0          40s\nCalico Network 安装与设定\nCalico 是一款纯 Layer 3 的数据中心网络方案(不需要 Overlay 网络)，Calico 好处是他已与各种云原生平台有良好的整合，而 Calico 在每一个节点利用 Linux Kernel 实现高效的 vRouter 来负责数据的转发，而当数据中心复杂度增加时，可以用 BGP route reflector 来达成。\n首先在master1通过 kubectl 建立 Calico policy controller：\n$ export CALICO_CONF_URL=\"https://kairen.github.io/files/manual-v1.8/network\"\n$ wget \"${CALICO_CONF_URL}/calico-controller.yml.conf\" -O calico-controller.yml\n$ kubectl apply -f calico-controller.yml\n$ kubectl -n kube-system get po -l k8s-app=calico-policy\nNAME                                        READY     STATUS    RESTARTS   AGE\ncalico-policy-controller-5ff8b4549d-tctmm   0/1       Pending   0          5sexport CALICO_CONF_URL=\"https://kairen.github.io/files/manual-v1.8/network\"\n$ wget \"${CALICO_CONF_URL}/calico-controller.yml.conf\" -O calico-controller.yml\n$ kubectl apply -f calico-controller.yml\n$ kubectl -n kube-system get po -l k8s-app=calico-policy\nNAME                                        READY     STATUS    RESTARTS   AGE\ncalico-policy-controller-5ff8b4549d-tctmm   0/1       Pending   0          5s\n在master1下载 Calico CLI 工具：\n$ wget https://github.com/projectcalico/calicoctl/releases/download/v1.6.1/calicoctl\n$ chmod +x calicoctl && mv calicoctl /usr/local/bin/://github.com/projectcalico/calicoctl/releases/download/v1.6.1/calicoctl\n$ chmod +x calicoctl && mv calicoctl /usr/local/bin/\n然后在所有节点下载 Calico，并执行以下步骤：\n$ export CALICO_URL=\"https://github.com/projectcalico/cni-plugin/releases/download/v1.11.0\"\n$ wget -N -P /opt/cni/bin ${CALICO_URL}/calico\n$ wget -N -P /opt/cni/bin ${CALICO_URL}/calico-ipam\n$ chmod +x /opt/cni/bin/calico /opt/cni/bin/calico-ipamexport CALICO_URL=\"https://github.com/projectcalico/cni-plugin/releases/download/v1.11.0\"\n$ wget -N -P /opt/cni/bin ${CALICO_URL}/calico\n$ wget -N -P /opt/cni/bin ${CALICO_URL}/calico-ipam\n$ chmod +x /opt/cni/bin/calico /opt/cni/bin/calico-ipam\n接着在所有节点下载 CNI plugins配置文件，以及 calico-node.service：\n$ mkdir -p /etc/cni/net.d\n$ export CALICO_CONF_URL=\"https://kairen.github.io/files/manual-v1.8/network\"\n$ wget \"${CALICO_CONF_URL}/10-calico.conf\" -O /etc/cni/net.d/10-calico.conf\n$ wget \"${CALICO_CONF_URL}/calico-node.service\" -O /lib/systemd/system/calico-node.service-p /etc/cni/net.d\n$ export CALICO_CONF_URL=\"https://kairen.github.io/files/manual-v1.8/network\"\n$ wget \"${CALICO_CONF_URL}/10-calico.conf\" -O /etc/cni/net.d/10-calico.conf\n$ wget \"${CALICO_CONF_URL}/calico-node.service\" -O /lib/systemd/system/calico-node.service\n 若部署的机器是使用虚拟机，如 Virtualbox 等的话，请修改calico-node.service文件，并在IP_AUTODETECTION_METHOD(包含 IP6)部分指定绑定的网卡，以避免默认绑定到 NAT 网络上。\n \n之后在所有节点启动 Calico-node:\n$ systemctl enable calico-node.service && systemctl start calico-node.service-node.service && systemctl start calico-node.service\n在master1查看 Calico nodes:\n$ cat \u003C\u003CEOF \u003E ~/calico-rc\nexport ETCD_ENDPOINTS=\"https://172.16.35.12:2379\"\nexport ETCD_CA_CERT_FILE=\"/etc/etcd/ssl/etcd-ca.pem\"\nexport ETCD_CERT_FILE=\"/etc/etcd/ssl/etcd.pem\"\nexport ETCD_KEY_FILE=\"/etc/etcd/ssl/etcd-key.pem\"\nEOF\n\n$ . ~/calico-rc\n$ calicoctl get node -o wide\nNAME      ASN       IPV4              IPV6\nmaster1   (64512)   172.16.35.12/24\nnode1     (64512)   172.16.35.10/24\nnode2     (64512)   172.16.35.11/24\u003C\u003CEOF \u003E ~/calico-rc\nexport ETCD_ENDPOINTS=\"https://172.16.35.12:2379\"\nexport ETCD_CA_CERT_FILE=\"/etc/etcd/ssl/etcd-ca.pem\"\nexport ETCD_CERT_FILE=\"/etc/etcd/ssl/etcd.pem\"\nexport ETCD_KEY_FILE=\"/etc/etcd/ssl/etcd-key.pem\"\nEOF\n\n$ . ~/calico-rc\n$ calicoctl get node -o wide\nNAME      ASN       IPV4              IPV6\nmaster1   (64512)   172.16.35.12/24\nnode1     (64512)   172.16.35.10/24\nnode2     (64512)   172.16.35.11/24\n查看 pending 的 pod 是否已执行：\n$ kubectl -n kube-system get po\nNAME                                        READY     STATUS    RESTARTS   AGE\ncalico-policy-controller-5ff8b4549d-tctmm   1/1       Running   0          4m\nkube-apiserver-master1                      1/1       Running   0          20m\nkube-controller-manager-master1             1/1       Running   0          20m\nkube-dns-6cb549f55f-h4zr5                   3/3       Running   0          5m\nkube-proxy-fnrkb                            1/1       Running   0          6m\nkube-proxy-l72bq                            1/1       Running   0          6m\nkube-proxy-m6rfw                            1/1       Running   0          6m\nkube-scheduler-master1                      1/1       Running   0          20m-n kube-system get po\nNAME                                        READY     STATUS    RESTARTS   AGE\ncalico-policy-controller-5ff8b4549d-tctmm   1/1       Running   0          4m\nkube-apiserver-master1                      1/1       Running   0          20m\nkube-controller-manager-master1             1/1       Running   0          20m\nkube-dns-6cb549f55f-h4zr5                   3/3       Running   0          5m\nkube-proxy-fnrkb                            1/1       Running   0          6m\nkube-proxy-l72bq                            1/1       Running   0          6m\nkube-proxy-m6rfw                            1/1       Running   0          6m\nkube-scheduler-master1                      1/1       Running   0          20m\n最后若想省事，可以直接用 Standard Hosted 方式安装。\nKubernetes Extra Addons 部署\n本节说明如何部署一些官方常用的 Addons，如 Dashboard、Heapster 等。\nDashboard addon\nDashboard 是 Kubernetes 社区官方开发的仪表板，有了仪表板后管理者就能够透过 Web-based 方式来管理 Kubernetes 集群，除了提升管理方便，也让资源可视化，让人更直觉看见系统信息的呈现结果。\n首先我们要建立kubernetes-dashboard-certs，来提供给 Dashboard TLS 使用：\n$ mkdir -p /etc/kubernetes/addons/certs && cd /etc/kubernetes/addons\n$ openssl genrsa -des3 -passout pass:x -out certs/dashboard.pass.key 2048\n$ openssl rsa -passin pass:x -in certs/dashboard.pass.key -out certs/dashboard.key\n$ openssl req -new -key certs/dashboard.key -out certs/dashboard.csr -subj '/CN=kube-dashboard'\n$ openssl x509 -req -sha256 -days 365 -in certs/dashboard.csr -signkey certs/dashboard.key -out certs/dashboard.crt\n$ rm certs/dashboard.pass.key\n$ kubectl create secret generic kubernetes-dashboard-certs\\\n    --from-file=certs -n kube-system-p /etc/kubernetes/addons/certs && cd /etc/kubernetes/addons\n$ openssl genrsa -des3 -passout pass:x -out certs/dashboard.pass.key 2048\n$ openssl rsa -passin pass:x -in certs/dashboard.pass.key -out certs/dashboard.key\n$ openssl req -new -key certs/dashboard.key -out certs/dashboard.csr -subj '/CN=kube-dashboard'\n$ openssl x509 -req -sha256 -days 365 -in certs/dashboard.csr -signkey certs/dashboard.key -out certs/dashboard.crt\n$ rm certs/dashboard.pass.key\n$ kubectl create secret generic kubernetes-dashboard-certs\\\n    --from-file=certs -n kube-system\n接着在master1通过 kubectl 来建立 kubernetes dashboard 即可：\n$ export ADDON_URL=\"https://kairen.github.io/files/manual-v1.8/addon\"\n$ wget ${ADDON_URL}/kube-dashboard.yml.conf -O kube-dashboard.yml\n$ kubectl apply -f kube-dashboard.yml\n$ kubectl -n kube-system get po,svc -l k8s-app=kubernetes-dashboard\nNAME                                      READY     STATUS    RESTARTS   AGE\npo/kubernetes-dashboard-747c4f7cf-md5m8   1/1       Running   0          56s\n\nNAME                       TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)   AGE\nsvc/kubernetes-dashboard   ClusterIP   10.98.120.209   \u003Cnone\u003E        443/TCP   56sexport ADDON_URL=\"https://kairen.github.io/files/manual-v1.8/addon\"\n$ wget ${ADDON_URL}/kube-dashboard.yml.conf -O kube-dashboard.yml\n$ kubectl apply -f kube-dashboard.yml\n$ kubectl -n kube-system get po,svc -l k8s-app=kubernetes-dashboard\nNAME                                      READY     STATUS    RESTARTS   AGE\npo/kubernetes-dashboard-747c4f7cf-md5m8   1/1       Running   0          56s\n\nNAME                       TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)   AGE\nsvc/kubernetes-dashboard   ClusterIP   10.98.120.209   \u003Cnone\u003E        443/TCP   56s\n P.S. 这边会额外创建一个名称为anonymous-open-door Cluster Role Binding，这仅作为方便测试时使用，在一般情况下不要开启，不然就会直接被存取所有 API。\n \n完成后，就可以透过浏览器访问 Dashboard，https://172.16.35.12:6443/api/v1/namespaces/kube-system/services/https:kubernetes-dashboard:/proxy/\nHeapster addon\nHeapster 是 Kubernetes 社区维护的容器集群监控分析工具。Heapster 会从 Kubernetes apiserver 获得所有 Node 信息，然后再通过这些 Node 来获得 kubelet 上的数据，最后再将所有收集到数据送到 Heapster 的后台储存 InfluxDB，最后利用 Grafana 来抓取 InfluxDB 的数据源来进行可视化。\n在master1通过 kubectl 来创建 kubernetes monitor 即可：\n$ export ADDON_URL=\"https://kairen.github.io/files/manual-v1.8/addon\"\n$ wget ${ADDON_URL}/kube-monitor.yml.conf -O kube-monitor.yml\n$ kubectl apply -f kube-monitor.yml\n$ kubectl -n kube-system get po,svc\nNAME                                           READY     STATUS    RESTARTS   AGE\n...\npo/heapster-74fb5c8cdc-62xzc                   4/4       Running   0          7m\npo/influxdb-grafana-55bd7df44-nw4nc            2/2       Running   0          7m\n\nNAME                       TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)             AGE\n...\nsvc/heapster               ClusterIP   10.100.242.225   \u003Cnone\u003E        80/TCP              7m\nsvc/monitoring-grafana     ClusterIP   10.101.106.180   \u003Cnone\u003E        80/TCP              7m\nsvc/monitoring-influxdb    ClusterIP   10.109.245.142   \u003Cnone\u003E        8083/TCP,8086/TCP   7m\n···export ADDON_URL=\"https://kairen.github.io/files/manual-v1.8/addon\"\n$ wget ${ADDON_URL}/kube-monitor.yml.conf -O kube-monitor.yml\n$ kubectl apply -f kube-monitor.yml\n$ kubectl -n kube-system get po,svc\nNAME                                           READY     STATUS    RESTARTS   AGE\n...\npo/heapster-74fb5c8cdc-62xzc                   4/4       Running   0          7m\npo/influxdb-grafana-55bd7df44-nw4nc            2/2       Running   0          7m\n\nNAME                       TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)             AGE\n...\nsvc/heapster               ClusterIP   10.100.242.225   \u003Cnone\u003E        80/TCP              7m\nsvc/monitoring-grafana     ClusterIP   10.101.106.180   \u003Cnone\u003E        80/TCP              7m\nsvc/monitoring-influxdb    ClusterIP   10.109.245.142   \u003Cnone\u003E        8083/TCP,8086/TCP   7m\n···\n完成后，就可以透过浏览器存取 Grafana Dashboard，https://172.16.35.12:6443/api/v1/proxy/namespaces/kube-system/services/monitoring-grafana\n简单部署 Nginx 服务\nKubernetes 可以选择使用指令直接创建应用程序与服务，或者撰写 YAML 与 JSON 档案来描述部署应用程序的配置，以下将创建一个简单的 Nginx 服务：\n$ kubectl run nginx --image=nginx --port=80\n$ kubectl expose deploy nginx --port=80 --type=LoadBalancer --external-ip=172.16.35.12\n$ kubectl get svc,po\nNAME             TYPE           CLUSTER-IP      EXTERNAL-IP    PORT(S)        AGE\nsvc/kubernetes   ClusterIP      10.96.0.1       \u003Cnone\u003E         443/TCP        1h\nsvc/nginx        LoadBalancer   10.97.121.243   172.16.35.12   80:30344/TCP   22s\n\nNAME                        READY     STATUS    RESTARTS   AGE\npo/nginx-7cbc4b4d9c-7796l   1/1       Running   0          28s       192.160.57.181   ,172.16.35.12   80:32054/TCP   21s--image=nginx --port=80\n$ kubectl expose deploy nginx --port=80 --type=LoadBalancer --external-ip=172.16.35.12\n$ kubectl get svc,po\nNAME             TYPE           CLUSTER-IP      EXTERNAL-IP    PORT(S)        AGE\nsvc/kubernetes   ClusterIP      10.96.0.1       \u003Cnone\u003E         443/TCP        1h\nsvc/nginx        LoadBalancer   10.97.121.243   172.16.35.12   80:30344/TCP   22s\n\nNAME                        READY     STATUS    RESTARTS   AGE\npo/nginx-7cbc4b4d9c-7796l   1/1       Running   0          28s       192.160.57.181   ,172.16.35.12   80:32054/TCP   21s\n 这边type可以选择 NodePort 与 LoadBalancer，在本地裸机部署，两者差异在于NodePort只映射 Host port 到 Container port，而LoadBalancer则继承NodePort额外多出映射 Host target port 到 Container port。\n \n确认没问题后即可在浏览器存取 http://172.16.35.12\n扩展服务数量\n若集群node节点增加了，而想让 Nginx 服务提供可靠性的话，可以通过以下方式来扩展服务的副本：\n$ kubectl scale deploy nginx --replicas=2\n\n$ kubectl get pods -o wide\nNAME                    READY     STATUS    RESTARTS   AGE       IP             NODE\nnginx-158599303-0h9lr   1/1       Running   0          25s       10.244.100.5   node2\nnginx-158599303-k7cbt   1/1       Running   0          1m        10.244.24.3    node1--replicas=2\n\n$ kubectl get pods -o wide\nNAME                    READY     STATUS    RESTARTS   AGE       IP             NODE\nnginx-158599303-0h9lr   1/1       Running   0          25s       10.244.100.5   node2\nnginx-158599303-k7cbt   1/1       Running   0          1m        10.244.24.3    node1","brief":"Kubernetes 提供了许多云端平台与操作系统的安装方式，本章将以全手动安装方式来部署，主要是学习与了解 Kubernetes 创建流程。若想要了解更多平台...","summary":"Kubernetes 提供了许多云端平台与操作系统的安装方式，本章将以全手动安装方式来部署，主要是学习与了解 Kubernetes 创建流程。若想要了解更多平台...","abstract":"Kubernetes 提供了许多云端平台与操作系统的安装方式，本章将以全手动安装方式来部署，主要是学习与了解 Kubernetes 创建流程。若想要了解更多平台...","posterSummary":"Kubernetes 提供了许多云端平台与操作系统的安装方式，本章将以全手动安装方式来部署，主要是学习与了解 Kubernetes 创建流程。若想要了解更多平台的部署可以参考 Picking the Right Solution来选择自己最喜欢的方式。","description":"","picture":"","coverImageUrl":"","sourceType":99,"sourceDetail":{},"channelType":2,"channelDetail":{"source":"csdn","originalTime":"2018-01-22"},"authorId":1220175,"columnId":77743,"writeTime":1671618639,"updateTime":1671618639,"viewCount":38,"likeCount":2,"commentCount":0,"favorCount":0,"weight":0,"status":2,"draftId":0,"tagIds":[10681,10207,10987,10750,10802],"tags":[{"id":10681,"tagId":10681,"name":"网络安全","groupId":10555,"groupName":"网络技术","tagName":"网络安全","categoryId":3,"articleCount":0,"disable":0},{"id":10207,"tagId":10207,"name":"JSON","groupId":10121,"groupName":"前端开发","tagName":"JSON","categoryId":3,"articleCount":0,"disable":0},{"id":10987,"tagId":10987,"name":"etcd","groupId":10133,"groupName":"开发技术","tagName":"etcd","categoryId":3,"articleCount":0,"disable":0},{"id":10750,"tagId":10750,"name":"TCP/IP","groupId":10555,"groupName":"网络技术","tagName":"TCP/IP","categoryId":3,"articleCount":0,"disable":0},{"id":10802,"tagId":10802,"name":"数据分析","groupId":10551,"groupName":"大数据技术","tagName":"数据分析","categoryId":3,"articleCount":0,"disable":0}],"isCommentEnable":true,"highQuality":false,"skipAds":false,"showAds":false,"keywords":[],"focusRead":false,"publishTime":1671618639,"editTime":0,"isCloseTextLink":false,"isTencent":0,"blogUrl":"https://blog.csdn.net/bbwangj","author":{"id":1220175,"name":"菲宇","label":"关注运维自动化，容器云","avatar":"https://ask.qcloudimg.com/avatar/1220175/3yhsgao20a.png","company":"","title":"","isProfessionVerified":false,"isInternal":false,"badgeInfo":{},"statInfo":{"articleCount":742,"validArticleCount":741,"joinedColumnCount":1,"followColumnCount":2,"uid":1220175,"beLikeNum":2030,"articleReadNum":831912,"articleRecommNum":0,"answerRecommNum":0,"contribNum":0,"createTime":"2019-09-09 15:37:04","articleCommentNum":19,"articleFavNum":92,"yesterdayBeLikeNum":2030,"yesterdayArticleReadNum":831452,"yesterdayArticleRecommNum":0,"yesterdayAnswerRecommNum":0,"yesterdayContribNum":0,"yesterdayArticleCommentNum":19,"yesterdayArticleFavNum":92},"rank":265,"userTeams":[],"fromInfo":{}},"column":{"id":77743,"name":"菲宇","desc":"","icon":"https://imgcache.qq.com/qcloud/developer/images/release/column-icons/9.png","background":"https://imgcache.qq.com/qcloud/developer/images/release/column-bgs/2.svg","status":2,"creatorId":1220175,"memberCount":1,"articleCount":741,"followCount":51,"createdTime":1560172309,"creator":{"1220175":{"id":1220175,"name":"菲宇","label":"关注运维自动化，容器云","avatar":"https://ask.qcloudimg.com/avatar/1220175/3yhsgao20a.png","company":"","title":"","isProfessionVerified":false,"isInternal":false}}},"translator":{},"textLinks":[{"text":"数据加密","link":"https://cloud.tencent.com/solution/domesticencryption","mark":"2356_2197170"},{"text":"docker","link":"https://cloud.tencent.com/product/tke","mark":"445_2197170"},{"text":"grafana","link":"https://cloud.tencent.com/product/tcmg","mark":"2136_2197170"}]},"articleAuditInfo":null,"commentsData":{"fetchStatus":"none","pageNumber":1,"pageSize":10,"total":0,"list":[]},"hotArticleList":[{"id":123781,"weight":1675420432,"type":8,"detail":{"abstract":"关于多线程的异步处理，由于项目的需求有个方法需要使用异步的方法来调用，方法是调用外部的接口，执行时间会比较长导致的没有办法同步拿去到结果，所以需要写一个异步线程的方法进行该接口的调用，下面是一个案例以及自己测试的异步结果的情况；","articleId":2213104,"coverImageUrl":"","weight":1675420432,"avatar":"//cloudcache.tencent-cloud.com/open_proj/proj_qcloud_v2/gateway/q-and-a/css/img/avatar-default.png","author":{"id":7172595,"name":"小马哥学JAVA","label":"JAVA技术工程师，公众号【小马哥学JAVA】","avatar":"https://developer.qcloudimg.com/http-save/10011/80ae49a78e8baae39ce667c18166ddcd.jpg","company":"软通动力信息技术(集团)股份有限","title":"高级工程师","isProfessionVerified":true,"isInternal":false},"authorBadgeInfo":{}},"createTime":1675420432,"objId":2213104,"entry":0,"readNum":79,"showReadNum":139,"abstract":"关于多线程的异步处理，由于项目的需求有个方法需要使用异步的方法来调用，方法是调用外部的接口，执行时间会比较长导致的没有办法同步拿去到结果，所以需要写一个异步线程的方法进行该接口的调用，下面是一个案例以及自己测试的异步结果的情况；","articleId":2213104,"coverImageUrl":"","avatar":"//cloudcache.tencent-cloud.com/open_proj/proj_qcloud_v2/gateway/q-and-a/css/img/avatar-default.png","title":"spring springboot关于异步线程实践案例","writeTime":1675387442,"tags":[],"picture":"","author":{"id":7172595,"name":"小马哥学JAVA","avatar":"https://developer.qcloudimg.com/http-save/10011/80ae49a78e8baae39ce667c18166ddcd.jpg"}},{"id":123779,"weight":1675416249,"type":8,"detail":{"abstract":"论文：A Survey on Trajectory-Prediction Methods for Autonomous Driving","articleId":2212578,"coverImageUrl":"https://developer.qcloudimg.com/http-save/10091650/16db7d72fc7d47f5f79a2f559df584ea.png","weight":1675416249,"avatar":"https://developer.qcloudimg.com/http-save/10091650/16db7d72fc7d47f5f79a2f559df584ea.png","author":{"id":10091650,"name":"一点人工一点智能","label":"AI与机器人的知识随笔分享小站，公众号、知乎号同名","avatar":"https://developer.qcloudimg.com/http-save/10011/262f66f96a3162f3770fd20930255a8a.jpg","company":"武汉蔡甸泛式教育","title":"","isProfessionVerified":false,"isInternal":false},"authorBadgeInfo":{}},"createTime":1675416249,"objId":2212578,"entry":0,"readNum":28,"showReadNum":122,"abstract":"论文：A Survey on Trajectory-Prediction Methods for Autonomous Driving","articleId":2212578,"coverImageUrl":"https://developer.qcloudimg.com/http-save/10091650/16db7d72fc7d47f5f79a2f559df584ea.png","avatar":"https://developer.qcloudimg.com/http-save/10091650/16db7d72fc7d47f5f79a2f559df584ea.png","title":"一文尽览 | 轨迹预测二十年发展全面回顾！","writeTime":1675258158,"tags":[{"tagId":11053,"tagName":"学习方法"},{"tagId":10692,"tagName":"强化学习"},{"tagId":10147,"tagName":"自动驾驶"},{"tagId":10684,"tagName":"无人驾驶"},{"tagId":10690,"tagName":"卷积神经网络"}],"picture":"https://developer.qcloudimg.com/http-save/10091650/16db7d72fc7d47f5f79a2f559df584ea.png","author":{"id":10091650,"name":"一点人工一点智能","avatar":"https://developer.qcloudimg.com/http-save/10011/262f66f96a3162f3770fd20930255a8a.jpg"}},{"id":123777,"weight":1675416227,"type":8,"detail":{"abstract":"两个人在恋爱中，会需要记录彼此在一起的每一天，特别是一些重要的纪念日比如100天纪念日，365天、或者520天纪念日。","articleId":2213285,"coverImageUrl":"https://ask.qcloudimg.com/article-cover-image/9261854/9ag0s2vlt7.jpeg","weight":1675416227,"avatar":"https://ask.qcloudimg.com/article-cover-image/9261854/9ag0s2vlt7.jpeg","author":{"id":9261854,"name":"腾讯云HiFlow场景连接器","label":"腾讯云HiFlow场景连接器，你的应用连接自动化助手！","avatar":"https://ask.qcloudimg.com/developer-images/custom-avatar/9261854/agg3cz5xr9.jpg","company":"腾讯云","title":"产品运营","isProfessionVerified":true,"isInternal":true},"authorBadgeInfo":{"list":[4],"entities":{"4":{"id":4,"uid":9261854,"status":2,"level":2}}}},"createTime":1675416227,"objId":2213285,"entry":0,"readNum":29,"showReadNum":68,"abstract":"两个人在恋爱中，会需要记录彼此在一起的每一天，特别是一些重要的纪念日比如100天纪念日，365天、或者520天纪念日。","articleId":2213285,"coverImageUrl":"https://ask.qcloudimg.com/article-cover-image/9261854/9ag0s2vlt7.jpeg","avatar":"https://ask.qcloudimg.com/article-cover-image/9261854/9ag0s2vlt7.jpeg","title":"在一起多少天怎么设置？如何微信推送在一起多少天","writeTime":1675410973,"tags":[{"tagId":11066,"tagName":"腾讯云HiFlow场景连接器"}],"picture":"https://ask.qcloudimg.com/article-cover-image/9261854/9ag0s2vlt7.jpeg","author":{"id":9261854,"name":"腾讯云HiFlow场景连接器","avatar":"https://ask.qcloudimg.com/developer-images/custom-avatar/9261854/agg3cz5xr9.jpg"}},{"id":123775,"weight":1675416221,"type":8,"detail":{"abstract":"一直使用Python做自动化测试，近期遇到了要对桌面端软件即windowsGUI进行自动化测试。Python的GUI自动化测试工具有很多，但是都有不同的侧重点。本次会详细说明为啥选择uiautomation来做测试。","articleId":2213048,"coverImageUrl":"","weight":1675416221,"avatar":"//cloudcache.tencent-cloud.com/open_proj/proj_qcloud_v2/gateway/q-and-a/css/img/avatar-default.png","author":{"id":10298071,"name":"虫无涯","label":"CSDN |  阿里云 | 51CTO | 华为云 等专家博主/博客专家【专注测试领域各种技术研究、分享和交流~】","avatar":"https://developer.qcloudimg.com/http-save/10011/4ae02187d526fa878ae62f82e99cee6d.jpg","company":"某科技公司","title":"测试管理","isProfessionVerified":false,"isInternal":false},"authorBadgeInfo":{}},"createTime":1675416221,"objId":2213048,"entry":0,"readNum":33,"showReadNum":108,"abstract":"一直使用Python做自动化测试，近期遇到了要对桌面端软件即windowsGUI进行自动化测试。Python的GUI自动化测试工具有很多，但是都有不同的侧重点。本次会详细说明为啥选择uiautomation来做测试。","articleId":2213048,"coverImageUrl":"","avatar":"//cloudcache.tencent-cloud.com/open_proj/proj_qcloud_v2/gateway/q-and-a/css/img/avatar-default.png","title":"基于Python＋uiautomation的windowsGUI自动化测试概述","writeTime":1675329514,"tags":[{"tagId":10813,"tagName":"https"},{"tagId":10681,"tagName":"网络安全"},{"tagId":10806,"tagName":"Windows"},{"tagId":10669,"tagName":"自动化"},{"tagId":10663,"tagName":"编程算法"}],"picture":"","author":{"id":10298071,"name":"虫无涯","avatar":"https://developer.qcloudimg.com/http-save/10011/4ae02187d526fa878ae62f82e99cee6d.jpg"}},{"id":123773,"weight":1675416217,"type":8,"detail":{"abstract":"最近二哥利用业余时间在复习 eBPF ，为啥说是复习呢？因为我曾经短暂使用过 eBPF 。一晃几年过去了，我在研究 K8s 网络模型和 service mesh 的过程中，反复看到它的出现。它真是一个勤劳的小蜜蜂，哪里都能看到它的身影。而我在几年后重新拾起 eBPF ，对它有了更深的感悟，对它的小巧精悍也有了更多的喜爱。","articleId":2212368,"coverImageUrl":"","weight":1675416217,"avatar":"//cloudcache.tencent-cloud.com/open_proj/proj_qcloud_v2/gateway/q-and-a/css/img/avatar-default.png","author":{"id":3868128,"name":"LanceZhang","label":"二哥，发量依旧适中，爱好仍然广泛。皱纹与知识量等多，年龄与代码量齐涨，此生唯愿腰身能和广州塔比瘦。","avatar":"https://ask.qcloudimg.com/http-save/yehe-3868128/e7f3b5c61d9a26f6ebe051d7b92b8ce8.jpeg","company":"","title":"","isProfessionVerified":false,"isInternal":false},"authorBadgeInfo":{}},"createTime":1675416217,"objId":2212368,"entry":0,"readNum":17,"showReadNum":70,"abstract":"最近二哥利用业余时间在复习 eBPF ，为啥说是复习呢？因为我曾经短暂使用过 eBPF 。一晃几年过去了，我在研究 K8s 网络模型和 service mesh 的过程中，反复看到它的出现。它真是一个勤劳的小蜜蜂，哪里都能看到它的身影。而我在几年后重新拾起 eBPF ，对它有了更深的感悟，对它的小巧精悍也有了更多的喜爱。","articleId":2212368,"coverImageUrl":"","avatar":"//cloudcache.tencent-cloud.com/open_proj/proj_qcloud_v2/gateway/q-and-a/css/img/avatar-default.png","title":"利用eBPF实现socket level重定向","writeTime":1675233042,"tags":[{"tagId":10777,"tagName":"Socket编程"},{"tagId":10548,"tagName":"网站"},{"tagId":10652,"tagName":"Kubernetes"},{"tagId":10750,"tagName":"TCP/IP"}],"picture":"","author":{"id":3868128,"name":"LanceZhang","avatar":"https://ask.qcloudimg.com/http-save/yehe-3868128/e7f3b5c61d9a26f6ebe051d7b92b8ce8.jpeg"}},{"id":123771,"weight":1675416211,"type":8,"detail":{"abstract":"数据在数据库中的存储方式就是数据存储结构。传统数据库由上到下，可以分为网络接入层、计算引擎层、存储引擎层、系统文件层，数据存储结构就是在存储引擎层，数据库通过存储引擎实现CRUD操作。不同的存储引擎决定了数据库的性能和功能，所以存储引擎层是数据库的核心。另外，在数据库中数据是以表的形式存储，所以存储引擎也可以称为表类型。","articleId":2213212,"coverImageUrl":"https://ask.qcloudimg.com/article-cover-image/10024156/og46yszpey.png","weight":1675416211,"avatar":"https://ask.qcloudimg.com/article-cover-image/10024156/og46yszpey.png","author":{"id":10024156,"name":"NineData","label":"NineData是玖章算术旗下数据库产品，公众号（ID：NineData-Cloud）","avatar":"https://developer.qcloudimg.com/http-save/10011/f188e3d172e7dccab39a7e6f054bcc3d.jpg","company":"玖章算术","title":"数据库开发岗","isProfessionVerified":false,"isInternal":false},"authorBadgeInfo":{}},"createTime":1675416211,"objId":2213212,"entry":0,"readNum":26,"showReadNum":62,"abstract":"数据在数据库中的存储方式就是数据存储结构。传统数据库由上到下，可以分为网络接入层、计算引擎层、存储引擎层、系统文件层，数据存储结构就是在存储引擎层，数据库通过存储引擎实现CRUD操作。不同的存储引擎决定了数据库的性能和功能，所以存储引擎层是数据库的核心。另外，在数据库中数据是以表的形式存储，所以存储引擎也可以称为表类型。","articleId":2213212,"coverImageUrl":"https://ask.qcloudimg.com/article-cover-image/10024156/og46yszpey.png","avatar":"https://ask.qcloudimg.com/article-cover-image/10024156/og46yszpey.png","title":"程序员必备的数据库知识：数据存储结构","writeTime":1675406527,"tags":[{"tagId":10665,"tagName":"存储"},{"tagId":10244,"tagName":"数据库"},{"tagId":10253,"tagName":"SQL"},{"tagId":10245,"tagName":"云数据库 SQL Server"},{"tagId":10812,"tagName":"数据结构"}],"picture":"https://ask.qcloudimg.com/article-cover-image/10024156/og46yszpey.png","author":{"id":10024156,"name":"NineData","avatar":"https://developer.qcloudimg.com/http-save/10011/f188e3d172e7dccab39a7e6f054bcc3d.jpg"}},{"id":123769,"weight":1675416193,"type":8,"detail":{"abstract":"","articleId":2213182,"coverImageUrl":"","weight":1675416193,"avatar":"//cloudcache.tencent-cloud.com/open_proj/proj_qcloud_v2/gateway/q-and-a/css/img/avatar-default.png","author":{"id":10298071,"name":"虫无涯","label":"CSDN |  阿里云 | 51CTO | 华为云 等专家博主/博客专家【专注测试领域各种技术研究、分享和交流~】","avatar":"https://developer.qcloudimg.com/http-save/10011/4ae02187d526fa878ae62f82e99cee6d.jpg","company":"某科技公司","title":"测试管理","isProfessionVerified":false,"isInternal":false},"authorBadgeInfo":{}},"createTime":1675416193,"objId":2213182,"entry":0,"readNum":14,"showReadNum":32,"abstract":"","articleId":2213182,"coverImageUrl":"","avatar":"//cloudcache.tencent-cloud.com/open_proj/proj_qcloud_v2/gateway/q-and-a/css/img/avatar-default.png","title":"WindowsGUI自动化测试框架搭建之需求整理、详细设计和框架设计","writeTime":1675402519,"tags":[{"tagId":10169,"tagName":"Python"},{"tagId":10497,"tagName":"腾讯云测试服务"},{"tagId":10784,"tagName":"UML"},{"tagId":10732,"tagName":"自动化测试"}],"picture":"","author":{"id":10298071,"name":"虫无涯","avatar":"https://developer.qcloudimg.com/http-save/10011/4ae02187d526fa878ae62f82e99cee6d.jpg"}},{"id":123767,"weight":1675416169,"type":8,"detail":{"abstract":"这算是一个非常严重的网站设计的事故了。这里，我们不过多讨论幕后的事情和其可能的社会影响力。专注在技术上，有两个事情我们值得思考：","articleId":2213176,"coverImageUrl":"","weight":1675416169,"avatar":"//cloudcache.tencent-cloud.com/open_proj/proj_qcloud_v2/gateway/q-and-a/css/img/avatar-default.png","author":{"id":2475237,"name":"点火三周","label":"Elastic首席云解决方案架构师，拥有多个云厂商架构师认证。是一个活跃的知识分享者和社区活动者。","avatar":"https://ask.qcloudimg.com/developer-images/custom-avatar/2475237/dj2h3slvr4.jpg","company":"Elastic","title":"首席云解决方案架构师","isProfessionVerified":false,"isInternal":false},"authorBadgeInfo":{}},"createTime":1675416169,"objId":2213176,"entry":0,"readNum":532,"showReadNum":677,"abstract":"这算是一个非常严重的网站设计的事故了。这里，我们不过多讨论幕后的事情和其可能的社会影响力。专注在技术上，有两个事情我们值得思考：","articleId":2213176,"coverImageUrl":"","avatar":"//cloudcache.tencent-cloud.com/open_proj/proj_qcloud_v2/gateway/q-and-a/css/img/avatar-default.png","title":"正确的做网站搜索——如何避免XAHWW的社死悲剧","writeTime":1675398795,"tags":[{"tagId":10548,"tagName":"网站"},{"tagId":10678,"tagName":"爬虫"},{"tagId":10301,"tagName":"搜索引擎"},{"tagId":10244,"tagName":"数据库"},{"tagId":10253,"tagName":"SQL"}],"picture":"","author":{"id":2475237,"name":"点火三周","avatar":"https://ask.qcloudimg.com/developer-images/custom-avatar/2475237/dj2h3slvr4.jpg"}},{"id":123765,"weight":1675387903,"type":8,"detail":{"abstract":"这时候就会思考，有没有能既清晰又流畅的进行屏幕、视频流的分享呢？很显然直播满足了这一系列条件。所以这里有这么些解决方案：","articleId":2212849,"coverImageUrl":"","weight":1675387903,"avatar":"//cloudcache.tencent-cloud.com/open_proj/proj_qcloud_v2/gateway/q-and-a/css/img/avatar-default.png","author":{"id":1025958,"name":"青橙.","label":"","avatar":"https://ask.qcloudimg.com/http-save/yehe-1025958/b8d063557314a363a30ec763e9d8fdd9.jpeg","company":"","title":"","isProfessionVerified":false,"isInternal":false},"authorBadgeInfo":{"list":[1],"entities":{"1":{"id":1,"uid":1025958,"status":1,"level":0}}}},"createTime":1675387903,"objId":2212849,"entry":0,"readNum":43,"showReadNum":135,"abstract":"这时候就会思考，有没有能既清晰又流畅的进行屏幕、视频流的分享呢？很显然直播满足了这一系列条件。所以这里有这么些解决方案：","articleId":2212849,"coverImageUrl":"","avatar":"//cloudcache.tencent-cloud.com/open_proj/proj_qcloud_v2/gateway/q-and-a/css/img/avatar-default.png","title":"使用 Nginx-RTMP 搭建简单的流媒体服务器","writeTime":1675322329,"tags":[{"tagId":10374,"tagName":"移动直播"},{"tagId":10372,"tagName":"云直播"},{"tagId":10315,"tagName":"Nginx"},{"tagId":10528,"tagName":"视频处理"}],"picture":"","author":{"id":1025958,"name":"青橙.","avatar":"https://ask.qcloudimg.com/http-save/yehe-1025958/b8d063557314a363a30ec763e9d8fdd9.jpeg"}},{"id":123763,"weight":1675331208,"type":8,"detail":{"abstract":"海外新加坡有一套aws的 eks集群，很小的规模 托管的 三节点（172-31-16-189节点为最近才加的，忽略）：","articleId":2213062,"coverImageUrl":"","weight":1675331208,"avatar":"//cloudcache.tencent-cloud.com/open_proj/proj_qcloud_v2/gateway/q-and-a/css/img/avatar-default.png","author":{"id":1006587,"name":"对你无可奈何","label":"喜欢新技术，kubernets，elastic爱好者，flink hadoop sark也开始喜欢中","avatar":"https://ask.qcloudimg.com/http-save/yehe-1006587/ewyy26o5wi.jpeg","company":"layabox","title":"运维工程师","isProfessionVerified":true,"isInternal":false},"authorBadgeInfo":{}},"createTime":1675331208,"objId":2213062,"entry":0,"readNum":45,"showReadNum":160,"abstract":"海外新加坡有一套aws的 eks集群，很小的规模 托管的 三节点（172-31-16-189节点为最近才加的，忽略）：","articleId":2213062,"coverImageUrl":"","avatar":"//cloudcache.tencent-cloud.com/open_proj/proj_qcloud_v2/gateway/q-and-a/css/img/avatar-default.png","title":"kubernetes关于eks一次异常问题的复盘","writeTime":1675330333,"tags":[{"tagId":10200,"tagName":"Node.js"},{"tagId":10318,"tagName":"Docker"}],"picture":"","author":{"id":1006587,"name":"对你无可奈何","avatar":"https://ask.qcloudimg.com/http-save/yehe-1006587/ewyy26o5wi.jpeg"}}],"relatedArticles":[{"id":1136829,"articleId":1136829,"title":"IT苦工指南 | Kubernetes v1.8.x全手动安装","content":"","plain":"","brief":"","summary":"觉得Rainbond提供的既简洁、又易用、而且生产就绪的Kubernets体验不过瘾……","abstract":"觉得Rainbond提供的既简洁、又易用、而且生产就绪的Kubernets体验不过瘾……","posterSummary":"","description":"","picture":"","coverImageUrl":"","sourceType":1,"sourceDetail":{},"channelType":0,"channelDetail":{},"authorId":2188477,"columnId":3564,"writeTime":0,"updateTime":0,"viewCount":489,"likeCount":5,"commentCount":3,"favorCount":0,"weight":0,"status":2,"draftId":0,"tagIds":[],"tags":[],"isCommentEnable":true,"highQuality":false,"skipAds":false,"showAds":false,"focusRead":false,"publishTime":null,"editTime":null,"isCloseTextLink":false,"author":{"id":2188477,"name":"Rainbond开源","label":"Rainbond 是一个云原生应用管理平台，使用简单，不需要懂容器、Kubernetes和底层复杂技术。","avatar":"https://ask.qcloudimg.com/http-save/yehe-2188477/e910c8af7162e69473aa0f34838e152a.jpg","company":"","title":"","isProfessionVerified":false,"isInternal":false},"column":{"id":3564,"name":"Rainbond开源「容器云平台」","desc":"rainbond简介、最佳实践、更多开源框架。","icon":"https://imgcache.qq.com/qcloud/developer/images/release/column-icons/18.png","background":"","status":2,"creatorId":2188477,"memberCount":2,"articleCount":304,"followCount":57,"createdTime":1526456866}},{"id":1472288,"articleId":1472288,"title":"kubernetes1.13.0 HA安装教程","content":"","plain":"","brief":"","summary":"sealos是一个轻量级kubernetes HA安装项目，重点关注功能的收敛而非庞大复杂厚重，旨在容易定制。除kubelet以外其它任何组件均在容器中运行 这...","abstract":"sealos是一个轻量级kubernetes HA安装项目，重点关注功能的收敛而非庞大复杂厚重，旨在容易定制。除kubelet以外其它任何组件均在容器中运行 这...","posterSummary":"sealos是一个轻量级kubernetes HA安装项目，重点关注功能的收敛而非庞大复杂厚重，旨在容易定制。除kubelet以外其它任何组件均在容器中运行 这样做的好处有几点：","description":"","picture":"","coverImageUrl":"","sourceType":1,"sourceDetail":{},"channelType":0,"channelDetail":{"source":"wechat","originalTime":"2018-12-11","author":"sealyun","nickName":"sealyun","userName":"gh_f33fe7b0c869","alias":"","authorName":"steven"},"authorId":5891535,"columnId":79063,"writeTime":0,"updateTime":0,"viewCount":464,"likeCount":2,"commentCount":0,"favorCount":0,"weight":0,"status":2,"draftId":0,"tagIds":[],"tags":[],"isCommentEnable":true,"highQuality":false,"skipAds":false,"showAds":false,"focusRead":false,"publishTime":null,"editTime":null,"isCloseTextLink":false,"author":{"id":5891535,"name":"sealyun","label":"云原生与sealyun","avatar":"https://ask.qcloudimg.com/custom-avatar/5891535/vgx0jqjt9t.jpg","company":"合肥北明网络科技有限公司","title":"CTO","isProfessionVerified":false,"isInternal":false},"column":{"id":79063,"name":"sealyun","desc":"","icon":"https://imgcache.qq.com/qcloud/developer/images/release/column-icons/1.png","background":"","status":2,"creatorId":5891535,"memberCount":1,"articleCount":55,"followCount":14,"createdTime":1563932755}},{"id":1704686,"articleId":1704686,"title":"centos7安装kubernetes教程","content":"","plain":"","brief":"","summary":"Kubernetes默认CRI（容器运行时）为Docker，因此先安装Docker。","abstract":"Kubernetes默认CRI（容器运行时）为Docker，因此先安装Docker。","posterSummary":"","description":"","picture":"https://ask.qcloudimg.com/http-save/yehe-3081251/kxehsleukn.png","coverImageUrl":"https://ask.qcloudimg.com/http-save/yehe-3081251/kxehsleukn.png","sourceType":1,"sourceDetail":{},"channelType":0,"channelDetail":{"source":"csdn","originalTime":"2020-09-22 18:17:18"},"authorId":3081251,"columnId":88735,"writeTime":0,"updateTime":0,"viewCount":3909,"likeCount":3,"commentCount":0,"favorCount":1,"weight":0,"status":2,"draftId":0,"tagIds":[],"tags":[],"isCommentEnable":true,"highQuality":false,"skipAds":false,"showAds":false,"focusRead":false,"publishTime":null,"editTime":null,"isCloseTextLink":false,"author":{"id":3081251,"name":"gang_luo","label":"","avatar":"https://ask.qcloudimg.com/http-save/yehe-3081251/6sx1qcqg4k.jpeg","company":"","title":"","isProfessionVerified":false,"isInternal":false},"column":{"id":88735,"name":"gang_luo","desc":"","icon":"https://imgcache.qq.com/qcloud/developer/images/release/column-icons/17.png","background":"","status":2,"creatorId":3081251,"memberCount":1,"articleCount":34,"followCount":16,"createdTime":1597116380}},{"id":1149268,"articleId":1149268,"title":"轻松加愉快的 Kubernetes 安装教程","content":"","plain":"","brief":"","summary":"","abstract":"","posterSummary":"","description":"","picture":"","coverImageUrl":"","sourceType":1,"sourceDetail":{},"channelType":0,"channelDetail":{"source":"wechat","originalTime":"2018-05-31","author":"","nickName":"马哥Linux运维","userName":"gh_904f08561055","alias":"magedu-Linux"},"authorId":1751832,"columnId":2708,"writeTime":0,"updateTime":0,"viewCount":4616,"likeCount":2,"commentCount":0,"favorCount":0,"weight":0,"status":2,"draftId":0,"tagIds":[],"tags":[],"isCommentEnable":true,"highQuality":false,"skipAds":false,"showAds":false,"focusRead":false,"publishTime":null,"editTime":null,"isCloseTextLink":false,"author":{"id":1751832,"name":"小小科","label":"","avatar":"https://ask.qcloudimg.com/custom-avatar/1751832/v8eezkecko.jpg","company":"","title":"","isProfessionVerified":false,"isInternal":false},"column":{"id":2708,"name":"北京马哥教育","desc":"","icon":"https://ask.qcloudimg.com/column-icons/2708/1751832/xe8n1v95wo.jpg","background":"","status":2,"creatorId":1751832,"memberCount":2,"articleCount":1832,"followCount":198,"createdTime":1524800738}},{"id":1995684,"articleId":1995684,"title":"使用Kubespray部署Kubernetes集群","content":"","plain":"","brief":"","summary":"Kubespray是Google开源的一个部署生产级别的Kubernetes服务器集群的开源项目，它整合了Ansible作为部署的工具。项目地址：https:/...","abstract":"Kubespray是Google开源的一个部署生产级别的Kubernetes服务器集群的开源项目，它整合了Ansible作为部署的工具。项目地址：https:/...","posterSummary":"Kubespray是Google开源的一个部署生产级别的Kubernetes服务器集群的开源项目，它整合了Ansible作为部署的工具。项目地址：https://github.com/kubernetes-incubator/kubespray","description":"","picture":"","coverImageUrl":"","sourceType":1,"sourceDetail":{},"channelType":0,"channelDetail":{"source":"csdn","originalTime":"2018-09-16"},"authorId":1128701,"columnId":1583,"writeTime":0,"updateTime":0,"viewCount":805,"likeCount":3,"commentCount":0,"favorCount":0,"weight":0,"status":2,"draftId":0,"tagIds":[],"tags":[],"isCommentEnable":true,"highQuality":false,"skipAds":false,"showAds":false,"focusRead":false,"publishTime":null,"editTime":null,"isCloseTextLink":false,"author":{"id":1128701,"name":"方志朋","label":"","avatar":"https://ask.qcloudimg.com/custom-avatar/1128701/1b2913hlhx.jpg","company":"腾讯","title":"","isProfessionVerified":false,"isInternal":false},"column":{"id":1583,"name":"史上最简单的Spring Cloud教程","desc":"","icon":"https://imgcache.qq.com/qcloud/developer/images/release/column-icons/19.png","background":"","status":2,"creatorId":1128701,"memberCount":1,"articleCount":191,"followCount":75,"createdTime":1512958974}},{"id":1910787,"articleId":1910787,"title":"Mesh7# wasm扩展Envoy使用详解","content":"","plain":"","brief":"","summary":"引言\n我们想要网格的服务发现、路由、熔断降级、负载均衡，这些流量治理都在数据面Envoy中执行才行。Envoy也提供的Filter机制来做这些功能，通常有以下方...","abstract":"引言\n我们想要网格的服务发现、路由、熔断降级、负载均衡，这些流量治理都在数据面Envoy中执行才行。Envoy也提供的Filter机制来做这些功能，通常有以下方...","posterSummary":"引言\n我们想要网格的服务发现、路由、熔断降级、负载均衡，这些流量治理都在数据面Envoy中执行才行。Envoy也提供的Filter机制来做这些功能，通常有以下方式：","description":"","picture":"https://ask.qcloudimg.com/http-save/yehe-3911980/2e8acafee88c13c2a8a6c3d7fb3b4574.png","coverImageUrl":"https://ask.qcloudimg.com/http-save/yehe-3911980/2e8acafee88c13c2a8a6c3d7fb3b4574.png","sourceType":1,"sourceDetail":{},"channelType":0,"channelDetail":{"source":"wechat","originalTime":"2021-11-29","author":"瓜农老梁","nickName":"瓜农老梁","userName":"gh_01130ae30a83","alias":"","authorName":"梁勇"},"authorId":3911980,"columnId":79399,"writeTime":0,"updateTime":0,"viewCount":324,"likeCount":3,"commentCount":0,"favorCount":0,"weight":0,"status":2,"draftId":0,"tagIds":[],"tags":[],"isCommentEnable":true,"highQuality":false,"skipAds":false,"showAds":false,"focusRead":false,"publishTime":null,"editTime":null,"isCloseTextLink":false,"author":{"id":3911980,"name":"瓜农老梁","label":"","avatar":"https://ask.qcloudimg.com/http-save/yehe-3911980/3j3gigc52g.jpeg","company":"","title":"","isProfessionVerified":false,"isInternal":false},"column":{"id":79399,"name":"瓜农老梁","desc":"","icon":"https://imgcache.qq.com/qcloud/developer/images/release/column-icons/8.png","background":"","status":2,"creatorId":3911980,"memberCount":1,"articleCount":183,"followCount":41,"createdTime":1564712863}},{"id":1590037,"articleId":1590037,"title":"Gitea安装教程/基于宝塔面板的Gitea安装","content":"","plain":"","brief":"","summary":"Gitea经过我测试，不支持1.x版本的git，刚开始我在Centos上面直接使用命令yum -y install git安装后，git版本是1.8.x，然后我...","abstract":"Gitea经过我测试，不支持1.x版本的git，刚开始我在Centos上面直接使用命令yum -y install git安装后，git版本是1.8.x，然后我...","posterSummary":"Gitea经过我测试，不支持1.x版本的git，刚开始我在Centos上面直接使用命令yum -y install git安装后，git版本是1.8.x，然后我就开始安装Gitea，最后报错了。","description":"","picture":"","coverImageUrl":"","sourceType":1,"sourceDetail":{},"channelType":0,"channelDetail":{"source":"nooss","originalTime":"2020-02-23 1:32:00"},"authorId":1052078,"columnId":82854,"writeTime":0,"updateTime":0,"viewCount":3472,"likeCount":4,"commentCount":14,"favorCount":0,"weight":0,"status":2,"draftId":0,"tagIds":[],"tags":[],"isCommentEnable":true,"highQuality":false,"skipAds":false,"showAds":false,"focusRead":false,"publishTime":null,"editTime":null,"isCloseTextLink":false,"author":{"id":1052078,"name":"华创信息技术","label":"","avatar":"https://ask.qcloudimg.com/http-save/yehe-1052078/ks3kkh5gr7.jpeg","company":"潍坊华创信息技术有限公司","title":"","isProfessionVerified":false,"isInternal":false},"column":{"id":82854,"name":"华创信息技术","desc":"http://wiki.nooss.cn","icon":"https://ask.qcloudimg.com/column-icons/82854/1052078/wtri9lkxsh.png","background":"","status":2,"creatorId":1052078,"memberCount":1,"articleCount":123,"followCount":24,"createdTime":1573098154}},{"id":1397916,"articleId":1397916,"title":"基于Unity的AR开发初探：发布AR应用到Android平台","content":"","plain":"","brief":"","summary":"本文接上一篇，介绍一下如何通过Unity发布第一个AR应用至Android平台，在Android手机上使用我们的第一个AR应用。","abstract":"本文接上一篇，介绍一下如何通过Unity发布第一个AR应用至Android平台，在Android手机上使用我们的第一个AR应用。","posterSummary":"","description":"","picture":"","coverImageUrl":"","sourceType":1,"sourceDetail":{},"channelType":0,"channelDetail":{"source":"cnblogs","originalTime":"2019-02-06 11:36"},"authorId":2719971,"columnId":4696,"writeTime":0,"updateTime":0,"viewCount":733,"likeCount":2,"commentCount":0,"favorCount":0,"weight":0,"status":2,"draftId":0,"tagIds":[],"tags":[],"isCommentEnable":true,"highQuality":false,"skipAds":false,"showAds":false,"focusRead":false,"publishTime":null,"editTime":null,"isCloseTextLink":false,"author":{"id":2719971,"name":"Edison Zhou","label":"阿里云MVP，博客园\"推荐博客\"博主，公众号\"EdisonTalk\"作者。","avatar":"https://ask.qcloudimg.com/http-save/yehe-2719971/yyvn9izcbg.jpeg","company":"喜鹊生活","title":"架构师","isProfessionVerified":true,"isInternal":false},"column":{"id":4696,"name":"EdisonTalk","desc":"本专栏主要聚焦.NET Core, 微服务, 云原生, DevOps 及 企业数字化转型等内容，欢迎关注。","icon":"https://ask.qcloudimg.com/http-save/yehe-2719971/15a7at2bvz.jpeg","background":"","status":2,"creatorId":2719971,"memberCount":1,"articleCount":433,"followCount":55,"createdTime":1532961983}},{"id":1033276,"articleId":1033276,"title":"【新手向】为何要这样安装Django？","content":"","plain":"","brief":"","summary":"專 欄\n❈JacobYRJ，做过爬虫，水仙花数，最擅长的领域是数据库和web框架，其中最熟悉的是Django框架。\nGithub博客地址：JacobYRJ.gi...","abstract":"專 欄\n❈JacobYRJ，做过爬虫，水仙花数，最擅长的领域是数据库和web框架，其中最熟悉的是Django框架。\nGithub博客地址：JacobYRJ.gi...","posterSummary":"專 欄\n❈JacobYRJ，做过爬虫，水仙花数，最擅长的领域是数据库和web框架，其中最熟悉的是Django框架。\nGithub博客地址：JacobYRJ.github.io❈—\n为何选择Django？\nDjango作为高级Python Web框架具有强大的快速开发能力，并且简洁，实在，其最大的设计目的就是：帮助开发者更快地将应用从概念变为实体！小编我特别喜欢Django自带的admin管理界面，...","description":"","picture":"https://ask.qcloudimg.com/http-save/yehe-1227999/npf4bxcv78.jpeg","coverImageUrl":"https://ask.qcloudimg.com/http-save/yehe-1227999/npf4bxcv78.jpeg","sourceType":1,"sourceDetail":{},"channelType":0,"channelDetail":{"source":"wechat","originalTime":"2017-02-14","author":"JacobYRJ","nickName":"Python中文社区","userName":"gh_d8489149b735","alias":"python-china","authorName":"JacobYRJ"},"authorId":1227999,"columnId":1987,"writeTime":0,"updateTime":0,"viewCount":609,"likeCount":8,"commentCount":0,"favorCount":0,"weight":0,"status":2,"draftId":0,"tagIds":[],"tags":[],"isCommentEnable":true,"highQuality":false,"skipAds":false,"showAds":false,"focusRead":false,"publishTime":null,"editTime":null,"isCloseTextLink":false,"author":{"id":1227999,"name":"Python中文社区","label":"全球Python中文开发者的精神部落。文章首发在公众号：Python中文社区，欢迎关注！","avatar":"https://ask.qcloudimg.com/avatar/1227999/maw5mw6294.jpg","company":"","title":"","isProfessionVerified":false,"isInternal":false},"column":{"id":1987,"name":"Python中文社区","desc":"","icon":"https://ask.qcloudimg.com/column-icons/1987/1227999/xgyhexwxm2.jpg","background":"https://imgcache.qq.com/qcloud/developer/images/release/column-bgs/1.svg","status":2,"creatorId":1227999,"memberCount":1,"articleCount":337,"followCount":173,"createdTime":1516677453}},{"id":1400610,"articleId":1400610,"title":"会了也要看的flink安装部署|适合阅读","content":"","plain":"","brief":"","summary":"Flink支持运行与所有的类linux环境，比如linux，mac os x 和cygwin(windows)，要求一个master节点，一个或者多个worke...","abstract":"Flink支持运行与所有的类linux环境，比如linux，mac os x 和cygwin(windows)，要求一个master节点，一个或者多个worke...","posterSummary":"Flink支持运行与所有的类linux环境，比如linux，mac os x 和cygwin(windows)，要求一个master节点，一个或者多个worker节点。再部署启动flink集群之前，要准备一下环境，对每个节点的环境要求是：","description":"","picture":"https://ask.qcloudimg.com/http-save/yehe-1088682/atzdxg9o99.jpeg","coverImageUrl":"https://ask.qcloudimg.com/http-save/yehe-1088682/atzdxg9o99.jpeg","sourceType":1,"sourceDetail":{},"channelType":0,"channelDetail":{"source":"wechat","originalTime":"2019-02-16","author":"浪院长","nickName":"Spark学习技巧","userName":"gh_70023c9d0c9e","alias":"bigdatatip"},"authorId":1088682,"columnId":1994,"writeTime":0,"updateTime":0,"viewCount":1184,"likeCount":2,"commentCount":0,"favorCount":0,"weight":0,"status":2,"draftId":0,"tagIds":[],"tags":[],"isCommentEnable":true,"highQuality":false,"skipAds":false,"showAds":false,"focusRead":false,"publishTime":null,"editTime":null,"isCloseTextLink":false,"author":{"id":1088682,"name":"Spark学习技巧","label":"公司CTO","avatar":"https://ask.qcloudimg.com/avatar/1088682/perwxxz68n.png","company":"环数科技有限公司","title":"数据库开发工程师","isProfessionVerified":true,"isInternal":false},"column":{"id":1994,"name":"Spark学习技巧","desc":"本公众号主要分享Spark使用及源码，spark 机器学习，图计算，同时会涉及到hadoop家族。","icon":"https://imgcache.qq.com/qcloud/developer/images/release/column-icons/18.png","background":"","status":2,"creatorId":1088682,"memberCount":1,"articleCount":762,"followCount":237,"createdTime":1516694781}},{"id":2141798,"articleId":2141798,"title":"Linux下mc服务器自动化管理的两个实现思路","content":"","plain":"","brief":"","summary":"此方法需要具备基础shell知识，且需要全手动编写，较为复杂，推荐有linux使用基础者使用，教程可移步b站大佬的专栏，极为详细。","abstract":"此方法需要具备基础shell知识，且需要全手动编写，较为复杂，推荐有linux使用基础者使用，教程可移步b站大佬的专栏，极为详细。","posterSummary":"","description":"","picture":"https://ask.qcloudimg.com/http-save/yehe-8222933/3e9c73891fe83b0fcc576ed930c5a893.png","coverImageUrl":"https://ask.qcloudimg.com/http-save/yehe-8222933/3e9c73891fe83b0fcc576ed930c5a893.png","sourceType":1,"sourceDetail":{},"channelType":0,"channelDetail":{"source":"lonelyenderman","originalTime":"2022-3-11 23:30"},"authorId":8222933,"columnId":96557,"writeTime":0,"updateTime":0,"viewCount":105,"likeCount":2,"commentCount":0,"favorCount":0,"weight":0,"status":2,"draftId":0,"tagIds":[],"tags":[],"isCommentEnable":true,"highQuality":false,"skipAds":false,"showAds":false,"focusRead":false,"publishTime":null,"editTime":null,"isCloseTextLink":false,"author":{"id":8222933,"name":"LonelyEnderman","label":"","avatar":"https://developer.qcloudimg.com/http-save/10011/af4a70381cbc4bcb9945502f4c238d8b.jpg","company":"","title":"","isProfessionVerified":false,"isInternal":false},"column":{"id":96557,"name":"小小黑的游戏开发之路","desc":"","icon":"https://developer.qcloudimg.com/http-save/yehe-8222933/ec4ddfc2f61614b13899d47af1e97203.jpg","background":"","status":2,"creatorId":8222933,"memberCount":1,"articleCount":23,"followCount":13,"createdTime":1660564422}},{"id":1696689,"articleId":1696689,"title":"Kubernetes之helm部署使用","content":"","plain":"","brief":"","summary":"是一个部署在Kubernetes集群内部的 server，其与 Helm client、Kubernetes API server 进行交互","abstract":"是一个部署在Kubernetes集群内部的 server，其与 Helm client、Kubernetes API server 进行交互","posterSummary":"","description":"","picture":"","coverImageUrl":"","sourceType":1,"sourceDetail":{},"channelType":0,"channelDetail":{},"authorId":5954574,"columnId":87421,"writeTime":0,"updateTime":0,"viewCount":1492,"likeCount":5,"commentCount":0,"favorCount":0,"weight":0,"status":2,"draftId":0,"tagIds":[],"tags":[],"isCommentEnable":true,"highQuality":false,"skipAds":false,"showAds":false,"focusRead":false,"publishTime":null,"editTime":null,"isCloseTextLink":false,"author":{"id":5954574,"name":"聂伟星","label":"主要从事公有云运维工作","avatar":"https://ask.qcloudimg.com/http-save/yehe-5954574/tiyzxdudvz.jpeg","company":"腾云悦智","title":"公有云运维","isProfessionVerified":true,"isInternal":true},"column":{"id":87421,"name":"腾讯云容器运维","desc":"个人博客: https://www.niewx.cn","icon":"https://imgcache.qq.com/qcloud/developer/images/release/column-icons/16.png","background":"https://imgcache.qq.com/qcloud/developer/images/release/column-bgs/5.svg","status":2,"creatorId":5954574,"memberCount":1,"articleCount":105,"followCount":42,"createdTime":1591003309}},{"id":1359628,"articleId":1359628,"title":"如何使用Helm软件包管理器在Kubernetes集群上安装软件","content":"","plain":"","brief":"","summary":"Helm是Kubernetes的软件包管理器，允许开发人员和操作员更轻松地在Kubernetes集群上配置和部署应用程序。","abstract":"Helm是Kubernetes的软件包管理器，允许开发人员和操作员更轻松地在Kubernetes集群上配置和部署应用程序。","posterSummary":"","description":"","picture":"","coverImageUrl":"","sourceType":1,"sourceDetail":{},"channelType":0,"channelDetail":{},"authorId":1221461,"columnId":1417,"writeTime":0,"updateTime":0,"viewCount":976,"likeCount":2,"commentCount":0,"favorCount":0,"weight":0,"status":2,"draftId":0,"tagIds":[],"tags":[],"isCommentEnable":true,"highQuality":false,"skipAds":false,"showAds":false,"focusRead":false,"publishTime":null,"editTime":null,"isCloseTextLink":false,"author":{"id":1221461,"name":"姚啊姚","label":"","avatar":"https://ask.qcloudimg.com/avatar/1221461/vsq9cks58w.png","company":"","title":"","isProfessionVerified":false,"isInternal":false},"column":{"id":1417,"name":"云计算教程系列","desc":"聚焦云计算知识交流与分享","icon":"https://imgcache.qq.com/qcloud/developer/images/release/column-icons/20.png","background":"https://imgcache.qq.com/qcloud/developer/images/release/column-bgs/1.svg","status":2,"creatorId":1002467,"memberCount":67,"articleCount":730,"followCount":556,"createdTime":1503305969}},{"id":1450258,"articleId":1450258,"title":"Kubernetes 基础概述","content":"","plain":"","brief":"","summary":"本互动教程介绍了Kubernetes群集编排系统的基础知识。每个模块都包含Kubernetes的主要功能、概念的一些背景介绍。使用本教程，你可以了解：","abstract":"本互动教程介绍了Kubernetes群集编排系统的基础知识。每个模块都包含Kubernetes的主要功能、概念的一些背景介绍。使用本教程，你可以了解：","posterSummary":"","description":"","picture":"https://ask.qcloudimg.com/http-save/yehe-2309443/wsd95nkdfz.jpeg","coverImageUrl":"https://ask.qcloudimg.com/http-save/yehe-2309443/wsd95nkdfz.jpeg","sourceType":1,"sourceDetail":{},"channelType":0,"channelDetail":{"source":"wechat","originalTime":"2019-03-17","author":"kubernetes中文社区","nickName":"kubernetes中文社区","userName":"gh_1a0fe85c30d9","alias":"DailyDev","authorName":"kubernetes"},"authorId":2309443,"columnId":78017,"writeTime":0,"updateTime":0,"viewCount":357,"likeCount":5,"commentCount":0,"favorCount":0,"weight":0,"status":2,"draftId":0,"tagIds":[],"tags":[],"isCommentEnable":true,"highQuality":false,"skipAds":false,"showAds":false,"focusRead":false,"publishTime":null,"editTime":null,"isCloseTextLink":false,"author":{"id":2309443,"name":"kubernetes中文社区","label":"一个混迹于魔都的运维工程师，公众号：kubernetes中文社区","avatar":"https://ask.qcloudimg.com/custom-avatar/2309443/q6yvlloln4.jpg","company":"","title":"运维工程师","isProfessionVerified":false,"isInternal":false},"column":{"id":78017,"name":"kubernetes中文社区","desc":"微信公众号：kubernetes中文社区","icon":"https://ask.qcloudimg.com/column-icons/78017/2309443/ijd00mqg93.jpg","background":"https://imgcache.qq.com/qcloud/developer/images/release/column-bgs/1.svg","status":2,"creatorId":2309443,"memberCount":1,"articleCount":165,"followCount":61,"createdTime":1561104978}},{"id":1549950,"articleId":1549950,"title":"动手使用Linkerd 2.0","content":"","plain":"","brief":"","summary":"Linkerd 2.0最近宣布一般可用（GA），表明它已经准备好用于生产。在本教程中，我们将向你介绍如何在你的Kubernetes集群上启动和运行Linkerd...","abstract":"Linkerd 2.0最近宣布一般可用（GA），表明它已经准备好用于生产。在本教程中，我们将向你介绍如何在你的Kubernetes集群上启动和运行Linkerd...","posterSummary":"Linkerd 2.0最近宣布一般可用（GA），表明它已经准备好用于生产。在本教程中，我们将向你介绍如何在你的Kubernetes集群上启动和运行Linkerd 2.0。","description":"","picture":"","coverImageUrl":"","sourceType":1,"sourceDetail":{},"channelType":0,"channelDetail":{"source":"wechat","originalTime":"2018-09-20","author":"CNCF","nickName":"CNCF","userName":"gh_6401cfaf222b","alias":"lf_cncf","authorName":"CNCF官微"},"authorId":6781541,"columnId":83441,"writeTime":0,"updateTime":0,"viewCount":462,"likeCount":2,"commentCount":0,"favorCount":0,"weight":0,"status":2,"draftId":0,"tagIds":[],"tags":[],"isCommentEnable":true,"highQuality":false,"skipAds":false,"showAds":false,"focusRead":false,"publishTime":null,"editTime":null,"isCloseTextLink":false,"author":{"id":6781541,"name":"CNCF","label":"","avatar":"https://ask.qcloudimg.com/random-avatar/6781541/wv9pzsfejr.png","company":"","title":"","isProfessionVerified":false,"isInternal":false},"column":{"id":83441,"name":"CNCF","desc":"","icon":"https://imgcache.qq.com/qcloud/developer/images/release/column-icons/1.png","background":"","status":2,"creatorId":6781541,"memberCount":1,"articleCount":1063,"followCount":97,"createdTime":1574914737}},{"id":1742960,"articleId":1742960,"title":"Docker（2）- Centos 7.x 下安装 Docker","content":"","plain":"","brief":"","summary":"https://www.cnblogs.com/poloyy/category/1870863.html","abstract":"https://www.cnblogs.com/poloyy/category/1870863.html","posterSummary":"","description":"","picture":"https://ask.qcloudimg.com/http-save/yehe-7440717/fk5gfv56av.png","coverImageUrl":"https://ask.qcloudimg.com/http-save/yehe-7440717/fk5gfv56av.png","sourceType":1,"sourceDetail":{},"channelType":0,"channelDetail":{"source":"cnblogs","originalTime":"2020-11-03 17:24"},"authorId":7440717,"columnId":87559,"writeTime":0,"updateTime":0,"viewCount":296,"likeCount":3,"commentCount":0,"favorCount":0,"weight":0,"status":2,"draftId":0,"tagIds":[],"tags":[],"isCommentEnable":true,"highQuality":false,"skipAds":false,"showAds":false,"focusRead":false,"publishTime":null,"editTime":null,"isCloseTextLink":false,"author":{"id":7440717,"name":"小菠萝测试笔记","label":"个人博客：https://www.cnblogs.com/poloyy","avatar":"https://ask.qcloudimg.com/http-save/yehe-7440717/o5gpqsdhfd.jpeg","company":"软件测试","title":"","isProfessionVerified":false,"isInternal":false},"column":{"id":87559,"name":"自动化、性能测试","desc":"专注于自动化、性能、安全测试的讲解，涉及Java、Js、前端、Python语言；以及还有各类测试工具的使用","icon":"https://ask.qcloudimg.com/http-save/yehe-7440717/bgpsn7qyno.png","background":"","status":2,"creatorId":7440717,"memberCount":1,"articleCount":919,"followCount":131,"createdTime":1591607474}}],"anchorToCommentsArea":false,"isFromOriginalSharing":false,"isCampusAmabassdor":false,"relatedInventoryData":{"list":[],"total":0},"myInventoryData":{"fetchStatus":"loaded","pageNumber":2,"pageSize":20,"done":false},"hasColumnArticleRecommendRight":false,"hasColumnArticleDeletedRight":false,"isFollowing":false,"moduleStoredKeyMap":{"mod-article-handpicked-special-topic":"COLUMN_article_handpicked_special_topic","mod-article-handpicked-activity":"COLUMN_article_handpicked_activity"},"moduleDataMap":{"mod-article-handpicked-special-topic":[{"id":"pRQeBt-T8","url":"https://cloud.tencent.com/developer/special/TencentCloudNative","title":"腾讯云原生专题","subTitle":"云原生技术干货，业务实践落地。","coverImageUrl":"https://ask.qcloudimg.com/raw/yehe-1b54603d7b98/k8pfdhqi7p.jpg"}],"mod-article-handpicked-activity":[{"id":"_2oAP_Fw6","url":"https://cloud.tencent.com/developer/article/2210043","title":"社区创作者年终回顾","subTitle":"参与活动，赢取限量周边礼品","btnText":"立即参加","coverImageUrl":"https://ask.qcloudimg.com/raw/yehe-1b54603d7b98/l7paq6x0qv.jpg"},{"id":"es8bcjiiD","url":"https://cloud.tencent.com/developer/support-plan-invitation","title":"邀请好友加入自媒体分享计划","subTitle":"邀请好友，同享奖励 30 / 100 / 180 元云服务器代金券","btnText":"立即邀请","coverImageUrl":"https://ask.qcloudimg.com/raw/yehe-1b54603d7b98/8rzvh0nm9n.jpg"}]},"developerSpreadBanner":{"id":343,"imageUrl":"https://ask.qcloudimg.com/raw/yehe-b3360f6a89f75/w1dedj1rgs.jpg","mImgUrl":"https://ask.qcloudimg.com/raw/yehe-b3360f6a89f75/ro6s1481g7.jpg","title":"移动开发平台即将公测上线","desc":"移动开发平台帮您解决以下后顾之忧，修个Bug发版本时间太长、应用测试覆盖不全机型、业务增长缺少各种数据...","buttonText":"立即抢购","spreadUrl":"https://cloud.tencent.com/product/tmf?from=19500"},"env":"production","documentBaseTitle":"腾讯云开发者社区-腾讯云","cdnDomain":"cloudcache.tencent-cloud.cn","cssDomain":"cloudcache.tencent-cloud.cn","qcloudDomain":"cloud.tencent.com","consoleDomain":"console.cloud.tencent.com","session":{"isLogined":false,"isQcloudUser":false,"isOwner":false,"nickname":"","accountInfoCompleted":false,"phoneCompleted":false,"profile":{},"contactPhoneCompleted":false,"userInfo":{}},"fromMiniProgram":false,"route":{"url":"/developer/article/2197170","path":"/developer/article/2197170","pathname":"/developer/article/2197170","search":null,"query":{},"segments":["developer","article","2197170"]}});
</script><script>
					if (!Element.prototype.matches)
	Element.prototype.matches = Element.prototype.msMatchesSelector ||
															Element.prototype.webkitMatchesSelector;
	if (!Element.prototype.closest)
		Element.prototype.closest = function(s) {
				var el = this;
				if (!document.documentElement.contains(el)) return null;
				do {
						if (el.matches(s)) return el;
						el = el.parentElement;
				} while (el !== null);
				return null;
		};
					 window.addEventListener('mouseover', function(evt) {
    const target = evt.target;
    if (!target) {
      return;
    }
    const aEle = target.closest('a');
    if (!aEle) {
      return;
    }
    let href = aEle.getAttribute('href');
    if (!href) {
      return;
    }
    href = href.replace(/cloud.tencent.com.cn|cloud.tencent.com|cloud.tencent.cn/g, 'cloud.tencent.com');
    aEle.setAttribute('href', href);
  }, true);
  
					</script></body></html>