# 扩散模型基本介绍

## 1. 扩散模型

Stable Diffusion 属于一种深度学习模型类别，称为扩散模型。这类模型属于生成模型，旨在生成与训练数据类似的新数据。在 Stable Diffusion 的案例中，生成的数据是图像。

### 1.1 正向扩散

正向扩散过程将图像逐渐转换为噪声。  
正向扩散过程会向训练图像中添加噪声，逐渐将其变成一个无特征的噪声图像。无论初始图像是猫还是狗，经过正向扩散后，它们都会变成噪声图像，最终你无法分辨这些图像最初是猫还是狗。（这点非常重要）

### 1.2 反向扩散

现在到激动人心的部分了。假设我们能反转这个扩散过程呢？

反向扩散过程恢复了图像。
从一个无意义的噪声图像开始，反向扩散可以恢复出猫或狗的图像。这就是主要的思想。

从技术上讲，每个扩散过程都有两个部分：

- （1）漂移

- （2）随机运动

反向扩散过程中的漂移会朝向猫或狗的图像，而不会在两者之间徘徊。这就是为什么最终的结果要么是猫，要么是狗，而不会是介于两者之间的其他物体。

## 2. 训练过程

反向扩散的概念无疑是聪明且优雅的。但关键问题是，“我们如何实现它？”

为了反转扩散过程，我们需要知道图像中添加了多少噪声。答案在于训练一个神经网络模型来预测添加的噪声。在 Stable Diffusion 中，这个模型被称为“噪声预测器”（noise predictor），它是一个 U-Net 模型。其训练过程如下：

1. 选择一张训练图像，比如一张猫的照片。
2. 生成一张随机噪声图像。
3. 通过在训练图像中添加这个噪声图像进行破坏，过程持续一定的步数。
4. 训练噪声预测器，教它判断添加了多少噪声。这个过程通过调整模型的权重并向其展示正确答案来实现。

在每一步中会依次添加噪声。噪声预测器估计在每一步中累计添加的噪声量。

### 2.1 反向扩散

经过训练后，我们得到了一个能够估计图像中添加噪声量的噪声预测器。那么我们该如何使用它呢？

首先，我们生成一张完全随机的图像，然后让噪声预测器告诉我们图像中包含的噪声。接着，我们从原始图像中减去这个估计的噪声。重复这个过程几次后，你将得到一张猫或狗的图像。

反向扩散的工作原理是逐步从图像中减去预测的噪声。

你可能注意到，我们无法控制生成的是猫的图像还是狗的图像。我们将在讨论条件生成（conditioning）时解决这个问题。目前，图像生成是无条件的。



## 疑问

LDM > Stable Disffusion

DiT 扩散 Transformers 模型  > SORA

交叉注意力机制实现将conditioning嵌入unet中？

扩散模型  > unet > ViT

## 参考资料

- 原文

https://stable-diffusion-art.com/how-stable-diffusion-work
