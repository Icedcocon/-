# 在CentOS7.7上安装 VMware 安装

- 问题1
  
  - 现象：VMWare workstation 16.2.4 Pro 在外网33节点的centos上运行提示缺少必要modules
  
  - 方案：安装VMWare workstation 15.5.7 Pro

- 问题2
  
  - 现象：RedHat官网找不到镜像下载入口，注册个人账户和企业账户均不允许下载系统镜像
  
  - 方案：找大佬要链接进入官网下载入口

- 问题3
  
  - 断网方法
  
  - 禁掉宿主机的nameserver

- 问题4
  
  - yum install --downloadonly --dir

- 问题5
  
  - 第二步的域名
  
  - 只使用cluster manager的域名

- 问题6
  
  - 下次密码用弱密码

- 问题7
  
  - 不同操作系统的软件版本号可能命名规则不同
  
  - yum -y --downloadoonly --downloaddir="pathname" install docker 下载最新版试试

- 问题8
  
  - 记录需要修改的包
    
    - ./rpm/ntp
    
    - ./3rd/bind-dns/rpm
    
    - ./rpm/docker

- 问题9
  
  - 现象：没有这个文件或目录
  
  - bind没装上

- 问题10
  
  - 现象：docker.service启动不起来
  
  - 故障点：
    
    - /usr/lib/systemd/system/docker.service中的`-H tcp://0.0.0.0:2375-current`选项（默认没有该项配置）
    
    - /etc/docker/daemon.json中的`"default-runtime":"runc"`（默认是空的）
  
  - 原因及方法
  
  - ![](D:\Cache\MarkText\2022-08-23-16-02-33-image.png)
  
  - 将shell/ais.install中的`dockerd`改为`dockerd-current`
  
  - 将config/daemon.json.cpu和config/daemon.json.gpu中的文件修改
  
  - 

- 问题11 
  
  - 现象：NVIDIA docker安装失败
  
  - 解决 添加repo下载docker-ce 、docker-compose
    
    ```bash
    yum install -y yum-rhn-plugin
    yum install -y yum-utils
    
    # ===================== 下载docker-ce        =================
    mv rpm/docker rpm/docker.bak2
    yum-config-manager --add-repo=https://download.docker.com/linux/centos/docker-ce.repo
    
    sed -ri 's/\$releasever/7/g' /etc/yum.repos.d/docker-ce.repo
    
    yum install -y https://download.docker.com/linux/centos/7/x86_64/stable/Packages/containerd.io-1.4.3-3.1.el7.x86_64.rpm
    yum install docker-ce -y
    
    # ====================== 下载 docker-compose  ================
    #mkdir /root/aisha-install-v2.2.bak/rpm/docker-compose
    #mkdir /root/aisha-install-v2.2.bak/docker-compose/docker-compose
    #curl -L "https://github.com/docker/compose/releases/download/1.27.4/docker-compose-$(uname -s)-$(uname -m)" -o /root/aisha-install-v2.2.bakin/docker-compose/
    #chmod +x /root/aisha-install-v2.2.bakin/docker-compose/docker-compose
    #ln -s /root/aisha-install-v2.2.bakin/docker-compose/docker-compose /usr/bin/docker-compose
    
    # ====================== 下载 nvidia-docker2  =================
    distribution=$(. /etc/os-release;echo $ID$VERSION_ID) \
       && curl -s -L https://nvidia.github.io/libnvidia-container/$distribution/libnvidia-container.repo | sudo tee /etc/yum.repos.d/nvidia-container-toolkit.repo
    
    yum-config-manager --enable libnvidia-container-experimental
    
    yum clean expire-cache
    yum install -y nvidia-docker2
    
    mv rpm/nvidia-docker rpm/nvidia-docker.bak
    yum install -y nvidia-docker2
    ```

只在 rpm/nvidia-docker 存在：libnvidia-container1-1.11.0-0.1.rc.2.x86_64.rpm
只在 rpm/nvidia-docker 存在：libnvidia-container-tools-1.11.0-0.1.rc.2.x86_64.rpm
只在 rpm/nvidia-docker 存在：nvidia-container-toolkit-1.11.0-0.1.rc.2.x86_64.rpm
只在 rpm/nvidia-docker 存在：nvidia-docker2-2.11.0-1.noarch.rpm

- 问题12
  
  - 现象：缺deliver-image文件
  
  ![](D:\Cache\MarkText\2022-08-24-16-57-07-b8e01067527952bb74cfce36f32de89.jpg)
  
  - 原因：太大没添加

- 问题13
  
  - 现象：缺少docker-compose.yml
  
  ![](D:\Cache\MarkText\2022-08-24-16-57-55-3035ac1cbe26963e3c9ee448c9b40ae.jpg)
  
  - 原因：脚本被设计为单个step可重复单独执行，该文件在setp 5 后会存在，因为重装docker后需要重启harbor。

- 问题14
  
  - 现象：hadoop没启动
  
  ![](D:\Cache\MarkText\2022-08-24-17-30-26-image.png)
  
  ![](D:\Cache\MarkText\2022-08-24-17-29-39-image.png)
  
  - 方案：再跑一遍，正常应该是inactivate(dead)

运行命令

```bash
 bash -x ais.sh root k8s 172.16.72.128 1; \
 bash -x ais.sh root test.cluster43 172.16.72.128 2; \
 bash -x ais.sh root k8s 172.16.72.128 3; \
 bash -x ais.sh root k8s 172.16.72.128 4;
```
